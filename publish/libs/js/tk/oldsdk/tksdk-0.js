var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,k,g){f!=Array.prototype&&f!=Object.prototype&&(f[k]=g.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var f=0;return function(k){return $jscomp.SYMBOL_PREFIX+(k||"")+f++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var k=0;return $jscomp.iteratorPrototype(function(){return k<f.length?{done:!1,value:f[k++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,k){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var g=0,d={next:function(){if(g<f.length){var a=g++;return{value:k(a,f[a]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(f,k,g,d){if(k){g=$jscomp.global;f=f.split(".");for(d=0;d<f.length-1;d++){var a=f[d];a in g||(g[a]={});g=g[a]}f=f[f.length-1];d=g[f];k=k(d);k!=d&&null!=k&&$jscomp.defineProperty(g,f,{configurable:!0,writable:!0,value:k})}};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f){return f})}},"es6","es3");
$jscomp.findInternal=function(f,k,g){f instanceof String&&(f=String(f));for(var d=f.length,a=0;a<d;a++){var b=f[a];if(k.call(g,b,a,f))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,g){return $jscomp.findInternal(this,f,g).v}},"es6","es3");$jscomp.owns=function(f,k){return Object.prototype.hasOwnProperty.call(f,k)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(f,k){for(var g=1;g<arguments.length;g++){var d=arguments[g];if(d)for(var a in d)$jscomp.owns(d,a)&&(f[a]=d[a])}return f};$jscomp.polyfill("Object.assign",function(f){return f||$jscomp.assign},"es6","es3");$jscomp.makeIterator=function(f){$jscomp.initSymbolIterator();var k=f[Symbol.iterator];return k?k.call(f):$jscomp.arrayIterator(f)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(f){function k(){this.batch_=null}function g(b){return b instanceof a?b:new a(function(a,c){a(b)})}if(f&&!$jscomp.FORCE_POLYFILL_PROMISE)return f;k.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};k.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;k.prototype.asyncExecuteFunction=function(a){d(a,
0)};k.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var m=a[b];a[b]=null;try{m()}catch(u){this.asyncThrow_(u)}}}this.batch_=null};k.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var a=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}};a.prototype.createResolveAndReject_=
function(){function a(a){return function(c){m||(m=!0,a.call(b,c))}}var b=this,m=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var c=null!=b;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};a.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(m){this.reject_(m);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};a.prototype.reject_=function(a){this.settle_(2,a)};a.prototype.fulfill_=function(a){this.settle_(1,a)};a.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)b.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var b=new k;a.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};a.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(u){c.reject(u)}};a.prototype.then=function(b,e){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(v){g(v)}}:
b}var d,g,n=new a(function(a,b){d=a;g=b});this.callWhenSettled_(c(b,d),c(e,g));return n};a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.callWhenSettled_=function(a,e){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:e(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?b.asyncExecute(c):this.onSettledCallbacks_.push(c)};a.resolve=g;a.reject=function(b){return new a(function(a,c){c(b)})};a.race=function(b){return new a(function(a,
c){for(var e=$jscomp.makeIterator(b),m=e.next();!m.done;m=e.next())g(m.value).callWhenSettled_(a,c)})};a.all=function(b){var c=$jscomp.makeIterator(b),m=c.next();return m.done?g([]):new a(function(a,b){function e(b){return function(c){d[b]=c;h--;0==h&&a(d)}}var d=[],h=0;do d.push(void 0),h++,g(m.value).callWhenSettled_(e(d.length-1),b),m=c.next();while(!m.done)})};return a},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var f={},k=Object.create(new $jscomp.global.Proxy(f,{get:function(g,d,a){return g==f&&"q"==d&&a==k}}));return!0===k.q}catch(g){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill("WeakMap",function(f){function k(){if(!f||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),c=new f([[a,2],[b,3]]);if(2!=c.get(a)||3!=c.get(b))return!1;c.delete(a);c.set(b,4);return!c.has(a)&&4==c.get(b)}catch(r){return!1}}function g(b){$jscomp.owns(b,a)||$jscomp.defineProperty(b,a,{value:{}})}function d(a){var b=Object[a];b&&(Object[a]=function(a){g(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(f&&$jscomp.ES6_CONFORMANCE)return f}else if(k())return f;
var a="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var b=0,c=function(a){this.id_=(b+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};c.prototype.set=function(b,c){g(b);if(!$jscomp.owns(b,a))throw Error("WeakMap key fail: "+b);b[a][this.id_]=c;return this};c.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:void 0};c.prototype.has=
function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};c.prototype.delete=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)?delete b[a][this.id_]:!1};return c},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(f){function k(){if($jscomp.ASSUME_NO_NATIVE_MAP||!f||"function"!=typeof f||!f.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),b=new f($jscomp.makeIterator([[a,"s"]]));if("s"!=b.get(a)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var c=b.entries(),e=c.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=c.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!c.next().done?!1:!0}catch(x){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(f&&$jscomp.ES6_CONFORMANCE)return f}else if(k())return f;$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=new WeakMap,d=function(a){this.data_={};this.head_=c();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(b,c){b=0===b?0:b;var e=a(this,b);e.list||(e.list=this.data_[e.id]=[]);e.entry?e.entry.value=c:(e.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:b,value:c},e.list.push(e.entry),this.head_.previous.next=e.entry,this.head_.previous=e.entry,this.size++);return this};d.prototype.delete=function(b){b=a(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=c();this.size=0};d.prototype.has=function(b){return!!a(this,b).entry};
d.prototype.get=function(b){return(b=a(this,b).entry)&&b.value};d.prototype.entries=function(){return b(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return b(this,function(a){return a.key})};d.prototype.values=function(){return b(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),e;!(e=c.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var a=function(a,b){var c=b&&typeof b;"object"==
c||"function"==c?g.has(b)?c=g.get(b):(c=""+ ++e,g.set(b,c)):c="p_"+b;var d=a.data_[c];if(d&&$jscomp.owns(a.data_,c))for(a=0;a<d.length;a++){var m=d[a];if(b!==b&&m.key!==m.key||b===m.key)return{id:c,list:d,index:a,entry:m}}return{id:c,list:d,index:-1,entry:void 0}},b=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},c=function(){var a={};return a.previous=
a.next=a.head=a},e=0;return d},"es6","es3");$jscomp.checkStringArgs=function(f,k,g){if(null==f)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return f+""};
$jscomp.polyfill("String.prototype.endsWith",function(f){return f?f:function(f,g){var d=$jscomp.checkStringArgs(this,f,"endsWith");f+="";void 0===g&&(g=d.length);g=Math.max(0,Math.min(g|0,d.length));for(var a=f.length;0<a&&0<g;)if(d[--g]!=f[--a])return!1;return 0>=a}},"es6","es3");$jscomp.polyfill("Object.values",function(f){return f?f:function(f){var g=[],d;for(d in f)$jscomp.owns(f,d)&&g.push(f[d]);return g}},"es8","es3");
$jscomp.polyfill("Array.from",function(f){return f?f:function(f,g,d){$jscomp.initSymbolIterator();g=null!=g?g:function(a){return a};var a=[],b=f[Symbol.iterator];if("function"==typeof b){f=b.call(f);for(var c=0;!(b=f.next()).done;)a.push(g.call(d,b.value,c++))}else for(b=f.length,c=0;c<b;c++)a.push(g.call(d,f[c],c));return a}},"es6","es3");window.TK=window.TK||{};window.L=window.L||{};
(function(){window.TK_ERR={DEVICE_ERROR_UnknownError:2501,DEVICE_ERROR_NotFoundError:2502,DEVICE_ERROR_NotAllowedError:2503,DEVICE_ERROR_NotReadableError:2504,DEVICE_ERROR_OverconstrainedError:2505,DEVICE_ERROR_TypeError:2506,ROOM_JOIN_FAILED:2507,ROOM_NOT_CONNECT:2508,CHECK_USERDesktopMediaError:2509,Server_Exception:2510}})();window.L=window.L||{};window.TK=window.TK||{};TK.LOG_DEBUG=0;TK.LOG_TRACE=1;TK.LOG_INFO=2;TK.LOG_WARNING=3;TK.LOG_ERROR=4;TK.LOG_NONE=5;
L.Logger=function(f){var k,g="",d=!1,a=!1;(new Date).getTime();var b=function(b,e){try{var c=new Logline("[tk-sdk]");switch(e){case f.Logger.DEBUG:a?c.warn.apply(c,b):c.debug.apply(c,b);break;case f.Logger.TRACE:c.trace.apply(c,b);break;case f.Logger.INFO:a?c.warn.apply(c,b):c.info.apply(c,b);break;case f.Logger.WARNING:c.warn.apply(c,b);break;case f.Logger.ERROR:c.error.apply(c,b);break;case f.Logger.NONE:c.warn("log level is none!");break;default:a?c.warn.apply(c,b):c.log.apply(c,b)}}catch(u){console.log.apply(console,
b)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(b){a=b},enableLogPanel:function(){f.Logger.panel=document.createElement("textarea");f.Logger.panel.setAttribute("id","licode-logs");f.Logger.panel.setAttribute("style","position:fixed;left:0;top:0;width: 100%; height: 100%; display: none;z-index:9999;  user-select: text ;-webkit-user-select: text; -moz-user-select: text ; -ms-user-select: text ;");f.Logger.panel.setAttribute("rows","20");f.Logger.panel.setAttribute("cols",
"20");f.Logger.panel.setAttribute("readOnly",!0);var a=document.createElement("button");a.innerHTML="open log";a.setAttribute("style","position:fixed;left:0;top:0;z-index:10000;background:gold;");a.onclick=function(){"open log"===a.innerHTML?(f.Logger.panel.style.display="block",a.innerHTML="close log"):(f.Logger.panel.style.display="none",a.innerHTML="open log")};document.body.appendChild(a);document.body.appendChild(f.Logger.panel)},setLogLevel:function(a){a>f.Logger.NONE?a=f.Logger.NONE:a<f.Logger.DEBUG&&
(a=f.Logger.DEBUG);f.Logger.logLevel=a},setOutputFunction:function(a){b=a},registerLogListener:function(a){k=a},setLogPrefix:function(a){g=a},setIsFormatLog:function(a){d=a},print:function(a){var c=g;if(!(a<f.Logger.logLevel)){a===f.Logger.DEBUG?c=c+"DEBUG("+(new Date).toLocaleString()+")":a===f.Logger.TRACE?c=c+"TRACE("+(new Date).toLocaleString()+")":a===f.Logger.INFO?c=c+"INFO("+(new Date).toLocaleString()+")":a===f.Logger.WARNING?c=c+"WARNING("+(new Date).toLocaleString()+")":a===f.Logger.ERROR&&
(c=c+"ERROR("+(new Date).toLocaleString()+")");c+=":";for(var m=[],u=0;u<arguments.length;u++)m[u]=arguments[u];m=m.slice(1);m=[c].concat(m);c="";if(void 0!==f.Logger.panel||d){u=0;for(var r=m.length;u<r;u++){var n="string"===typeof m[u]?m[u]:Array.isArray(m[u])?"["+m[u].join(",")+"]":"object"===typeof m[u]?f.Utils.toJsonStringify(m[u]):m[u];c=c+n+" "}}void 0!==f.Logger.panel&&(f.Logger.panel.value=f.Logger.panel.value+"\n"+c);b.apply(f.Logger,[d&&c?[c]:m,a]);"function"===typeof k&&k(d&&c?[c]:m,a)}},
debug:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];f.Logger.print.apply(f.Logger,[f.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];f.Logger.print.apply(f.Logger,[f.Logger.TRACE].concat(a))},info:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];f.Logger.print.apply(f.Logger,[f.Logger.INFO].concat(a))},warning:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];f.Logger.print.apply(f.Logger,
[f.Logger.WARNING].concat(a))},error:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];f.Logger.print.apply(f.Logger,[f.Logger.ERROR].concat(a))},getAllLog:function(a,b,d){function c(a,b){switch(a){case "4":b=b.filter(function(a,b){return"3"!=a.level});break;case "5":b=b.filter(function(a,b){return"3"!=a.level&&"4"!=a.level});break;case "6":b=b.filter(function(a,b){return"3"!=a.level&&"4"!=a.level&&"5"!=a.level})}return b}Logline.all(function(e){e?f.Utils.isFunction(b)&&b(c(a,e)):
f.Utils.isFunction(d)&&d()})},keep:function(a){Logline.keep(a)}}}(L);
TK.tkLogPrintConfig=function(f,k,g){k=k||{};f=f||{};g=g||{};var d=void 0!=k.logLevel?k.logLevel:0;f=void 0!=f.debug?f.debug:!0;g=void 0!=g.webrtcLogDebug?g.webrtcLogDebug:!0;L.Logger.setLogDevelopment(void 0!=k.development?k.development:!0);L.Logger.setLogLevel(d);if(L&&L.Utils&&L.Utils.localStorage)L.Utils.localStorage.setItem("debug",f?"*":"none");else try{window.localStorage?window.localStorage.setItem("debug",f?"*":"none"):console.warn("[tk-sdk]window.localStorage is not exist!")}catch(a){console.warn("[tk-sdk]Browser does not support localStorage!")}window.webrtcLogDebug=g};
TK.tkLogPrintConfig({debug:!1},{development:!1,logLevel:TK.LOG_INFO},{webrtcLogDebug:!1});TK.Logger=L.Logger;window.TK=window.TK||{};window.L=window.L||{};
(function(){window.TK.TALKRECODER={STATE_ROOM_CONNECTED:0};window.TK_VIDEO_MODE={ASPECT_RATIO_CONTAIN:20001,ASPECT_RATIO_COVER:20002};window.TK.ROOM_ROLE={TEACHER:0,ASSISTANT:1,STUDENT:2,AUDIT:3,PATROL:4,SYSTEM_ADMIN:10,ENTERPRISE_ADMIN:11,ADMIN:12,PLAYBACK:-1};window.TK.ROOM_MODE={NORMAL_ROOM:"normalRoom",BIG_ROOM:"bigRoom"};window.TK.NET_QUALITY={TK_NET_QUALITY_EXCELLENT:1,TK_NET_QUALITY_GOOD:2,TK_NET_QUALITY_ACCEPTED:3,TK_NET_QUALITY_BAD:4,TK_NET_QUALITY_VERYBAD:5};window.TK.MEDIA_TYPE={DEVICE_AV:"video",
FILE:"file",SCREEN:"screen",MEDIA:"media"};window.TK.EVENT_TYPE={roomConnected:"room-connected",roomCheckroom:"room-checkroom",roomCheckroomPlayback:"room-checkroom-playback",roomError:"room-error",roomConnectFail:"room-connect-fail",roomLeaveRoom:"room-leaveroom",roomServerAddressUpdate:"room-serveraddress-update",roomDisconnected:"room-disconnected",roomFiles:"room-files",roomReconnecting:"room-reconnecting",roomParticipantEvicted:"room-participant_evicted",roomMsgList:"room-msglist",roomReconnected:"room-reconnected",
roomAudioVideoStateSwitched:"room-audiovideostate-switched",roomDeleteFile:"room-delete-file",roomAddFile:"room-add-file",roomUpdateFile:"room-update-file",roomUserAudioStateChanged:"room-useraudiostate-changed",roomErrorNotice:"room-error-notice",roomInfoNotice:"room-info-notice",roomWarnNotice:"room-warn-notice",roomUserNetworkStateChanged:"room-usernetworkstate-changed",roomParticipantLeave:"room-participant_leave",roomParticipantJoin:"room-participant_join",roomTextMessage:"room-text-message",
roomModeChanged:"room-mode-changed",roomPubmsg:"room-pubmsg",roomDelmsg:"room-delmsg",roomUserPropertyChanged:"room-userproperty-changed",roomUserMainCameraChanged:"room-usermaincamera-changed",roomPlaybackClear_all:"room-playback-clear_all",roomPlaybackDuration:"room-playback-duration",roomPlaybackPlaybackEnd:"room-playback-playbackEnd",roomPlaybackPlayback_updatetime:"room-playback-playback_updatetime",roomClientNotificationOnMediaFileEnded:"room-clientNotification-onMediaFileEnded",roomNativeNotification:"room-native-notification",
roomClientClose:"room-client-close",roomUserVideoStateChanged:"room-uservideostate-changed",roomUserMediaStateChanged:"room-usermediastate-changed",roomUserScreenStateChanged:"room-userscreenstate-changed",roomUserFileStateChanged:"room-userfilestate-changed",roomVideoNetworkStateChanged:"room-videonetworkstate-changed",roomMediaNetworkStateChanged:"room-medianetworkstate-changed",roomScreenNetworkStateChanged:"room-screennetworkstate-changed",roomFileNetworkStateChanged:"room-filenetworkstate-changed",
deviceFailure:"device-failure",deviceNotAvailable:"device-not-available",deviceSuccess:"device-success",roomUserVideoAttributesUpdate:"room-uservideoattributes-update",roomUserMediaAttributesUpdate:"room-usermediaattributes-update",roomUserScreenAttributesUpdate:"room-userscreenattributes-update",roomUserFileAttributesUpdate:"room-userfileattributes-update",roomFirstVideoFrame:"room-first-video-frame",roomFirstAudioFrame:"room-first-audio-frame",getUserMediaSuccess:"getUserMedia_success",getUserMediaFailure:"getUserMedia_failure",
getUserMediaFailureReGetOnlyAudioStream:"getUserMedia_failure_reGetOnlyAudioStream",getUserMediaFailureReGetOnlyVideoStream:"getUserMedia_failure_reGetOnlyVideoStream",roomRtcStatsReportEvent:"room-rtcStatsReportEvent"};window.TK.ERROR_NOTICE={ERR_OK:0,ERR_NOT_INITIALIZED:101,ERR_INVALID_STATUS:102,ERR_BAD_PARAMETERS:103,ERR_NO_THIS_USER:104,ERR_HTTP_REQUEST_FAILED:111,ERR_PUBLISH_FAILED:131,ERR_PUBLISH_TIMEOUT:132,ERR_PUBLISH_ROOMMAXVIDEOLIMITED:133,ERR_PUBLISH_MAX_RECONNECT_COUNT:134,ERR_SUBSCRIBE_FAILED:141,
ERR_SUBSCRIBE_TIMEOUT:142,ERR_SUBSCRIBE_STREAM_NOTFOUND:143,ERR_SWITCH_SERVER_FAILED:151};window.TK.INFO_NOTICE={INFO_PUBLISH_COMPLETED:2001,INFO_SUBSCRIBE_COMPLETED:2002};window.TK.WARNING_NOTICE={WAR_UNPUBLISHVIDEO_BY_SWITCHAUDIOROOM:1011,WAR_PUBLISHVIDEO_BY_SWITCHAUDIOVIDEOROOM:1012,WAR_UNPUBLISHVIDEO_BY_MAX_RECONNECT_COUNT:1013,WAR_UNPUBLISHAUDIO_BY_MAX_RECONNECT_COUNT:1014,WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE:1015,WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE:1016}})();
L.Constant=function(){return{deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",videoinput:"videoinputDeviceId"},LOGLEVEL:{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5}}}(L);TK.Constant=L.Constant;window.TK=window.TK||{};window.L=window.L||{};L.aexInstance=void 0;
(function(){var f={cipher:function(d,a){for(var b=a.length/4-1,c=[[],[],[],[]],e=0;16>e;e++)c[e%4][Math.floor(e/4)]=d[e];c=f.addRoundKey(c,a,0,4);for(e=1;e<b;e++)c=f.subBytes(c,4),c=f.shiftRows(c,4),c=f.mixColumns(c,4),c=f.addRoundKey(c,a,e,4);c=f.subBytes(c,4);c=f.shiftRows(c,4);c=f.addRoundKey(c,a,b,4);a=Array(16);for(e=0;16>e;e++)a[e]=c[e%4][Math.floor(e/4)];return a},keyExpansion:function(d){for(var a=d.length/4,b=a+6,c=Array(4*(b+1)),e=Array(4),m=0;m<a;m++)c[m]=[d[4*m],d[4*m+1],d[4*m+2],d[4*
m+3]];for(m=a;m<4*(b+1);m++){c[m]=Array(4);for(d=0;4>d;d++)e[d]=c[m-1][d];if(0==m%a)for(e=f.subWord(f.rotWord(e)),d=0;4>d;d++)e[d]^=f.rCon[m/a][d];else 6<a&&4==m%a&&(e=f.subWord(e));for(d=0;4>d;d++)c[m][d]=c[m-a][d]^e[d]}return c},subBytes:function(d,a){for(var b=0;4>b;b++)for(var c=0;c<a;c++)d[b][c]=f.sBox[d[b][c]];return d},shiftRows:function(d,a){for(var b=Array(4),c=1;4>c;c++){for(var e=0;4>e;e++)b[e]=d[c][(e+c)%a];for(e=0;4>e;e++)d[c][e]=b[e]}return d},mixColumns:function(d,a){for(a=0;4>a;a++){for(var b=
Array(4),c=Array(4),e=0;4>e;e++)b[e]=d[e][a],c[e]=d[e][a]&128?d[e][a]<<1^283:d[e][a]<<1;d[0][a]=c[0]^b[1]^c[1]^b[2]^b[3];d[1][a]=b[0]^c[1]^b[2]^c[2]^b[3];d[2][a]=b[0]^b[1]^c[2]^b[3]^c[3];d[3][a]=b[0]^c[0]^b[1]^b[2]^c[3]}return d},addRoundKey:function(d,a,b,c){for(var e=0;4>e;e++)for(var m=0;m<c;m++)d[e][m]^=a[4*b+m][e];return d},subWord:function(d){for(var a=0;4>a;a++)d[a]=f.sBox[d[a]];return d},rotWord:function(d){for(var a=d[0],b=0;3>b;b++)d[b]=d[b+1];d[3]=a;return d},sBox:[99,124,119,123,242,107,
111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,
34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,
0,0,0]],Ctr:{}};f.Ctr.encrypt=function(d,a,b){a=a||"talk_2018_@beijing_20180310_talk_2018_@beijing";b=b||256;if(128!=b&&192!=b&&256!=b)return"";d=g.encode(d);a=g.encode(a);var c=b/8,e=Array(c);for(b=0;b<c;b++)e[b]=isNaN(a.charCodeAt(b))?0:a.charCodeAt(b);e=f.cipher(e,f.keyExpansion(e));e=e.concat(e.slice(0,c-16));a=Array(16);b=(new Date).getTime();c=b%1E3;var m=Math.floor(b/1E3),u=Math.floor(65535*Math.random());for(b=0;2>b;b++)a[b]=c>>>8*b&255;for(b=0;2>b;b++)a[b+2]=u>>>8*b&255;for(b=0;4>b;b++)a[b+
4]=m>>>8*b&255;c="";for(b=0;8>b;b++)c+=String.fromCharCode(a[b]);e=f.keyExpansion(e);m=Math.ceil(d.length/16);u=Array(m);for(var r=0;r<m;r++){for(b=0;4>b;b++)a[15-b]=r>>>8*b&255;for(b=0;4>b;b++)a[15-b-4]=r/4294967296>>>8*b;var n=f.cipher(a,e),x=r<m-1?16:(d.length-1)%16+1,h=Array(x);for(b=0;b<x;b++)h[b]=n[b]^d.charCodeAt(16*r+b),h[b]=String.fromCharCode(h[b]);u[r]=h.join("")}d=c+u.join("");return d=k.encode(d)};f.Ctr.decrypt=function(d,a,b){a=a||"talk_2018_@beijing_20180310_talk_2018_@beijing";b=b||
256;if(128!=b&&192!=b&&256!=b)return"";d=k.decode(d);a=g.encode(a);var c=b/8,e=Array(c);for(b=0;b<c;b++)e[b]=isNaN(a.charCodeAt(b))?0:a.charCodeAt(b);e=f.cipher(e,f.keyExpansion(e));e=e.concat(e.slice(0,c-16));a=Array(8);c=d.slice(0,8);for(b=0;8>b;b++)a[b]=c.charCodeAt(b);c=f.keyExpansion(e);e=Math.ceil((d.length-8)/16);b=Array(e);for(var m=0;m<e;m++)b[m]=d.slice(8+16*m,16*m+24);d=b;var u=Array(d.length);for(m=0;m<e;m++){for(b=0;4>b;b++)a[15-b]=m>>>8*b&255;for(b=0;4>b;b++)a[15-b-4]=(m+1)/4294967296-
1>>>8*b&255;var r=f.cipher(a,c),n=Array(d[m].length);for(b=0;b<d[m].length;b++)n[b]=r[b]^d[m].charCodeAt(b),n[b]=String.fromCharCode(n[b]);u[m]=n.join("")}d=u.join("");return d=g.decode(d)};var k={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",encode:function(d,a){var b=[],c="",e=k.code;a=("undefined"==typeof a?0:a)?d.encodeUTF8():d;d=a.length%3;if(0<d)for(;3>d++;)c+="\x3d",a+="\x00";for(d=0;d<a.length;d+=3){var m=a.charCodeAt(d);var f=a.charCodeAt(d+1);var g=a.charCodeAt(d+
2);var n=m<<16|f<<8|g;m=n>>18&63;f=n>>12&63;g=n>>6&63;n&=63;b[d/3]=e.charAt(m)+e.charAt(f)+e.charAt(g)+e.charAt(n)}b=b.join("");return b=b.slice(0,b.length-c.length)+c},decode:function(d,a){a="undefined"==typeof a?!1:a;var b=[],c=k.code;var e=a?d.decodeUTF8():d;for(var m=0;m<e.length;m+=4){var f=c.indexOf(e.charAt(m));var g=c.indexOf(e.charAt(m+1));d=c.indexOf(e.charAt(m+2));var n=c.indexOf(e.charAt(m+3));var x=f<<18|g<<12|d<<6|n;f=x>>>16&255;g=x>>>8&255;x&=255;b[m/4]=String.fromCharCode(f,g,x);64==
n&&(b[m/4]=String.fromCharCode(f,g));64==d&&(b[m/4]=String.fromCharCode(f))}b=b.join("");return a?b.decodeUTF8():b}},g={encode:function(d){d=d.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return d=d.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&63,128|a&63)})},decode:function(d){d=d.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&
63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return d=d.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})}};L.aexInstance=f.Ctr})();
L.Utils=function(){var f=void 0,k=!1,g=!1,d={fileName:"L.Utils.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};f={handleMediaPlayOnEvent:function(a,b){try{if(L.Utils.removeEvent(a,"canplay",f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",f.handleMediaPlayOnEvent.bind(null,a,b)),a&&a.play&&"function"===typeof a.play){var c=a.play();c&&c.catch&&"function"===typeof c.catch&&
c.catch(function(c){L.Logger.error(d,"[tk-sdk]media play err:",L.Utils.toJsonStringify(c),b?" , media element id is "+b:" media element:",b?"":a)})}}catch(e){L.Logger.error(d,"[tk-sdk]media play error:",L.Utils.toJsonStringify(e),b?" , media element id is "+b:" media element:",b?"":a)}},handleMediaPauseOnEvent:function(a,b){try{if(L.Utils.removeEvent(a,"canplay",f.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",f.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,
"loadeddata",f.handleMediaPauseOnEvent.bind(null,a,b)),a&&a.pause&&"function"===typeof a.pause){var c=a.pause();c&&c.catch&&"function"===typeof c.catch&&c.catch(function(c){L.Logger.error(d,"[tk-sdk]media pause err:",L.Utils.toJsonStringify(c),b?" , media element id is "+b:" media element:",b?"":a)})}}catch(e){L.Logger.error(d,"[tk-sdk]media pause error:",L.Utils.toJsonStringify(e),b?" , media element id is "+b:" media element:",b?"":a)}}};return{addEvent:function(a,b,c,e){a.addEventListener?a.addEventListener(b,
c,void 0!=e&&null!=e?e:!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,b,c,e){a.removeEventListener?a.removeEventListener(b,c,void 0!=e&&null!=e?e:!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},toJsonStringify:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("object"!==typeof a)return a;var c=JSON.stringify(a);c&&(a=c)}catch(e){}return a},toJsonParse:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("string"!==typeof a)return a;var c=JSON.parse(a);c&&(a=
c)}catch(e){}return a},encrypt:function(a,b,c,e){if(!a)return a;c=c||TK.hexEncryptDecryptKey;e=e||TK.hexEncryptDecryptBit;b=void 0!=b?b:"talk_2018_@beijing";a=L.aexInstance.encrypt(a,c,e);return b+a+b},decrypt:function(a,b,c,e){if(!a)return a;c=c||TK.hexEncryptDecryptKey;e=e||TK.hexEncryptDecryptBit;a=a.replace(new RegExp(void 0!=b?b:"talk_2018_@beijing","gm"),"");return L.aexInstance.decrypt(a,c,e)},mediaPlay:function(a){var b=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
a.getAttribute&&"function"===typeof a.getAttribute&&(b=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?f.handleMediaPlayOnEvent(a,b):(L.Utils.removeEvent(a,"canplay",f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"canplay",f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadedmetadata",
f.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadeddata",f.handleMediaPlayOnEvent.bind(null,a,b))))},mediaPause:function(a){var b=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(b=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?f.handleMediaPauseOnEvent(a,b):(L.Utils.removeEvent(a,"canplay",f.handleMediaPauseOnEvent.bind(null,
a,b)),L.Utils.removeEvent(a,"loadedmetadata",f.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",f.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"canplay",f.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadedmetadata",f.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadeddata",f.handleMediaPauseOnEvent.bind(null,a,b))))},localStorage:{setItem:function(a,b){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(a,
b):L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage.setItem , key is "+a+" , value is "+b+"!"):k||(k=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage!"))}catch(c){k||(k=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(c)))}},getItem:function(a){try{if(window.localStorage){if(window.localStorage.getItem)return window.localStorage.getItem(a);L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage.getItem , key is "+
a+" !");return""}k||(k=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage!"));return""}catch(b){return k||(k=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(b))),""}},removeItem:function(a){try{if(window.localStorage){if(window.localStorage.removeItem)return window.localStorage.removeItem(a);L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage.removeItem , key is "+a+" !");return""}k||(k=!0,L.Logger.warning(d,
"[tk-sdk]Browser does not support localStorage!"));return""}catch(b){return k||(k=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(b))),""}}},sessionStorage:{setItem:function(a,b){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(a,b):L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage.setItem , key is "+a+" , value is "+b+"!"):g||(g=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage!"))}catch(c){g||
(g=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(c)))}},getItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.getItem)return window.sessionStorage.getItem(a);L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage.getItem , key is "+a+" !");return""}g||(g=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage!"));return""}catch(b){return g||(g=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage , error info:",
L.Utils.toJsonStringify(b))),""}},removeItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.removeItem)return window.sessionStorage.removeItem(a);L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage.removeItem , key is "+a+" !");return""}g||(g=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage!"));return""}catch(b){return g||(g=!0,L.Logger.warning(d,"[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(b))),""}}},
getBrowserInfo:function(){var a=/(msie\s|trident.*rv:)([\w.]+)/,b=/edge\/(\d+).(\d+)$/,c=/(firefox)\/([\w.]+)/,e=/(opera).+version\/([\w.]+)/,d=/(chrome)\/([\w.]+)/,f=/version\/([\w.]+).*(safari)/,g=function(m){var h=a.exec(m);return h?{browser:"IE",version:h[2]||"0"}:(h=b.exec(m))?{browser:"Edge",version:h[2]||"0"}:(h=c.exec(m))?{browser:h[1]||"Firefox",version:h[2]||"0"}:(h=e.exec(m))?{browser:h[1]||"Opera",version:h[2]||"0"}:(h=d.exec(m))?{browser:h[1]||"Chrome",version:h[2]||"0"}:(h=f.exec(m))?
{browser:h[2]||"Safari",version:h[1]||"0"}:{browser:"unknown",version:"unknown"}}(window.navigator.userAgent.toLowerCase()),n=navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||navigator.language;return{versions:function(){var a=navigator.userAgent;return{edge:-1<a.indexOf("Edge"),trident:-1<a.indexOf("Trident"),presto:-1<a.indexOf("Presto"),webKit:-1<a.indexOf("AppleWebKit"),gecko:-1<a.indexOf("Gecko")&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
android:-1<a.indexOf("Android")||-1<a.indexOf("Linux"),iPhone:-1<a.indexOf("iPhone"),iPad:-1<a.indexOf("iPad"),webApp:-1==a.indexOf("Safari")}}(),language:n?n.toLowerCase():void 0,info:{browserName:g.browser,browserVersion:g.version,appCodeName:navigator.appCodeName,appMinorVersion:navigator.appMinorVersion,appName:navigator.appName,appVersion:navigator.appVersion,browserLanguage:navigator.browserLanguage,cookieEnabled:navigator.cookieEnabled,cpuClass:navigator.cpuClass,onLine:navigator.onLine,platform:navigator.platform,
systemLanguage:navigator.systemLanguage,userAgent:navigator.userAgent,userLanguage:navigator.userLanguage}}},getJsonLength:function(a){var b=0;if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&++b;return b},detectOS:function(){try{var a=navigator.userAgent,b="Win32"===navigator.platform||"Windows"===navigator.platform,c="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(c)return"Mac";if("X11"===navigator.platform&&
!b&&!c)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(b){if(-1<a.indexOf("Windows NT 5.0")||-1<a.indexOf("Windows 2000"))return"Win2000";if(-1<a.indexOf("Windows NT 5.1")||-1<a.indexOf("Windows XP"))return"WinXP";if(-1<a.indexOf("Windows NT 5.2")||-1<a.indexOf("Windows 2003"))return"Win2003";if(-1<a.indexOf("Windows NT 6.0")||-1<a.indexOf("Windows Vista"))return"WinVista";if(-1<a.indexOf("Windows NT 6.1")||-1<a.indexOf("Windows 7"))return"Win7";if(-1<a.indexOf("Windows NT 6.2")||
-1<a.indexOf("Windows 8"))return"Win8";if(-1<a.indexOf("Windows NT 10.0")||-1<a.indexOf("Windows 10"))return"Win10"}return"Other"}catch(e){return L.Logger.error(d,"[tk-sdk]detectOS method error:",e),"Other"}},isFunction:function(a){return"function"===typeof a},isString:function(a){return"string"===typeof a},isNumber:function(a){return"number"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isArray:function(a){return Array.isArray(a)},isHTMLCollection:function(a){return"object"===typeof a&&
window.HTMLCollection&&a instanceof window.HTMLCollection},isNull:function(a){return!a&&0!==a&&"boolean"!==typeof a},getFileName:function(a){if("string"!==typeof a)return"";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return a.substring(Math.max(b,c)+1)},copy:function(a){var b={},c;for(c in a)b[c]="object"===typeof a[c]?L.Utils.copy(a[c]):a[c];return b},stopTrack:function(a,b){b?a.stop():TK.notStopTrack||a&&"video"===a.kind&&TK.notStopVideoTrack||a&&"audio"===a.kind&&TK.notStopAudioTrack||a&&"function"===
typeof a.stop&&a.stop()},cloneTrack:function(a){return a&&L.Utils.isFunction(a.clone)?a.clone():a},cloneMediaStream:function(a,b,c){b="boolean"===typeof b?b:!0;c="boolean"===typeof c?c:!0;if(!a)return a;var e=function(){var h=a&&"function"===typeof a.clone?a.clone():void 0;if(!h)return a;if(h&&0<h.getTracks().length)for(var p=h.getTracks().length-1;0<=p;p--){var e=h.getTracks()[p];L.Utils.stopTrack(e);h.removeTrack(e)}h=h&&"function"===typeof h.clone?h.clone():void 0;if(!h)return a;if(b&&0<a.getAudioTracks().length)for(p=
0,e=a.getAudioTracks().length;p<e;p++){var d=a.getAudioTracks()[p];h.addTrack(L.Utils.cloneTrack(d))}if(c&&0<a.getVideoTracks().length)for(p=0,e=a.getVideoTracks().length;p<e;p++)d=a.getVideoTracks()[p],h.addTrack(L.Utils.cloneTrack(d));return h};if(window.MediaStream&&"function"===typeof window.MediaStream)try{var d=new window.MediaStream;if(b&&0<a.getAudioTracks().length)for(var f=0,g=a.getAudioTracks().length;f<g;f++){var n=a.getAudioTracks()[f];d.addTrack(L.Utils.cloneTrack(n))}if(c&&0<a.getVideoTracks().length)for(f=
0,g=a.getVideoTracks().length;f<g;f++){var k=a.getVideoTracks()[f];d.addTrack(L.Utils.cloneTrack(k))}return d}catch(h){return e()}else return e()},sdkAjax:function(a){function b(a,b){var h=0;var p=!!a&&"length"in a&&a.length;var e=c(a);p=L.Utils.isFunction(a)||null!=a&&a===a.window?!1:"array"===e||0===p||"number"===typeof p&&0<p&&p-1 in a;if(p)for(p=a.length;h<p&&!1!==b.call(a[h],h,a[h]);h++);else for(h in a)if(!1===b.call(a[h],h,a[h]))break;return a}function c(a){return null==a?a+"":"object"===typeof a||
"function"===typeof a?{}[{}.toString.call(a)]||"object":typeof a}function e(a,b){b="";a&&"object"===typeof a?b=g(a):"string"===typeof a&&(b=a);return b}function m(a){if(!a||"[object Object]"!==toString.call(a))return!1;a=Object.getPrototypeOf(a);if(!a)return!0;a={}.hasOwnProperty.call(a,"constructor")&&a.constructor;return"function"===typeof a&&{}.hasOwnProperty.toString.call(a)==={}.hasOwnProperty.toString.call(Object)}function f(a,h,p,e){var d;if(Array.isArray(h))b(h,function(b,c){p||n.test(a)?
e(a,c):f(a+"["+("object"===typeof c&&null!=c?b:"")+"]",c,p,e)});else if(p||"object"!==c(h))e(a,h);else for(d in h)f(a+"["+d+"]",h[d],p,e)}function g(a,c){var h,p=[],e=function(a,b){b=L.Utils.isFunction(b)?b():b;p[p.length]=encodeURIComponent(a)+"\x3d"+encodeURIComponent(null==b?"":b)};if(null==a)return"";if(Array.isArray(a)||m&&!m(a))b(a,function(){e(this.name,this.value)});else for(h in a)f(h,a[h],c,e);return p.join("\x26")}var n=/\[\]$/,k={type:a.type||"GET",url:a.url||"",data:a.data||null,async:a.async||
!0,dataType:a.dataType||"text",contentType:a.contentType||"application/x-www-form-urlencoded;charset\x3dUTF-8",isupLoadFile:a.isupLoadFile,success:a.success||function(){},error:a.error||function(){},progress:a.progress||function(){},start:a.progress||function(){},end:a.end||function(){}};k.type=k.type.toUpperCase();if(k.success&&"function"!==typeof k.success)L.Logger.error(d,"[myAjax] success is not a function, is ",k.success);else if(k.error&&"function"!==typeof k.error)L.Logger.error(d,"[myAjax] error is not a function, is ",
k.error);else if(k.progress&&"function"!==typeof k.progress)L.Logger.error(d,"[myAjax] progress is not a function, is ",k.progress);else if(k.start&&"function"!==typeof k.start)L.Logger.error(d,"[myAjax] start is not a function, is ",k.start);else if(k.end&&"function"!==typeof k.end)L.Logger.error(d,"[myAjax] end is not a function, is ",k.end);else{var h=void 0;a=void 0;window.XMLHttpRequest?h=new XMLHttpRequest:window.ActiveXObject?h=new ActiveXObject("Microsoft.XMLHTTP"):L.Logger.error(d,"[myAjax] Your browser does not support it : XMLHttpRequest and  ActiveXObject ");
h.upload.onprogress=k.progress;h.onreadystatechange=function(){if(4===h.readyState)if(200<=h.status&&300>h.status||304===h.status)switch(h.upload.onprogress=null,k.dataType){case "text":case "TEXT":k.success(h.responseText);break;case "json":case "JSON":k.success(JSON.parse(h.responseText));break;case "xml":case "XML":k.success(h.responseXML)}else h.upload.onprogress=null,k.error(h.status)};h.onload=function(a){};h.onerror=function(a){};h.onloadstart=function(){k.start()};h.onloadend=function(){k.end()};
a=-1===k.url.indexOf("?")?"?":"\x26";k.url.indexOf("?")===k.url.length-1&&(a="");if("GET"===k.type){var p=e(k.data);0!==p.length&&(p=a+p);a=k.url+p;h.open(k.type,a,k.async);h.send()}else"POST"===k.type&&(a=k.url,h.open(k.type,a,k.async),k.isupLoadFile?h.send(k.data):(h.setRequestHeader("Content-Type",k.contentType),h.send(e(k.data))));return h}},getUserMediaFailCode:function(a){var b=window.TK_ERR.DEVICE_ERROR_UnknownError;switch(a){case "NotFoundError":case "DevicesNotFoundError":b=window.TK_ERR.DEVICE_ERROR_NotFoundError;
break;case "NotAllowedError":case "PermissionDeniedError":b=window.TK_ERR.DEVICE_ERROR_NotAllowedError;break;case "NotReadableError":case "TrackStartError":b=window.TK_ERR.DEVICE_ERROR_NotReadableError;break;case "OverconstrainedError":case "ConstraintNotSatisfiedError":b=window.TK_ERR.DEVICE_ERROR_OverconstrainedError;break;case "TypeError":b=window.TK_ERR.DEVICE_ERROR_UnknownError}return b},getMaxBPS:function(a,b){return 80>=a?20>b?64:96:176>=a?20>b?128:192:320>=a?20>b?256:384:640>=a?20>b?384:512:
1280>=a?15>b?1024:15<=b&&20>=b?1280:1536:15>b?1280:15<=b&&20>=b?1536:2048},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")},generategGuid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getNetLevel:function(a,b){a=L.Utils.getNetPacketsLostRateLevel(a);b=L.Utils.getNetDelayLevel(b);return Math.max(a,b)},getNetPacketsLostRateLevel:function(a){return 1>a?window.TK.NET_QUALITY.TK_NET_QUALITY_EXCELLENT:
5>a?window.TK.NET_QUALITY.TK_NET_QUALITY_GOOD:10>a?window.TK.NET_QUALITY.TK_NET_QUALITY_ACCEPTED:20>a?window.TK.NET_QUALITY.TK_NET_QUALITY_BAD:window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD},getNetDelayLevel:function(a){return 80>a?window.TK.NET_QUALITY.TK_NET_QUALITY_EXCELLENT:150>a?window.TK.NET_QUALITY.TK_NET_QUALITY_GOOD:300>a?window.TK.NET_QUALITY.TK_NET_QUALITY_ACCEPTED:500>a?window.TK.NET_QUALITY.TK_NET_QUALITY_BAD:window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD},randomWord:function(a){a=a||1024;
for(var b="",c=0;c<a;c++)b+="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678".charAt(Math.floor(48*Math.random()));b.toLowerCase();return b},setMaxBWToSdp:function(a,b,c){a=L.Utils.formatSdp(a);if(b&&b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var e=a.match(/m=video.*\r\n/);null==e&&(e=a.match(/m=video.*\n/));e&&0<e.length&&(b=e[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n",a=a.replace(e[0],b))}c&&c.audio&&c.maxAudioBW&&(e=a.match(/m=audio.*\r\n/),null==e&&(e=a.match(/m=audio.*\n/)),e&&0<e.length&&
(b=e[0]+"b\x3dAS:"+c.maxAudioBW+"\r\n",a=a.replace(e[0],b)));return a},setHiFiToSdp:function(a){a=L.Utils.formatSdp(a);if(TK.isHiFi){a=a.replace(new RegExp("a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d"+TK.maxaveragebitrateToHifi+";maxplaybackrate\x3d48000;stereo\x3d1\r\n","g"),"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d"+TK.maxaveragebitrateToHifi+
";maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},formatSdp:function(a){return a=a.replace(/\r?\n/g,"#talkcloudFormatSdp_r_n#").replace(/#talkcloudFormatSdp_r_n#/g,"\r\n")},getBrowser:function(){var a="none";null!==window.navigator.userAgent.match("Firefox")?a="mozilla":null!==window.navigator.userAgent.match("Bowser")?a="bowser":null!==window.navigator.userAgent.match("Chrome")?(a="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(a="electron")):null!==
window.navigator.userAgent.match("Safari")?a="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(a="bowser");return a},createMediaStream:function(a,b){var c=void 0;window.MediaStream&&"function"===typeof window.MediaStream?(c=new window.MediaStream,a&&c.addTrack(a),b&&c.addTrack(b)):L.Logger.error(d,"[tk-sdk]The browser does not support the creation of mediaStream!");return c},getWhereWebInfo:function(a,b,c,e,m){m=L.Utils.isBoolean(m)?m:!0;a=a+"://"+b+":"+(/https/g.test(a)?8080:81)+
"/where.html?ts\x3d"+(new Date).getTime();L.Utils.sdkAjax({url:a,type:"get",async:m,success:function(a){L.Logger.info(d,"[tk-sdk]getFalsificationIp resp :",window.__TkSdkBuild__?L.Utils.encrypt("object"===typeof a?L.Utils.toJsonStringify(a):a):"object"===typeof a?L.Utils.toJsonStringify(a):a);"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&"object"===typeof a?L.Utils.isFunction(c)&&c(a):(L.Logger.error(d,"[tk-sdk]getFalsificationIp resp not is json"),L.Utils.isFunction(e)&&e("getFalsificationIp resp not is json"))},
error:function(a){L.Logger.error(d,"[tk-sdk]getFalsificationIp fail:",a);L.Utils.isFunction(e)&&e(a)}})},replaceHostname:function(a,b){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)&&b&&a){var c=a.indexOf(".");0<c&&(c=a.substring(0,c),a=a.replace(new RegExp(c),b))}return a},speedNetwordk:function(a,b,c,e,m){m=m||{};m.infoLog=L.Utils.isBoolean(m.infoLog)?m.infoLog:!0;m.errorLog=L.Utils.isBoolean(m.errorLog)?m.errorLog:!0;var f=m.randomWordLength||512,g=(new Date).getTime(),n=a+"://"+b+":"+c+
"/speed.php?ts\x3d"+g;a=L.Utils.randomWord(f);return L.Utils.sdkAjax({url:n,type:"GET",async:!0,data:{data:a},success:function(a){var b=(new Date).getTime();m.infoLog&&L.Logger.info(d,"[tk-sdk]"+(m.source||"")+"speedNetwordk finshed,url is "+n+" ,elapsed time is "+(b-g)+" ms");L.Utils.isFunction(e)&&e(0,b-g,g,b,a)},error:function(a){var b=(new Date).getTime();m.errorLog&&L.Logger.error(d,"[tk-sdk]"+(m.source||"")+"speedNetwordk fail,url is "+n+" ,elapsed time is "+(b-g)+" ms, error info:",a);L.Utils.isFunction(e)&&
e(-1,b-g,g,b,a)}})},nativeMediaStream:function(a,b){var c={},e=[],m=[];a&&(e=[a]);b&&(m=[b]);c.getAudioTracks=function(){return m};c.getVideoTracks=function(){return e};c.addTrack=function(a){a&&a.kind&&a.id?"video"===a.kind?e.push(a):"audio"===a.kind&&m.push(a):L.Logger.error(d,"[tk-sdk]Native addTrack Parameters are not! ")};c.removeTrack=function(a){a&&a.kind&&a.id?"video"===a.kind?e=e.filter(function(b){return b.id!==a.id}):"audio"===a.kind&&(m=m.filter(function(b){return b.id!==a.id})):L.Logger.error(d,
"[tk-sdk]Native addTrack Parameters are not! ")};return c},isVideoinputDeviceIdFromDeviceList:function(a){var b=!1;if(TK.deviceInfoMap&&TK.deviceInfoMap.videoinput&&TK.deviceInfoMap.videoinput.length)for(var c=0,e=TK.deviceInfoMap.videoinput.length;c<e;c++)if(TK.deviceInfoMap.videoinput[c]&&TK.deviceInfoMap.videoinput[c].deviceId===a){b=!0;break}return b},isAudioinputDeviceIdFromDeviceList:function(a){var b=!1;if(TK.deviceInfoMap&&TK.deviceInfoMap.audioinput&&TK.deviceInfoMap.audioinput.length)for(var c=
0,e=TK.deviceInfoMap.audioinput.length;c<e;c++)if(TK.deviceInfoMap.audioinput[c]&&TK.deviceInfoMap.audioinput[c].deviceId===a){b=!0;break}return b},isSupportMediaStreamTrackMethod:function(a){try{if(!TK.isTkNative&&window.MediaStreamTrack&&window.MediaStreamTrack.prototype)return window.MediaStreamTrack.prototype.hasOwnProperty(a)}catch(b){L.Logger.error(d,"[tk-sdk]getMediaStreamTrackSupport error:",b)}return!1},isSupportRTCRtpSenderMethod:function(a){try{if(!TK.isTkNative&&window.RTCRtpSender&&window.RTCRtpSender.prototype)return window.RTCRtpSender.prototype.hasOwnProperty(a);
if(TK.isTkNative)return!0}catch(b){L.Logger.error(d,"[tk-sdk]getMediaStreamTrackSupport error:",b)}return!1},getBrowserName:function(){function a(){function a(a,b){var h=c.external||{},p;for(p in h)if(a.test(b?h[p]:p))return!0;return!1}var c=window,e=c.navigator,d=c.ActiveXObject,f=c.document.documentMode,g=/^Apple/,n=function(){for(var a=3,b=document.createElement("p"),c=b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e",c[0];);return 4<
a?a:0}()||f||0,k=d||f,h=/Edge/i,p=/(?:Chrome\/)(\d+)(?:\.)/i,v=function(){if(k||"undefined"!==typeof c.scrollMaxX||g.test(e.vendor||""))return"";if(h.test(navigator.userAgent))return"Edge";document.createElement("track");c.chrome&&c.chrome.webstore&&Object.keys(c.chrome.webstore);c.chrome&&c.chrome.app&&Object.keys(c.chrome.app);if(/qqbrowser/.test(navigator.userAgent.toLowerCase()))return"qq";if(a(/^sogou/i,0))return"sogou";if(a(/^liebao/i,0))return"liebao";if(c.clientInformation&&c.clientInformation.languages&&
2<c.clientInformation.languages.length)return"chrome";a:{var b=navigator.mimeTypes;for(var p in b)if("application/vnd.chromium.remoting-viewer"==b[p].type){b=!0;break a}b=!1}return b?"360":""}();return{isIE:function(){return!!n},ieVersion:function(){return n},isEdge:function(){return"Edge"===v},isChrome:function(){return"chrome"===v},chromeVersion:function(){var a=p.exec(navigator.userAgent);return a[a.length-1]},is360:function(){return"360"===v},isLiebao:function(){return"liebao"===v},isSogou:function(){return"sogou"===
v},isQQ:function(){return"qq"===v}}}return function(){var b=a();return b.isIE()?"IE:"+b.ieVersion():b.isEdge()?"Edge":b.isChrome()?"chrome:"+b.chromeVersion():b.is360()?"360":b.isLiebao()?"liebao":b.isSogou()?"sogou":b.isQQ()?"qq":""}()},createTack:function(){return document.createElement("canvas").captureStream().getTracks()[0]}}}(L);window&&L.Utils.addEvent(window,"load",function(){TK&&TK.DeviceMgr&&"function"===typeof TK.DeviceMgr.getDevices&&TK.DeviceMgr.getDevices()});window.TK=window.TK||{};window.L=window.L||{};
!function(f){function k(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function g(a,b,c,h,e,d){a=k(k(b,a),k(h,d));return k(a<<e|a>>>32-e,c)}function d(a,b,c,h,e,d,m){return g(b&c|~b&h,a,b,e,d,m)}function a(a,b,c,h,e,d,m){return g(b&h|c&~h,a,b,e,d,m)}function b(a,b,c,h,e,d,m){return g(b^c^h,a,b,e,d,m)}function c(a,b,c,h,e,d,m){return g(c^(b|~h),a,b,e,d,m)}function e(h,e){h[e>>5]|=128<<e%32;h[14+(e+64>>>9<<4)]=e;var p=1732584193,m=-271733879,n=-1732584194,f=271733878;for(e=
0;e<h.length;e+=16){var g=p;var v=m;var u=n;var r=f;m=c(m=c(m=c(m=c(m=b(m=b(m=b(m=b(m=a(m=a(m=a(m=a(m=d(m=d(m=d(m=d(m,n=d(n,f=d(f,p=d(p,m,n,f,h[e],7,-680876936),m,n,h[e+1],12,-389564586),p,m,h[e+2],17,606105819),f,p,h[e+3],22,-1044525330),n=d(n,f=d(f,p=d(p,m,n,f,h[e+4],7,-176418897),m,n,h[e+5],12,1200080426),p,m,h[e+6],17,-1473231341),f,p,h[e+7],22,-45705983),n=d(n,f=d(f,p=d(p,m,n,f,h[e+8],7,1770035416),m,n,h[e+9],12,-1958414417),p,m,h[e+10],17,-42063),f,p,h[e+11],22,-1990404162),n=d(n,f=d(f,p=d(p,
m,n,f,h[e+12],7,1804603682),m,n,h[e+13],12,-40341101),p,m,h[e+14],17,-1502002290),f,p,h[e+15],22,1236535329),n=a(n,f=a(f,p=a(p,m,n,f,h[e+1],5,-165796510),m,n,h[e+6],9,-1069501632),p,m,h[e+11],14,643717713),f,p,h[e],20,-373897302),n=a(n,f=a(f,p=a(p,m,n,f,h[e+5],5,-701558691),m,n,h[e+10],9,38016083),p,m,h[e+15],14,-660478335),f,p,h[e+4],20,-405537848),n=a(n,f=a(f,p=a(p,m,n,f,h[e+9],5,568446438),m,n,h[e+14],9,-1019803690),p,m,h[e+3],14,-187363961),f,p,h[e+8],20,1163531501),n=a(n,f=a(f,p=a(p,m,n,f,h[e+
13],5,-1444681467),m,n,h[e+2],9,-51403784),p,m,h[e+7],14,1735328473),f,p,h[e+12],20,-1926607734),n=b(n,f=b(f,p=b(p,m,n,f,h[e+5],4,-378558),m,n,h[e+8],11,-2022574463),p,m,h[e+11],16,1839030562),f,p,h[e+14],23,-35309556),n=b(n,f=b(f,p=b(p,m,n,f,h[e+1],4,-1530992060),m,n,h[e+4],11,1272893353),p,m,h[e+7],16,-155497632),f,p,h[e+10],23,-1094730640),n=b(n,f=b(f,p=b(p,m,n,f,h[e+13],4,681279174),m,n,h[e],11,-358537222),p,m,h[e+3],16,-722521979),f,p,h[e+6],23,76029189),n=b(n,f=b(f,p=b(p,m,n,f,h[e+9],4,-640364487),
m,n,h[e+12],11,-421815835),p,m,h[e+15],16,530742520),f,p,h[e+2],23,-995338651),n=c(n,f=c(f,p=c(p,m,n,f,h[e],6,-198630844),m,n,h[e+7],10,1126891415),p,m,h[e+14],15,-1416354905),f,p,h[e+5],21,-57434055),n=c(n,f=c(f,p=c(p,m,n,f,h[e+12],6,1700485571),m,n,h[e+3],10,-1894986606),p,m,h[e+10],15,-1051523),f,p,h[e+1],21,-2054922799),n=c(n,f=c(f,p=c(p,m,n,f,h[e+8],6,1873313359),m,n,h[e+15],10,-30611744),p,m,h[e+6],15,-1560198380),f,p,h[e+13],21,1309151649),n=c(n,f=c(f,p=c(p,m,n,f,h[e+4],6,-145523070),m,n,h[e+
11],10,-1120210379),p,m,h[e+2],15,718787259),f,p,h[e+9],21,-343485551);p=k(p,g);m=k(m,v);n=k(n,u);f=k(f,r)}return[p,m,n,f]}function m(a){var b,c="",h=32*a.length;for(b=0;b<h;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function u(a){var b,c=[];c[(a.length>>2)-1]=void 0;for(b=0;b<c.length;b+=1)c[b]=0;var h=8*a.length;for(b=0;b<h;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function r(a){return m(e(u(a),8*a.length))}function n(a,b){var c,h=u(a),p=[],d=[];p[15]=d[15]=void 0;16<h.length&&
(h=e(h,8*a.length));for(a=0;16>a;a+=1)p[a]=909522486^h[a],d[a]=1549556828^h[a];return c=e(p.concat(u(b)),512+8*b.length),m(e(d.concat(c),640))}function x(a){var b,c="";for(b=0;b<a.length;b+=1){var h=a.charCodeAt(b);c+="0123456789abcdef".charAt(h>>>4&15)+"0123456789abcdef".charAt(15&h)}return c}function h(a,b,c){b?c?a=n(unescape(encodeURIComponent(b)),unescape(encodeURIComponent(a))):(a=n(unescape(encodeURIComponent(b)),unescape(encodeURIComponent(a))),a=x(a)):a=c?r(unescape(encodeURIComponent(a))):
x(r(unescape(encodeURIComponent(a))));return a}"function"==typeof define&&define.amd?define(function(){return h}):"object"==typeof module&&module.exports?module.exports=h:f.md5=h;"undefined"!==typeof window&&(window.md5=h)}(this);window.TK.MD5=window.TK.MD5||window.md5;if(!window.TK.MD5)try{window.TK.MD5=md5}catch(f){console.error("[tk-sdk]Encryption method missing, please check if an encrypted file is introduced,please link MD5,for example: window.TK.MD5 \x3d md5")};window.TK=window.TK||{};window.L=window.L||{};
(function(f){("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).adapter=f()})(function(){return function a(k,g,d){function b(e,u){if(!g[e]){if(!k[e]){var m="function"==typeof require&&require;if(!u&&m)return m(e,!0);if(c)return c(e,!0);u=Error("Cannot find module '"+e+"'");throw u.code="MODULE_NOT_FOUND",u;}u=g[e]={exports:{}};k[e][0].call(u.exports,function(a){var c=k[e][1][a];return b(c?c:a)},u,u.exports,a,k,g,d)}return g[e].exports}for(var c=
"function"==typeof require&&require,e=0;e<d.length;e++)b(d[e]);return b}({1:[function(k,g,d){function a(a,b,c,e,d){b=r.writeRtpDescription(a.kind,b);b+=r.writeIceParameters(a.iceGatherer.getLocalParameters());b+=r.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":d||"active");b+="a\x3dmid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a\x3dsendrecv\r\n":a.rtpSender?b+"a\x3dsendonly\r\n":a.rtpReceiver?b+"a\x3drecvonly\r\n":b+"a\x3dinactive\r\n";a.rtpSender&&(c=a.rtpSender._initialTrackId||
a.rtpSender.track.id,a.rtpSender._initialTrackId=c,e="msid:"+(e?e.id:"-")+" "+c+"\r\n",b=b+("a\x3d"+e)+("a\x3dssrc:"+a.sendEncodingParameters[0].ssrc+" "+e),a.sendEncodingParameters[0].rtx&&(b+="a\x3dssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+e,b+="a\x3dssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n"));b+="a\x3dssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+="a\x3dssrc:"+
a.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n");return b}function b(a,b){var c=!1;a=JSON.parse(JSON.stringify(a));return a.filter(function(a){if(a&&(a.urls||a.url)){var h=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"===typeof h;e&&(h=[h]);h=h.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport\x3dudp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&14393<=b&&-1===a.indexOf("?transport\x3dudp"):
c=!0});delete a.url;a.urls=e?h[0]:h;return!!h.length}})}function c(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},e=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},d=function(a,b,c,h){a=e(a.parameters.apt,c);b=e(b.parameters.apt,h);return a&&b&&a.name.toLowerCase()===b.name.toLowerCase()};a.codecs.forEach(function(h){for(var e=0;e<b.codecs.length;e++){var p=b.codecs[e];if(h.name.toLowerCase()===p.name.toLowerCase()&&
h.clockRate===p.clockRate&&("rtx"!==h.name.toLowerCase()||!h.parameters||!p.parameters.apt||d(h,p,a.codecs,b.codecs))){p=JSON.parse(JSON.stringify(p));p.numChannels=Math.min(h.numChannels,p.numChannels);c.codecs.push(p);p.rtcpFeedback=p.rtcpFeedback.filter(function(a){for(var b=0;b<h.rtcpFeedback.length;b++)if(h.rtcpFeedback[b].type===a.type&&h.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}});a.headerExtensions.forEach(function(a){for(var h=0;h<b.headerExtensions.length;h++){var e=
b.headerExtensions[h];if(a.uri===e.uri){c.headerExtensions.push(e);break}}});return c}function e(a,b,c){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)}function m(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===
a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});c||a.addRemoteCandidate(b);return!c}function u(a,b){b=Error(b);b.name=a;b.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a];return b}var r=k("sdp");g.exports=function(d,g){function h(a,b){b.addTrack(a);b.dispatchEvent(new d.MediaStreamTrackEvent("addtrack",{track:a}))}function p(a,b){b.removeTrack(a);b.dispatchEvent(new d.MediaStreamTrackEvent("removetrack",{track:a}))}
function n(a,b,c,h){var e=new Event("track");e.track=b;e.receiver=c;e.transceiver={receiver:c};e.streams=h;d.setTimeout(function(){a._dispatchEvent("track",e)})}var k=function(a){var c=this,h=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){c[a]=h[a].bind(h)});this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this._remoteDescription=this._localDescription=null;this.signalingState="stable";
this.iceGatheringState=this.connectionState=this.iceConnectionState="new";a=JSON.parse(JSON.stringify(a||{}));this.usingBundle="max-bundle"===a.bundlePolicy;if("negotiate"===a.rtcpMuxPolicy)throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");a.rtcpMuxPolicy||(a.rtcpMuxPolicy="require");switch(a.iceTransportPolicy){case "all":case "relay":break;default:a.iceTransportPolicy="all"}switch(a.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:a.bundlePolicy=
"balanced"}a.iceServers=b(a.iceServers||[],g);this._iceGatherers=[];if(a.iceCandidatePoolSize)for(var e=a.iceCandidatePoolSize;0<e;e--)this._iceGatherers.push(new d.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy}));else a.iceCandidatePoolSize=0;this._config=a;this.transceivers=[];this._sdpSessionId=r.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};Object.defineProperty(k.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}});
Object.defineProperty(k.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}});k.prototype.onicecandidate=null;k.prototype.onaddstream=null;k.prototype.ontrack=null;k.prototype.onremovestream=null;k.prototype.onsignalingstatechange=null;k.prototype.oniceconnectionstatechange=null;k.prototype.onconnectionstatechange=null;k.prototype.onicegatheringstatechange=null;k.prototype.onnegotiationneeded=null;k.prototype.ondatachannel=null;k.prototype._dispatchEvent=
function(a,b){if(!this._isClosed&&(this.dispatchEvent(b),"function"===typeof this["on"+a]))this["on"+a](b)};k.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)};k.prototype.getConfiguration=function(){return this._config};k.prototype.getLocalStreams=function(){return this.localStreams};k.prototype.getRemoteStreams=function(){return this.remoteStreams};k.prototype._createTransceiver=function(a,b){var c=0<this.transceivers.length;
a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};this.usingBundle&&c?(a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport):(c=this._createIceAndDtlsTransports(),a.iceTransport=c.iceTransport,a.dtlsTransport=c.dtlsTransport);
b||this.transceivers.push(a);return a};k.prototype.addTrack=function(a,b){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(b){return b.track===a}))throw u("InvalidAccessError","Track already exists.");for(var c,h=0;h<this.transceivers.length;h++)this.transceivers[h].track||this.transceivers[h].kind!==a.kind||(c=this.transceivers[h]);c||(c=this._createTransceiver(a.kind));this._maybeFireNegotiationNeeded();-1===
this.localStreams.indexOf(b)&&this.localStreams.push(b);c.track=a;c.stream=b;c.rtpSender=new d.RTCRtpSender(a,c.dtlsTransport);return c.rtpSender};k.prototype.addStream=function(a){var b=this;if(15025<=g)a.getTracks().forEach(function(c){b.addTrack(c,a)});else{var c=a.clone();a.getTracks().forEach(function(a,b){var h=c.getTracks()[b];a.addEventListener("enabled",function(a){h.enabled=a.enabled})});c.getTracks().forEach(function(a){b.addTrack(a,c)})}};k.prototype.removeTrack=function(a){if(this._isClosed)throw u("InvalidStateError",
"Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof d.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var b=this.transceivers.find(function(b){return b.rtpSender===a});if(!b)throw u("InvalidAccessError","Sender was not created by this connection.");var c=b.stream;b.rtpSender.stop();b.rtpSender=null;b.track=null;b.stream=null;-1===this.transceivers.map(function(a){return a.stream}).indexOf(c)&&-1<
this.localStreams.indexOf(c)&&this.localStreams.splice(this.localStreams.indexOf(c),1);this._maybeFireNegotiationNeeded()};k.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&b.removeTrack(c)})};k.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};k.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};
k.prototype._createIceGatherer=function(a,b){var c=this;if(b&&0<a)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var h=new d.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(h,"state",{value:"new",writable:!0});this.transceivers[a].bufferedCandidateEvents=[];this.transceivers[a].bufferCandidates=function(b){var e=!b.candidate||0===Object.keys(b.candidate).length;h.state=e?
"completed":"gathering";null!==c.transceivers[a].bufferedCandidateEvents&&c.transceivers[a].bufferedCandidateEvents.push(b)};h.addEventListener("localcandidate",this.transceivers[a].bufferCandidates);return h};k.prototype._gather=function(a,b){var c=this,h=this.transceivers[b].iceGatherer;if(!h.onlocalcandidate){var e=this.transceivers[b].bufferedCandidateEvents;this.transceivers[b].bufferedCandidateEvents=null;h.removeEventListener("localcandidate",this.transceivers[b].bufferCandidates);h.onlocalcandidate=
function(e){if(!(c.usingBundle&&0<b)){var d=new Event("icecandidate");d.candidate={sdpMid:a,sdpMLineIndex:b};var p=e.candidate;if(e=!p||0===Object.keys(p).length){if("new"===h.state||"gathering"===h.state)h.state="completed"}else"new"===h.state&&(h.state="gathering"),p.component=1,p.ufrag=h.getLocalParameters().usernameFragment,p=r.writeCandidate(p),d.candidate=Object.assign(d.candidate,r.parseCandidate(p)),d.candidate.candidate=p,d.candidate.toJSON=function(){return{candidate:d.candidate.candidate,
sdpMid:d.candidate.sdpMid,sdpMLineIndex:d.candidate.sdpMLineIndex,usernameFragment:d.candidate.usernameFragment}};p=r.getMediaSections(c._localDescription.sdp);p[d.candidate.sdpMLineIndex]=e?p[d.candidate.sdpMLineIndex]+"a\x3dend-of-candidates\r\n":p[d.candidate.sdpMLineIndex]+("a\x3d"+d.candidate.candidate+"\r\n");c._localDescription.sdp=r.getDescription(c._localDescription.sdp)+p.join("");p=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==
c.iceGatheringState&&(c.iceGatheringState="gathering",c._emitGatheringStateChange());e||c._dispatchEvent("icecandidate",d);p&&(c._dispatchEvent("icecandidate",new Event("icecandidate")),c.iceGatheringState="complete",c._emitGatheringStateChange())}};d.setTimeout(function(){e.forEach(function(a){h.onlocalcandidate(a)})},0)}};k.prototype._createIceAndDtlsTransports=function(){var a=this,b=new d.RTCIceTransport(null);b.onicestatechange=function(){a._updateIceConnectionState();a._updateConnectionState()};
var c=new d.RTCDtlsTransport(b);c.ondtlsstatechange=function(){a._updateConnectionState()};c.onerror=function(){Object.defineProperty(c,"state",{value:"failed",writable:!0});a._updateConnectionState()};return{iceTransport:b,dtlsTransport:c}};k.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);if(b=this.transceivers[a].iceTransport)delete b.onicestatechange,delete this.transceivers[a].iceTransport;
if(b=this.transceivers[a].dtlsTransport)delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[a].dtlsTransport};k.prototype._transceive=function(a,b,h){var e=c(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:r.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e));h&&a.rtpReceiver&&0<e.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&
15019>g&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),e.encodings=a.recvEncodingParameters.length?a.recvEncodingParameters:[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))};k.prototype.setLocalDescription=function(a){var b=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(u("TypeError",'Unsupported type "'+
a.type+'"'));if(!e("setLocalDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));if("offer"===a.type){var h=r.splitSections(a.sdp);var d=h.shift();h.forEach(function(a,c){a=r.parseRtpParameters(a);b.transceivers[c].localCapabilities=a});b.transceivers.forEach(function(a,c){b._gather(a.mid,c)})}else if("answer"===a.type){h=r.splitSections(b._remoteDescription.sdp);d=h.shift();var p=0<r.matchPrefix(d,
"a\x3dice-lite").length;h.forEach(function(a,h){var e=b.transceivers[h],m=e.iceGatherer,n=e.iceTransport,g=e.dtlsTransport,k=e.localCapabilities,v=e.remoteCapabilities;if(!(r.isRejected(a)&&0===r.matchPrefix(a,"a\x3dbundle-only").length||e.rejected)){var u=r.getIceParameters(a,d);a=r.getDtlsParameters(a,d);p&&(a.role="server");b.usingBundle&&0!==h||(b._gather(e.mid,h),"new"===n.state&&n.start(m,u,p?"controlling":"controlled"),"new"===g.state&&g.start(a));h=c(k,v);b._transceive(e,0<h.codecs.length,
!1)}})}b._localDescription={type:a.type,sdp:a.sdp};"offer"===a.type?b._updateSignalingState("have-local-offer"):b._updateSignalingState("stable");return Promise.resolve()};k.prototype.setRemoteDescription=function(a){var b=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(u("TypeError",'Unsupported type "'+a.type+'"'));if(!e("setRemoteDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+a.type+" in state "+b.signalingState));
var c={};b.remoteStreams.forEach(function(a){c[a.id]=a});var k=[],v=r.splitSections(a.sdp),N=v.shift(),x=0<r.matchPrefix(N,"a\x3dice-lite").length,E=0<r.matchPrefix(N,"a\x3dgroup:BUNDLE ").length;b.usingBundle=E;var B=r.matchPrefix(N,"a\x3dice-options:")[0];b.canTrickleIceCandidates=B?0<=B.substr(14).split(" ").indexOf("trickle"):!1;v.forEach(function(e,n){var v=r.splitLines(e),u=r.getKind(e),X=r.isRejected(e)&&0===r.matchPrefix(e,"a\x3dbundle-only").length,M=v[0].substr(2).split(" ")[2];v=r.getDirection(e,
N);var z=r.parseMsid(e),B=r.getMid(e)||r.generateIdentifier();if(X||"application"===u&&("DTLS/SCTP"===M||"UDP/DTLS/SCTP"===M))b.transceivers[n]={mid:B,kind:u,protocol:M,rejected:!0};else{!X&&b.transceivers[n]&&b.transceivers[n].rejected&&(b.transceivers[n]=b._createTransceiver(u,!0));var K=r.parseRtpParameters(e);if(!X){var O=r.getIceParameters(e,N);var ta=r.getDtlsParameters(e,N);ta.role="client"}M=r.parseRtpEncodingParameters(e);var I=r.parseRtcpParameters(e),Q=0<r.matchPrefix(e,"a\x3dend-of-candidates",
N).length,F=r.matchPrefix(e,"a\x3dcandidate:").map(function(a){return r.parseCandidate(a)}).filter(function(a){return 1===a.component});("offer"===a.type||"answer"===a.type)&&!X&&E&&0<n&&b.transceivers[n]&&(b._disposeIceAndDtlsTransports(n),b.transceivers[n].iceGatherer=b.transceivers[0].iceGatherer,b.transceivers[n].iceTransport=b.transceivers[0].iceTransport,b.transceivers[n].dtlsTransport=b.transceivers[0].dtlsTransport,b.transceivers[n].rtpSender&&b.transceivers[n].rtpSender.setTransport(b.transceivers[0].dtlsTransport),
b.transceivers[n].rtpReceiver&&b.transceivers[n].rtpReceiver.setTransport(b.transceivers[0].dtlsTransport));if("offer"!==a.type||X)"answer"!==a.type||X||(G=b.transceivers[n],aa=G.iceGatherer,u=G.iceTransport,B=G.dtlsTransport,S=G.rtpReceiver,X=G.sendEncodingParameters,e=G.localCapabilities,b.transceivers[n].recvEncodingParameters=M,b.transceivers[n].remoteCapabilities=K,b.transceivers[n].rtcpParameters=I,F.length&&"new"===u.state&&(!x&&!Q||E&&0!==n?F.forEach(function(a){m(G.iceTransport,a)}):u.setRemoteCandidates(F)),
E&&0!==n||("new"===u.state&&u.start(aa,O,"controlling"),"new"===B.state&&B.start(ta)),b._transceive(G,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!S||"sendrecv"!==v&&"sendonly"!==v?delete G.rtpReceiver:(v=S.track,z?(c[z.stream]||(c[z.stream]=new d.MediaStream),h(v,c[z.stream]),k.push([v,S,c[z.stream]])):(c.default||(c.default=new d.MediaStream),h(v,c.default),k.push([v,S,c.default]))));else{var G=b.transceivers[n]||b._createTransceiver(u);G.mid=B;G.iceGatherer||(G.iceGatherer=b._createIceGatherer(n,
E));F.length&&"new"===G.iceTransport.state&&(!Q||E&&0!==n?F.forEach(function(a){m(G.iceTransport,a)}):G.iceTransport.setRemoteCandidates(F));e=d.RTCRtpReceiver.getCapabilities(u);15019>g&&(e.codecs=e.codecs.filter(function(a){return"rtx"!==a.name}));X=G.sendEncodingParameters||[{ssrc:1001*(2*n+2)}];O=!1;if("sendrecv"===v||"sendonly"===v){O=!G.rtpReceiver;var S=G.rtpReceiver||new d.RTCRtpReceiver(G.dtlsTransport,u);if(O){v=S.track;if(!z||"-"!==z.stream)if(z){c[z.stream]||(c[z.stream]=new d.MediaStream,
Object.defineProperty(c[z.stream],"id",{get:function(){return z.stream}}));Object.defineProperty(v,"id",{get:function(){return z.track}});var aa=c[z.stream]}else c.default||(c.default=new d.MediaStream),aa=c.default;aa&&(h(v,aa),G.associatedRemoteMediaStreams.push(aa));k.push([v,S,aa])}}else G.rtpReceiver&&G.rtpReceiver.track&&(G.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===G.rtpReceiver.track.id});b&&p(b,a)}),G.associatedRemoteMediaStreams=[]);
G.localCapabilities=e;G.remoteCapabilities=K;G.rtpReceiver=S;G.rtcpParameters=I;G.sendEncodingParameters=X;G.recvEncodingParameters=M;b._transceive(b.transceivers[n],!1,O)}}});void 0===b._dtlsRole&&(b._dtlsRole="offer"===a.type?"active":"passive");b._remoteDescription={type:a.type,sdp:a.sdp};"offer"===a.type?b._updateSignalingState("have-remote-offer"):b._updateSignalingState("stable");Object.keys(c).forEach(function(a){var h=c[a];if(h.getTracks().length){if(-1===b.remoteStreams.indexOf(h)){b.remoteStreams.push(h);
var e=new Event("addstream");e.stream=h;d.setTimeout(function(){b._dispatchEvent("addstream",e)})}k.forEach(function(a){h.id===a[2].id&&n(b,a[0],a[1],[h])})}});k.forEach(function(a){a[2]||n(b,a[0],a[1],[])});d.setTimeout(function(){b&&b.transceivers&&b.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},
4E3);return Promise.resolve()};k.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")};k.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)};k.prototype._maybeFireNegotiationNeeded=function(){var a=
this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,d.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=!1;var b=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",b)}},0))};k.prototype._updateIceConnectionState=function(){var a={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){a[b.iceTransport.state]++});var b="new";0<a.failed?b="failed":0<a.checking?b="checking":0<
a.disconnected?b="disconnected":0<a.new?b="new":0<a.connected?b="connected":0<a.completed&&(b="completed");b!==this.iceConnectionState&&(this.iceConnectionState=b,b=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",b))};k.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(b){a[b.iceTransport.state]++;a[b.dtlsTransport.state]++});a.connected+=a.completed;
var b="new";0<a.failed?b="failed":0<a.connecting?b="connecting":0<a.disconnected?b="disconnected":0<a.new?b="new":0<a.connected&&(b="connected");b!==this.connectionState&&(this.connectionState=b,b=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",b))};k.prototype.createOffer=function(b){var c=this;if(c._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var h=c.transceivers.filter(function(a){return"audio"===a.kind}).length,e=
c.transceivers.filter(function(a){return"video"===a.kind}).length;if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(h=!0===b.offerToReceiveAudio?1:!1===b.offerToReceiveAudio?0:b.offerToReceiveAudio);void 0!==b.offerToReceiveVideo&&(e=!0===b.offerToReceiveVideo?1:!1===b.offerToReceiveVideo?0:b.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?(h--,0>h&&(a.wantReceive=!1)):"video"===
a.kind&&(e--,0>e&&(a.wantReceive=!1))});0<h||0<e;)0<h&&(c._createTransceiver("audio"),h--),0<e&&(c._createTransceiver("video"),e--);var p=r.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(a,b){var h=a.track,e=a.kind,p=a.mid||r.generateIdentifier();a.mid=p;a.iceGatherer||(a.iceGatherer=c._createIceGatherer(b,c.usingBundle));p=d.RTCRtpSender.getCapabilities(e);15019>g&&(p.codecs=p.codecs.filter(function(a){return"rtx"!==a.name}));p.codecs.forEach(function(b){"H264"===
b.name&&void 0===b.parameters["level-asymmetry-allowed"]&&(b.parameters["level-asymmetry-allowed"]="1");a.remoteCapabilities&&a.remoteCapabilities.codecs&&a.remoteCapabilities.codecs.forEach(function(a){b.name.toLowerCase()===a.name.toLowerCase()&&b.clockRate===a.clockRate&&(b.preferredPayloadType=a.payloadType)})});p.headerExtensions.forEach(function(b){(a.remoteCapabilities&&a.remoteCapabilities.headerExtensions||[]).forEach(function(a){b.uri===a.uri&&(b.id=a.id)})});b=a.sendEncodingParameters||
[{ssrc:1001*(2*b+1)}];h&&15019<=g&&"video"===e&&!b[0].rtx&&(b[0].rtx={ssrc:b[0].ssrc+1});a.wantReceive&&(a.rtpReceiver=new d.RTCRtpReceiver(a.dtlsTransport,e));a.localCapabilities=p;a.sendEncodingParameters=b});"max-compat"!==c._config.bundlePolicy&&(p+="a\x3dgroup:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");p+="a\x3dice-options:trickle\r\n";c.transceivers.forEach(function(b,h){p+=a(b,b.localCapabilities,"offer",b.stream,c._dtlsRole);p+="a\x3drtcp-rsize\r\n";!b.iceGatherer||
"new"===c.iceGatheringState||0!==h&&c.usingBundle||(b.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;p+="a\x3d"+r.writeCandidate(a)+"\r\n"}),"completed"===b.iceGatherer.state&&(p+="a\x3dend-of-candidates\r\n"))});b=new d.RTCSessionDescription({type:"offer",sdp:p});return Promise.resolve(b)};k.prototype.createAnswer=function(){var b=this;if(b._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==b.signalingState&&
"have-local-pranswer"!==b.signalingState)return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+b.signalingState));var h=r.writeSessionBoilerplate(b._sdpSessionId,b._sdpSessionVersion++);b.usingBundle&&(h+="a\x3dgroup:BUNDLE "+b.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var e=r.getMediaSections(b._remoteDescription.sdp).length;b.transceivers.forEach(function(p,d){if(!(d+1>e))if(p.rejected)"application"===p.kind?h="DTLS/SCTP"===p.protocol?h+"m\x3dapplication 0 DTLS/SCTP 5000\r\n":
h+("m\x3dapplication 0 "+p.protocol+" webrtc-datachannel\r\n"):"audio"===p.kind?h+="m\x3daudio 0 UDP/TLS/RTP/SAVPF 0\r\na\x3drtpmap:0 PCMU/8000\r\n":"video"===p.kind&&(h+="m\x3dvideo 0 UDP/TLS/RTP/SAVPF 120\r\na\x3drtpmap:120 VP8/90000\r\n"),h+="c\x3dIN IP4 0.0.0.0\r\na\x3dinactive\r\na\x3dmid:"+p.mid+"\r\n";else{if(p.stream){var m;"audio"===p.kind?m=p.stream.getAudioTracks()[0]:"video"===p.kind&&(m=p.stream.getVideoTracks()[0]);m&&15019<=g&&"video"===p.kind&&!p.sendEncodingParameters[0].rtx&&(p.sendEncodingParameters[0].rtx=
{ssrc:p.sendEncodingParameters[0].ssrc+1})}d=c(p.localCapabilities,p.remoteCapabilities);!d.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&p.sendEncodingParameters[0].rtx&&delete p.sendEncodingParameters[0].rtx;h+=a(p,d,"answer",p.stream,b._dtlsRole);p.rtcpParameters&&p.rtcpParameters.reducedSize&&(h+="a\x3drtcp-rsize\r\n")}});var p=new d.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(p)};k.prototype.addIceCandidate=function(a){var b=this,c;return a&&void 0===
a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(h,e){if(b._remoteDescription)if(a&&""!==a.candidate){var p=a.sdpMLineIndex;if(a.sdpMid)for(var d=0;d<b.transceivers.length;d++)if(b.transceivers[d].mid===a.sdpMid){p=d;break}var n=b.transceivers[p];if(n){if(n.rejected)return h();d=0<Object.keys(a.candidate).length?r.parseCandidate(a.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port)||d.component&&1!==d.component)return h();
if((0===p||0<p&&n.iceTransport!==b.transceivers[0].iceTransport)&&!m(n.iceTransport,d))return e(u("OperationError","Can not add ICE candidate"));e=a.candidate.trim();0===e.indexOf("a\x3d")&&(e=e.substr(2));c=r.getMediaSections(b._remoteDescription.sdp);c[p]+="a\x3d"+(d.type?e:"end-of-candidates")+"\r\n";b._remoteDescription.sdp=r.getDescription(b._remoteDescription.sdp)+c.join("")}else return e(u("OperationError","Can not add ICE candidate"))}else for(p=0;p<b.transceivers.length&&(b.transceivers[p].rejected||
(b.transceivers[p].iceTransport.addRemoteCandidate({}),c=r.getMediaSections(b._remoteDescription.sdp),c[p]+="a\x3dend-of-candidates\r\n",b._remoteDescription.sdp=r.getDescription(b._remoteDescription.sdp)+c.join(""),!b.usingBundle));p++);else return e(u("InvalidStateError","Can not add ICE candidate without a remote description"));h()})};k.prototype.getStats=function(a){if(a&&a instanceof d.MediaStreamTrack){var b=null;this.transceivers.forEach(function(c){c.rtpSender&&c.rtpSender.track===a?b=c.rtpSender:
c.rtpReceiver&&c.rtpReceiver.track===a&&(b=c.rtpReceiver)});if(!b)throw u("InvalidAccessError","Invalid selector.");return b.getStats()}var c=[];this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){a[b]&&c.push(a[b].getStats())})});return Promise.all(c).then(function(a){var b=new Map;a.forEach(function(a){a.forEach(function(a){b.set(a.id,a)})});return b})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport",
"RTCDtlsTransport"].forEach(function(a){if((a=d[a])&&a.prototype&&a.prototype.getStats){var b=a.prototype.getStats;a.prototype.getStats=function(){return b.apply(this).then(function(a){var b=new Map;Object.keys(a).forEach(function(c){var h=a[c];a[c].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type;b.set(c,a[c])});return b})}}});var x=["createOffer","createAnswer"];x.forEach(function(a){var b=
k.prototype[a];k.prototype[a]=function(){var a=arguments;return"function"===typeof a[0]||"function"===typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"===typeof a[0]&&a[0].apply(null,[b])},function(b){"function"===typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}});x=["setLocalDescription","setRemoteDescription","addIceCandidate"];x.forEach(function(a){var b=k.prototype[a];k.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]||"function"===typeof a[2]?
b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)},function(b){"function"===typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}});["getStats"].forEach(function(a){var b=k.prototype[a];k.prototype[a]=function(){var a=arguments;return"function"===typeof a[1]?b.apply(this,arguments).then(function(){"function"===typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}});return k}},{sdp:2}],2:[function(k,g,d){var a={generateIdentifier:function(){return Math.random().toString(36).substr(2,
10)}};a.localCName=a.generateIdentifier();a.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};a.splitSections=function(a){return a.split("\nm\x3d").map(function(a,b){return(0<b?"m\x3d"+a:a).trim()+"\r\n"})};a.getDescription=function(b){return(b=a.splitSections(b))&&b[0]};a.getMediaSections=function(b){b=a.splitSections(b);b.shift();return b};a.matchPrefix=function(b,c){return a.splitLines(b).filter(function(a){return 0===a.indexOf(c)})};a.parseCandidate=function(a){a=
0===a.indexOf("a\x3dcandidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var b={foundation:a[0],component:parseInt(a[1],10),protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},e=8;e<a.length;e+=2)switch(a[e]){case "raddr":b.relatedAddress=a[e+1];break;case "rport":b.relatedPort=parseInt(a[e+1],10);break;case "tcptype":b.tcpType=a[e+1];break;case "ufrag":b.ufrag=a[e+1];b.usernameFragment=a[e+1];break;default:b[a[e]]=a[e+1]}return b};a.writeCandidate=
function(a){var b=[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var e=a.type;b.push("typ");b.push(e);"host"!==e&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));if(a.usernameFragment||a.ufrag)b.push("ufrag"),b.push(a.usernameFragment||a.ufrag);return"candidate:"+b.join(" ")};
a.parseIceOptions=function(a){return a.substr(14).split(" ")};a.parseRtpMap=function(a){a=a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.channels=3===a.length?parseInt(a[2],10):1;b.numChannels=b.channels;return b};a.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);var e=a.channels||a.numChannels||1;return"a\x3drtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==e?"/"+e:"")+
"\r\n"};a.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:"sendrecv",uri:a[1]}};a.writeExtmap=function(a){return"a\x3dextmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};a.parseFmtp=function(a){for(var b={},e=a.substr(a.indexOf(" ")+1).split(";"),d=0;d<e.length;d++)a=e[d].trim().split("\x3d"),b[a[0].trim()]=a[1];return b};a.writeFmtp=function(a){var b="",e=a.payloadType;
void 0!==a.preferredPayloadType&&(e=a.preferredPayloadType);if(a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"\x3d"+a.parameters[b]):d.push(b)});b+="a\x3dfmtp:"+e+" "+d.join(";")+"\r\n"}return b};a.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};a.writeRtcpFb=function(a){var b="",e=a.payloadType;void 0!==a.preferredPayloadType&&(e=a.preferredPayloadType);
a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a\x3drtcp-fb:"+e+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"});return b};a.parseSsrcMedia=function(a){var b=a.indexOf(" "),e={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);-1<d?(e.attribute=a.substr(b+1,d-b-1),e.value=a.substr(d+1)):e.attribute=a.substr(b+1);return e};a.parseSsrcGroup=function(a){a=a.substr(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(function(a){return parseInt(a,
10)})}};a.getMid=function(b){if(b=a.matchPrefix(b,"a\x3dmid:")[0])return b.substr(6)};a.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};a.getDtlsParameters=function(b,c){return{role:"auto",fingerprints:a.matchPrefix(b+c,"a\x3dfingerprint:").map(a.parseFingerprint)}};a.writeDtlsParameters=function(a,c){var b="a\x3dsetup:"+c+"\r\n";a.fingerprints.forEach(function(a){b+="a\x3dfingerprint:"+a.algorithm+" "+a.value+"\r\n"});return b};a.getIceParameters=
function(b,c){b=a.splitLines(b);b=b.concat(a.splitLines(c));return{usernameFragment:b.filter(function(a){return 0===a.indexOf("a\x3dice-ufrag:")})[0].substr(12),password:b.filter(function(a){return 0===a.indexOf("a\x3dice-pwd:")})[0].substr(10)}};a.writeIceParameters=function(a){return"a\x3dice-ufrag:"+a.usernameFragment+"\r\na\x3dice-pwd:"+a.password+"\r\n"};a.parseRtpParameters=function(b){for(var c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=a.splitLines(b)[0].split(" "),d=3;d<e.length;d++){var g=
e[d],k=a.matchPrefix(b,"a\x3drtpmap:"+g+" ")[0];if(k){k=a.parseRtpMap(k);var n=a.matchPrefix(b,"a\x3dfmtp:"+g+" ");k.parameters=n.length?a.parseFmtp(n[0]):{};k.rtcpFeedback=a.matchPrefix(b,"a\x3drtcp-fb:"+g+" ").map(a.parseRtcpFb);c.codecs.push(k);switch(k.name.toUpperCase()){case "RED":case "ULPFEC":c.fecMechanisms.push(k.name.toUpperCase())}}}a.matchPrefix(b,"a\x3dextmap:").forEach(function(b){c.headerExtensions.push(a.parseExtmap(b))});return c};a.writeRtpDescription=function(b,c){var e="";e+=
"m\x3d"+b+" ";e+=0<c.codecs.length?"9":"0";e+=" UDP/TLS/RTP/SAVPF ";e+=c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n";e+="c\x3dIN IP4 0.0.0.0\r\n";e+="a\x3drtcp:9 IN IP4 0.0.0.0\r\n";c.codecs.forEach(function(b){e+=a.writeRtpMap(b);e+=a.writeFmtp(b);e+=a.writeRtcpFb(b)});var d=0;c.codecs.forEach(function(a){a.maxptime>d&&(d=a.maxptime)});0<d&&(e+="a\x3dmaxptime:"+d+"\r\n");e+="a\x3drtcp-mux\r\n";c.headerExtensions&&c.headerExtensions.forEach(function(b){e+=
a.writeExtmap(b)});return e};a.parseRtpEncodingParameters=function(b){var c=[],e=a.parseRtpParameters(b),d=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),k=a.matchPrefix(b,"a\x3dssrc:").map(function(b){return a.parseSsrcMedia(b)}).filter(function(a){return"cname"===a.attribute}),n=0<k.length&&k[0].ssrc,x;k=a.matchPrefix(b,"a\x3dssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,10)})});0<k.length&&1<k[0].length&&k[0][0]===
n&&(x=k[0][1]);e.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:n,codecPayloadType:parseInt(a.parameters.apt,10)},n&&x&&(a.rtx={ssrc:x}),c.push(a),d&&(a=JSON.parse(JSON.stringify(a)),a.fec={ssrc:x,mechanism:g?"red+ulpfec":"red"},c.push(a)))});0===c.length&&n&&c.push({ssrc:n});var h=a.matchPrefix(b,"b\x3d");h.length&&(h=0===h[0].indexOf("b\x3dTIAS:")?parseInt(h[0].substr(7),10):0===h[0].indexOf("b\x3dAS:")?950*parseInt(h[0].substr(5),10)-16E3:void 0,c.forEach(function(a){a.maxBitrate=
h}));return c};a.parseRtcpParameters=function(b){var c={},e=a.matchPrefix(b,"a\x3dssrc:").map(function(b){return a.parseSsrcMedia(b)}).filter(function(a){return"cname"===a.attribute})[0];e&&(c.cname=e.value,c.ssrc=e.ssrc);e=a.matchPrefix(b,"a\x3drtcp-rsize");c.reducedSize=0<e.length;c.compound=0===e.length;b=a.matchPrefix(b,"a\x3drtcp-mux");c.mux=0<b.length;return c};a.parseMsid=function(b){var c=a.matchPrefix(b,"a\x3dmsid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};
b=a.matchPrefix(b,"a\x3dssrc:").map(function(b){return a.parseSsrcMedia(b)}).filter(function(a){return"msid"===a.attribute});if(0<b.length)return b=b[0].value.split(" "),{stream:b[0],track:b[1]}};a.generateSessionId=function(){return Math.random().toString().substr(2,21)};a.writeSessionBoilerplate=function(b,c){c=void 0!==c?c:2;return"v\x3d0\r\no\x3dthisisadapterortc "+(b?b:a.generateSessionId())+" "+c+" IN IP4 127.0.0.1\r\ns\x3d-\r\nt\x3d0 0\r\n"};a.writeMediaSection=function(b,c,e,d){c=a.writeRtpDescription(b.kind,
c);c+=a.writeIceParameters(b.iceGatherer.getLocalParameters());c+=a.writeDtlsParameters(b.dtlsTransport.getLocalParameters(),"offer"===e?"actpass":"active");c+="a\x3dmid:"+b.mid+"\r\n";c=b.direction?c+("a\x3d"+b.direction+"\r\n"):b.rtpSender&&b.rtpReceiver?c+"a\x3dsendrecv\r\n":b.rtpSender?c+"a\x3dsendonly\r\n":b.rtpReceiver?c+"a\x3drecvonly\r\n":c+"a\x3dinactive\r\n";b.rtpSender&&(e="msid:"+d.id+" "+b.rtpSender.track.id+"\r\n",c=c+("a\x3d"+e)+("a\x3dssrc:"+b.sendEncodingParameters[0].ssrc+" "+e),
b.sendEncodingParameters[0].rtx&&(c+="a\x3dssrc:"+b.sendEncodingParameters[0].rtx.ssrc+" "+e,c+="a\x3dssrc-group:FID "+b.sendEncodingParameters[0].ssrc+" "+b.sendEncodingParameters[0].rtx.ssrc+"\r\n"));c+="a\x3dssrc:"+b.sendEncodingParameters[0].ssrc+" cname:"+a.localCName+"\r\n";b.rtpSender&&b.sendEncodingParameters[0].rtx&&(c+="a\x3dssrc:"+b.sendEncodingParameters[0].rtx.ssrc+" cname:"+a.localCName+"\r\n");return c};a.getDirection=function(b,c){b=a.splitLines(b);for(var e=0;e<b.length;e++)switch(b[e]){case "a\x3dsendrecv":case "a\x3dsendonly":case "a\x3drecvonly":case "a\x3dinactive":return b[e].substr(2)}return c?
a.getDirection(c):"sendrecv"};a.getKind=function(b){return a.splitLines(b)[0].split(" ")[0].substr(2)};a.isRejected=function(a){return"0"===a.split(" ",2)[1]};a.parseMLine=function(b){b=a.splitLines(b)[0].substr(2).split(" ");return{kind:b[0],port:parseInt(b[1],10),protocol:b[2],fmt:b.slice(3).join(" ")}};a.parseOLine=function(b){b=a.matchPrefix(b,"o\x3d")[0].substr(2).split(" ");return{username:b[0],sessionId:b[1],sessionVersion:parseInt(b[2],10),netType:b[3],addressType:b[4],address:b[5]}};a.isValidSDP=
function(b){if("string"!==typeof b||0===b.length)return!1;b=a.splitLines(b);for(var c=0;c<b.length;c++)if(2>b[c].length||"\x3d"!==b[c].charAt(1))return!1;return!0};"object"===typeof g&&(g.exports=a)},{}],3:[function(k,g,d){d="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};k=k("./adapter_factory.js");g.exports=k({window:d.window})},{"./adapter_factory.js":4}],4:[function(k,g,d){var a=k("./utils");g.exports=function(b,c){b=b&&b.window;var e={shimChrome:!0,
shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(d in c)hasOwnProperty.call(c,d)&&(e[d]=c[d]);c=a.log;var d=a.detectBrowser(b);var g=k("./chrome/chrome_shim")||null,r=k("./edge/edge_shim")||null,n=k("./firefox/firefox_shim")||null,x=k("./safari/safari_shim")||null,h=k("./common_shim")||null,p={browserDetails:d,commonShim:h,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(d.browser){case "chrome":if(!g||!g.shimPeerConnection||!e.shimChrome){c("Chrome shim is not included in this adapter release.");
break}c("adapter.js shimming chrome.");p.browserShim=g;h.shimCreateObjectURL(b);g.shimGetUserMedia(b);g.shimMediaStream(b);g.shimSourceObject(b);g.shimPeerConnection(b);g.shimOnTrack(b);g.shimAddTrackRemoveTrack(b);g.shimGetSendersWithDtmf(b);g.shimSenderReceiverGetStats(b);g.fixNegotiationNeeded(b);h.shimRTCIceCandidate(b);h.shimMaxMessageSize(b);h.shimSendThrowTypeError(b);break;case "firefox":if(!n||!n.shimPeerConnection||!e.shimFirefox){c("Firefox shim is not included in this adapter release.");
break}c("adapter.js shimming firefox.");p.browserShim=n;h.shimCreateObjectURL(b);n.shimGetUserMedia(b);n.shimSourceObject(b);n.shimPeerConnection(b);n.shimOnTrack(b);n.shimRemoveStream(b);n.shimSenderGetStats(b);n.shimReceiverGetStats(b);n.shimRTCDataChannel(b);h.shimRTCIceCandidate(b);h.shimMaxMessageSize(b);h.shimSendThrowTypeError(b);break;case "edge":if(!r||!r.shimPeerConnection||!e.shimEdge){c("MS edge shim is not included in this adapter release.");break}c("adapter.js shimming edge.");p.browserShim=
r;h.shimCreateObjectURL(b);r.shimGetUserMedia(b);r.shimPeerConnection(b);r.shimReplaceTrack(b);h.shimMaxMessageSize(b);h.shimSendThrowTypeError(b);break;case "safari":if(!x||!e.shimSafari){c("Safari shim is not included in this adapter release.");break}c("adapter.js shimming safari.");p.browserShim=x;h.shimCreateObjectURL(b);x.shimRTCIceServerUrls(b);x.shimCreateOfferLegacy(b);x.shimCallbacksAPI(b);x.shimLocalStreamsAPI(b);x.shimRemoteStreamsAPI(b);x.shimTrackEventTransceiver(b);x.shimGetUserMedia(b);
h.shimRTCIceCandidate(b);h.shimMaxMessageSize(b);h.shimSendThrowTypeError(b);break;default:c("Unsupported browser!")}return p}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(k,g,d){function a(b,c,e){c&&!e.has(c.id)&&(e.set(c.id,c),Object.keys(c).forEach(function(d){d.endsWith("Id")?a(b,b.get(c[d]),e):d.endsWith("Ids")&&c[d].forEach(function(c){a(b,b.get(c),e)})}))}function b(b,c,e){var d=e?"outbound-rtp":
"inbound-rtp",m=new Map;if(null===c)return m;var h=[];b.forEach(function(a){"track"===a.type&&a.trackIdentifier===c.id&&h.push(a)});h.forEach(function(c){b.forEach(function(h){h.type===d&&h.trackId===c.id&&a(b,h,m)})});return m}var c=k("../utils.js"),e=c.log;g.exports={shimGetUserMedia:k("./getusermedia"),shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)"RTCRtpTransceiver"in
a||c.wrapPeerConnectionEvent(a,"track",function(a){a.transceiver||(a.transceiver={receiver:a.receiver});return a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=
this;c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(e){var h=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===e.track.id}):{track:e.track};var d=new Event("track");d.track=e.track;d.receiver=h;d.transceiver={receiver:h};d.streams=[b.stream];c.dispatchEvent(d)});b.stream.getTracks().forEach(function(e){var h=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&
a.track.id===e.id}):{track:e};var d=new Event("track");d.track=e;d.receiver=h;d.transceiver={receiver:h};d.streams=[b.stream];c.dispatchEvent(d)})},c.addEventListener("addstream",c._ontrackpoly));return b.apply(c,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"===typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){void 0===this._dtmf&&(this._dtmf="audio"===b.kind?
a.createDTMFSender(b):null);return this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,h){var e=c.apply(this,arguments);e||(e=b(this,a),this._senders.push(e));return e};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){e.apply(this,
arguments);var b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}var d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;c._senders=c._senders||[];d.apply(c,[a]);a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[];h.apply(b,[a]);a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===
a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"===typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var p=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=p.apply(a,[]);b.forEach(function(b){b._pc=a});return b};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===
this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null);return this._dtmf}})}},shimSenderReceiverGetStats:function(a){if("object"===typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver){if(!("getStats"in a.RTCRtpSender.prototype)){var e=a.RTCPeerConnection.prototype.getSenders;e&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=e.apply(a,[]);b.forEach(function(b){b._pc=a});return b});var d=a.RTCPeerConnection.prototype.addTrack;d&&
(a.RTCPeerConnection.prototype.addTrack=function(){var a=d.apply(this,arguments);a._pc=this;return a});a.RTCRtpSender.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(c){return b(c,a.track,!0)})}}if(!("getStats"in a.RTCRtpReceiver.prototype)){var n=a.RTCPeerConnection.prototype.getReceivers;n&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=n.apply(a,[]);b.forEach(function(b){b._pc=a});return b});c.wrapPeerConnectionEvent(a,"track",function(a){a.receiver._pc=
a.srcElement;return a});a.RTCRtpReceiver.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(c){return b(c,a.track,!1)})}}if("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype){var m=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof a.MediaStreamTrack){var b=arguments[0],c,e,d;this.getSenders().forEach(function(a){a.track===b&&(c?d=!0:c=a)});this.getReceivers().forEach(function(a){a.track===
b&&(e?d=!0:e=a);return a.track===b});return d||c&&e?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():e?e.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return m.apply(this,arguments)}}}},shimSourceObject:function(a){var b=a&&a.URL;"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,
"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;this._srcObject=a;this.src&&b.revokeObjectURL(this.src);a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src);c.src=b.createObjectURL(a)}),a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src);c.src=b.createObjectURL(a)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=
this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};return Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var h=b.apply(this,arguments);this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(h)&&this._shimmedLocalStreams[c.id].push(h):
this._shimmedLocalStreams[c.id]=[c,h];return h};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a.getTracks().forEach(function(a){if(b.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});var h=b.getSenders();c.apply(this,arguments);var e=b.getSenders().filter(function(a){return-1===h.indexOf(a)});this._shimmedLocalStreams[a.id]=
[a].concat(e)};var e=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{};delete this._shimmedLocalStreams[a.id];return e.apply(this,arguments)};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{};a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var h=b._shimmedLocalStreams[c].indexOf(a);
-1!==h&&b._shimmedLocalStreams[c].splice(h,1);1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]});return d.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function b(a,b){var c=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];c=c.replace(new RegExp(a._streams[b.id].id,"g"),b.id)});return new RTCSessionDescription({type:b.type,sdp:c})}function e(a,b){var c=b.sdp;Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];
c=c.replace(new RegExp(b.id,"g"),a._streams[b.id].id)});return new RTCSessionDescription({type:b.type,sdp:c})}var d=c.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=d.version)return this.shimAddTrackRemoveTrackWithNative(a);var g=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=g.apply(this);a._reverseStreams=a._reverseStreams||{};return b.map(function(b){return a._reverseStreams[b.id]})};var h=a.RTCPeerConnection.prototype.addStream;
a.RTCPeerConnection.prototype.addStream=function(b){var c=this;c._streams=c._streams||{};c._reverseStreams=c._reverseStreams||{};b.getTracks().forEach(function(a){if(c.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");});if(!c._reverseStreams[b.id]){var e=new a.MediaStream(b.getTracks());c._streams[b.id]=e;c._reverseStreams[e.id]=b;b=e}h.apply(c,[b])};var p=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=
function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};p.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=function(b,c){var h=this;if("closed"===h.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===
b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(h.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.","InvalidAccessError");h._streams=h._streams||{};h._reverseStreams=h._reverseStreams||{};(e=h._streams[c.id])?(e.addTrack(b),Promise.resolve().then(function(){h.dispatchEvent(new Event("negotiationneeded"))})):(e=new a.MediaStream([b]),h._streams[c.id]=
e,h._reverseStreams[e.id]=c,h.addStream(e));return h.getSenders().find(function(a){return a.track===b})};["createOffer","createAnswer"].forEach(function(c){var h=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments;return arguments.length&&"function"===typeof arguments[0]?h.apply(a,[function(h){h=b(a,h);c[0].apply(null,[h])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):h.apply(a,arguments).then(function(c){return b(a,c)})}});var m=a.RTCPeerConnection.prototype.setLocalDescription;
a.RTCPeerConnection.prototype.setLocalDescription=function(){if(!arguments.length||!arguments[0].type)return m.apply(this,arguments);arguments[0]=e(this,arguments[0]);return m.apply(this,arguments)};var k=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=k.get.apply(this);return""===a.type?a:b(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===
b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==b)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var c;Object.keys(b._streams).forEach(function(h){b._streams[h].getTracks().find(function(b){return a.track===b})&&(c=b._streams[h])});
c&&(1===c.getTracks().length?b.removeStream(b._reverseStreams[c.id]):c.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(a){var b=c.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection)a.RTCPeerConnection=function(b,c){e("PeerConnection");b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy);return new a.webkitRTCPeerConnection(b,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&
Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});else{var d=a.RTCPeerConnection;a.RTCPeerConnection=function(a,b){if(a&&a.iceServers){for(var h=[],e=0;e<a.iceServers.length;e++){var p=a.iceServers[e];!p.hasOwnProperty("urls")&&p.hasOwnProperty("url")?(c.deprecated("RTCIceServer.url","RTCIceServer.urls"),p=JSON.parse(JSON.stringify(p)),p.urls=p.url,h.push(p)):h.push(a.iceServers[e])}a.iceServers=h}return new d(a,
b)};a.RTCPeerConnection.prototype=d.prototype;Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return d.generateCertificate}})}var n=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,c){var h=this,e=arguments;if(0<arguments.length&&"function"===typeof a)return n.apply(this,arguments);var d=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||
a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b},p=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};return 2<=arguments.length?n.apply(this,[function(a){e[1](p(d(a)))},arguments[0]]):(new Promise(function(a,b){n.apply(h,[function(b){a(p(d(b)))},b])})).then(b,c)};51>b.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=
arguments,b=this,h=new Promise(function(h,e){c.apply(b,[a[0],h,e])});return 2>a.length?h:h.then(function(){a[1].apply(null,[])},function(b){3<=a.length&&a[2].apply(null,[b])})}});52>b.version&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(h,e){c.apply(a,
[h,e,b])})}return c.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});var g=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?g.apply(this,arguments):(arguments[1]&&
arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(a){c.wrapPeerConnectionEvent(a,"negotiationneeded",function(a){if("stable"===a.target.signalingState)return a})},shimGetDisplayMedia:function(a,b){"getDisplayMedia"in a.navigator||("function"!==typeof b?console.error("shimGetDisplayMedia: getSourceId argument is not a function"):navigator.getDisplayMedia=function(a){return b(a).then(function(b){a.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b,maxFrameRate:a.video.frameRate||
3}};return navigator.mediaDevices.getUserMedia(a)})})}}},{"../utils.js":14,"./getusermedia":6}],6:[function(k,g,d){var a=k("../utils.js"),b=a.log;g.exports=function(c){var e=a.detectBrowser(c),d=c&&c.navigator,g=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var h="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0!==h.exact&&"number"===typeof h.exact&&(h.min=h.max=h.exact);var e=function(a,
b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==h.ideal){b.optional=b.optional||[];var d={};"number"===typeof h.ideal?(d[e("min",c)]=h.ideal,b.optional.push(d),d={},d[e("max",c)]=h.ideal):d[e("",c)]=h.ideal;b.optional.push(d)}void 0!==h.exact&&"number"!==typeof h.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=h.exact):["min","max"].forEach(function(a){void 0!==h[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=h[a])})}});a.advanced&&(b.optional=
(b.optional||[]).concat(a.advanced));return b},k=function(a,c){if(61<=e.version)return c(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===typeof a.audio){var h=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a));h(a.audio,"autoGainControl","googAutoGainControl");h(a.audio,"noiseSuppression","googNoiseSuppression");a.audio=g(a.audio)}if(a&&"object"===typeof a.video){var p=a.video.facingMode;p=p&&("object"===typeof p?p:{ideal:p});h=66>e.version;if(!(!p||"user"!==
p.exact&&"environment"!==p.exact&&"user"!==p.ideal&&"environment"!==p.ideal||d.mediaDevices.getSupportedConstraints&&d.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;if("environment"===p.exact||"environment"===p.ideal)var n=["back","rear"];else if("user"===p.exact||"user"===p.ideal)n=["front"];if(n)return d.mediaDevices.enumerateDevices().then(function(h){h=h.filter(function(a){return"videoinput"===a.kind});var e=h.find(function(a){return n.some(function(b){return-1!==
a.label.toLowerCase().indexOf(b)})});!e&&h.length&&-1!==n.indexOf("back")&&(e=h[h.length-1]);e&&(a.video.deviceId=p.exact?{exact:e.deviceId}:{ideal:e.deviceId});a.video=g(a.video);b("chrome: "+JSON.stringify(a));return c(a)})}a.video=g(a.video)}b("chrome: "+JSON.stringify(a));return c(a)},n=function(a){return 64<=e.version?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",
TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};d.getUserMedia=function(a,b,c){k(a,function(a){d.webkitGetUserMedia(a,b,function(a){c&&c(n(a))})})};var x=function(a){return new Promise(function(b,
c){d.getUserMedia(a,b,c)})};d.mediaDevices||(d.mediaDevices={getUserMedia:x,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return c.MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}});if(d.mediaDevices.getUserMedia){var h=d.mediaDevices.getUserMedia.bind(d.mediaDevices);
d.mediaDevices.getUserMedia=function(a){return k(a,function(a){return h(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){c.L&&c.L.Utils&&"function"===typeof c.L.Utils.stopTrack?c.L.Utils.stopTrack(a):a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(n(a))})})}}else d.mediaDevices.getUserMedia=function(a){return x(a)};"undefined"===typeof d.mediaDevices.addEventListener&&
(d.mediaDevices.addEventListener=function(){b("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof d.mediaDevices.removeEventListener&&(d.mediaDevices.removeEventListener=function(){b("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(k,g,d){var a=k("sdp"),b=k("./utils");g.exports={shimRTCIceCandidate:function(c){if(c.RTCIceCandidate&&!(c.RTCIceCandidate&&"foundation"in c.RTCIceCandidate.prototype)){var e=c.RTCIceCandidate;c.RTCIceCandidate=function(b){"object"===
typeof b&&b.candidate&&0===b.candidate.indexOf("a\x3d")&&(b=JSON.parse(JSON.stringify(b)),b.candidate=b.candidate.substr(2));if(b.candidate&&b.candidate.length){var c=new e(b);b=a.parseCandidate(b.candidate);var d=Object.assign(c,b);d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}};return d}return new e(b)};c.RTCIceCandidate.prototype=e.prototype;b.wrapPeerConnectionEvent(c,"icecandidate",function(a){a.candidate&&Object.defineProperty(a,
"candidate",{value:new c.RTCIceCandidate(a.candidate),writable:"false"});return a})}},shimCreateObjectURL:function(a){var c=a&&a.URL;if("object"===typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&c.createObjectURL&&c.revokeObjectURL){var d=c.createObjectURL.bind(c),g=c.revokeObjectURL.bind(c),k=new Map,n=0;c.createObjectURL=function(a){if("getTracks"in a){var c="polyblob:"+ ++n;k.set(c,a);b.deprecated("URL.createObjectURL(stream)","elem.srcObject \x3d stream");return c}return d(a)};
c.revokeObjectURL=function(a){g(a);k.delete(a)};var x=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return x.get.apply(this)},set:function(a){this.srcObject=k.get(a)||null;return x.set.apply(this,[a])}});var h=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=k.get(arguments[1])||null);
return h.apply(this,arguments)}}},shimMaxMessageSize:function(c){if(!c.RTCSctpTransport&&c.RTCPeerConnection){var e=b.detectBrowser(c);"sctp"in c.RTCPeerConnection.prototype||Object.defineProperty(c.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var d=function(b){b=a.splitSections(b.sdp);b.shift();return b.some(function(b){return(b=a.parseMLine(b))&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},g=function(a){a=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);
if(null===a||2>a.length)return-1;a=parseInt(a[1],10);return a!==a?-1:a},k=function(a){var b=65536;"firefox"===e.browser&&(b=57>e.version?-1===a?16384:2147483637:60>e.version?57===e.version?65535:65536:2147483637);return b},n=function(b,c){var h=65536;"firefox"===e.browser&&57===e.version&&(h=65535);b=a.matchPrefix(b.sdp,"a\x3dmax-message-size:");0<b.length?h=parseInt(b[0].substr(19),10):"firefox"===e.browser&&-1!==c&&(h=2147483637);return h},x=c.RTCPeerConnection.prototype.setRemoteDescription;c.RTCPeerConnection.prototype.setRemoteDescription=
function(){this._sctp=null;if(d(arguments[0])){var a=g(arguments[0]),b=k(a);a=n(arguments[0],a);var c=0===b&&0===a?Number.POSITIVE_INFINITY:0===b||0===a?Math.max(b,a):Math.min(b,a);b={};Object.defineProperty(b,"maxMessageSize",{get:function(){return c}});this._sctp=b}return x.apply(this,arguments)}}},shimSendThrowTypeError:function(a){function c(a,b){var c=a.send;a.send=function(){var e=arguments[0];e=e.length||e.size||e.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+
b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var d=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=d.apply(this,arguments);c(a,this);return a};b.wrapPeerConnectionEvent(a,"datachannel",function(a){c(a.channel,a.target);return a})}}}},{"./utils":14,sdp:2}],8:[function(k,g,d){var a=k("../utils"),b=k("./filtericeservers"),c=k("rtcpeerconnection-shim");
g.exports={shimGetUserMedia:k("./getusermedia"),shimPeerConnection:function(e){var d=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(a){return a}),e.RTCSessionDescription||(e.RTCSessionDescription=function(a){return a}),15025>d.version)){var g=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(a){g.set.call(this,a);var b=new Event("enabled");b.enabled=a;this.dispatchEvent(b)}})}!e.RTCRtpSender||
"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null));return this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var k=c(e,d.version);e.RTCPeerConnection=function(a){a&&a.iceServers&&(a.iceServers=b(a.iceServers));return new k(a)};e.RTCPeerConnection.prototype=k.prototype},shimReplaceTrack:function(a){!a.RTCRtpSender||
"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(k,g,d){var a=k("../utils");g.exports=function(b,c){var e=!1;b=JSON.parse(JSON.stringify(b));return b.filter(function(b){if(b&&(b.urls||b.url)){var d=b.urls||b.url;b.url&&!b.urls&&a.deprecated("RTCIceServer.url","RTCIceServer.urls");var g="string"===typeof d;g&&(d=[d]);d=d.filter(function(a){return 0!==
a.indexOf("turn:")||-1===a.indexOf("transport\x3dudp")||-1!==a.indexOf("turn:[")||e?0===a.indexOf("stun:")&&14393<=c&&-1===a.indexOf("?transport\x3dudp"):e=!0});delete b.url;b.urls=g?d[0]:d;return!!d.length}})}},{"../utils":14}],10:[function(k,g,d){g.exports=function(a){a=a&&a.navigator;var b=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},c=a.mediaDevices.getUserMedia.bind(a.mediaDevices);
a.mediaDevices.getUserMedia=function(a){return c(a).catch(function(a){return Promise.reject(b(a))})}}},{}],11:[function(k,g,d){var a=k("../utils");g.exports={shimGetUserMedia:k("./getusermedia"),shimOnTrack:function(a){"object"!==typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",
this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b;c.receiver={track:b};c.transceiver={receiver:c.receiver};c.streams=[a.stream];this.dispatchEvent(c)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0});"object"===typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,
"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"===typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(b){var c=a.detectBrowser(b);if("object"===typeof b&&(b.RTCPeerConnection||b.mozRTCPeerConnection)){b.RTCPeerConnection||(b.RTCPeerConnection=function(a,
e){if(38>c.version&&a&&a.iceServers){for(var h=[],d=0;d<a.iceServers.length;d++){var g=a.iceServers[d];if(g.hasOwnProperty("urls"))for(var n=0;n<g.urls.length;n++){var k={url:g.urls[n]};0===g.urls[n].indexOf("turn")&&(k.username=g.username,k.credential=g.credential);h.push(k)}else h.push(a.iceServers[d])}a.iceServers=h}return new b.mozRTCPeerConnection(a,e)},b.RTCPeerConnection.prototype=b.mozRTCPeerConnection.prototype,b.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(b.RTCPeerConnection,
"generateCertificate",{get:function(){return b.mozRTCPeerConnection.generateCertificate}}),b.RTCSessionDescription=b.mozRTCSessionDescription,b.RTCIceCandidate=b.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=b.RTCPeerConnection.prototype[a];b.RTCPeerConnection.prototype[a]=function(){arguments[0]=new ("addIceCandidate"===a?b.RTCIceCandidate:b.RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}});var e=b.RTCPeerConnection.prototype.addIceCandidate;
b.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var d=function(a){var b=new Map;Object.keys(a).forEach(function(c){b.set(c,a[c]);b[c]=a[c]});return b},g={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},k=b.RTCPeerConnection.prototype.getStats;b.RTCPeerConnection.prototype.getStats=function(a,
b,h){return k.apply(this,[a||null]).then(function(a){48>c.version&&(a=d(a));if(53>c.version&&!b)try{a.forEach(function(a){a.type=g[a.type]||a.type})}catch(v){if("TypeError"!==v.name)throw v;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:g[b.type]||b.type}))})}return a}).then(b,h)}}},shimSenderGetStats:function(a){if("object"===typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=
function(){var a=this,c=b.apply(a,[]);c.forEach(function(b){b._pc=a});return c});var e=a.RTCPeerConnection.prototype.addTrack;e&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=e.apply(this,arguments);a._pc=this;return a});a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(b){if("object"===typeof b&&b.RTCPeerConnection&&b.RTCRtpSender&&!(b.RTCRtpSender&&"getStats"in b.RTCRtpReceiver.prototype)){var c=
b.RTCPeerConnection.prototype.getReceivers;c&&(b.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=c.apply(a,[]);b.forEach(function(b){b._pc=a});return b});a.wrapPeerConnectionEvent(b,"track",function(a){a.receiver._pc=a.srcElement;return a});b.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(b){!b.RTCPeerConnection||"removeStream"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.removeStream=function(b){var c=
this;a.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(a){a.track&&-1!==b.getTracks().indexOf(a.track)&&c.removeTrack(a)})})},shimRTCDataChannel:function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)},shimGetDisplayMedia:function(a,c){"getDisplayMedia"in a.navigator||(navigator.getDisplayMedia=function(a){if(!a||!a.video)return a=new DOMException("getDisplayMedia without video constraints is undefined"),a.name="NotFoundError",a.code=8,Promise.reject(a);
!0===a.video?a.video={mediaSource:c}:a.video.mediaSource=c;return navigator.mediaDevices.getUserMedia(a)})}}},{"../utils":14,"./getusermedia":12}],12:[function(k,g,d){var a=k("../utils"),b=a.log;g.exports=function(c){var e=a.detectBrowser(c),d=c&&c.navigator,g=c&&c.MediaStreamTrack,k=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||
a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},n=function(a,c,h){var p=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var h=a[c]="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0===h.min&&void 0===h.max&&void 0===h.exact||b.push(c);void 0!==h.exact&&("number"===typeof h.exact?h.min=h.max=h.exact:a[c]=h.exact,delete h.exact);if(void 0!==
h.ideal){a.advanced=a.advanced||[];var e={};e[c]="number"===typeof h.ideal?{min:h.ideal,max:h.ideal}:h.ideal;a.advanced.push(e);delete h.ideal;Object.keys(h).length||delete a[c]}}});b.length&&(a.require=b);return a};a=JSON.parse(JSON.stringify(a));38>e.version&&(b("spec: "+JSON.stringify(a)),a.audio&&(a.audio=p(a.audio)),a.video&&(a.video=p(a.video)),b("ff37: "+JSON.stringify(a)));return d.mozGetUserMedia(a,c,function(a){h(k(a))})},x=function(a){return new Promise(function(b,c){n(a,b,c)})};d.mediaDevices||
(d.mediaDevices={getUserMedia:x,addEventListener:function(){},removeEventListener:function(){}});d.mediaDevices.enumerateDevices=d.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>e.version){var h=d.mediaDevices.enumerateDevices.bind(d.mediaDevices);d.mediaDevices.enumerateDevices=function(){return h().then(void 0,function(a){if("NotFoundError"===
a.name)return[];throw a;})}}if(49>e.version){var p=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){return p(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){c.L&&c.L.Utils&&"function"===typeof c.L.Utils.stopTrack?c.L.Utils.stopTrack(a):a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(k(a))})}}if(!(55<
e.version&&"autoGainControl"in d.mediaDevices.getSupportedConstraints())){var v=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},E=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){"object"===typeof a&&"object"===typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),v(a.audio,"autoGainControl","mozAutoGainControl"),v(a.audio,"noiseSuppression","mozNoiseSuppression"));return E(a)};if(g&&g.prototype.getSettings){var B=g.prototype.getSettings;g.prototype.getSettings=
function(){var a=B.apply(this,arguments);v(a,"mozAutoGainControl","autoGainControl");v(a,"mozNoiseSuppression","noiseSuppression");return a}}if(g&&g.prototype.applyConstraints){var K=g.prototype.applyConstraints;g.prototype.applyConstraints=function(a){"audio"===this.kind&&"object"===typeof a&&(a=JSON.parse(JSON.stringify(a)),v(a,"autoGainControl","mozAutoGainControl"),v(a,"noiseSuppression","mozNoiseSuppression"));return K.apply(this,[a])}}}d.getUserMedia=function(b,c,h){if(44>e.version)return n(b,
c,h);a.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");d.mediaDevices.getUserMedia(b).then(c,h)}}},{"../utils":14}],13:[function(k,g,d){var a=k("../utils");g.exports={shimLocalStreamsAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection){"getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){this._localStreams||(this._localStreams=[]);return this._localStreams});"getStreamById"in a.RTCPeerConnection.prototype||
(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)});this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)});return b});if(!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var c=this;
a.getTracks().forEach(function(e){b.call(c,e,a)})};a.RTCPeerConnection.prototype.addTrack=function(a,c){c&&(this._localStreams?-1===this._localStreams.indexOf(c)&&this._localStreams.push(c):this._localStreams=[c]);return b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){-1!==
d.indexOf(a.track)&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){this._onaddstream&&this.removeEventListener("addstream",
this._onaddstream);this.addEventListener("addstream",this._onaddstream=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(function(b){a._remoteStreams||(a._remoteStreams=[]);if(!(0<=a._remoteStreams.indexOf(b))){a._remoteStreams.push(b);var c=new Event("addstream");c.stream=b;a.dispatchEvent(c)}})});return b.apply(a,
arguments)}}},shimCallbacksAPI:function(a){if("object"===typeof a&&a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var b=a.createOffer,d=a.createAnswer,g=a.setLocalDescription,k=a.setRemoteDescription,r=a.addIceCandidate;a.createOffer=function(a,c){var h=b.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!c)return h;h.then(a,c);return Promise.resolve()};a.createAnswer=function(a,b){var c=d.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);if(!b)return c;c.then(a,b);return Promise.resolve()};
var n=function(a,b,c){a=g.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};a.setLocalDescription=n;n=function(a,b,c){a=k.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};a.setRemoteDescription=n;n=function(a,b,c){a=r.apply(this,[a]);if(!c)return a;a.then(b,c);return Promise.resolve()};a.addIceCandidate=n}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&
(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b)))},shimRTCIceServerUrls:function(b){var c=b.RTCPeerConnection;b.RTCPeerConnection=function(b,d){if(b&&b.iceServers){for(var e=[],g=0;g<b.iceServers.length;g++){var n=b.iceServers[g];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,e.push(n)):e.push(b.iceServers[g])}b.iceServers=e}return new c(b,d)};b.RTCPeerConnection.prototype=
c.prototype;"generateCertificate"in b.RTCPeerConnection&&Object.defineProperty(b.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"===typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection.prototype.createOffer;
a.RTCPeerConnection.prototype.createOffer=function(a){if(a){"undefined"!==typeof a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var c=this.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio");
"undefined"!==typeof a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);c=this.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection("sendonly"):"recvonly"===c.direction&&c.setDirection("inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video")}return b.apply(this,arguments)}}}},{"../utils":14}],14:[function(k,g,d){function a(a,b,c){return(a=a.match(b))&&a.length>=
c&&parseInt(a[c],10)}var b=!0,c=!0;g.exports={extractVersion:a,wrapPeerConnectionEvent:function(a,b,c){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var d=a.addEventListener;a.addEventListener=function(a,h){if(a!==b)return d.apply(this,arguments);var e=function(a){(a=c(a))&&h(a)};this._eventMap=this._eventMap||{};this._eventMap[h]=e;return d.apply(this,[a,e])};var e=a.removeEventListener;a.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return e.apply(this,
arguments);var h=this._eventMap[c];delete this._eventMap[c];return e.apply(this,[a,h])};Object.defineProperty(a,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]);a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}},disableLog:function(a){return"boolean"!==typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(b=a)?"adapter.js logging disabled":"adapter.js logging enabled"},
disableWarnings:function(a){if("boolean"!==typeof a)return Error("Argument type: "+typeof a+". Please use a boolean.");c=!a;return"adapter.js deprecation warnings "+(a?"disabled":"enabled")},log:function(){"object"!==typeof window||b||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},deprecated:function(a,b){c&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(b){var c=b&&b.navigator,d={browser:null,version:null};
if("undefined"===typeof b||!b.navigator)return d.browser="Not a browser.",d;c.mozGetUserMedia?(d.browser="firefox",d.version=a(c.userAgent,/Firefox\/(\d+)\./,1)):c.webkitGetUserMedia?(d.browser="chrome",d.version=a(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/)?(d.browser="edge",d.version=a(c.userAgent,/Edge\/(\d+).(\d+)$/,2)):b.RTCPeerConnection&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(d.browser="safari",d.version=a(c.userAgent,/AppleWebKit\/(\d+)\./,
1)):d.browser="Not a supported browser.";return d}}},{}]},{},[3])(3)});/*
 @overview es6-promise - a tiny implementation of Promises/A+.
 @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 @license   Licensed under MIT license
            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 @version   v4.2.4+314e4831
*/
window.TK=window.TK||{};window.L=window.L||{};
(function(f,k){"object"===typeof exports&&"undefined"!==typeof module?module.exports=k():"function"===typeof define&&define.amd?define(k):f.ES6Promise=k();("undefined"!==typeof window?window:"undefined"!==typeof self?self:this).Promise=k()})(this,function(){function f(){return function(){return process.nextTick(b)}}function k(){return"undefined"!==typeof G?function(){G(b)}:a()}function g(){var a=0,c=new va(b),h=document.createTextNode("");c.observe(h,{characterData:!0});return function(){h.data=a=
++a%2}}function d(){var a=new MessageChannel;a.port1.onmessage=b;return function(){return a.port2.postMessage(0)}}function a(){var a=setTimeout;return function(){return a(b,1)}}function b(){for(var a=0;a<F;a+=2)(0,ia[a])(ia[a+1]),ia[a]=void 0,ia[a+1]=void 0;F=0}function c(){try{var b=Function("return this")().require("vertx");G=b.runOnLoop||b.runOnContext;return k()}catch(ba){return a()}}function e(a,b){var c=this,h=new this.constructor(u);void 0===h[T]&&N(h);var d=c._state;if(d){var e=arguments[d-
1];Y(function(){return X(d,h,e,c._result)})}else M(c,h,a,b);return h}function m(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(u);v(b,a);return b}function u(){}function r(a){try{return a.then}catch(ba){return R.error=ba,R}}function n(a,b,c,h){try{a.call(b,c,h)}catch(ua){return ua}}function x(a,b,c){Y(function(a){var h=!1,d=n(c,b,function(c){h||(h=!0,b!==c?v(a,c):B(a,c))},function(b){h||(h=!0,K(a,b))},"Settle: "+(a._label||" unknown promise"));!h&&d&&(h=!0,K(a,d))},a)}function h(a,
b){b._state===ta?B(a,b._result):b._state===pa?K(a,b._result):M(b,void 0,function(b){return v(a,b)},function(b){return K(a,b)})}function p(a,b,c){b.constructor===a.constructor&&c===e&&b.constructor.resolve===m?h(a,b):c===R?(K(a,R.error),R.error=null):void 0===c?B(a,b):"function"===typeof c?x(a,b,c):B(a,b)}function v(a,b){if(a===b)K(a,new TypeError("You cannot resolve a promise with itself"));else{var c=typeof b;null===b||"object"!==c&&"function"!==c?B(a,b):p(a,b,r(b))}}function E(a){a._onerror&&a._onerror(a._result);
Q(a)}function B(a,b){a._state===ha&&(a._result=b,a._state=ta,0!==a._subscribers.length&&Y(Q,a))}function K(a,b){a._state===ha&&(a._state=pa,a._result=b,Y(E,a))}function M(a,b,c,h){var d=a._subscribers,e=d.length;a._onerror=null;d[e]=b;d[e+ta]=c;d[e+pa]=h;0===e&&a._state&&Y(Q,a)}function Q(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var h,d,e=a._result,p=0;p<b.length;p+=3)h=b[p],d=b[p+c],h?X(c,h,d,e):d(e);a._subscribers.length=0}}function X(a,b,c,h){var d="function"===typeof c,e=void 0,
p=void 0,f=void 0,g=void 0;if(d){try{e=c(h)}catch(A){R.error=A,e=R}e===R?(g=!0,p=e.error,e.error=null):f=!0;if(b===e){K(b,new TypeError("A promises callback cannot return that same promise."));return}}else e=h,f=!0;b._state===ha&&(d&&f?v(b,e):g?K(b,p):a===ta?B(b,e):a===pa&&K(b,e))}function z(a,b){try{b(function(b){v(a,b)},function(b){K(a,b)})}catch(y){K(a,y)}}function N(a){a[T]=wa++;a._state=void 0;a._result=void 0;a._subscribers=[]}var I=void 0,O=I=Array.isArray?Array.isArray:function(a){return"[object Array]"===
Object.prototype.toString.call(a)},F=0,G=void 0,S=void 0,Y=function(a,c){ia[F]=a;ia[F+1]=c;F+=2;2===F&&(S?S(b):ca())},J=(I="undefined"!==typeof window?window:void 0)||{},va=J.MutationObserver||J.WebKitMutationObserver;J="undefined"===typeof self&&"undefined"!==typeof process&&"[object process]"==={}.toString.call(process);var C="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,ia=Array(1E3),ca=void 0;ca=J?f():va?g():C?d():void 0===I&&"function"===
typeof require?c():a();var T=Math.random().toString(36).substring(2),ha=void 0,ta=1,pa=2,R={error:null},wa=0,ja=function(){function a(a,b){this._instanceConstructor=a;this.promise=new a(u);this.promise[T]||N(this.promise);O(b)?(this._remaining=this.length=b.length,this._result=Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&B(this.promise,this._result))):K(this.promise,Error("Array Methods must be provided an Array"))}
a.prototype._enumerate=function(a){for(var b=0;this._state===ha&&b<a.length;b++)this._eachEntry(a[b],b)};a.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,h=c.resolve;h===m?(h=r(a),h===e&&a._state!==ha?this._settledAt(a._state,b,a._result):"function"!==typeof h?(this._remaining--,this._result[b]=a):c===V?(c=new c(u),p(c,a,h),this._willSettleAt(c,b)):this._willSettleAt(new c(function(b){return b(a)}),b)):this._willSettleAt(h(a),b)};a.prototype._settledAt=function(a,b,c){var h=this.promise;
h._state===ha&&(this._remaining--,a===pa?K(h,c):this._result[b]=c);0===this._remaining&&B(h,this._result)};a.prototype._willSettleAt=function(a,b){var c=this;M(a,void 0,function(a){return c._settledAt(ta,b,a)},function(a){return c._settledAt(pa,b,a)})};return a}(),V=function(){function a(b){this[T]=wa++;this._result=this._state=void 0;this._subscribers=[];if(u!==b){if("function"!==typeof b)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof
a)z(this,b);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}}a.prototype.catch=function(a){return this.then(null,a)};a.prototype.finally=function(a){var b=this.constructor;return this.then(function(c){return b.resolve(a()).then(function(){return c})},function(c){return b.resolve(a()).then(function(){throw c;})})};return a}();V.prototype.then=e;V.all=function(a){return(new ja(this,a)).promise};V.race=
function(a){var b=this;return O(a)?new b(function(c,h){for(var d=a.length,e=0;e<d;e++)b.resolve(a[e]).then(c,h)}):new b(function(a,b){return b(new TypeError("You must pass an array to race."))})};V.resolve=m;V.reject=function(a){var b=new this(u);K(b,a);return b};V._setScheduler=function(a){S=a};V._setAsap=function(a){Y=a};V._asap=Y;V.polyfill=function(){var a=void 0;if("undefined"!==typeof global)a=global;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(Z){throw Error("polyfill failed because global object is unavailable in this environment");
}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(Z){}if("[object Promise]"===c&&!b.cast)return}a.Promise=V};V.Promise=V;V.polyfill();return V});window.TK=window.TK||{};window.L=window.L||{};(function(){var f=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"===typeof window.__SDKDEV__)try{f=window.__SDKDEV__}catch(g){f=!1}if(!f){f=decodeURIComponent(window.location.href);var k=f.indexOf("?");f=f.substring(k+1).match(/(^|&)debug=([^&]*)(&|$)/i);f=null!=f?f[2]:""}window.__TkSdkBuild__=!f;try{window.localStorage?window.localStorage.setItem("debug",f?"*":"none"):console.warn("[tk-sdk]window.localStorage is not exist!")}catch(g){console.warn("[tk-sdk]Browser does not support localStorage!")}})();
!function(f,k){"object"==typeof exports&&"object"==typeof module?module.exports=k():"function"==typeof define&&define.amd?define([],k):"object"==typeof exports?exports.io=k():f.io=k();window&&"function"===typeof k&&!window.io&&(window.io=k())}(this||window,function(){return function(f){function k(d){if(g[d])return g[d].exports;var a=g[d]={exports:{},id:d,loaded:!1};return f[d].call(a.exports,a,a.exports,k),a.loaded=!0,a.exports}var g={};return k.m=f,k.c=g,k.p="",k(0)}([function(f,k,g){function d(c,
d){"object"===("undefined"==typeof c?"undefined":a(c))&&(d=c,c=void 0);d=d||{};var f;c=b(c);var h=c.source,p=c.id,g=c.path;g=u[p]&&g in u[p].nsps;return d.forceNew||d["force new connection"]||!1===d.multiplex||g?(m("ignoring socket cache for %s",h),f=e(h,d)):(u[p]||(m("new io instance for %s",h),u[p]=e(h,d)),f=u[p]),c.query&&!d.query&&(d.query=c.query),f.socket(c.path,d)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==
typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b=g(1),c=g(7),e=g(13),m=g(3)("socket.io-client");f.exports=k=d;var u=k.managers={};k.protocol=c.protocol;k.connect=d;k.Manager=g(13);k.Socket=g(39)},function(f,k,g){(function(d){var a=g(2),b=g(3)("socket.io-client:url");f.exports=function(c,e){var f=c;e=e||d.location;null==c&&(c=e.protocol+"//"+e.host);"string"==typeof c&&("/"===c.charAt(0)&&(c="/"===c.charAt(1)?e.protocol+c:e.host+c),/^(https?|wss?):\/\//.test(c)||(b("protocol-less url %s",
c),c="undefined"!=typeof e?e.protocol+"//"+c:"https://"+c),b("parse %s",c),f=a(c));f.port||(/^(http|ws)$/.test(f.protocol)?f.port="80":/^(http|ws)s$/.test(f.protocol)&&(f.port="443"));f.path=f.path||"/";c=-1!==f.host.indexOf(":")?"["+f.host+"]":f.host;return f.id=f.protocol+"://"+c+":"+f.port,f.href=f.protocol+"://"+c+(e&&e.port===f.port?"":":"+f.port),f}}).call(k,function(){return this||window}())},function(f,k){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
d="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");f.exports=function(a){var b=a,c=a.indexOf("["),e=a.indexOf("]");-1!=c&&-1!=e&&(a=a.substring(0,c)+a.substring(c,e).replace(/:/g,";")+a.substring(e,a.length));a=g.exec(a||"");for(var f={},k=14;k--;)f[d[k]]=a[k]||"";return-1!=c&&-1!=e&&(f.source=b,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=
!0),f}},function(f,k,g){(function(d){function a(){try{var a=k.storage.debug}catch(m){}return!a&&"undefined"!=typeof d&&"env"in d&&(a=d.env.DEBUG),a}k=f.exports=g(5);k.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};k.formatArgs=function(a){var b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+k.humanize(this.diff),b){b="color: "+this.color;a.splice(1,0,b,"color: inherit");var c=0,d=0;a[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&(c++,"%c"===a&&(d=c))});a.splice(d,0,b)}};k.save=function(a){try{null==a?k.storage.removeItem("debug"):k.storage.debug=a}catch(m){}};k.load=a;k.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var b=k;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var c=chrome.storage.local;else a:{try{c=window.localStorage;break a}catch(e){}c=void 0}b.storage=c;k.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
k.formatters.j=function(a){try{return JSON.stringify(a)}catch(m){return"[UnexpectedJSONParseError]: "+m.message}};k.enable(a())}).call(k,g(4))},function(f,k){function g(){throw Error("setTimeout has not been defined");}function d(){throw Error("clearTimeout has not been defined");}function a(a){if(r===setTimeout)return setTimeout(a,0);if((r===g||!r)&&setTimeout)return r=setTimeout,setTimeout(a,0);try{return r(a,0)}catch(B){try{return r.call(null,a,0)}catch(K){return r.call(this,a,0)}}}function b(a){if(n===
clearTimeout)return clearTimeout(a);if((n===d||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(a);try{return n(a)}catch(B){try{return n.call(null,a)}catch(K){return n.call(this,a)}}}function c(){p&&x&&(p=!1,x.length?h=x.concat(h):v=-1,h.length&&e())}function e(){if(!p){var d=a(c);p=!0;for(var e=h.length;e;){x=h;for(h=[];++v<e;)x&&x[v].run();v=-1;e=h.length}x=null;p=!1;b(d)}}function m(a,b){this.fun=a;this.array=b}function u(){}f=f.exports={};try{var r="function"==typeof setTimeout?setTimeout:
g}catch(E){r=g}try{var n="function"==typeof clearTimeout?clearTimeout:d}catch(E){n=d}!0;var x,h=[],p=!1,v=-1;f.nextTick=function(b){var c=Array(arguments.length-1);if(1<arguments.length)for(var d=1;d<arguments.length;d++)c[d-1]=arguments[d];h.push(new m(b,c));1!==h.length||p||a(e)};m.prototype.run=function(){this.fun.apply(null,this.array)};f.title="browser";f.browser=!0;f.env={};f.argv=[];f.version="";f.versions={};f.on=u;f.addListener=u;f.once=u;f.off=u;f.removeListener=u;f.removeAllListeners=u;
f.emit=u;f.prependListener=u;f.prependOnceListener=u;f.listeners=function(a){return[]};f.binding=function(a){throw Error("process.binding is not supported");};f.cwd=function(){return"/"};f.chdir=function(a){throw Error("process.chdir is not supported");};f.umask=function(){return 0}},function(f,k,g){function d(a){var b,c=0;for(b in a)c=(c<<5)-c+a.charCodeAt(b),c|=0;return k.colors[Math.abs(c)%k.colors.length]}function a(a){function c(){if(c.enabled){var a=+new Date;c.diff=a-(b||a);c.prev=b;b=c.curr=
a;var d=Array(arguments.length);for(a=0;a<d.length;a++)d[a]=arguments[a];d[0]=k.coerce(d[0]);"string"!=typeof d[0]&&d.unshift("%O");var e=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(a,b){if("%%"===a)return a;e++;b=k.formatters[b];"function"==typeof b&&(a=b.call(c,d[e]),d.splice(e,1),e--);return a});k.formatArgs.call(c,d);(c.log||k.log||console.log.bind(console)).apply(c,d)}}return c.namespace=a,c.enabled=k.enabled(a),c.useColors=k.useColors(),c.color=d(a),"function"==typeof k.init&&k.init(c),c}k=
f.exports=a.debug=a["default"]=a;k.coerce=function(a){return a instanceof Error?a.stack||a.message:a};k.disable=function(){k.enable("")};k.enable=function(a){k.save(a);k.names=[];k.skips=[];for(var b=("string"==typeof a?a:"").split(/[\s,]+/),c=b.length,d=0;d<c;d++)b[d]&&(a=b[d].replace(/\*/g,".*?"),"-"===a[0]?k.skips.push(new RegExp("^"+a.substr(1)+"$")):k.names.push(new RegExp("^"+a+"$")))};k.enabled=function(a){var b;var c=0;for(b=k.skips.length;c<b;c++)if(k.skips[c].test(a))return!1;c=0;for(b=
k.names.length;c<b;c++)if(k.names[c].test(a))return!0;return!1};k.humanize=g(6);k.names=[];k.skips=[];k.formatters={};var b},function(f,k){function g(d){if(d=String(d),!(100<d.length))if(d=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(d)){var f=parseFloat(d[1]);switch((d[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return f*m;case "days":case "day":case "d":return f*e;case "hours":case "hour":case "hrs":case "hr":case "h":return f*
c;case "minutes":case "minute":case "mins":case "min":case "m":return f*b;case "seconds":case "second":case "secs":case "sec":case "s":return f*a;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return f}}}function d(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var a=1E3,b=60*a,c=60*b,e=24*c,m=365.25*e;f.exports=function(f,k){k=k||{};var n=typeof f;if("string"===n&&0<f.length)return g(f);if("number"===n&&!1===isNaN(f))return k["long"]?d(f,
e,"day")||d(f,c,"hour")||d(f,b,"minute")||d(f,a,"second")||f+" ms":f>=e?Math.round(f/e)+"d":f>=c?Math.round(f/c)+"h":f>=b?Math.round(f/b)+"m":f>=a?Math.round(f/a)+"s":f+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(f));}},function(f,k,g){function d(){}function a(a){var b=""+a.type;return k.BINARY_EVENT!==a.type&&k.BINARY_ACK!==a.type||(b+=a.attachments+"-"),a.nsp&&"/"!==a.nsp&&(b+=a.nsp+","),null!=a.id&&(b+=a.id),null!=a.data&&(b+=JSON.stringify(a.data)),
u("encoded %j as %s",a,b),b}function b(b,c){n.removeBlobs(b,function(b){var h=n.deconstructPacket(b);b=a(h.packet);h=h.buffers;h.unshift(b);c(h)})}function c(){this.reconstructor=null}function e(a){this.reconPack=a;this.buffers=[]}function m(){return{type:k.ERROR,data:"parser error"}}var u=g(3)("socket.io-parser");f=g(8);var r=g(9),n=g(11),x=g(12);k.protocol=4;k.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");k.CONNECT=0;k.DISCONNECT=1;k.EVENT=2;k.ACK=3;k.ERROR=4;k.BINARY_EVENT=
5;k.BINARY_ACK=6;k.Encoder=d;k.Decoder=c;d.prototype.encode=function(c,d){(c.type!==k.EVENT&&c.type!==k.ACK||!r(c.data)||(c.type=c.type===k.EVENT?k.BINARY_EVENT:k.BINARY_ACK),u("encoding packet %j",c),k.BINARY_EVENT===c.type||k.BINARY_ACK===c.type)?b(c,d):(c=a(c),d([c]))};f(c.prototype);c.prototype.add=function(a){if("string"==typeof a){var b=0,c={type:Number(a.charAt(0))};if(null==k.types[c.type])a=m();else{if(k.BINARY_EVENT===c.type||k.BINARY_ACK===c.type){for(var d="";"-"!==a.charAt(++b)&&(d+=
a.charAt(b),b!=a.length););if(d!=Number(d)||"-"!==a.charAt(b))throw Error("Illegal attachments");c.attachments=Number(d)}if("/"===a.charAt(b+1))for(c.nsp="";++b;){d=a.charAt(b);if(","===d)break;if(c.nsp+=d,b===a.length)break}else c.nsp="/";d=a.charAt(b+1);if(""!==d&&Number(d)==d){for(c.id="";++b;){d=a.charAt(b);if(null==d||Number(d)!=d){--b;break}if(c.id+=a.charAt(b),b===a.length)break}c.id=Number(c.id)}if(a.charAt(++b)){b:{b=a.substr(b);try{c.data=JSON.parse(b)}catch(B){b=m();break b}b=c}c=b}a=(u("decoded %s as %j",
a,c),c)}k.BINARY_EVENT===a.type||k.BINARY_ACK===a.type?(this.reconstructor=new e(a),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",a)):this.emit("decoded",a)}else{if(!x(a)&&!a.base64)throw Error("Unknown type: "+a);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(a=this.reconstructor.takeBinaryData(a))&&(this.reconstructor=null,this.emit("decoded",a))}};c.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
e.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===this.reconPack.attachments)?(a=n.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};e.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(f,k,g){function d(a){if(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}}f.exports=d;d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+
a]=this._callbacks["$"+a]||[]).push(b),this};d.prototype.once=function(a,b){function c(){this.off(a,c);b.apply(this,arguments)}return c.fn=b,this.on(a,c),this};d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,f=0;f<c.length;f++)if(d=
c[f],d===b||d.fn===b){c.splice(f,1);break}return this};d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,f=c.length;d<f;++d)c[d].apply(this,b)}return this};d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(f,k,g){(function(d){function a(c){if(!c||"object"!=typeof c)return!1;
if(b(c)){for(var f=0,g=c.length;f<g;f++)if(a(c[f]))return!0;return!1}if("function"==typeof d.Buffer&&d.Buffer.isBuffer&&d.Buffer.isBuffer(c)||"function"==typeof d.ArrayBuffer&&c instanceof ArrayBuffer||e&&c instanceof Blob||k&&c instanceof File)return!0;if(c.toJSON&&"function"==typeof c.toJSON&&1===arguments.length)return a(c.toJSON(),!0);for(f in c)if(Object.prototype.hasOwnProperty.call(c,f)&&a(c[f]))return!0;return!1}var b=g(10),c=Object.prototype.toString,e="function"==typeof d.Blob||"[object BlobConstructor]"===
c.call(d.Blob),k="function"==typeof d.File||"[object FileConstructor]"===c.call(d.File);f.exports=a}).call(k,function(){return this||window}())},function(f,k){var g={}.toString;f.exports=Array.isArray||function(d){return"[object Array]"==g.call(d)}},function(f,k,g){(function(d){function a(b,d){if(!b)return b;if(e(b)){var h={_placeholder:!0,num:d.length};return d.push(b),h}if(c(b)){h=Array(b.length);for(var f=0;f<b.length;f++)h[f]=a(b[f],d);return h}if("object"==typeof b&&!(b instanceof Date)){h={};
for(f in b)h[f]=a(b[f],d);return h}return b}function b(a,d){if(!a)return a;if(a&&a._placeholder)return d[a.num];if(c(a))for(var h=0;h<a.length;h++)a[h]=b(a[h],d);else if("object"==typeof a)for(h in a)a[h]=b(a[h],d);return a}var c=g(10),e=g(12),f=Object.prototype.toString,u="function"==typeof d.Blob||"[object BlobConstructor]"===f.call(d.Blob),r="function"==typeof d.File||"[object FileConstructor]"===f.call(d.File);k.deconstructPacket=function(b){var c=[];return b.data=a(b.data,c),b.attachments=c.length,
{packet:b,buffers:c}};k.reconstructPacket=function(a,c){return a.data=b(a.data,c),a.attachments=void 0,a};k.removeBlobs=function(a,b){function d(a,h,p){if(!a)return a;if(u&&a instanceof Blob||r&&a instanceof File){f++;var k=new FileReader;k.onload=function(){p?p[h]=this.result:g=this.result;--f||b(g)};k.readAsArrayBuffer(a)}else if(c(a))for(k=0;k<a.length;k++)d(a[k],k,a);else if("object"==typeof a&&!e(a))for(k in a)d(a[k],k,a)}var f=0,g=a;d(g);f||b(g)}}).call(k,function(){return this||window}())},
function(f,k){(function(g){f.exports=function(d){return g.Buffer&&g.Buffer.isBuffer(d)||g.ArrayBuffer&&d instanceof ArrayBuffer}}).call(k,function(){return this||window}())},function(f,k,g){function d(b,c){if(!(this instanceof d))return new d(b,c);b&&"object"===("undefined"==typeof b?"undefined":a(b))&&(c=b,b=void 0);c=c||{};c.path=c.path||"/socket.io";this.nsps={};this.subs=[];this.opts=c;this.reconnection(!1!==c.reconnection);this.reconnectionAttempts(c.reconnectionAttempts||1/0);this.reconnectionDelay(c.reconnectionDelay||
1E3);this.reconnectionDelayMax(c.reconnectionDelayMax||5E3);this.randomizationFactor(c.randomizationFactor||.5);this.backoff=new x({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==c.timeout?2E4:c.timeout);this.readyState="closed";this.uri=b;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];b=c.parser||e;this.encoder=new b.Encoder;this.decoder=new b.Decoder;(this.autoConnect=!1!==c.autoConnect)&&this.open()}
var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b=g(14),c=g(39);k=g(8);var e=g(7),m=g(41),u=g(42),r=g(3)("socket.io-client:manager"),n=g(37),x=g(43),h=Object.prototype.hasOwnProperty;f.exports=d;d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)h.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)};
d.prototype.updateSocketIds=function(){for(var a in this.nsps)h.call(this.nsps,a)&&(this.nsps[a].id=this.generateId(a))};d.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};k(d.prototype);d.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};d.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};d.prototype.reconnectionDelay=function(a){return arguments.length?
(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),this):this._reconnectionDelay};d.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};d.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};d.prototype.timeout=function(a){return arguments.length?(this._timeout=
a,this):this._timeout};d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};d.prototype.open=d.prototype.connect=function(a,c){if(r("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;r("opening %s",this.uri);var d=this.engine=b(this.uri,this.opts),h=this;this.readyState="opening";this.skipReconnect=!1;var e=m(d,"open",function(){h.onopen();a&&a()});c=m(d,"error",function(b){if(r("connect_error"),
h.cleanup(),h.readyState="closed",h.emitAll("connect_error",b),a){var c=Error("Connection error");c.data=b;a(c)}else h.maybeReconnectOnOpen()});if(!1!==this._timeout){var f=this._timeout;r("connect attempt will timeout after %d",f);var g=setTimeout(function(){r("connect attempt timed out after %d",f);e.destroy();d.close();d.emit("error","timeout");h.emitAll("connect_timeout",f)},f);this.subs.push({destroy:function(){clearTimeout(g)}})}return this.subs.push(e),this.subs.push(c),this};d.prototype.onopen=
function(){r("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;this.subs.push(m(a,"data",u(this,"ondata")));this.subs.push(m(a,"ping",u(this,"onping")));this.subs.push(m(a,"pong",u(this,"onpong")));this.subs.push(m(a,"error",u(this,"onerror")));this.subs.push(m(a,"close",u(this,"onclose")));this.subs.push(m(this.decoder,"decoded",u(this,"ondecoded")))};d.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};d.prototype.onpong=function(){this.emitAll("pong",
new Date-this.lastPing)};d.prototype.ondata=function(a){this.decoder.add(a)};d.prototype.ondecoded=function(a){this.emit("packet",a)};d.prototype.onerror=function(a){r("error",a);this.emitAll("error",a)};d.prototype.socket=function(a,b){function d(){~n(e.connecting,h)||e.connecting.push(h)}var h=this.nsps[a];if(!h){h=new c(this,a,b);this.nsps[a]=h;var e=this;h.on("connecting",d);h.on("connect",function(){h.id=e.generateId(a)});this.autoConnect&&d()}return h};d.prototype.destroy=function(a){a=n(this.connecting,
a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};d.prototype.packet=function(a){r("writing packet %j",a);var b=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1;b.processPacketQueue()}))};d.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};
d.prototype.cleanup=function(){r("cleanup");for(var a=this.subs.length,b=0;b<a;b++)this.subs.shift().destroy();this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};d.prototype.close=d.prototype.disconnect=function(){r("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};d.prototype.onclose=function(a){r("onclose");this.cleanup();this.backoff.reset();
this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)r("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();r("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(r("attempting reconnect"),
a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),a.skipReconnect||a.open(function(b){b?(r("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(r("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}};d.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(f,
k,g){f.exports=g(15)},function(f,k,g){f.exports=g(16);f.exports.parser=g(23)},function(f,k,g){(function(d){function a(b,c){if(!(this instanceof a))return new a(b,c);c=c||{};b&&"object"==typeof b&&(c=b,b=null);b?(b=r(b),c.hostname=b.host,c.secure="https"===b.protocol||"wss"===b.protocol,c.port=b.port,b.query&&(c.query=b.query)):c.host&&(c.hostname=r(c.host).host);this.secure=null!=c.secure?c.secure:d.location&&"https:"===location.protocol;c.hostname&&!c.port&&(c.port=this.secure?"443":"80");this.agent=
c.agent||!1;this.hostname=c.hostname||(d.location?location.hostname:"localhost");this.port=c.port||(d.location&&location.port?location.port:this.secure?443:80);this.query=c.query||{};"string"==typeof this.query&&(this.query=x.decode(this.query));this.upgrade=!1!==c.upgrade;this.path=(c.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!c.forceJSONP;this.jsonp=!1!==c.jsonp;this.forceBase64=!!c.forceBase64;this.enablesXDR=!!c.enablesXDR;this.timestampParam=c.timestampParam||"t";this.timestampRequests=
c.timestampRequests;this.transports=c.transports||["polling","websocket"];this.transportOptions=c.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=c.policyPort||843;this.rememberUpgrade=c.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=c.onlyBinaryUpgrades;this.perMessageDeflate=!1!==c.perMessageDeflate&&(c.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&
(this.perMessageDeflate.threshold=1024);this.pfx=c.pfx||null;this.key=c.key||null;this.passphrase=c.passphrase||null;this.cert=c.cert||null;this.ca=c.ca||null;this.ciphers=c.ciphers||null;this.rejectUnauthorized=void 0===c.rejectUnauthorized||c.rejectUnauthorized;this.forceNode=!!c.forceNode;b="object"==typeof d&&d;b.global===b&&(c.extraHeaders&&0<Object.keys(c.extraHeaders).length&&(this.extraHeaders=c.extraHeaders),c.localAddress&&(this.localAddress=c.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=
this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}var b=g(17),c=g(8),e=g(3)("engine.io-client:socket"),k=g(37),u=g(23),r=g(2),n=g(38),x=g(31);f.exports=a;a.priorWebsocketSuccess=!1;c(a.prototype);a.protocol=u.protocol;a.Socket=a;a.Transport=g(22);a.transports=g(17);a.parser=g(23);a.prototype.createTransport=function(a){e('creating transport "%s"',a);var c=this.query,d={},h;for(h in c)c.hasOwnProperty(h)&&(d[h]=c[h]);d.EIO=u.protocol;d.transport=a;c=this.transportOptions[a]||
{};this.id&&(d.sid=this.id);return new b[a]({query:d,socket:this,agent:c.agent||this.agent,hostname:c.hostname||this.hostname,port:c.port||this.port,secure:c.secure||this.secure,path:c.path||this.path,forceJSONP:c.forceJSONP||this.forceJSONP,jsonp:c.jsonp||this.jsonp,forceBase64:c.forceBase64||this.forceBase64,enablesXDR:c.enablesXDR||this.enablesXDR,timestampRequests:c.timestampRequests||this.timestampRequests,timestampParam:c.timestampParam||this.timestampParam,policyPort:c.policyPort||this.policyPort,
pfx:c.pfx||this.pfx,key:c.key||this.key,passphrase:c.passphrase||this.passphrase,cert:c.cert||this.cert,ca:c.ca||this.ca,ciphers:c.ciphers||this.ciphers,rejectUnauthorized:c.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:c.perMessageDeflate||this.perMessageDeflate,extraHeaders:c.extraHeaders||this.extraHeaders,forceNode:c.forceNode||this.forceNode,localAddress:c.localAddress||this.localAddress,requestTimeout:c.requestTimeout||this.requestTimeout,protocols:c.protocols||void 0})};a.prototype.open=
function(){if(this.rememberUpgrade&&a.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var b="websocket";else{if(0===this.transports.length){var c=this;return void setTimeout(function(){c.emit("error","No transports available")},0)}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(v){return this.transports.shift(),void this.open()}b.open();this.setTransport(b)};a.prototype.setTransport=function(a){e("setting transport %s",a.name);var b=this;this.transport&&
(e("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};a.prototype.probe=function(b){function c(){if(N.onlyBinaryUpgrades){var c=!this.supportsBinary&&N.transport.supportsBinary;r=r||c}r||(e('probe transport "%s" opened',b),m.send([{type:"ping",data:"probe"}]),m.once("packet",
function(c){if(!r)if("pong"===c.type&&"probe"===c.data){if(e('probe transport "%s" pong',b),N.upgrading=!0,N.emit("upgrading",m),m)a.priorWebsocketSuccess="websocket"===m.name,e('pausing current transport "%s"',N.transport.name),N.transport.pause(function(){r||"closed"!==N.readyState&&(e("changing transport and sending upgrade packet"),n(),N.setTransport(m),m.send([{type:"upgrade"}]),N.emit("upgrade",m),m=null,N.upgrading=!1,N.flush())})}else e('probe transport "%s" failed',b),c=Error("probe error"),
c.transport=m.name,N.emit("upgradeError",c)}))}function d(){r||(r=!0,n(),m.close(),m=null)}function h(a){var c=Error("probe error: "+a);c.transport=m.name;d();e('probe transport "%s" failed because of error: %s',b,a);N.emit("upgradeError",c)}function f(){h("transport closed")}function g(){h("socket closed")}function k(a){m&&a.name!==m.name&&(e('"%s" works - aborting "%s"',a.name,m.name),d())}function n(){m.removeListener("open",c);m.removeListener("error",h);m.removeListener("close",f);N.removeListener("close",
g);N.removeListener("upgrading",k)}e('probing transport "%s"',b);var m=this.createTransport(b,{probe:1}),r=!1,N=this;a.priorWebsocketSuccess=!1;m.once("open",c);m.once("error",h);m.once("close",f);this.once("close",g);this.once("upgrading",k);m.open()};a.prototype.onOpen=function(){if(e("socket open"),this.readyState="open",a.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){e("starting upgrade probes");
for(var b=0,c=this.upgrades.length;b<c;b++)this.probe(this.upgrades[b])}};a.prototype.onPacket=function(a){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(e('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(n(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",
a.data),this.emit("message",a.data)}else e('packet received with socket readyState "%s"',this.readyState)};a.prototype.onHandshake=function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};a.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);
var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)};a.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){e("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};a.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};a.prototype.onDrain=function(){this.writeBuffer.splice(0,
this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):this.flush()};a.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(e("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};a.prototype.write=a.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};a.prototype.sendPacket=
function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)c=c||{},c.compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),d&&this.once("flush",d),this.flush()};a.prototype.close=function(){function a(){d.onClose("forced close");e("socket closing - telling transport to close");d.transport.close()}function b(){d.removeListener("upgrade",b);d.removeListener("upgradeError",
b);a()}function c(){d.once("upgrade",b);d.once("upgradeError",b)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};a.prototype.onError=function(b){e("socket error %j",b);a.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",b)};a.prototype.onClose=function(a,b){if("opening"===this.readyState||"open"===this.readyState||
"closing"===this.readyState)e('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0};a.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~k(this.transports,a[c])&&b.push(a[c]);return b}}).call(k,function(){return this||
window}())},function(f,k,g){(function(d){var a=g(18),b=g(20),c=g(34),e=g(35);k.polling=function(e){var f,g=!1,k=!1,m=!1!==e.jsonp;d.location&&(k="https:"===location.protocol,(g=location.port)||(g=k?443:80),g=e.hostname!==location.hostname||g!==e.port,k=e.secure!==k);if(e.xdomain=g,e.xscheme=k,f=new a(e),"open"in f&&!e.forceJSONP)return new b(e);if(!m)throw Error("JSONP disabled");return new c(e)};k.websocket=e}).call(k,function(){return this||window}())},function(f,k,g){(function(d){var a=g(19);f.exports=
function(b){var c=b.xdomain,e=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!c||a))return new XMLHttpRequest}catch(m){}try{if("undefined"!=typeof XDomainRequest&&!e&&b)return new XDomainRequest}catch(m){}if(!c)try{return new (d[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(m){}}}).call(k,function(){return this||window}())},function(f,k){try{f.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(g){f.exports=!1}},function(f,
k,g){(function(d){function a(){}function b(a){if(u.call(this,a),this.requestTimeout=a.requestTimeout,this.extraHeaders=a.extraHeaders,d.location){var b="https:"===location.protocol,c=location.port;c||(c=b?443:80);this.xd=a.hostname!==d.location.hostname||c!==a.port;this.xs=a.secure!==b}}function c(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=
a.supportsBinary;this.enablesXDR=a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function e(){for(var a in c.requests)c.requests.hasOwnProperty(a)&&c.requests[a].abort()}var k=g(18),u=g(21),r=g(8),n=g(32),x=g(3)("engine.io-client:polling-xhr");f.exports=b;f.exports.Request=c;n(b,u);b.prototype.supportsBinary=
!0;b.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new c(a)};b.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=
typeof a&&void 0!==a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};b.prototype.doPoll=function(){x("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};r(c.prototype);c.prototype.create=function(){var a={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};a.pfx=this.pfx;a.key=this.key;a.passphrase=this.passphrase;a.cert=
this.cert;a.ca=this.ca;a.ciphers=this.ciphers;a.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new k(a),e=this;try{x("xhr open %s: %s",this.method,this.uri);b.open(this.method,this.uri,this.async);try{if(this.extraHeaders){b.setDisableHeaderCheck&&b.setDisableHeaderCheck(!0);for(var f in this.extraHeaders)this.extraHeaders.hasOwnProperty(f)&&b.setRequestHeader(f,this.extraHeaders[f])}}catch(B){}if("POST"===this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):
b.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8")}catch(B){}try{b.setRequestHeader("Accept","*/*")}catch(B){}"withCredentials"in b&&(b.withCredentials=!0);this.requestTimeout&&(b.timeout=this.requestTimeout);this.hasXDR()?(b.onload=function(){e.onLoad()},b.onerror=function(){e.onError(b.responseText)}):b.onreadystatechange=function(){if(2===b.readyState){try{var a=b.getResponseHeader("Content-Type")}catch(K){}"application/octet-stream"===a&&(b.responseType="arraybuffer")}4===b.readyState&&
(200===b.status||1223===b.status?e.onLoad():setTimeout(function(){e.onError(b.status)},0))};x("xhr data %s",this.data);b.send(this.data)}catch(B){return void setTimeout(function(){e.onError(B)},0)}d.document&&(this.index=c.requestsCount++,c.requests[this.index]=this)};c.prototype.onSuccess=function(){this.emit("success");this.cleanup()};c.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};c.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};c.prototype.cleanup=function(b){if("undefined"!=
typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=a:this.xhr.onreadystatechange=a,b)try{this.xhr.abort()}catch(p){}d.document&&delete c.requests[this.index];this.xhr=null}};c.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(v){}var b="application/octet-stream"===a?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(v){this.onError(v)}null!=b&&this.onData(b)};c.prototype.hasXDR=function(){return"undefined"!=
typeof d.XDomainRequest&&!this.xs&&this.enablesXDR};c.prototype.abort=function(){this.cleanup()};c.requestsCount=0;c.requests={};d.document&&(d.attachEvent?d.attachEvent("onunload",e):d.addEventListener&&d.addEventListener("beforeunload",e,!1))}).call(k,function(){return this||window}())},function(f,k,g){function d(b){var c=b&&b.forceBase64;u&&!c||(this.supportsBinary=!1);a.call(this,b)}var a=g(22),b=g(31),c=g(23);k=g(32);var e=g(33),m=g(3)("engine.io-client:polling");f.exports=d;var u=null!=(new (g(18))({xdomain:!1})).responseType;
k(d,a);d.prototype.name="polling";d.prototype.doOpen=function(){this.poll()};d.prototype.pause=function(a){function b(){m("paused");c.readyState="paused";a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(m("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){m("pre-pause polling complete");--d||b()}));this.writable||(m("we are currently writing - waiting to pause"),d++,this.once("drain",function(){m("pre-pause writing complete");
--d||b()}))}else b()};d.prototype.poll=function(){m("polling");this.polling=!0;this.doPoll();this.emit("poll")};d.prototype.onData=function(a){var b=this;m("polling got data %s",a);c.decodePayload(a,this.socket.binaryType,function(a,c,d){return"opening"===b.readyState&&b.onOpen(),"close"===a.type?(b.onClose(),!1):void b.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():m('ignoring poll - transport state "%s"',this.readyState))};
d.prototype.doClose=function(){function a(){m("writing close packet");b.write([{type:"close"}])}var b=this;"open"===this.readyState?(m("transport open - closing"),a()):(m("transport not open - deferring close"),this.once("open",a))};d.prototype.write=function(a){var b=this;this.writable=!1;var d=function(){b.writable=!0;b.emit("drain")};c.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,d)})};d.prototype.uri=function(){var a=this.query||{},c=this.secure?"https":"http",d="";!1!==this.timestampRequests&&
(a[this.timestampParam]=e());this.supportsBinary||a.sid||(a.b64=1);a=b.encode(a);this.port&&("https"===c&&443!==Number(this.port)||"http"===c&&80!==Number(this.port))&&(d=":"+this.port);a.length&&(a="?"+a);var h=-1!==this.hostname.indexOf(":");return c+"://"+(h?"["+this.hostname+"]":this.hostname)+d+this.path+a}},function(f,k,g){function d(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=
a.timestampRequests;this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var a=g(23);k=g(8);f.exports=d;k(d.prototype);d.prototype.onError=function(a,c){a=Error(a);return a.type="TransportError",a.description=c,this.emit("error",
a),this};d.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};d.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};d.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};d.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};d.prototype.onData=function(b){b=a.decodePacket(b,
this.socket.binaryType);this.onPacket(b)};d.prototype.onPacket=function(a){this.emit("packet",a)};d.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},function(f,k,g){(function(d){function a(a,b,c){if(!b)return k.encodeBase64Packet(a,c);var d=new FileReader;return d.onload=function(){a.data=d.result;k.encodePacket(a,b,!0,c)},d.readAsArrayBuffer(a.data)}function b(a,b,c){var d=Array(a.length);c=r(a.length,c);for(var e=function(a,c,e){b(c,function(b,c){d[a]=c;e(b,d)})},h=0;h<
a.length;h++)e(h,a[h],c)}var c,e=g(24),f=g(9),u=g(25),r=g(26),n=g(27);d&&d.ArrayBuffer&&(c=g(29));var x="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),p=x||h;k.protocol=3;var v=k.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},E=e(v),B={type:"error",data:"parser error"},K=g(30);k.encodePacket=function(b,c,e,h){"function"==typeof c&&(h=c,c=!1);"function"==typeof e&&(h=e,e=null);var f=void 0===
b.data?void 0:b.data.buffer||b.data;if(d.ArrayBuffer&&f instanceof ArrayBuffer){if(c){e=b.data;c=new Uint8Array(e);e=new Uint8Array(1+e.byteLength);e[0]=v[b.type];for(b=0;b<c.length;b++)e[b+1]=c[b];b=h(e.buffer)}else b=k.encodeBase64Packet(b,h);return b}if(K&&f instanceof d.Blob)return c?p?b=a(b,c,h):(c=new Uint8Array(1),c[0]=v[b.type],b=new K([c.buffer,b.data]),b=h(b)):b=k.encodeBase64Packet(b,h),b;if(f&&f.base64)return h("b"+k.packets[b.type]+b.data.data);c=v[b.type];return void 0!==b.data&&(c+=
e?n.encode(String(b.data),{strict:!1}):String(b.data)),h(""+c)};k.encodeBase64Packet=function(a,b){var c="b"+k.packets[a.type];if(K&&a.data instanceof d.Blob){var e=new FileReader;return e.onload=function(){var a=e.result.split(",")[1];b(c+a)},e.readAsDataURL(a.data)}try{var h=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(O){a=new Uint8Array(a.data);h=Array(a.length);for(var f=0;f<a.length;f++)h[f]=a[f];h=String.fromCharCode.apply(null,h)}return c+=d.btoa(h),b(c)};k.decodePacket=function(a,
b,c){if(void 0===a)return B;if("string"==typeof a){if("b"===a.charAt(0))return k.decodeBase64Packet(a.substr(1),b);if(b=c){b=a;try{b=n.decode(b,{strict:!1})}catch(z){b=!1}b=(a=b,!1===a)}if(b)return B;c=a.charAt(0);return Number(c)==c&&E[c]?1<a.length?{type:E[c],data:a.substring(1)}:{type:E[c]}:B}c=(new Uint8Array(a))[0];a=u(a,1);return K&&"blob"===b&&(a=new K([a])),{type:E[c],data:a}};k.decodeBase64Packet=function(a,b){var d=E[a.charAt(0)];if(!c)return{type:d,data:{base64:!0,data:a.substr(1)}};a=
c.decode(a.substr(1));return"blob"===b&&K&&(a=new K([a])),{type:d,data:a}};k.encodePayload=function(a,c,d){function e(a,b){k.encodePacket(a,!!h&&c,!1,function(a){b(null,a.length+":"+a)})}"function"==typeof c&&(d=c,c=null);var h=f(a);return c&&h?K&&!p?k.encodePayloadAsBlob(a,d):k.encodePayloadAsArrayBuffer(a,d):a.length?void b(a,e,function(a,b){return d(b.join(""))}):d("0:")};k.decodePayload=function(a,b,c){if("string"!=typeof a)return k.decodePayloadAsBinary(a,b,c);"function"==typeof b&&(c=b,b=null);
var d;if(""===a)return c(B,0,1);for(var e,h,f="",g=0,n=a.length;g<n;g++){var p=a.charAt(g);if(":"===p){if(""===f||f!=(e=Number(f))||(h=a.substr(g+1,e),f!=h.length))return c(B,0,1);if(h.length){if(d=k.decodePacket(h,b,!1),B.type===d.type&&B.data===d.data)return c(B,0,1);if(!1===c(d,g+e,n))return}g+=e;f=""}else f+=p}return""!==f?c(B,0,1):void 0};k.encodePayloadAsArrayBuffer=function(a,c){function d(a,b){k.encodePacket(a,!0,!0,function(a){return b(null,a)})}return a.length?void b(a,d,function(a,b){a=
b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var d=new Uint8Array(a),e=0;return b.forEach(function(a){var b="string"==typeof a,c=a;if(b){c=new Uint8Array(a.length);for(var h=0;h<a.length;h++)c[h]=a.charCodeAt(h);c=c.buffer}b?d[e++]=0:d[e++]=1;a=c.byteLength.toString();for(h=0;h<a.length;h++)d[e++]=parseInt(a[h]);d[e++]=255;c=new Uint8Array(c);for(h=0;h<c.length;h++)d[e++]=c[h]}),c(d.buffer)}):c(new ArrayBuffer(0))};k.encodePayloadAsBlob=
function(a,c){b(a,function(a,b){k.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer;c[0]=0}d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString();var h=new Uint8Array(d.length+1);for(e=0;e<d.length;e++)h[e]=parseInt(d[e]);if(h[d.length]=255,K)a=new K([c.buffer,h.buffer,a]),b(null,a)})},function(a,b){return c(new K(b))})};k.decodePayloadAsBinary=function(a,b,c){"function"==
typeof b&&(c=b,b=null);for(var d=[];0<a.byteLength;){for(var e=new Uint8Array(a),h=0===e[0],f="",g=1;255!==e[g];g++){if(310<f.length)return c(B,0,1);f+=e[g]}a=u(a,2+f.length);f=parseInt(f);e=u(a,0,f);if(h)try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(S){for(h=new Uint8Array(e),e="",g=0;g<h.length;g++)e+=String.fromCharCode(h[g])}d.push(e);a=u(a,f)}var n=d.length;d.forEach(function(a,d){c(k.decodePacket(a,b,!0),d,n)})}}).call(k,function(){return this||window}())},function(f,k){f.exports=
Object.keys||function(f){var d=[],a=Object.prototype.hasOwnProperty,b;for(b in f)a.call(f,b)&&d.push(b);return d}},function(f,k){f.exports=function(f,d,a){var b=f.byteLength;if(d=d||0,a=a||b,f.slice)return f.slice(d,a);if(0>d&&(d+=b),0>a&&(a+=b),a>b&&(a=b),d>=b||d>=a||0===b)return new ArrayBuffer(0);f=new Uint8Array(f);b=new Uint8Array(a-d);for(var c=0;d<a;d++,c++)b[c]=f[d];return b.buffer}},function(f,k){function g(){}f.exports=function(d,a,b){function c(d,f){if(0>=c.count)throw Error("after called too many times");
--c.count;d?(e=!0,a(d),a=b):0!==c.count||e||a(null,f)}var e=!1;return b=b||g,c.count=d,0===d?a():c}},function(f,k,g){var d;(function(a,b){!function(b){function c(a){for(var b,c,d=[],e=0,h=a.length;e<h;)b=a.charCodeAt(e++),55296<=b&&56319>=b&&e<h?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}
function g(){if(h>=x)throw Error("Invalid byte index");var a=255&n[h];if(h++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function r(a){var b,c,d,e,k;if(h>x)throw Error("Invalid byte index");if(h==x)return!1;if(b=255&n[h],h++,0==(128&b))return b;if(192==(224&b)){if(c=g(),k=(31&b)<<6|c,128<=k)return k;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=g(),d=g(),k=(15&b)<<12|c<<6|d,2048<=k)return f(k,a)?k:65533;throw Error("Invalid continuation byte");}if(240==(248&
b)&&(c=g(),d=g(),e=g(),k=(7&b)<<18|c<<12|d<<6|e,65536<=k&&1114111>=k))return k;throw Error("Invalid UTF-8 detected");}b="object"==typeof k&&k;"object"==typeof a&&a&&a.exports==b&&a;var n,x,h,p=String.fromCharCode;d={version:"2.1.2",encode:function(a,b){b=b||{};b=!1!==b.strict;a=c(a);for(var d=a.length,e=-1,h="";++e<d;){var g=a[e];var k=b;if(0==(4294967168&g))k=p(g);else{var n="";k=(0==(4294965248&g)?n=p(g>>6&31|192):0==(4294901760&g)?(f(g,k)||(g=65533),n=p(g>>12&15|224),n+=p(g>>6&63|128)):0==(4292870144&
g)&&(n=p(g>>18&7|240),n+=p(g>>12&63|128),n+=p(g>>6&63|128)),n+p(63&g|128))}h+=k}return h},decode:function(a,b){b=b||{};b=!1!==b.strict;n=c(a);x=n.length;h=0;var d;for(a=[];!1!==(d=r(b));)a.push(d);d=a.length;for(var e=-1,f="";++e<d;)b=a[e],65535<b&&(b-=65536,f+=p(b>>>10&1023|55296),b=56320|1023&b),f+=p(b);return f}};!(void 0!==d&&(a.exports=d))}(this)}).call(k,g(28)(f),function(){return this||window}())},function(f,k){f.exports=function(f){return f.webpackPolyfill||(f.deprecate=function(){},f.paths=
[],f.children=[],f.webpackPolyfill=1),f}},function(f,k){!function(){for(var f=new Uint8Array(256),d=0;64>d;d++)f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(d)]=d;k.encode=function(a){var b=new Uint8Array(a),c=b.length,d="";for(a=0;a<c;a+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[a]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&b[a])<<4|b[a+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&
b[a+1])<<2|b[a+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&b[a+2]];return 2===c%3?d=d.substring(0,d.length-1)+"\x3d":1===c%3&&(d=d.substring(0,d.length-2)+"\x3d\x3d"),d};k.decode=function(a){var b=.75*a.length;var c=a.length,d=0;"\x3d"===a[a.length-1]&&(b--,"\x3d"===a[a.length-2]&&b--);var g=new ArrayBuffer(b),k=new Uint8Array(g);for(b=0;b<c;b+=4){var r=f[a.charCodeAt(b)];var n=f[a.charCodeAt(b+1)];var x=f[a.charCodeAt(b+2)];var h=f[a.charCodeAt(b+3)];k[d++]=r<<
2|n>>4;k[d++]=(15&n)<<4|x>>2;k[d++]=(3&x)<<6|63&h}return g}}()},function(f,k){(function(g){function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=e.buffer}a[b]=d}}}function a(a,b){b=b||{};var e=new c;d(a);for(var h=0;h<a.length;h++)e.append(a[h]);return b.type?e.getBlob(b.type):e.getBlob()}function b(a,b){return d(a),new Blob(a,b||
{})}var c=g.BlobBuilder||g.WebKitBlobBuilder||g.MSBlobBuilder||g.MozBlobBuilder;try{var e=2===(new Blob(["hi"])).size}catch(r){e=!1}var k;if(k=e)try{k=2===(new Blob([new Uint8Array([1,2])])).size}catch(r){k=!1}var u=c&&c.prototype.append&&c.prototype.getBlob;f.exports=e?k?g.Blob:b:u?a:void 0}).call(k,function(){return this||window}())},function(f,k){k.encode=function(f){var d="",a;for(a in f)f.hasOwnProperty(a)&&(d.length&&(d+="\x26"),d+=encodeURIComponent(a)+"\x3d"+encodeURIComponent(f[a]));return d};
k.decode=function(f){var d={};f=f.split("\x26");for(var a=0,b=f.length;a<b;a++){var c=f[a].split("\x3d");d[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return d}},function(f,k){f.exports=function(f,d){var a=function(){};a.prototype=d.prototype;f.prototype=new a;f.prototype.constructor=f}},function(f,k){function g(a){var d="";do d=b[a%c]+d,a=Math.floor(a/c);while(0<a);return d}function d(){var b=g(+new Date);return b!==a?(m=0,a=b):b+"."+g(m++)}for(var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),
c=64,e={},m=0,u=0;u<c;u++)e[b[u]]=u;d.encode=g;d.decode=function(a){var b=0;for(u=0;u<a.length;u++)b=b*c+e[a.charAt(u)];return b};f.exports=d},function(f,k,g){(function(d){function a(){}function b(b){c.call(this,b);this.query=this.query||{};k||(d.___eio||(d.___eio=[]),k=d.___eio);this.index=k.length;var e=this;k.push(function(a){e.onData(a)});this.query.j=this.index;d.document&&d.addEventListener&&d.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=a)},!1)}var c=g(21),e=g(32);
f.exports=b;var k,u=/\n/g,r=/\\n/g;e(b,c);b.prototype.supportsBinary=!1;b.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);c.prototype.doClose.call(this)};b.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",
b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};b.prototype.doWrite=function(a,b){function c(){d();b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(Q){e.onError("jsonp polling iframe removal error",
Q)}try{f=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+e.iframeId+'"\x3e')}catch(Q){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId;e.form.appendChild(f);e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),k=document.createElement("textarea"),n=this.iframeId="eio_iframe_"+this.index;g.className="socketio";g.style.position="absolute";g.style.top="-1000px";g.style.left="-1000px";g.target=n;g.method="POST";g.setAttribute("accept-charset",
"utf-8");k.name="d";g.appendChild(k);document.body.appendChild(g);this.form=g;this.area=k}this.form.action=this.uri();d();a=a.replace(r,"\\\n");this.area.value=a.replace(u,"\\n");try{this.form.submit()}catch(Q){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(k,function(){return this||window}())},function(f,k,g){(function(d){function a(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;
this.usingBrowserWebSocket=n&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(h=x);b.call(this,a)}var b=g(22),c=g(23),e=g(31),k=g(32),u=g(33),r=g(3)("engine.io-client:websocket"),n=d.WebSocket||d.MozWebSocket;if("undefined"==typeof window)try{var x=g(36)}catch(p){}var h=n;h||"undefined"!=typeof window||(h=x);f.exports=a;k(a,b);a.prototype.name="websocket";a.prototype.supportsBinary=!0;a.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,
perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new h(a,b):new h(a):new h(a,b,c)}catch(B){return this.emit("error",B)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?
(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};a.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};a.prototype.write=function(a){function b(){e.emit("flush");setTimeout(function(){e.writable=!0;e.emit("drain")},0)}var e=this;this.writable=!1;for(var h=
a.length,f=0,g=h;f<g;f++)!function(a){c.encodePacket(a,e.supportsBinary,function(c){if(!e.usingBrowserWebSocket){var f={};(a.options&&(f.compress=a.options.compress),e.perMessageDeflate)&&("string"==typeof c?d.Buffer.byteLength(c):c.length)<e.perMessageDeflate.threshold&&(f.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(c):e.ws.send(c,f)}catch(N){r("websocket closed before onclose event")}--h||b()})}(a[f])};a.prototype.onClose=function(){b.prototype.onClose.call(this)};a.prototype.doClose=function(){"undefined"!=
typeof this.ws&&this.ws.close()};a.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=u());this.supportsBinary||(a.b64=1);a=e.encode(a);a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a};a.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===
a.prototype.name)}}).call(k,function(){return this||window}())},function(f,k){},function(f,k){var g=[].indexOf;f.exports=function(d,a){if(g)return d.indexOf(a);for(var b=0;b<d.length;++b)if(d[b]===a)return b;return-1}},function(f,k){(function(g){var d=/^[\],:{}\s]*$/,a=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,b=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,c=/(?:^|:|,)(?:\s*\[)+/g,e=/^\s+/,k=/\s+$/;f.exports=function(f){return"string"==typeof f&&f?(f=f.replace(e,"").replace(k,""),
g.JSON&&JSON.parse?JSON.parse(f):d.test(f.replace(a,"@").replace(b,"]").replace(c,""))?(new Function("return "+f))():void 0):null}}).call(k,function(){return this||window}())},function(f,k,g){function d(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:
function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b=g(7);k=g(8);var c=g(40),e=g(41),m=g(42),u=g(3)("socket.io-client:socket"),r=g(31);f.exports=d;var n={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},x=k.prototype.emit;k(d.prototype);d.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[e(a,
"open",m(this,"onopen")),e(a,"packet",m(this,"onpacket")),e(a,"close",m(this,"onclose"))]}};d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};d.prototype.send=function(){var a=c(arguments);return a.unshift("message"),this.emit.apply(this,a),this};d.prototype.emit=function(a){if(n.hasOwnProperty(a))return x.apply(this,arguments),this;var d=c(arguments),e={type:b.EVENT,
data:d};return e.options={},e.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof d[d.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=d.pop(),e.id=this.ids++),this.connected?this.packet(e):this.sendBuffer.push(e),delete this.flags,this};d.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};d.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var c="object"===a(this.query)?r.encode(this.query):
this.query;u("sending connect packet with query %s",c);this.packet({type:b.CONNECT,query:c})}else this.packet({type:b.CONNECT})};d.prototype.onclose=function(a){u("close (%s)",a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};d.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case b.CONNECT:this.onconnect();break;case b.EVENT:this.onevent(a);break;case b.BINARY_EVENT:this.onevent(a);break;case b.ACK:this.onack(a);break;case b.BINARY_ACK:this.onack(a);
break;case b.DISCONNECT:this.ondisconnect();break;case b.ERROR:this.emit("error",a.data)}};d.prototype.onevent=function(a){var b=a.data||[];u("emitting event %j",b);null!=a.id&&(u("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?x.apply(this,b):this.receiveBuffer.push(b)};d.prototype.ack=function(a){var d=this,e=!1;return function(){if(!e){e=!0;var h=c(arguments);u("sending ack %j",h);d.packet({type:b.ACK,id:a,data:h})}}};d.prototype.onack=function(a){var b=this.acks[a.id];
"function"==typeof b?(u("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):u("bad ack %s",a.id)};d.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};d.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)x.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};d.prototype.ondisconnect=function(){u("server disconnect (%s)",
this.nsp);this.destroy();this.onclose("io server disconnect")};d.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)};d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:b.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};d.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=
a,this}},function(f,k){f.exports=function(f,d){for(var a=[],b=(d=d||0)||0;b<f.length;b++)a[b-d]=f[b];return a}},function(f,k){f.exports=function(f,d,a){return f.on(d,a),{destroy:function(){f.removeListener(d,a)}}}},function(f,k){var g=[].slice;f.exports=function(d,a){if("string"==typeof a&&(a=d[a]),"function"!=typeof a)throw Error("bind() requires a function");var b=g.call(arguments,2);return function(){return a.apply(d,b.concat(g.call(arguments)))}}},function(f,k){function g(d){d=d||{};this.ms=d.min||
100;this.max=d.max||1E4;this.factor=d.factor||2;this.jitter=0<d.jitter&&1>=d.jitter?d.jitter:0;this.attempts=0}f.exports=g;g.prototype.duration=function(){var d=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),b=Math.floor(a*this.jitter*d);d=0==(1&Math.floor(10*a))?d-b:d+b}return 0|Math.min(d,this.max)};g.prototype.reset=function(){this.attempts=0};g.prototype.setMin=function(d){this.ms=d};g.prototype.setMax=function(d){this.max=d};g.prototype.setJitter=function(d){this.jitter=
d}}])});window.TK.socketIO=window.TK.socketIO||window.io;if(!window.TK.socketIO)try{window.TK.socketIO=io}catch(f){console.error("[tk-sdk]socket.io registration failed,please link socket.io,for example: window.tk.SocketIO \x3d io (io is the socket.io that you want to associate with)!")};window.TK=window.TK||{};window.L=window.L||{};TK.CONNECTION_TYPE={UP:0,DOWN:1};
TK.NativeConnection=function(f){function k(){return r.media?h.MEDIA:r.screen?h.SCREEN:h.VIDEO}function g(){var a=c;if(!c)throw Error("Invalid native-peer-connection ID");return a.toString()}function d(){var a=n;if(!n)throw Error("Invalid extensionId ID");return a.toString()}var a={},b=void 0,c=f.connectionId,e=!1,m=!1,u=f.connectionType,r=f.extraData||{},n=f.extraData.extensionId,x={fileName:"NativeConnection.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""},h={VIDEO:0,MEDIA:1,
SCREEN:2},p={isNative:!0,getConnectionId:function(){return c},createOffer:function(b,c){var e=u===TK.CONNECTION_TYPE.UP?!0:!1;window.tknative.postMessage({command:"createOffer",streamId:d(),offerToSend:e});a.create_offer_success=b;a.create_offer_failure=c},createAnswer:function(b,c){window.tknative.postMessage({command:"createOffer",streamId:d(),offerToSend:!1});a.create_offer_success=b;a.create_offer_failure=c},setRemoteDescription:function(a,b,c){L.Utils.isNull(a)?(L.Logger.error(x,"[tk-sdk] Connection::setRemoteDescription: sdp object is null"),
L.Utils.isFunction(c)&&c("sdp object is null")):(window.tknative.postMessage({command:"setRemoteDescription",sdpAnswer:a.sdp,streamId:d()}),L.Utils.isFunction(b)&&b())},addIceCandidate:function(a){tknative.postMessage({command:"setIceCandidate",candidate:a.candidate,sdpMid:0,sdpMLineIndex:a.sdpMLineIndex,streamId:d()})},setMediaStream:function(a,c,e){c&&L.Utils.isFunction(c)&&((c=c(a))?a=c:L.Logger.error(x,"[tk-sdk]setStreamMethod Wrong return result."));u===TK.CONNECTION_TYPE.UP&&(window.tknative&&
window.tknative.postMessage&&window.tknative&&window.tknative.postMessage&&window.tknative.postMessage({command:"addStream",streamId:d(),type:Number(k())}),b=a)},getMediaStream:function(){return b},removeMediaStream:function(a){window.tknative.postMessage({command:"removeStream",streamId:d(),type:Number(k())})},getVideoTrack:function(){},getAudioTrack:function(){},addAudioTrack:function(){},addVideoTrack:function(){},removeVideoTrack:function(){},removeAudioTrack:function(){},enableVideo:function(a){e=
a;u==TK.CONNECTION_TYPE.UP&&window.tknative.postMessage({command:"enableVideo",enable:a,connectionId:d()})},videoEnabled:function(){return e},enableAudio:function(a){m=a;u==TK.CONNECTION_TYPE.UP&&window.tknative.postMessage({command:"enableAudio",enable:a,connectionId:d()})},audioEnabled:function(){return m},close:function(){var a=u===TK.CONNECTION_TYPE.UP?!0:!1;window.tknative.postMessage({command:"closeConnection",streamId:d(),offerToSend:a,type:Number(k())})},getStats:function(a,b){L.Utils.isFunction(a)&&
a(void 0,-1)},replaceVideoTrack:function(a,b){window.tknative.postMessage({command:"setCamera",deviceId:a.id})},replaceAudioTrack:function(a){window.tknative.postMessage({command:"setMicrophone",deviceId:a.id})},needRePublish:function(){return!1},onOfferGenerated:void 0,onIceCandidate:void 0,onIceConnectionStateChange:void 0,onAddStream:void 0,onRemoveStream:void 0,checkReplaceTrackSupport:function(){return!1}};window.tknative.addEventListener("message",function(b){var c=b.data.name;if(b.data.connectionId==
d())if("onLocalDescription"===c){if(c={},c.sdp=b.data.sdp,c.type="offer",L.Utils.isFunction(a.create_offer_success)&&a.create_offer_success(),delete a.create_offer_success,delete a.create_offer_failure,L.Utils.isFunction(p.onOfferGenerated))p.onOfferGenerated(g(),c)}else if("onIceCandidate"===c)L.Utils.isFunction(p.onIceCandidate)&&(c={type:"candidate",candidate:{}},c.candidate.sdpMLineIndex=b.data.sdpMLineIndex,c.candidate.sdpMid=b.data.sdpMid,c.candidate.candidate="a\x3d"+b.data.candidate,p.onIceCandidate(g(),
c));else if("onIceStatusChanged"===c){if(L.Utils.isFunction(p.onIceConnectionStateChange))if(b=b.data.state,1==b)p.onIceConnectionStateChange(g(),"checking");else if(2==b)p.onIceConnectionStateChange(g(),"connected");else if(3==b)p.onIceConnectionStateChange(g(),"completed");else if(4==b)p.onIceConnectionStateChange(g(),"failed");else if(5==b)p.onIceConnectionStateChange(g(),"disconnected");else if(6==b)p.onIceConnectionStateChange(g(),"closed")}else if("onAddStream"===c){if(L.Utils.isFunction(p.onAddStream))p.onAddStream(g(),
{stream:{}})}else if("onRemoveStream"===c&&L.Utils.isFunction(p.onRemoveStream))p.onRemoveStream(g())},!1);return p};window.TK=window.TK||{};window.L=window.L||{};
TK.AudioPlayer=function(f){function k(){try{if(b&&b.audio&&b.audio.play){var a=L.Utils.mediaPlay(b.audio);a&&a.catch&&a.catch(function(a){L.Logger.warning(r,"[tk-sdk]audio.play method catch error , audioPlayer id is "+b.id+" , error info:"+a)})}}catch(h){L.Logger.warning(r,"[tk-sdk]audio.play method error , audioPlayer id is "+(b?b.id:"undefined")+" !")}}function g(){b.audio&&(L.Utils.removeEvent(b.audio,"canplay",g),L.Utils.removeEvent(b.audio,"loadeddata",g),L.Utils.removeEvent(b.audio,"loadedmetadata",
g));if(!e&&(e=!0,TK.roomInstance&&!f.deviceCheck)){var a=b.userid;"_local_default_extension_id_"===a&&(a="");a=TK.RoomEvent({type:"room-first-audio-frame",message:{userId:a,mediaType:b.type}});TK.roomInstance.dispatchEvent(a)}}function d(b,c){if(c&&c.getAudioTracks&&c.getAudioTracks()&&c.getAudioTracks().length){a(b);try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(b.srcObject=c,L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);
b.setSinkId&&b.setSinkId(d).then(function(a){L.Logger.info(r,"[tk-sdk]AudioPlayer setSinkId success:",d)}).catch(function(a){L.Logger.info(r,"[tk-sdk]AudioPlayer setSinkId error:",a)})}}else{var e=window.URL||webkitURL;b.src=e.createObjectURL(c)}}catch(E){L.Logger.warning(r,"[tk-sdk]audioPlayer attachMediaStream. attach by srcObject failed.",E,adapter.browserDetails),e=window.URL||webkitURL,b.src=e.createObjectURL(c)}}}function a(a){try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(a.srcObject&&
L.Utils.isFunction(a.srcObject.removeTrack)&&L.Utils.isFunction(a.srcObject.getTracks))for(var b=a.srcObject.getTracks(),c=b.length-1;0<=c;c--)a.srcObject.removeTrack(b[c]);a.srcObject=null}else a.src=""}catch(v){a.src=""}}f.options=f.options||{};var b=TK.EventDispatcher({}),c=L.Utils.createMediaStream(),e=!1,m=100,u=!1,r={fileName:"AudioPlayer.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};b.id=f.id;b.local=f.local;b.type=f.type;b.elementID=f.elementID;b.bundleId=f.bundleId;
b.userid=f.userid;b.userId=b.userid;b.extensionId=f.extensionId;b.updateAudioPlayerSpec=function(a){if("object"===typeof a)for(var c in a)if(b.hasOwnProperty(c))switch(b[c]=a[c],c){case "id":b.div&&b.div.setAttribute("id","audioplayer__"+b.id),b.audio&&b.audio.setAttribute("id","audioplayerstream_"+b.id)}};b.destroy=function(){try{b.audio&&(L.Utils.mediaPause(b.audio),a(b.audio));if(b.div)try{b.container.removeChild(b.div)}catch(x){L.Logger.error(r,"[tk-sdk]AudioPlayer removeChild error:",x)}b.removeAudioTrack();
c=void 0}catch(x){L.Logger.error(r,"[tk-sdk]AudioPlayer destroy error , error info:",x)}};b.div=document.createElement("div");b.div.setAttribute("id","audioplayer__"+b.id);b.div.setAttribute("class","Talk_player");b.div.setAttribute("style","width: 100%; height: 100%; position: relative;background-color: black; overflow: hidden; display: none;");b.audio=document.createElement("audio");b.audio.setAttribute("id","audioplayerstream_"+b.id);b.audio.setAttribute("class","Talk_stream");b.audio.setAttribute("style",
"width: 100%; height: 100%; position: absolute;background-color:#000;");b.audio.setAttribute("autoplay","autoplay");b.audio.setAttribute("webkit-playsinline","true");b.audio.setAttribute("x-webkit-airplay","true");b.audio.setAttribute("playsinline","true");b.audio.muted=!1;b.audio.volume=1;L.Utils.addEvent(b.audio,"canplay",g);L.Utils.addEvent(b.audio,"loadeddata",g);L.Utils.addEvent(b.audio,"loadedmetadata",g);b.hasAudioTrack=function(){var a=!1;c&&c.getAudioTracks()&&c.getAudioTracks().length&&
(a=!0);return a};b.getAudioTrack=function(){if(c&&c.getAudioTracks()&&c.getAudioTracks().length)return c.getAudioTracks()[0]};b.removeAudioTrack=function(){b.hasAudioTrack()&&c&&c.removeTrack&&(c.removeTrack(b.getAudioTrack()),a(b.audio))};b.addAudioTrack=function(a){b.hasAudioTrack()&&b.removeAudioTrack();c&&c.addTrack&&a&&(c.addTrack(a),c&&d(b.audio,c))};b.setMute=function(a){"boolean"!==typeof a?L.Logger.error(r,"[tk-sdk]Stream setMute isMute type must is boolean!"):(b.local&&b.type===TK.STREAM_VIDEO?
(L.Logger.debug(r,"[tk-sdk]audioPlayer setMute:local audio must is mute!"),u=!0):u=a,b.audio&&void 0!==b.audio.muted&&(b.audio.muted=u),b.audio&&void 0!==b.audio.muted&&(b.audio.muted=u))};b.setVolume=function(a){"number"!==typeof a?L.Logger.error(r,"[tk-sdk]Stream setVolume volume type must is number!"):(b.local&&b.type===TK.STREAM_VIDEO?(L.Logger.debug(r,"[tk-sdk]audioPlayer setVolume:local audio must is mute , volume must is 0!"),m=0):m=a,b.audio&&void 0!==b.audio.volume&&(b.audio.volume=m/100),
b.audio&&void 0!==b.audio.volume&&(b.audio.volume=m/100))};b.getVolume=function(a){if(a&&"function"===typeof a){if(b.audio&&void 0!==b.audio.volume)return a(parseInt(100*b.audio.volume)),parseInt(100*b.audio.volume);L.Logger.warning(r,"[tk-sdk]audioPlayer getVolume failure , audio is not exist!");a(m);return m}L.Logger.warning(r,"[tk-sdk]audioPlayer getVolume callback is not exist , callback must is function!");return m};b.updateAudioPlayerOptions=function(a){};b.local&&b.type===TK.STREAM_VIDEO&&
(b.setVolume(0),b.setMute(!0));b.div.appendChild(b.audio);if("string"===typeof b.elementID)if(b.container=document.getElementById(b.elementID),b.container){var n=document.getElementById("audioplayer__"+b.id);if(n)try{L.Logger.warning(r,"[tk-sdk]audioPlayer:There are other nodes in the video player that have not been released,not released element id is "+n.id+" ,element id is "+b.elementID+",id is "+b.id+",type is "+b.type+",userId is "+b.userid),b.container.removeChild(n)}catch(x){L.Logger.error(r,
"[tk-sdk]audioPlayer error:",x)}b.container.appendChild(b.div)}else L.Logger.error(r,"[tk-sdk]audioPlayer error:find element,element id is "+b.elementID+",id is "+b.id+",type is "+b.type+",userId is "+b.userid);else L.Logger.error(r,"[tk-sdk]audioPlayer error:element id must is string,element id is "+b.elementID+",id is "+b.id+",type is "+b.type+",userId is "+b.userid);c&&d(b.audio,c);n=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);b.audio&&n?TK.DeviceMgr.associateElementsToSpeaker(b.audio,
n,function(){k()}):k();return b};window.TK=window.TK||{};window.L=window.L||{};
TK.NativeVideoPlayer=function(f){f.options=f.options||{};f.options.bar=void 0!==f.options.bar?f.options.bar:!1;f.options.mirror=f.options.mirror||!1;f.options.mode=f.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;f.options.loader=L.Utils.isBoolean(f.options.loader)?f.options.loader:!0;var k=void 0!==f.options.audioPlayer?f.options.audioPlayer:!1,g=TK.EventDispatcher({}),d=f.options.loader,a={fileName:"NativeVideoPlayer.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:
""},b=L.Utils.nativeMediaStream();g.id=f.id;g.local=f.stream.local;g.videoPlayerMediaStreamClone=f.stream.stream;g.type=f.stream&&f.stream.getAttributes&&f.stream.getAttributes()?f.stream.getAttributes().type:void 0;g.elementID=f.elementID;g.updateVideoPlayerSpec=function(a){if("object"===typeof a)for(var b in a)if(g.hasOwnProperty(b))switch(g[b]=a[b],b){case "id":g.div&&g.div.setAttribute("id","player_"+g.id),g.loader&&g.loader.setAttribute("id","back_"+g.id),g.video&&g.video.setAttribute("id",g.id)}};
g.destroy=function(){try{g.container&&g.div&&(g.div.parentNode===g.container?g.container.removeChild(g.div):L.Logger.warning(a,"[tk-sdk]VideoPlayer removeChild warning: Element removal warning"))}catch(c){L.Logger.error(a,"[tk-sdk]NativeVideoPlayer removeChild error:",c)}g=b=g.videoPlayerMediaStreamClone=void 0};g.hasVideoTrack=function(){var a=!1;b&&b.getVideoTracks()&&b.getVideoTracks().length&&(a=!0);return a};g.getVideoTrack=function(){if(b&&b.getVideoTracks()&&b.getVideoTracks().length)return b.getVideoTracks()[0]};
g.removeVideoTrack=function(){g.hasVideoTrack()&&b&&b.removeTrack&&b.removeTrack(g.getVideoTrack())};g.addVideoTrack=function(a){g.hasVideoTrack()&&g.removeVideoTrack();b&&b.addTrack&&a&&b.addTrack(a)};g.showVideo=function(){g.video&&(g.video.style.opacity=1);d&&(g.loader&&(g.loader.style.display=""),g.div.style.backgroundColor="")};g.hideVideo=function(){g.video&&(g.video.style.opacity=0);d&&(g.loader&&(g.loader.style.display=""),g.div.style.backgroundColor="")};g.hideLoading=function(){d=!1;g.loader&&
(g.loader.style.display="none");g.div.style.backgroundColor="transparent"};g.showLoading=function(){d=!0;g.loader&&(g.loader.style.display="");g.div.style.backgroundColor=""};g.div=document.createElement("div");g.div.setAttribute("id","player_"+g.id);g.div.setAttribute("class","Talk_player");g.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(k?"  display: none;":" "));f.options.loader&&(g.loader=document.createElement("div"),g.loader.setAttribute("id",
"back_"+g.id),g.loader.setAttribute("class","Talk_loader"),g.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'));
g.video=document.createElement("embed");g.video.setAttribute("id",g.id);g.video.setAttribute("class","Talk_stream");g.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(f.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":""));g.video.setAttribute("tk-render-mode",f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":
"ASPECT_RATIO_CONTAIN");g.video.setAttribute("type","application/x-ppapi-proxy");g.videoSupernatant=document.createElement("div");g.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");g.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");g.updateVideoPlayerOptions=function(b){if(b&&"object"===typeof b&&(void 0!==b.mirror&&(f.options.mirror=b.mirror,g.video.style.webkitTransform=b.mirror?"rotateY(180deg)":
"",g.video.style.mozTransform=b.mirror?"rotateY(180deg)":"",g.video.style.oTransform=b.mirror?"rotateY(180deg)":"",g.video.style.msTransform=b.mirror?"rotateY(180deg)":"",g.video.style.transform=b.mirror?"rotateY(180deg)":""),void 0!==b.mode&&(f.options.mode=b.mode,g.video.setAttribute("tk-render-mode",f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"),window.tknative.postMessage({command:"updateRenderMode",args:{connections:[g.id],mode:f.options.mode===
window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"}})),void 0!==b.loader))if(f.options.loader=b.loader,f.options.loader&&!g.loader)g.loader=document.createElement("div"),g.loader.setAttribute("id","back_"+g.id),g.loader.setAttribute("class","Talk_loader"),g.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'),
d?g.showLoading():g.hideLoading();else if(!f.options.loader&&g.loader){try{g.div&&g.loader&&(g.loader.parentNode===g.div?g.div.removeChild(g.loader):L.Logger.warning(a,"[tk-sdk]VideoPlayer removeChild loader warning: Element removal warning"))}catch(e){L.Logger.error(a,"[tk-sdk]NativeVideoPlayer removeChild error:",e)}g.loader=void 0}};g.getVideoPlayerOptions=function(){return f.options};g.showVideoContainer=function(){};g.hideVideoContainer=function(){};TK.isOnlyAudioRoom&&g.hideVideo();g.container=
void 0!==g.elementID?"object"===typeof g.elementID&&"function"===typeof g.elementID.appendChild?g.elementID:document.getElementById(g.elementID):document.body;g.container.appendChild(g.div);g.loader&&(d?g.showLoading():g.hideLoading(),g.div.appendChild(g.loader));g.div.appendChild(g.video);g.div.appendChild(g.videoSupernatant);g.containerWidth=0;g.containerHeight=0;g.hideLoading();return g};window.TK=window.TK||{};window.L=window.L||{};
TK.NativeAudioPlayer=function(f){f.options=f.options||{};var k=TK.EventDispatcher({}),g=100,d=!1,a={fileName:"NativeAudioPlayer.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};k.id=f.id;k.local=f.local;k.type=f.type;k.elementID=f.elementID;k.bundleId=f.bundleId;k.userid=f.userid;k.userId=k.userid;k.extensionId=f.extensionId;var b=L.Utils.nativeMediaStream();k.setMute=function(b){"boolean"!==typeof b?L.Logger.error(a,"[tk-sdk]Stream setMute isMute type must is boolean!"):(k.local&&
"video"===k.type?(L.Logger.debug(a,"[tk-sdk]videoPlayer setMute:local video must is mute!"),d=!0):d=b,d?window.tknative.postMessage({command:"setEmbedVolume",connectionId:k.id,volume:0}):window.tknative.postMessage({command:"setEmbedVolume",connectionId:k.id,volume:g}))};k.setVolume=function(b){"number"!==typeof b?L.Logger.error(a,"[tk-sdk]Stream setVolume volume type must is number!"):(b*=2.55,k.local&&k.type===TK.STREAM_VIDEO?(L.Logger.debug(a,"[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),
g=0):g=b,window.tknative.postMessage({command:"setEmbedVolume",connectionId:k.id,volume:b}))};k.getVolume=function(b){if(b&&"function"===typeof b){if(TK.isTkNative)return b(g),g}else return L.Logger.warning(a,"[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!"),g};k.updateAudioPlayerOptions=function(a){};k.updateAudioPlayerSpec=function(a){};k.destroy=function(){try{b=void 0}catch(c){L.Logger.error(a,"[tk-sdk]AudioPlayer destroy error , error info:",c)}};k.hasAudioTrack=
function(){var a=!1;b&&b.getAudioTracks()&&b.getAudioTracks().length&&(a=!0);return a};k.getAudioTrack=function(){if(b&&b.getAudioTracks()&&b.getAudioTracks().length)return b.getAudioTracks()[0]};k.removeAudioTrack=function(){k.hasAudioTrack()&&b&&b.removeTrack&&b.removeTrack(k.getAudioTrack())};k.addAudioTrack=function(a){k.hasAudioTrack()&&k.removeAudioTrack();b&&b.addTrack&&a&&b.addTrack(a)};k.onRemoteAudioVolume=function(a){};k.onMicVolumeReport=function(a){};k.local&&k.type===TK.STREAM_VIDEO&&
(k.setVolume(0),k.setMute(!0));return k};window.TK=window.TK||{};window.L=window.L||{};
TK.VideoPlayer=function(f){function k(){c.hideLoading();c.video&&(L.Utils.removeEvent(c.video,"canplay",k),L.Utils.removeEvent(c.video,"loadeddata",k),L.Utils.removeEvent(c.video,"loadedmetadata",k));if(!m&&c.video&&0!==c.video.readyState&&(m=!0,TK.roomInstance&&!f.deviceCheck)){var a=c.userid;"_local_default_extension_id_"===a&&(a="");a={userId:a,mediaType:c.type,width:c.video&&c.video.videoWidth||0,height:c.video&&c.video.videoHeight||0};if(c.type===TK.STREAM_VIDEO){var d=new RegExp(c.userid+":",
"g");d.test(c.extensionId)&&(d=c.extensionId.replace(d,""),a.deviceId=d)}a=TK.RoomEvent({type:TK.EVENT_TYPE.roomFirstVideoFrame,message:a});TK.roomInstance.dispatchEvent(a)}b()}function g(a,b){if(b&&b.getVideoTracks&&b.getVideoTracks()&&b.getVideoTracks().length){d(a);try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(a.srcObject=b,L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)){var c=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);
a.setSinkId&&a.setSinkId(c).then(function(a){L.Logger.info(p,"[tk-sdk]VideoPlayer setSinkId success:",c)}).catch(function(a){L.Logger.info(p,"[tk-sdk]VideoPlayer setSinkId error:",a)})}}else{var e=window.URL||webkitURL;a.src=e.createObjectURL(b)}}catch(z){L.Logger.warning(p,"[tk-sdk]videoPlayer attachMediaStream. attach by srcObject failed.",z,adapter.browserDetails),e=window.URL||webkitURL,a.src=e.createObjectURL(b)}}}function d(a){try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(a.srcObject&&
L.Utils.isFunction(a.srcObject.removeTrack)&&L.Utils.isFunction(a.srcObject.getTracks))for(var b=a.srcObject.getTracks(),c=b.length-1;0<=c;c--)a.srcObject.removeTrack(b[c]);a.srcObject=null}else a.src=""}catch(X){a.src=""}}function a(){r=f.options.mirror?"rotateY(180deg)":"";var a=n+(r?" ":"")+r;c.video.style.webkitTransform=a;c.video.style.mozTransform=a;c.video.style.oTransform=a;c.video.style.msTransform=a;c.video.style.transform=a}function b(){if(c.video.videoWidth&&c.video.videoHeight&&c.div.clientWidth&&
c.div.clientHeight){n=f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"translate(-50%,-50%)":"";var a=n+(r?" ":"")+r;c.video.style.webkitTransform=a;c.video.style.mozTransform=a;c.video.style.oTransform=a;c.video.style.msTransform=a;c.video.style.transform=a;f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?(c.video.style.height="100%",c.video.style.width="100%",c.video.style.top="50%",c.video.style.left="50%"):(c.video.style.height="100%",c.video.style.width="100%",c.video.style.top=
"0%",c.video.style.left="0%")}else n="",a=n+(r?" ":"")+r,c.video.style.webkitTransform=a,c.video.style.mozTransform=a,c.video.style.oTransform=a,c.video.style.msTransform=a,c.video.style.transform=a,c.video.style.height="100%",c.video.style.width="100%",c.video.style.top="0%",c.video.style.left="0%",c.video.style.webkitObjectFit=f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.mozObjectFit=f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.oObjectFit=
f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.msObjectFit=f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.objectFit=f.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":""}f.options=f.options||{};f.options.mirror=f.options.mirror||!1;f.options.mode=f.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;f.options.loader=L.Utils.isBoolean(f.options.loader)?f.options.loader:!0;var c=TK.EventDispatcher({}),e=f.options.loader,
m=!1,u=L.Utils.createMediaStream(),r="",n="",x=f.successFn,h=f.failureFn,p={fileName:"VideoPlayer.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};c.id=f.id;c.local=f.local;c.type=f.type;c.elementID=f.elementID;c.bundleId=f.bundleId;c.userid=f.userid;c.userId=c.userid;c.extensionId=f.extensionId;c.div=document.createElement("div");c.div.setAttribute("id","videoplayer_"+c.id);c.div.setAttribute("class","Talk_player");c.div.setAttribute("style","width: 100%; height: 100%; position: relative;background-color: black; overflow: hidden;");
f.options.loader&&(c.loader=document.createElement("div"),c.loader.setAttribute("id","videoplayback_"+c.id),c.loader.setAttribute("class","Talk_loader"),c.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'));
c.video=document.createElement("video");c.video.setAttribute("id","videoplaystream_"+c.id);c.video.setAttribute("class","Talk_stream");c.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;");c.video.setAttribute("autoplay","autoplay");c.video.setAttribute("webkit-playsinline","true");c.video.setAttribute("x-webkit-airplay","true");c.video.setAttribute("playsinline","true");c.video.setAttribute("x5-video-player-type","h5");c.video.setAttribute("x5-video-player-fullscreen",
"true");c.video.setAttribute("muted","muted");c.video.muted=!0;c.video.volume=0;L.Utils.addEvent(c.video,"canplay",k);L.Utils.addEvent(c.video,"loadeddata",k);L.Utils.addEvent(c.video,"loadedmetadata",k);c.videoSupernatant=document.createElement("div");c.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");c.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");c.video.oncanplay=function(a){L.Utils.isFunction(x)&&
x(a)};c.video.onerror=function(a){L.Utils.isFunction(h)&&h(a)};c.updateVideoPlayerSpec=function(a){if("object"===typeof a)for(var b in a)if(c.hasOwnProperty(b))switch(c[b]=a[b],b){case "id":c.div&&c.div.setAttribute("id","videoplayer_"+c.id),c.loader&&c.loader.setAttribute("id","videoplayback_"+c.id),c.video&&c.video.setAttribute("id","videoplaystream_"+c.id)}};c.destroy=function(){try{c.video&&(L.Utils.mediaPause(c.video),d(c.video));if(c.container&&c.div)try{c.div.parentNode===c.container?c.container.removeChild(c.div):
L.Logger.warning(p,"[tk-sdk]VideoPlayer removeChild warning: Element removal warning")}catch(K){L.Logger.error(p,"[tk-sdk]VideoPlayer removeChild error:",K)}c.removeVideoTrack();u=void 0}catch(K){L.Logger.error(p,"[tk-sdk]VideoPlayer destroy error , error info:",K)}};c.updateVideoPlayerOptions=function(d){if(d&&"object"===typeof d&&(void 0!==d.mirror&&(f.options.mirror=d.mirror,a()),void 0!==d.mode&&(f.options.mode=d.mode,b()),void 0!==d.loader))if(f.options.loader=d.loader,f.options.loader&&!c.loader)c.loader=
document.createElement("div"),c.loader.setAttribute("id","videoplayback_"+c.id),c.loader.setAttribute("class","Talk_loader"),c.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'),
e?c.showLoading():c.hideLoading();else if(!f.options.loader&&c.loader){try{c.loader.parentNode===c.div?c.div.removeChild(c.loader):L.Logger.warning(p,"[tk-sdk]VideoPlayer removeChild loader warning: Element removal warning")}catch(M){L.Logger.error(p,"[tk-sdk]VideoPlayer removeChild error:",M)}c.loader=void 0}};c.getVideoPlayerOptions=function(){return f.options};c.showVideoContainer=function(){c.container&&(c.container.style.display="block")};c.hideVideoContainer=function(){c.container&&(c.container.style.display=
"none")};c.showVideo=function(){c.video&&(c.video.style.display="block");e&&c.loader&&(c.loader.style.display="")};c.hideVideo=function(){c.video&&(c.video.style.display="none");e&&c.loader&&(c.loader.style.display="")};c.hideLoading=function(){e=!1;c.loader&&(c.loader.style.display="none");c.div.style.backgroundColor="transparent"};c.showLoading=function(){e=!0;c.loader&&(c.loader.style.display="");c.div.style.backgroundColor=""};c.hasVideoTrack=function(){var a=!1;u&&u.getVideoTracks()&&u.getVideoTracks().length&&
(a=!0);return a};c.getVideoTrack=function(){if(u&&u.getVideoTracks()&&u.getVideoTracks().length)return u.getVideoTracks()[0]};c.removeVideoTrack=function(){c.hasVideoTrack()&&u&&u.removeTrack&&(u.removeTrack(c.getVideoTrack()),d(c.video),b())};c.addVideoTrack=function(a){c.hasVideoTrack()&&c.removeVideoTrack();u&&u.addTrack&&a&&(a.enabled=!0,u.addTrack(a),g(c.video,u),b())};c.loader&&(e?c.showLoading():c.hideLoading(),c.div.appendChild(c.loader));c.div.appendChild(c.video);c.div.appendChild(c.videoSupernatant);
if("string"===typeof c.elementID)if(c.container=document.getElementById(c.elementID),c.container){var v=c.container.getElementsByClassName("Talk_player");if(v&&v.length)try{for(var E=v.length-1;0<=E;E--)L.Logger.warning(p,"[tk-sdk]videoPlayer:There are other nodes in the video player that have not been released,not released element id is "+v[E].id+" ,element id is "+c.elementID+",id is "+c.id+",type is "+c.type+",userId is "+c.userid),v[E].parentNode===c.container?c.container.removeChild(v[E]):L.Logger.warning(p,
"[tk-sdk]VideoPlayer removeChild  warning -traversal: Element removal warning")}catch(K){L.Logger.error(p,"[tk-sdk]videoPlayer error:",K)}c.container.appendChild(c.div)}else L.Logger.error(p,"[tk-sdk]videoPlayer error:find element,element id is "+c.elementID+",id is "+c.id+",type is "+c.type+",userId is "+c.userid);else L.Logger.error(p,"[tk-sdk]videoPlayer error:element id must is string,element id is "+c.elementID+",id is "+c.id+",type is "+c.type+",userId is "+c.userid);u&&g(c.video,u);try{if(c&&
c.video&&c.video.play){var B=L.Utils.mediaPlay(c.video);B&&B.catch&&B.catch(function(a){L.Logger.warning(p,"[tk-sdk]video.play method catch error , videoPlayer id is "+c.id+" , error info:"+a)})}}catch(K){L.Logger.warning(p,"[tk-sdk]video.play method error , videoPlayer id is "+(c?c.id:"undefined")+" !")}a();b();return c};window.TK=window.TK||{};window.L=window.L||{};TK.deviceInfoMap=TK.deviceInfoMap||{videoinput:[],audioinput:[],audiooutput:[]};TK.hasDevice=TK.hasDevice||{videoinput:!1,audioinput:!1,audiooutput:!1};TK.networkTestInfo=TK.networkTestInfo||{protocol:"https",host:"global.talk-cloud.net",port:443,isConnectRoom:!1};
TK.DeviceMgr=function(){function f(a,b,c,d){if(L.Utils.isSupportMediaStreamTrackMethod("applyConstraints")&&T[a]&&T[a].track)if(T[a].profile.width!==b.width||T[a].profile.height!==b.height||d){var e={width:{ideal:b.width},height:{ideal:b.height},frameRate:{ideal:b.maxfps}},f=function(){T[a]&&(T[a].profile=b);L.Utils.isFunction(c)&&c()};d=T[a].track;if(L.Utils.isFunction(d.getCapabilities)){var h=d.getCapabilities();"{}"!==JSON.stringify(h)&&(h.width.max>e.width.ideal&&(e.width.max=e.width.ideal),
h.height.max>e.height.ideal&&(e.height.max=e.height.ideal),h.frameRate.max>e.frameRate.ideal&&(e.frameRate.max=e.frameRate.ideal))}"mozilla"===L.Utils.getBrowser()&&delete e.frameRate;d.applyConstraints(e).then(function(){L.Logger.debug(C,"[tk-sdk]applyConstraintsToVideoTrack finshed,applyConstraints videoTrack success,apply constraints:"+L.Utils.toJsonStringify(e));f()}).catch(function(a){L.Logger.info(C,"[tk-sdk]applyConstraintsToVideoTrack finshed,applyConstraints videoTrack fail,apply constraints:"+
L.Utils.toJsonStringify(e),"reason:",L.Utils.toJsonStringify(a));f()})}else L.Utils.isFunction(c)&&c()}function k(a,b,c){if(a.video&&"object"===typeof a.video&&"object"===typeof a.video.deviceId&&"string"===typeof a.video.deviceId.exact&&!L.Utils.isVideoinputDeviceIdFromDeviceList(a.video.deviceId.exact)||a.audio&&"object"===typeof a.audio&&"object"===typeof a.audio.deviceId&&"string"===typeof a.audio.deviceId.exact&&!L.Utils.isAudioinputDeviceIdFromDeviceList(a.audio.deviceId.exact)){var d={code:8,
message:"Requested device not found",name:"NotFoundError"};L.Logger.info(C,"[tk-sdk]getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(d),L.Utils.toJsonStringify(a),L.Utils.toJsonStringify(adapter.browserDetails));L.Utils.isFunction(c)&&c(d)}else{var e=function(a){L.Utils.isFunction(b)&&b(a)},f=function(a){L.Utils.isFunction(c)&&c(a)};u(a,e,function(b){-1!==b.code&&a&&a.video&&"object"===typeof a.video&&void 0!==a.video.frameRate?(L.Logger.info(C,"[tk-sdk]getUserMedia fail,delete frameRate again getUserMedia,fail info(failInfo,constraints,browserDetails):",
L.Utils.toJsonStringify(b),L.Utils.toJsonStringify(a),L.Utils.toJsonStringify(adapter.browserDetails)),delete a.video.frameRate,u(a,e,function(b){-1!==b.code&&a&&a.video&&"object"===typeof a.video&&(void 0!==a.video.width||void 0!==a.video.height)?(L.Logger.info(C,"[tk-sdk]getUserMedia fail,delete width and height again getUserMedia,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(b),L.Utils.toJsonStringify(a),L.Utils.toJsonStringify(adapter.browserDetails)),delete a.video.width,
delete a.video.height,u(a,e,function(b){L.Logger.info(C,"[tk-sdk]delete width and height again getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(b),L.Utils.toJsonStringify(a),L.Utils.toJsonStringify(adapter.browserDetails));f(b)})):(L.Logger.info(C,"[tk-sdk]delete frameRate again getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(b),L.Utils.toJsonStringify(a),L.Utils.toJsonStringify(adapter.browserDetails)),f(b))})):(L.Logger.info(C,
"[tk-sdk]getUserMedia failed,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(b),L.Utils.toJsonStringify(a),L.Utils.toJsonStringify(adapter.browserDetails)),f(b))})}}function g(a){L.Logger.debug(C,"[tk-sdk]DeviceMgr:onDeviceChangeEvent. event:",a);var b=(new Date).getTime();L.Logger.info(C,"[tk-sdk]device change start,change date is "+b);e(function(c,d){c={};var e={};d&&d.addDevices&&(c=d.addDevices);d&&d.removedDevices&&(e=d.removedDevices);L.Logger.info(C,"[tk-sdk]device change finshed,change date is "+
b+",addDevices:"+L.Utils.toJsonStringify(c)+",removedDevices:"+L.Utils.toJsonStringify(e));if(L.Utils.getJsonLength(c)||L.Utils.getJsonLength(e))if(L.Utils.isFunction(z.onDeviceChanged))z.onDeviceChanged(c,e,a,S);else L.Utils.isFunction(S)&&S(c,e,a)},{getDeviceChangeInfo:!0})}function d(a,b,c){b=void 0!==b?b:!0;c=void 0!==c?c:!0;if(b&&c&&a&&a.getTracks&&"function"===typeof a.getTracks){if((a=a.getTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&L.Utils.stopTrack(a[c])}else{if(b&&
a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(b=a.getVideoTracks())&&0<b.length)for(var d=0;d<b.length;d++)b[d]&&b[d].stop&&"function"===typeof b[d].stop&&L.Utils.stopTrack(b[d]);if(c&&a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&L.Utils.stopTrack(a[c])}}function a(a,b,c,d,e,f){d=d||{};a?b?(a.videoPlayer&&a.videoPlayer.destroy&&a.videoPlayer.destroy(),a.videoPlayer=
TK.VideoPlayer({id:"videoDeviceStream_"+(new Date).getTime(),elementID:b,deviceCheck:!0,options:d,successFn:e,failureFn:f}),a.videoPlayer.addVideoTrack(a.getVideoTracks()[0]),"function"===typeof c&&c(a.videoPlayer)):L.Logger.error(C,"[tk-sdk]playDeviceStream elementID can not be empty!"):L.Logger.error(C,"[tk-sdk]playDeviceStream mediaStream can not be empty!")}function b(a){a?a&&a.videoPlayer&&a.videoPlayer.destroy&&(a.videoPlayer.destroy(),a.videoPlayer=void 0,delete a.videoPlayer):L.Logger.error(C,
"[tk-sdk]unplayDeviceStream mediaStream can not be empty!")}function c(a,b,c,d){d=d||{};a?b?(a.audioPlayer&&a.audioPlayer.destroy&&a.audioPlayer.destroy(),a.audioPlayer=TK.AudioPlayer({id:"audioDeviceStream_"+(new Date).getTime(),elementID:b,deviceCheck:!0,options:d}),a.audioPlayer.addAudioTrack(a.getAudioTracks()[0]),"function"===typeof c&&c(a.audioPlayer)):L.Logger.error(C,"[tk-sdk]playDeviceStream elementID can not be empty!"):L.Logger.error(C,"[tk-sdk]playDeviceStream mediaStream can not be empty!")}
function e(a,b){b=b||{};L.Logger.debug(C,"[tk-sdk]call enumerateDevices!");b.isSetlocalStorage=void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;(function(a){var b=[];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.warning(C,"[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),a&&"function"===typeof a&&a(b),null;navigator.mediaDevices.enumerateDevices().then(function(c){for(var d={},e=0,f=c.length;e<f;e++){var h=c[e];if("default"!==h.deviceId&&
"communications"!==h.groupId&&"communications"!==h.deviceId&&"\u901a\u8baf"!==h.label){d[h.kind]=d[h.kind]||{};var g={kind:h.kind,label:h.label,deviceId:h.deviceId,groupId:h.groupId};d[h.kind][h.deviceId]=g;b.push(g)}}a&&"function"===typeof a&&a(b)}).catch(function(c){L.Logger.warning(C,"[tk-sdk]enumerateDevices error :"+c.name+": "+c.message);a&&"function"===typeof a&&a(b);throw c;})})(function(c){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),
f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),h={},g={},k={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},n=L.Utils.getBrowserInfo();n=n&&n.language&&n.language.toLowerCase().match(/zh/g)?"chinese":"english";var p={videoinput:{label:"chinese"===n?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===n?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",
num:0},audiooutput:{label:"chinese"===n?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}};c&&c.forEach&&c.forEach(function(a){if(a){var b={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!b.label&&p[a.kind]&&(b.label=p[a.kind].label+ ++p[a.kind].num);"audioinput"===a.kind&&a.deviceId===d&&(k.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===e&&(k.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===f&&(k.useDevices[a.kind]=a.deviceId);
h[a.kind]=h[a.kind]||a.deviceId;k.devices[a.kind].push(b);k.hasdevice[a.kind]=!0;"default"===a.deviceId&&(g[a.kind]=a.deviceId)}});k.useDevices.audioinput||(k.useDevices.audioinput=g.audioinput||h.audioinput||"");k.useDevices.videoinput||(k.useDevices.videoinput=g.videoinput||h.videoinput||"");k.useDevices.audiooutput||(k.useDevices.audiooutput=g.audiooutput||h.audiooutput||"");TK.hasDevice=L.Utils.toJsonParse(L.Utils.toJsonStringify(k.hasdevice));c=L.Utils.toJsonParse(L.Utils.toJsonStringify(TK.deviceInfoMap));
TK.deviceInfoMap=L.Utils.toJsonParse(L.Utils.toJsonStringify(k.devices));L.Utils.localStorage?b.isSetlocalStorage&&(b.ignoreAudioinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,k.useDevices.audioinput),b.ignoreVideoinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,k.useDevices.videoinput),b.ignoreAudiooutputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,k.useDevices.audiooutput)):L.Logger.warning(C,
"[tk-sdk]not support localStorage");k.useDevices={audioinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||"",videoinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",audiooutput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)||""};va=k.useDevices;n=L.Utils.toJsonParse(L.Utils.toJsonStringify(TK.deviceInfoMap));for(var m in n)for(var U=c[m],N=n[m],r=U.length-1;0<=r;r--)for(var A=N.length-1;0<=A;A--)if(U[r].deviceId===N[A].deviceId){U.splice(r,
1);N.splice(A,1);break}U={};N={};for(m in n)n[m]&&n[m].length&&(U[m]=n[m]);for(m in c)c[m]&&c[m].length&&(N[m]=c[m]);L.Utils.getJsonLength(U)||L.Utils.getJsonLength(N)?L.Logger.info(C,"[tk-sdk]enumerateDevices devicesInfo:",L.Utils.toJsonStringify(k)):L.Logger.debug(C,"[tk-sdk]enumerateDevices devicesInfo:",L.Utils.toJsonStringify(k));a&&"function"===typeof a&&a(k,b.getDeviceChangeInfo?{addDevices:U,removedDevices:N}:void 0)})}function m(a,b,c,d){d=d||{};try{if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)){var e=
0,f=function(a,f,h){if(a&&a.nodeName&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(d.speakerTest||"TKSDK_speakerTest"!==a.id)if(L.Utils.isFunction(a.setSinkId))try{a.setSinkId(b).then(function(){var d=a.getAttribute("id");L.Logger.debug(C,"[tk-sdk]Audio output device set to "+b,d?" , element id is "+d:"  element:",d?"":a);e++;e===h&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var d=void 0,f=a.getAttribute("id");b&&"object"===typeof b&&"SecurityError"===b.name&&(d="You need to use HTTPS for selecting audio output device  ");
L.Logger.info(C,"[tk-sdk]setSinkId error:",b,d?d:"",f?" , element id is "+f:"  element:",f?"":a);e++;e===h&&c&&"function"===typeof c&&c(!1)})}catch(A){f=a.getAttribute("id"),L.Logger.warning(C,"[tk-sdk]setSinkId err:",A,f?" , element id is "+f:"  element:",f?"":a),e++,e===h&&c&&"function"===typeof c&&c(!1)}else f=a.getAttribute("id"),L.Logger.warning(C,"[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,f?" , element id is "+f:"  element:",f?"":a),e++,e===h&&c&&"function"===
typeof c&&c(!1);else e++,e===h&&c&&"function"===typeof c&&c(!1);else e++,e===h&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var h=document.getElementsByTagName("audio"),g=document.getElementsByTagName("video");if(h&&0<h.length)for(var k=0;k<h.length;k++){var n=h[k];a.push(n)}if(g&&0<g.length)for(k=0;k<g.length;k++)n=g[k],a.push(n)}if(a&&(L.Utils.isArray(a)||L.Utils.isHTMLCollection(a)))if(a&&0<a.length){var p=a.length;for(k=0;k<a.length;k++){n=a[k];var m=k;f(n,m,p)}}else m=0,f(a[m],m,1);else f(a,
0,1)}else c&&"function"===typeof c&&c(!1)}catch(U){L.Logger.error(C,"[tk-sdk]setElementSinkIdToAudioouputDevice error:",U),c&&"function"===typeof c&&c(!1)}}function u(a,b,c){var d=function(a){L.Utils.isFunction(b)&&b(a)},e=function(a){var b={};"object"===typeof a?(b.code=a.code,b.name=a.name,b.message=a.message):b={code:-1,name:"UnknownError",message:a};L.Utils.isFunction(c)&&c(b)};try{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then(d).catch(e):
(L.Logger.warning(C,"[tk-sdk]adapter`s getUserMedia un-defined ?!",L.Utils.toJsonStringify(adapter.browserDetails)),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia(a,d,e))}catch(V){e(V)}}function r(a,b,c,d,e){Y.testing?L.Utils.speedNetwordk(a,b,c,function(a,b){TK.networkTestInfo.isConnectRoom?(n(),Y.testing=!1,L.Logger.warning(C,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),
L.Utils.isFunction(e)&&e("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):Y.testing?(b=parseInt(b/2),0!==a&&(b=99999),a=L.Utils.getNetDelayLevel(b),L.Utils.isFunction(d)&&d(a,b)):n()},{source:"(NetworkTest)",infoLog:!1}):n()}function n(){clearInterval(Y.timer);Y.timer=void 0}function x(a,b){n();var c=function(){TK.networkTestInfo.isConnectRoom?(n(),Y.testing=!1,L.Logger.warning(C,"[tk-sdk]The room has been connected successfully, and the startNetworkTest method is not supported after successful connection."),
L.Utils.isFunction(b)&&b("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):Y.testing?(r(TK.networkTestInfo.protocol,TK.networkTestInfo.host,TK.networkTestInfo.port,a,b),Y.timer=setInterval(function(){TK.networkTestInfo.isConnectRoom?(n(),Y.testing=!1,L.Logger.warning(C,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(b)&&b("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):Y.testing?r(TK.networkTestInfo.protocol,TK.networkTestInfo.host,
TK.networkTestInfo.port,a,b):n()},3E3)):n()};TK.networkTestInfo.isConnectRoom?c():L.Utils.getWhereWebInfo(TK.networkTestInfo.protocol,"global.talk-cloud.net",function(a){Y.testing?(TK.networkTestInfo.host=L.Utils.replaceHostname(TK.networkTestInfo.host,L.Utils.trim(a.name)),c()):n()},function(){c()})}function h(){if(F.mediaStream){var a=F.mediaStream;a?a&&a.audioPlayer&&a.audioPlayer.destroy&&(a.audioPlayer.destroy(),a.audioPlayer=void 0,delete a.audioPlayer):L.Logger.error(C,"[tk-sdk]unplayDeviceStream mediaStream can not be empty!");
d(F.mediaStream);F.mediaStream=null}F._soundMeter&&F._soundMeter.stop&&(F._soundMeter.stop(),F._soundMeter=void 0);clearInterval(F._soundMeterTimer);F._soundMeter=void 0;F._soundMeterTimer=void 0}function p(a,b,d,e){a?(h(),z.getUserMedia({audio:{deviceId:{exact:a}},video:!1},function(a){if(F.testing){h();F.mediaStream=a;b&&c(F.mediaStream,b);try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext,
F._soundMeter&&F._soundMeter.stop&&(F._soundMeter.stop(),F._soundMeter=void 0),TK.audioContext&&F.mediaStream&&z&&z.getsSoundMeterInstance&&(F._soundMeter=z.getsSoundMeterInstance(TK.audioContext,F),F._soundMeter&&F._soundMeter.connectToSource&&F._soundMeter.connectToSource(F.mediaStream,function(a){a||(F._soundMeter&&F._soundMeter.instant&&F._soundMeter.instant.toFixed?(a=Math.floor(100*F._soundMeter.instant.toFixed(2)),L.Utils.isFunction(d)&&d(a)):L.Utils.isFunction(d)&&d(0),clearInterval(F._soundMeterTimer),
F._soundMeterTimer=setInterval(function(){if(F._soundMeter&&F._soundMeter.instant&&F._soundMeter.instant.toFixed){var a=Math.floor(100*F._soundMeter.instant.toFixed(2));L.Utils.isFunction(d)&&d(a)}else L.Utils.isFunction(d)&&d(0)},100))}))}catch(V){L.Logger.warning(C,"[tk-sdk]startMicrophoneTest error:",V)}}else h()},function(a){F.testing?(L.Utils.isFunction(e)&&e(a),L.Logger.info(C,"[tk-sdk] getUserMedia failed when test microphone, failure info:",a)):h()})):(L.Logger.error(C,"startMicrophoneTest got invalid deviceId"),
L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"))}function v(a){I.mediaStream&&(b(I.mediaStream),a&&d(I.mediaStream),I.mediaStream=null)}function E(a,c){try{O[a]&&O[a].mediaStream&&(b(O[[a]].mediaStream),c&&d(O[a].mediaStream),O[a].mediaStream=null)}catch(R){L.Logger.warning(C,"_stopVideoTestFromSdk Method capture error info:",R)}}function B(b,c,d,e,f){e=e||{};b?c?(v(),z.getVideoTrack(b,function(b){I.testing?(b=L.Utils.createMediaStream(b),v(),I.mediaStream=b,a(I.mediaStream,c,void 0,e,f,d)):v()},function(a){I.testing?
(L.Logger.info(C,"[tk-sdk] getUserMedia failed when test camera, failure info:",a),L.Utils.isFunction(d)&&d(a)):v()})):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(C,"startCameraTest got invalid elementId")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(C,"startCameraTest got invalid deviceId"))}function K(b,c,d,e,f){d=d||{};b?c?(E(b),z.getVideoTrack(b,function(h){O[b]?O[b].testing?(h=L.Utils.createMediaStream(h),E(b),O[b].mediaStream=h,a(O[b].mediaStream,c,void 0,
d,e,f)):E(b):L.Logger.error(C,"_startVideoTestFromSdk got invalid stream")},function(a){O[b].testing?(L.Logger.info(C,"[tk-sdk] getUserMedia failed when test camera, failure info:",a),L.Utils.isFunction(f)&&f(a)):E(b)})):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error(C,"startCameraTest got invalid elementId")):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error(C,"startCameraTest got invalid deviceId"))}function M(){var a=document.getElementById("TKSDK_speakerTest");a&&
(L.Utils.mediaPause(a),a.src="");G.audioUrl=null}function Q(a,b,c){if(a)if(b)try{var d=document.getElementById("TKSDK_speakerTest");d||(d=document.createElement("audio"),d.setAttribute("id","TKSDK_speakerTest"),d.setAttribute("loop","loop"),d.style.display="none",document.body.appendChild(d));G.audioUrl=b;m([d],a,function(a){a?G.testing?(d.src=G.audioUrl,L.Utils.mediaPlay(d)):M():L.Utils.isFunction(c)&&c("TK_Speaker_Test_Fail")},{speakerTest:!0})}catch(ja){L.Logger.warning(C,"[tk-sdk]startSpeakerTest err:",
ja),L.Utils.isFunction(c)&&c("TK_Speaker_Test_Fail",ja)}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error(C,"startSpeakerTest got invalid audioUrl");else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error(C,"startSpeakerTest got invalid deviceId")}function X(a,b){var c={};c[a]=L.Utils.localStorage.getItem(a);c[a]!==b&&L.Utils.localStorage.setItem(a,b);return c}var z={onDevicesSetted:null,onDeviceChanged:null,onCameraSetted:null,onMicrophoneSetted:null,onSpeakerSetted:null,
isNativeSetVideoProfile:!1},N={},I={testing:!1},O={},F={testing:!1},G={testing:!1},S=void 0,Y={testing:!1,timer:void 0},J={sharing:!1,shared:!1},va={},C={fileName:"AVMgr.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};J={sharing:!1,shared:!1};var ia={},ca={width:1920,height:1080,maxfps:30},T={},ha={};C={fileName:"AVMgr.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};z.destroyVideoTrack=function(a){TK.notStopVideoTrack||TK.notStopTrack||(T[a]&&L.Utils.stopTrack(T[a].track),
T[a]=void 0,delete T[a])};z.destroyAllVideoTrack=function(){for(var a in T)z.destroyVideoTrack(a)};z.destroyAudioTrack=function(a){ha[a]&&L.Utils.stopTrack(ha[a]);ha[a]=void 0;delete ha[a]};z.destroyAllAudioTrack=function(){for(var a in ha)z.destroyAudioTrack(a)};z.hasVideoTrack=function(a){return T[a]?!0:!1};z.hasAudioTrack=function(a){return ha[a]?!0:!1};z.setMaxVideoProfile=function(a,b,c){ca.width=a||ca.width;ca.height=b||ca.height;ca.maxfps=c||ca.maxfps;for(var d in T)a=z.getUseVideoProfile(d),
T[d].profile.width===a.width&&T[d].profile.height===a.height||f(d,z.getUseVideoProfile(d),void 0,!1)};z.setVideoProfile=function(a,b,c){TK.isMultiCamera?ia[b]=a:(ia=a,b=N.videoinput);if(T[b]&&T[b].track)if(TK.isMultiCamera)a=z.getUseVideoProfile(b),f(b,a,c,!1);else for(var d in T)a=z.getUseVideoProfile(d),T[d].profile.width===a.width&&T[d].profile.height===a.height||f(d,z.getUseVideoProfile(d),void 0,!1);else c(),L.Logger.info(C,"[tk-sdk]The specified track was not found locally.")};z.getVideoProfile=
function(a){var b={};TK.isMultiCamera&&ia.hasOwnProperty(a)?b=L.Utils.copy(ia[a]):TK.isMultiCamera||(b=L.Utils.copy(ia));L.Utils.getJsonLength(b)||(b=L.Utils.copy(ca));return b};z.getMaxVideoProfile=function(){return L.Utils.copy(ca)};z.getUseVideoProfile=function(a){a=z.getVideoProfile(a);if(a.width*a.height>ca.width*ca.height){var b=a.width*a.height/(ca.width*ca.height);a.width=Math.floor(a.width/b);a.height=Math.floor(a.height/b)}a.maxfps>ca.maxfps&&(a.maxfps=ca.maxfps);return a};z.getVideoTrack=
function(a,b,c){if(a)if(T[a]&&T[a].track)L.Utils.isFunction(b)&&b(T[a].track);else{var d=L.Utils.isSupportMediaStreamTrackMethod("applyConstraints"),e=z.getUseVideoProfile(a);T[a]={profile:e};TK.isMultiCamera||(N.videoinput=a);var h={deviceId:{exact:a},width:{ideal:d?ca.width:profle.width},height:{ideal:d?ca.height:e.height},frameRate:{ideal:d?ca.maxfps:e.maxfps,max:30}};"mozilla"===L.Utils.getBrowser()&&delete h.frameRate;z.getUserMedia({video:h,audio:!1},function(h){var g=h.getVideoTracks()[0];
if(g){T[a].track=g;h.getVideoTracks();var k=function(){L.Utils.isFunction(b)&&b(T[a].track)};e=z.getUseVideoProfile(a);!d||ca.width==e.width&&ca.height==e.height?k():f(a,e,function(){k()},!0)}else L.Utils.isFunction(c)&&c({code:-1,message:"Requested device not video track",name:"UnknownError"});h=void 0},function(a){L.Utils.isFunction(c)&&c(a)})}else L.Utils.isFunction(c)&&c({code:8,message:"Requested device not found",name:"NotFoundError"})};z.getAudioTrack=function(a,b,c){a?ha[a]?L.Utils.isFunction(b)&&
b(ha[a]):z.getUserMedia({audio:{deviceId:a},video:!1},function(d){(d=d.getAudioTracks()[0])?(ha[a]=d,L.Utils.isFunction(b)&&b(ha[a])):L.Utils.isFunction(c)&&c({code:-1,message:"Requested device not audio track",name:"UnknownError"})},function(a){L.Utils.isFunction(c)&&c(a)}):L.Utils.isFunction(c)&&c({code:8,message:"Requested device not found",name:"NotFoundError"})};z.getUserMedia=function(a,b,c){k(a,b,c)};z.getsSoundMeterInstance=function(a,b){try{if(a)return new function(a){var c=this,d=void 0,
e=b&&"object"===typeof b;c.audioContext=a;c.instant=0;c.slow=0;c.clip=0;c.script=c.audioContext.createScriptProcessor(2048,1,1);c.script.onaudioprocess=function(a){if(!e||b&&b.mediaStream){a=a.inputBuffer.getChannelData(0);var f,h=0,g=0;for(f=0;f<a.length;++f)h+=a[f]*a[f],.99<Math.abs(a[f])&&(g+=1);c.instant=Math.sqrt(h/a.length);c.slow=.95*c.slow+.05*c.instant;c.clip=g/a.length}else c.stop();"function"===typeof d&&(d(null),d=void 0)};c.connectToSource=function(a,b){L.Logger.debug(C,"SoundMeter connecting");
try{a&&a.getAudioTracks&&a.getAudioTracks().length?(c.mic=c.audioContext.createMediaStreamSource(a),c.mic.connect(c.script),c.script.connect(c.audioContext.destination),d=b):(c.stop(),d=b,"function"===typeof d&&(d(null),d=void 0))}catch(y){L.Logger.error(C,"[tk-sdk]connecToSource error:",y),"undefined"!==typeof b&&b(y)}};c.stop=function(){c.mic&&c.mic.disconnect&&c.mic.disconnect();c.script&&c.script.disconnect&&c.script.disconnect()};return c}(a);L.Logger.error(C,"[tk-sdk]getsSoundMeterInstance audioContext is not exist!")}catch(R){L.Logger.error(C,
"[tk-sdk]getsSoundMeterInstance errorinfo:",R)}};z.addDeviceChangeListener=function(a){S=null;S=a};z.removeDeviceChangeListener=function(){S=null};z.stopCameraTest=function(){v();I={testing:!1}};z.stopVideoTest=function(a,b,c){try{if(a)E(a),O[a]={},O[a].testing=!1,O[a].mediaStream=null;else for(var d in O)a=d,O[a]?(E(a),O[a].testing=!1,O[a].mediaStream=null):L.Logger.warning(C,"_stopVideoTestFromSdk This operation fails info: No specified device.");L.Utils.isFunction(b)&&b()}catch(ja){L.Utils.isFunction(c)&&
c(),L.Logger.warning(C,"_stopVideoTestFromSdk Method capture error info:",ja)}};z.startCameraTest=function(a,b,c,d,e){I.testing=!0;B(a,b,c,d,e)};z.startVideoTest=function(a,b,c,d,e){O[a]&&O[a].testing&&(E(a),L.Logger.warning(C,"startVideoTest Method Is testing"));O[a]={};O[a].testing=!0;K(a,b,c,d,e)};z.stopMicrophoneTest=function(){h();F={testing:!1}};z.startMicrophoneTest=function(a,b,c,d){F.testing=!0;p(a,b,c,d)};z.stopSpeakerTest=function(){M();G.testing=!1};z.startSpeakerTest=function(a,b,c){G.testing=
!0;Q(a,b,c)};z.stopNetworkTest=function(){n();Y.testing=!1};z.startNetworkTest=function(a,b){Y.testing=!0;x(a,b)};z.getDevices=function(a,b){e(a,b)};z.getCameras=function(a,b){e(function(b,c){b&&b.devices&&a&&"function"===typeof a&&a(b.devices.videoinput||[],c)},b)};z.getMicrophones=function(a,b){e(function(b,c){b&&b.devices&&a&&"function"===typeof a&&a(b.devices.audioinput||[],c)},b)};z.getSpeakers=function(a,b){e(function(b,c){b&&b.devices&&a&&"function"===typeof a&&a(b.devices.audiooutput||[],
c)},b)};z.setDevices=function(a,b){var c={},d={};a=a||{};for(var e in a)a[e]&&"undefined"!==a[e]||delete a[e],d[e]=L.Utils.localStorage.getItem(L.Constant.deviceStorage[e]),L.Constant.deviceStorage[e]&&a[e]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[e])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[e],a[e]),c[e]=!0);N.videoinput=a?a.videoinput:"";c.audiooutput&&m();if(L.Utils.isFunction(z.onDevicesSetted))z.onDevicesSetted(a,d,b)};z.setCamera=function(a,b){if(a){N.videoinput=
a?a:"";var c=X(L.Constant.deviceStorage.videoinput,a);if(L.Utils.isFunction(z.onCameraSetted))z.onCameraSetted(a,c,b)}else L.Logger.error(C,"[tk-sdk]Lack of key parameters!")};z.setMicrophone=function(a,b){if(a){var c=X(L.Constant.deviceStorage.audioinput,a);if(L.Utils.isFunction(z.onMicrophoneSetted))z.onMicrophoneSetted(a,c,b)}else L.Logger.error(C,"[tk-sdk]Lack of key parameters!")};z.setSpeaker=function(a,b){if(a){var c=X(L.Constant.deviceStorage.audiooutput,a);m();if(L.Utils.isFunction(z.onSpeakerSetted))z.onSpeakerSetted(a,
c,b)}else L.Logger.error(C,"[tk-sdk]Lack of key parameters!")};z.checkVideoInputDevice=function(a,b){a?z.getVideoTrack(a,function(c){z.destroyVideoTrack(a);c?L.Utils.isFunction(b)&&b(!0):L.Utils.isFunction(b)&&b(!1)},function(){L.Utils.isFunction(b)&&b(!1)}):L.Utils.isFunction(b)&&b(!1)};z.checkAudioInputDevice=function(a,b){a?z.getAudioTrack(a,function(c){z.destroyAudioTrack(a);c?L.Utils.isFunction(b)&&b(!0):L.Utils.isFunction(b)&&b(!1)},function(){L.Utils.isFunction(b)&&b(!1)}):L.Utils.isFunction(b)&&
b(!1)};z.getUserDesktopMedia=function(a,b,c,d){function e(e,f){a.audio=!1;a.video=a.video||{};a.video.mandatory=a.video.mandatory||{};a.video.mandatory.chromeMediaSource=a.video.mandatory.chromeMediaSource||"desktop";a.video.mandatory.chromeMediaSourceId=e;a.video.mandatory.maxWidth=window.screen.width;a.video.mandatory.maxHeight=window.screen.height;var h=function(){delete J.mediaStream;L.Utils.isFunction(d)&&d()};u(a,function(a){J.shared=!0;J.sharing=!1;J.mediaStream=a;a.getVideoTracks()[0].onended=
h;L.Utils.isFunction(b)&&b(a)},function(a){J.shared=!1;J.sharing=!1;delete J.mediaStream;L.Utils.isFunction(c)&&c(a)})}a=a||{};!0===J.sharing?L.Logger.warning(C,"[tk-sdk]one task getUserDesktopMedia is doing."):(z.closeUserDesktopMedia(),J.sharing=!0,J.istimeoutForGet=!1,J.timeridForGet=setTimeout(function(){L.Logger.warning(C,"getUserDesktopMedia Do TimeOut.");J.istimeoutForGet=!0;J.shared=!1;J.sharing=!1;delete J.mediaStream;L.Utils.isFunction(c)&&c({code:-2,name:"TimeOut",message:"getUserDesktopMedia TimeOut"});
J.eventListenForGet&&(window.removeEventListener("message",J.eventListenForGet),delete J.eventListenForGet)},2E3),J.eventListenForGet&&window.removeEventListener("message",J.eventListenForGet),J.eventListenForGet=function(a){!0!==J.istimeoutForGet&&("tk-reply-clear"===a.data.type?J.timeridForGet&&clearTimeout(J.timeridForGet):"tk-reply-get"===a.data.type&&(0===a.data.error?e(a.data.msg.streamId,a.data.msg.canRequestAudioTrack):(L.Logger.warning(C,"[tk-sdk]getUserDesktopMedia tk-reply-get errorinfo:",
a.data.msg),J.shared=!1,J.sharing=!1,delete J.mediaStream,L.Utils.isFunction(c)&&c({code:-1,name:a.data.type,message:a.data.msg})),window.removeEventListener("message",J.eventListenForGet),delete J.eventListenForGet))},window.addEventListener("message",J.eventListenForGet),window.postMessage({type:"get-custom-sourceId",info:["screen","window","tab"]},"*"))};z.getUseDevice=function(){return va};z.closeUserDesktopMedia=function(){z.cancelUserDesktopMediaDialog();if(J.mediaStream){L.Logger.info(C,"[tk-sdk]closeUserDesktopMedia");
if(J.mediaStream.getVideoTracks&&"function"===typeof J.mediaStream.getVideoTracks){var a=J.mediaStream.getVideoTracks();if(a&&0<a.length)for(var b=0;b<a.length;b++)a[b]&&a[b].stop&&"function"===typeof a[b].stop&&L.Utils.stopTrack(a[b],!0)}if(J.mediaStream.getAudioTracks&&"function"===typeof J.mediaStream.getAudioTracks&&(a=J.mediaStream.getAudioTracks())&&0<a.length)for(b=0;b<a.length;b++)a[b]&&a[b].stop&&"function"===typeof a[b].stop&&L.Utils.stopTrack(a[b],!0);delete J.mediaStream}J.shared=!1};
z.cancelUserDesktopMediaDialog=function(){L.Logger.info(C,"[tk-sdk]cancelUserDesktopMediaDialog");window.postMessage({type:"close-select-dialog"},"*")};z.checkUserDesktopMediaMode=function(a){J.istimeoutForCheck=!1;J.timeridForCheck=setTimeout(function(){L.Logger.warning(C,"checkUserDesktopMediaMode DoTimeOut.");J.istimeoutForCheck=!0;L.Utils.isFunction(a)&&a(!1);J.eventListenForCheck&&(window.removeEventListener("message",J.eventListenForCheck),delete J.eventListenForCheck)},2E3);J.eventListenForCheck&&
window.removeEventListener("message",J.eventListenForCheck);J.eventListenForCheck=function(b){!0!==J.istimeoutForCheck&&"tk-reply-rtcmulticonnection"===b.data.type&&(J.timeridForCheck&&clearTimeout(J.timeridForCheck),L.Utils.isFunction(a)&&a(!0),window.removeEventListener("message",J.eventListenForCheck),delete J.eventListenForCheck)};window.addEventListener("message",J.eventListenForCheck);window.postMessage({type:"rtcmulticonnection"},"*")};z.enumerateDevices=function(a,b){z.getDevices(a,b)};z.stopStreamTracks=
function(a,b,c){d(a,b,c)};z.setElementSinkIdToAudioouputDevice=function(a,b,c){m(a,b,c)};z.associateElementsToSpeaker=function(a,b,c){m(a,b,c)};navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=g);return z}();window.TK=window.TK||{};window.L=window.L||{};TK.CONNECTION_TYPE={UP:0,DOWN:1};TK.customStreamFn=void 0;
TK.Connection=function(f){function k(a){var b=void 0;switch(a){case "video":b=I.getVideoTrack();break;case "audio":b=I.getAudioTrack()}return b}function g(a,b,c){var d=k(a.kind);a&&d?("audio"===d.kind&&(L.Utils.stopTrack(d),a&&(a=L.Utils.cloneTrack(a))),L.Logger.debug(r,"[tk-sdk]replaceTrack(connection_id is "+h+")",d,a),Promise.resolve().then(function(){var b=n.getSenders().find(function(a){return a.track===d});if(!b)throw Error("local track not found");return b.replaceTrack(a)}).then(function(){x&&
x.removeTrack(d);x&&x.addTrack(a);X=a;"video"===a.kind?I.enableVideo(p):"audio"===a.kind&&m();L.Utils.isFunction(b)&&b()}).catch(function(a){L.Logger.error(r,"[tk-sdk]replaceTrack error(connection_id is "+h+"):",a);L.Utils.isFunction(c)&&c(a)})):(L.Logger.warning(r,"[tk-sdk]replaceTrack fail ( connection_id is "+h+" ) track \x3d\x3d null!"),L.Utils.isFunction(c)&&c())}function d(a){L.Logger.info(r,"[tk-sdk] Connection::onAddStream",h,a);x=a.stream;X=I.getVideoTrack();I.enableVideo(p);m();if("safari"===
L.Utils.getBrowserInfo().info.browserName)a.stream.onaddtrack=function(b){if(L.Utils.isFunction(I.onAddStream))I.onAddStream(h,a)};else if(L.Utils.isFunction(I.onAddStream))I.onAddStream(h,a)}function a(a){L.Logger.info(r,"[tk-sdk] Connection::onRemoveStream",h,a);x=void 0;if(L.Utils.isFunction(I.onRemoveStream))I.onRemoveStream(h,a)}function b(a){L.Logger.debug(r,"[tk-sdk] Connection::onIceCandidate",h,a);if(L.Utils.isFunction(I.onIceCandidate)&&a.candidate){var b;a.candidate.candidate.match(/a=/)||
(b="a\x3d"+a.candidate.candidate);I.onIceCandidate(h,{type:"candidate",candidate:{sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:b}})}}function c(a){if(!L.Utils.isNull(n)&&(L.Logger.info(r,"[tk-sdk] Connection::onIceConnectionStateChange",h,n.iceConnectionState),L.Utils.isFunction(I.onIceConnectionStateChange)))I.onIceConnectionStateChange(h,n.iceConnectionState)}function e(a){var b=I.getAudioTrack();b&&b.enabled!==a&&(b.enabled=a)}function m(){var a=I.getAudioTrack();
a&&a.enabled!==v&&e(v)}function u(a){if(E===TK.CONNECTION_TYPE.DOWN&&"string"===typeof B&&/(firefox)/g.test(B.toLowerCase())&&/^59\./g.test(K)){L.Logger.debug(r,"[tk-sdk]firefox 59 hack,hack before sdp:"+a);a=L.Utils.formatSdp(a);for(var b=a.split("\r\n"),c=-1,d=-1,e=0,f=b.length;e<f&&(/^m=audio/.test(b[e])?c=e:/^m=video/.test(b[e])&&(d=e),-1===c||-1===d);e++);c<d&&(a=b.slice(c,d),d=b.slice(d,b.length-1),a=b.slice(0,c).join("\r\n")+"\r\n"+d.join("\r\n")+"\r\n"+a.join("\r\n"));L.Logger.debug(r,"[tk-sdk]firefox 59 hack,hack after sdp:"+
a)}return a}var r={fileName:"Connection.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};if(L.Utils.isNull(f))throw"[tk-sdk] got null parameter while creating connection";if(!f.hasOwnProperty("connectionId"))throw"[tk-sdk] got a parameter without property connectionId while creating connection";if(!f.hasOwnProperty("connectionType"))throw"[tk-sdk] got a parameter without property connectionType while creating connection";var n,x=void 0,h=f.connectionId,p=!0,v=!0,E=f.connectionType,
B=L.Utils.getBrowserInfo().info.browserName,K=L.Utils.getBrowserInfo().info.browserVersion,M=null,Q=f.extensionId,X=null,z=!1,N=null,I={setPeerConnection:function(e){n=e;n.onaddstream=d;n.onremovestream=a;n.onicecandidate=b;n.oniceconnectionstatechange=c},getPeerConnection:function(){return n},getExtensionId:function(){return Q},getConnectionId:function(){return h},createOffer:function(a,b){if(L.Utils.isNull(n)){if(L.Logger.error(r,"[tk-sdk] Connection::createOffer: peerconnection object is null"),
L.Utils.isFunction(b)){var c=new DOMException("peerconnection object is null","createOffer-error");b(c)}}else n.createOffer(function(b){L.Logger.debug(r,"[tk-sdk]Local Description(createOffer)",b.sdp);L.Utils.isFunction(a)&&a(b);n.setLocalDescription(b,function(){if(L.Utils.isFunction(I.onOfferGenerated))I.onOfferGenerated(h,b)},function(a){L.Logger.error(r,"[tk-sdk] Connection::setLocalDescription failed",a)})},function(a){L.Logger.error(r,"[tk-sdk] Connection::createOffer failed",a);L.Utils.isFunction(b)&&
b(a)},{offerToReceiveAudio:E!==TK.CONNECTION_TYPE.UP,offerToReceiveVideo:E!==TK.CONNECTION_TYPE.UP})},createAnswer:function(){n.createAnswer(function(a){n.setLocalDescription(a,function(){L.Logger.debug(r,"createAnswer setLocalDes",a);if(L.Utils.isFunction(I.onOfferGenerated))I.onOfferGenerated(h,a)},function(a){L.Logger.error(r,"createAnswer setLocalDes error")})},function(){})},setBandWidth:function(a,b,c){M?p?n.createOffer(function(d){L.Logger.debug(r,"[tk-sdk]Local Description(createOffer)",d.sdp);
n.setLocalDescription(d,function(){M.sdp=L.Utils.setMaxBWToSdp(M.sdp,{video:!0,maxVideoBW:a},{audio:!0,maxVideoBW:null});n.setRemoteDescription(new RTCSessionDescription(M),function(){L.Utils.isFunction(b)&&b();L.Logger.info(r,"[tk-sdk] Connection::setRemoteDescription: success")},function(a){L.Utils.isFunction(c)&&c(a);L.Logger.info(r,"[tk-sdk] Connection::setRemoteDescription: error",a)})},function(a){L.Logger.error(r,"[tk-sdk] Connection::setLocalDescription failed",a)})},function(a){L.Logger.error(r,
"[tk-sdk] Connection::createOffer failed",a);L.Utils.isFunction(c)&&c(a)},{offerToReceiveAudio:E!==TK.CONNECTION_TYPE.UP,offerToReceiveVideo:E!==TK.CONNECTION_TYPE.UP}):(N=a,L.Utils.isFunction(b)&&b()):L.Logger.error(r,"[tk-sdk] setBandWidth Fn failed info Sdp inexistence")},setRemoteDescription:function(a,b,c){L.Utils.isNull(n)?(L.Logger.error(r,"[tk-sdk] Connection::setRemoteDescription: peerconnection object is null"),L.Utils.isFunction(c)&&c("peerconnection object is null")):L.Utils.isNull(a)?
(L.Logger.error(r,"[tk-sdk] Connection::setRemoteDescription: sdp object is null"),L.Utils.isFunction(c)&&c("sdp object is null")):(E===TK.CONNECTION_TYPE.DOWN&&"string"===typeof B&&/(firefox)/g.test(B.toLowerCase())&&/^59\./g.test(K)&&(a.sdp=u(a.sdp)),M=a,n.setRemoteDescription(new RTCSessionDescription(a),function(){L.Utils.isFunction(b)&&b()},function(a){L.Utils.isFunction(c)&&c(a)}))},addIceCandidate:function(a){var b=new RTCIceCandidate(a);n.addIceCandidate(b,function(){L.Logger.debug(r,"addIceCandidate success",
h,b)},function(){L.Logger.error(r,"addIceCandidate failed",h,b)})},setMediaStream:function(a,b){if(a.getAudioTracks()&&0<a.getAudioTracks().length){var c=a.getAudioTracks()[0];a.removeTrack(c);a.addTrack(L.Utils.cloneTrack(c))}b&&L.Utils.isFunction(b)&&(c=b(a),TK.customStreamFn=b,c?a=c:L.Logger.error(r,"[tk-sdk]setStreamMethod Wrong return result."));E!==TK.CONNECTION_TYPE.UP||L.Utils.isNull(n)||L.Utils.isNull(a)||n.addStream(a);x=a},getMediaStream:function(){if(!L.Utils.isNull(n)){if(E===TK.CONNECTION_TYPE.UP)return x;
if(E===TK.CONNECTION_TYPE.DOWN)return n.getRemoteStreams()[0]}},removeMediaStream:function(a){E!==TK.CONNECTION_TYPE.UP||L.Utils.isNull(n)||L.Utils.isNull(a)||n.removeStream(a);x=void 0},replaceAudioTrack:function(a){I.getAudioTrack()?g(a):L.Logger.warning(r,"[tk-sdk]old track is not exist,not support addAudioTrack method!")},replaceVideoTrack:function(a,b){I.getVideoTrack()||X?!I.getVideoTrack()&&X?z=X!==a:g(a,null,b):L.Logger.warning(r,"[tk-sdk]old track is not exist,not support getVideoTrack method!")},
needRePublish:function(){return z},getVideoTrack:function(){if(!L.Utils.isNull(I.getMediaStream()))return I.getMediaStream().getVideoTracks()[0]},getAudioTrack:function(){if(!L.Utils.isNull(I.getMediaStream()))return I.getMediaStream().getAudioTracks()[0]},enableVideo:function(a){a=p=a;if(E===TK.CONNECTION_TYPE.UP)a?!I.getVideoTrack()&&X&&x.addTrack(X):(X=I.getVideoTrack())&&x.removeTrack(X);else{var b=I.getVideoTrack();b&&b.enabled!==a&&(b.enabled=a)}N&&p&&(I.setBandWidth(N),N=null)},videoEnabled:function(){return p},
enableAudio:function(a){v=a;e(v)},audioEnabled:function(){return v},close:function(){L.Utils.isNull(n)||(x&&x.getTracks().forEach(function(a){"audio"===a.kind&&L.Utils.stopTrack(a);x.removeTrack(a)}),n.close(),x=null)},getStats:function(a,b){L.Utils.isNull(n)&&(L.Logger.error(r,"[tk-sdk] Connection::getStats: peerconnection object is null"),L.Utils.isFunction(b)&&b("peerconnection object is null"));n.getStats(null,function(b){L.Utils.isFunction(a)&&a(b)},function(a){L.Utils.isFunction(b)&&b(a)})},
onOfferGenerated:void 0,onIceCandidate:void 0,onIceConnectionStateChange:void 0,onAddStream:void 0,onRemoveStream:void 0};return I};window.TK=window.TK||{};window.L=window.L||{};
TK.ConnectionMgr=function(){var f={fileName:"ConnectionMgr.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""},k={};return{createUpConnection:function(g,d){if(L.Utils.isNull(g))L.Logger.error(f,"[tk-sdk] createUpConnection got invalid parameter");else{var a=!1,b=void 0;L.Utils.isNull(d)||L.Utils.isNull(d.useNative)||!L.Utils.isBoolean(d.useNative)||(a=d.useNative);!L.Utils.isNull(d)&&d.hasOwnProperty("extraData")&&(b=d.extraData);a?(a=TK.NativeConnection({connectionId:g,connectionType:TK.CONNECTION_TYPE.UP,
extraData:b}),!L.Utils.isNull(d)&&d.hasOwnProperty("mediaStream")&&a.setMediaStream(d.mediaStream,d.extraData.setStreamMethod,d.extraData)):(a=TK.Connection({connectionId:g,connectionType:TK.CONNECTION_TYPE.UP,extensionId:d.extraData.extensionId}),b=new RTCPeerConnection,a.setPeerConnection(b),!L.Utils.isNull(d)&&d.hasOwnProperty("mediaStream")&&a.setMediaStream(d.mediaStream,d.extraData.setStreamMethod));return k[g]=a}},addIceCandidate:function(f,d){(f=k[f])&&f.addIceCandidate(d)},createDownConnection:function(g,
d){if(L.Utils.isNull(g))L.Logger.error(f,"[tk-sdk] createUpConnection got invalid parameter");else{var a=!1,b=void 0;L.Utils.isNull(d)||L.Utils.isNull(d.useNative)||!L.Utils.isBoolean(d.useNative)||(a=d.useNative);!L.Utils.isNull(d)&&d.hasOwnProperty("extraData")&&(b=d.extraData);a?d=TK.NativeConnection({connectionId:g,connectionType:TK.CONNECTION_TYPE.DOWN,extraData:b}):(d=TK.Connection({connectionId:g,connectionType:TK.CONNECTION_TYPE.DOWN}),a=new RTCPeerConnection,d.setPeerConnection(a));return k[g]=
d}},getConnection:function(f){return k[f]},getConnectionByExtensionId:function(f){var d=null,a;for(a in k)if(k[a].getExtensionId()===f){d=k[a];break}return d},getAllConnections:function(){var f=[],d;for(d in k)f.push(k[d]);return f},closeConnection:function(f){var d=k[f];d&&(d.close(),delete k[f])},closeAllConnections:function(){for(var f in k)k[f].close();k={}},createOffer:function(f,d,a){(f=k[f])?f.createOffer(d,a):L.Utils.isFunction(a)&&a("TK_ERR_NOT_PEERCONNECTION")},setRemoteDescription:function(f,
d,a,b){(f=k[f])?f.setRemoteDescription(d,a,b):L.Utils.isFunction(b)&&b("TK_ERR_NOT_PEERCONNECTION")},setBandWidth:function(f,d,a,b){(f=k[f])&&f.setBandWidth(d,a,b)},getStats:function(f,d,a){(f=k[f])?f.getStats(d,a):L.Utils.isFunction(a)&&a("TK_ERR_NOT_PEERCONNECTION")},bindIceCandidate:function(f,d){if(f=k[f])f.onIceCandidate=d},bindOfferGenerated:function(f,d){if(f=k[f])f.onOfferGenerated=d},bindIceConnectionStateChange:function(f,d){if(f=k[f])f.onIceConnectionStateChange=d},bindAddStream:function(f,
d){if(f=k[f])f.onAddStream=d},getConnectionMediaStream:function(f){if(f=k[f])return f.getMediaStream()},setConnectionMediaStream:function(f,d,a){if(f=k[f])return f.setMediaStream(d,a)},getConnectionVideoTrack:function(f){if(f=k[f])return f.getVideoTrack()},getConnectionAudioTrack:function(f){if(f=k[f])return f.getAudioTrack()},getConnectionVideoEnabled:function(f){if(f=k[f])return f.videoEnabled()},getConnectionAudioEnabled:function(f){if(f=k[f])return f.audioEnabled()},setConnectionVideoEnabled:function(f,
d){(f=k[f])&&f.enableVideo(d)},setConnectionAudioEnabled:function(f,d){(f=k[f])&&f.enableAudio(d)},checkReplaceTrackSupport:function(f){return(f=k[f])&&f.checkReplaceTrackSupport?f.checkReplaceTrackSupport():!1}}}();window.TK=window.TK||{};window.L=window.L||{};
TK.EventDispatcher=function(f){var k={fileName:"Events.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""},g={};f=f||{};f.dispatcher={};f.dispatcher.eventListeners={};f.dispatcher.backupListerners={};g.addEventListener=function(d,a,b){void 0!==d&&null!==d&&(void 0===f.dispatcher.eventListeners[d]&&(f.dispatcher.eventListeners[d]=[]),f.dispatcher.eventListeners[d].push(a),b&&(void 0===f.dispatcher.backupListerners[b]&&(f.dispatcher.backupListerners[b]=[]),f.dispatcher.backupListerners[b].push({eventType:d,
listener:a})))};g.removeEventListener=function(d,a){f.dispatcher.eventListeners[d]?(a=f.dispatcher.eventListeners[d].indexOf(a),-1!==a&&f.dispatcher.eventListeners[d].splice(a,1)):L.Logger.info(k,"[tk-sdk]not event type: "+d)};g.removeAllEventListener=function(d){if(d&&"object"===typeof d&&"number"===typeof d.length&&"function"===typeof d.splice&&!d.propertyIsEnumerable("length"))for(var a in d){var b=d[a];delete f.dispatcher.eventListeners[b]}else if("string"===typeof d)delete f.dispatcher.eventListeners[d];
else if("object"===typeof d)for(var c in d)b=c,g.removeEventListener(b,d[c])};g.dispatchEvent=function(d,a){var b;(void 0!=a?a:1)&&L.Logger.debug(k,"sdk-dispatchEvent , event type: "+d.type+", evnet:",d);for(b in f.dispatcher.eventListeners[d.type])if(f.dispatcher.eventListeners[d.type].hasOwnProperty(b))f.dispatcher.eventListeners[d.type][b](d)};g.removeBackupListerner=function(d){if(d&&f.dispatcher.backupListerners[d]){for(var a=0;a<f.dispatcher.backupListerners[d].length;a++){var b=f.dispatcher.backupListerners[d][a];
g.removeEventListener(b.eventType,b.listener)}f.dispatcher.backupListerners[d].length=0;delete f.dispatcher.backupListerners[d]}};return g};TK.TalkEvent=function(f){var k={};k.type=f.type;k.data=f.data;return k};TK.RoomEvent=function(f,k){var g=TK.TalkEvent(f);g.streams=f.streams;g.message=f.message;g.user=f.user;g.userid=f.user?f.user.id:void 0;g.userId=g.userid;if(k&&"object"===typeof k)for(var d in k)g[d]=k[d];return g};
TK.StreamEvent=function(f,k){var g=TK.TalkEvent(f);g.stream=f.stream;g.message=f.message;g.bandwidth=f.bandwidth;g.attrs=f.attrs;g.userid=f.stream&&f.stream.extensionId&&f.stream.getAttributes&&f.stream.getAttributes()&&f.stream.getAttributes().type?f.stream.extensionId.replace(new RegExp(":"+f.stream.getAttributes().type,"g"),""):void 0;g.userId=g.userid;g.streamType=f.stream&&f.stream.extensionId&&f.stream.getAttributes&&f.stream.getAttributes()&&f.stream.getAttributes().type?f.stream.getAttributes().type:
void 0;g.streamInfo={audio:f.stream&&f.stream.hasAudio?f.stream.hasAudio():!1,video:f.stream&&f.stream.hasVideo?f.stream.hasVideo():!1,attributes:f.stream&&f.stream.getAttributes?f.stream.getAttributes():{}};if(k&&"object"===typeof k)for(var d in k)g[d]=k[d];return g};TK.coreEventController=TK.EventDispatcher({});window.TK=window.TK||{};window.L=window.L||{};window.TK_MODULE=window.TK_MODULE||{};TK.updateApplyConstraintsToCloneTrack=TK.updateApplyConstraintsToCloneTrack||{};
window.TK_MODULE.MediaControl=function(){var f={fileName:"MediaControl.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""},k={},g=TK.ConnectionMgr;k.createUpConnection=function(d,a){a=a||{};return g.createUpConnection(d,a)};k.createDownConnection=function(d,a){return g.createDownConnection(d,a)};k.closeConnection=function(d){g.closeConnection(d)};k.closeAllConnections=function(){g.closeAllConnections()};k.hasConnection=function(d){return g.getConnection(d)?!0:!1};k.replaceAudioTrack=
function(d,a){(d=g.getConnection(d))&&d.replaceAudioTrack(a)};k.replaceVideoTrack=function(d,a){(d=g.getConnection(d))&&d.replaceVideoTrack(a)};k.openWebScreen=function(d,a,b,c){try{TK.DeviceMgr.getUserDesktopMedia(d,function(b){L.Utils.isFunction(a)&&(a(b),L.Logger.info(f,"[tk-sdk]Web Screen sharing success !"))},function(a){L.Logger.warning(f,"[tk-sdk]Web Screen sharing failed !");L.Utils.isFunction(b)&&b()},c)}catch(e){L.Logger.warning(f,"[tk-sdk]Web Screen sharing failed !")}};k.closeWebScreen=
function(){TK.DeviceMgr.closeUserDesktopMedia()};k.getVideoProfile=function(d){return TK.DeviceMgr.getVideoProfile(d)};k.getDeviceMediaStream=function(d,a,b,c){var e=!1,f=!1,k,g,n,x,h=function(){if(e&&f)if(k||g){var a=TK.isTkNative?TK.isTkMacNative?L.Utils.createMediaStream(k,g):L.Utils.nativeMediaStream(k,g):L.Utils.createMediaStream(k,g);L.Utils.isFunction(b)&&b(a,n,x)}else L.Utils.isFunction(c)&&c(n,x)};d?TK.DeviceMgr.getVideoTrack(d,function(a){e=!0;k=a;h()},function(a){e=!0;n=a;h()}):(e=!0,h());
a?TK.DeviceMgr.getAudioTrack(a,function(a){f=!0;g=a;h()},function(a){f=!0;x=a;h()}):(f=!0,h())};k.hasDeviceVideoTrack=function(d){return TK.DeviceMgr.hasVideoTrack(d)};k.hasDeviceAudioTrack=function(d){return TK.DeviceMgr.hasAudioTrack(d)};k.setMaxVideoProfile=function(d,a,b){TK.DeviceMgr.setMaxVideoProfile(d,a,b)};k.destroyVideoTrack=function(d){TK.DeviceMgr.destroyVideoTrack(d)};k.destroyAudioTrack=function(d){TK.DeviceMgr.destroyAudioTrack(d)};k.destroyAllVideoTrack=function(){TK.DeviceMgr.destroyAllVideoTrack()};
k.destroyAllAudioTrack=function(){TK.DeviceMgr.destroyAllAudioTrack()};k.getConnectionMediaStream=function(d){return g.getConnectionMediaStream(d)};k.setConnectionMediaStream=function(d,a,b){g.setConnectionMediaStream(d,a,b)};k.getConnectionVideoTrack=function(d){return g.getConnectionVideoTrack(d)};k.getConnectionAudioTrack=function(d){return g.getConnectionAudioTrack(d)};k.createOffer=function(d,a,b){g.createOffer(d,a,b)};k.setRemoteDescription=function(d,a,b,c){g.setRemoteDescription(d,a,b,c)};
k.setBandWidth=function(d,a,b,c){g.setBandWidth(d,a,b,c)};k.getStats=function(d,a,b){g.getStats(d,a,b)};k.bindIceCandidate=function(d,a){g.bindIceCandidate(d,a)};k.bindOfferGenerated=function(d,a){g.bindOfferGenerated(d,a)};k.bindIceConnectionStateChange=function(d,a){g.bindIceConnectionStateChange(d,a)};k.bindAddStream=function(d,a){g.bindAddStream(d,function(b,c){L.Utils.isFunction(a)&&a(b,c)})};k.getDeviceMgr=function(){return TK.DeviceMgr};k.checkDeviceAvailability=function(d,a,b){function c(){k+=
1;2<=k&&L.Utils.isFunction(a)&&a()}b=b||{};var e=d.devices;d=e.videoinput.slice(0);e=e.audioinput.slice(0);var k=0;if(d.length){if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput))for(var g=d.length-1;0<=g;g--){var r=d[g];if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)===r.deviceId){d.splice(g,1);d.unshift(r);break}}}else videoAvailableErr={code:8,message:"Requested device not found",name:"NotFoundError"};if(e.length){if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput))for(g=
e.length-1;0<=g;g--)if(r=e[g],L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)===r.deviceId){e.splice(g,1);e.unshift(r);break}}else audioAvailableErr={code:8,message:"Requested device not found",name:"NotFoundError"};(function(a){if(a.length){var d=a.shift();TK.DeviceMgr.checkVideoInputDevice(d.deviceId,function(a){if(a){if(b.findAvailabilityDevice&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.deviceId),L.Utils.isFunction(b.onVideoSuccess))b.onVideoSuccess()}else L.Logger.error(f,
"[tk-sdk] The equipment is not available deviceId:",d.deviceId);c()})}else{if(L.Utils.isFunction(b.onVideoFailure))b.onVideoFailure({code:-1,message:"Requested device unknown error",name:"UnknownError"});c()}})(d);(function(a){if(a.length){var d=a.shift();TK.DeviceMgr.checkAudioInputDevice(d.deviceId,function(a){if(a){if(b.findAvailabilityDevice&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.deviceId),L.Utils.isFunction(b.onAudioSuccess))b.onAudioSuccess()}else L.Logger.error(f,
"[tk-sdk] The equipment is not available deviceId:",d.deviceId);c()})}else L.Utils.isFunction(b.onAudioFailure)&&(audioAvailableErr={code:-1,message:"Requested device unknown error",name:"UnknownError"},b.onAudioFailure(audioAvailableErr)),c()})(e)};k.getConnectionVideoEnabled=function(d){return g.getConnectionVideoEnabled(d)};k.getConnectionAudioEnabled=function(d){return g.getConnectionAudioEnabled(d)};k.setConnectionVideoEnabled=function(d,a){g.setConnectionVideoEnabled(d,a)};k.setConnectionAudioEnabled=
function(d,a){g.setConnectionAudioEnabled(d,a)};k.getConnectionStats=function(d,a,b){g.getStats(d,a,b)};k.hasNativeConnection=function(d){return(d=g.getConnection(d))&&d.isNative?!0:!1};k.checkReplaceTrackSupport=function(d){return g.checkReplaceTrackSupport(d)};k.resetTrack=function(d,a,b){TK.DeviceMgr.resetTrack(d,a,b)};k.setVideoProfile=function(d,a,b,c){TK.DeviceMgr.setVideoProfile(d,a,function(){TK.DeviceMgr.hasVideoTrack(a)?TK.DeviceMgr.getVideoTrack(a,function(a){L.Utils.isFunction(b)&&b()},
function(){L.Utils.isFunction(c)&&c()}):L.Utils.isFunction(b)&&b()})};k.getUseVideoProfile=function(d){return TK.DeviceMgr.getUseVideoProfile(d)};k.getMaxVideoProfile=function(){return TK.DeviceMgr.getMaxVideoProfile()};k.needRePublish=function(d){return(d=g.getConnection(d))?d.needRePublish():!1};return k}();window.TK=window.TK||{};window.L=window.L||{};TK.deviceInfoMap=TK.deviceInfoMap||{videoinput:[],audioinput:[],audiooutput:[]};TK.hasDevice=TK.hasDevice||{videoinput:!1,audioinput:!1,audiooutput:!1};TK.networkTestInfo=TK.networkTestInfo||{protocol:"https",host:"global.talk-cloud.net",port:443,isConnectRoom:!1};
TK.NativeAVMgr=function(){function f(a,b,d,e){d=d||{};a?(a=TK.NativeVideoPlayer({id:"videoinput_stream_player",stream:{stream:void 0},elementID:a,options:d}),a.addVideoTrack(),"function"===typeof b&&b(a)):L.Logger.error(c,"[tk-sdk]playDeviceStream elementID can not be empty!")}function k(a,b){try{if(a=a||{},a[b]&&a[b].deviceId){if("string"===typeof a[b].deviceId)return a[b].deviceId;if("object"===typeof a[b].deviceId){if("string"===typeof a[b].deviceId.exact)return a[b].deviceId.exact}else return""}else return""}catch(N){return""}}
function g(a,b,d){var f=function(a){var f=k(a,"video"),g=k(a,"audio");if(f){if(!h[f]){var n=e.getUseVideoProfile(f);window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:n.width,height:n.height,frameRate:n.maxfps},deviceId:f});h[f]=!0}window.tknative.postMessage({command:"setCamera",deviceId:f})}g&&window.tknative.postMessage({command:"setMicrophone",deviceId:g});B++;L.Utils.isNull(a.video.deviceId)&&L.Utils.isNull(a.audio.deviceId)?(a={code:8,message:"Requested device not found",
name:"NotFoundError"},L.Utils.isFunction(d)&&d(a),L.Logger.error(c,"[tk-sdk] getUserMedia failed.",a)):b(L.Utils.nativeMediaStream(f?{id:f,kind:"video"}:null,g?{id:g,kind:"audio"}:null))};a=a||{audio:{},video:{}};d=d||function(a){L.Logger.error(c,"[tk-sdk]getUserMedia error:",a)};a.screen?(L.Logger.debug(c,"[tk-sdk]Screen access requested!"),b(null)):f(a)}function d(a,b){var c={};c[a]=L.Utils.localStorage.getItem(a);c[a]!==b&&L.Utils.localStorage.setItem(a,b);return c}function a(a,b,d,f,h){Q.testing?
L.Utils.speedNetwordk(a,b,d,function(a,b){TK.networkTestInfo.isConnectRoom?(e.stopNetworkTest(),L.Logger.warning(c,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(h)&&h("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):Q.testing?(b=parseInt(b/2),0!==a&&(b=99999),a=L.Utils.getNetDelayLevel(b),L.Utils.isFunction(f)&&f(a,b)):e.stopNetworkTest()},{source:"(NetworkTest)",infoLog:!1}):e.stopNetworkTest()}function b(a,
b,d){try{if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.tknative.postMessage({command:"setSpeaker",deviceId:b}),d&&"function"===typeof d&&d(!1);else{var e=0,f=function(a,f,h){if(a&&a.nodeName&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var f=a.getAttribute("id");L.Logger.debug(c,"[tk-sdk]Audio output device set to "+
b,f?" , element id is "+f:"  element:",f?"":a);e++;e===h&&d&&"function"===typeof d&&d(!0)}).catch(function(b){var f=void 0,k=a.getAttribute("id");b&&"object"===typeof b&&"SecurityError"===b.name&&(f="You need to use HTTPS for selecting audio output device  ");L.Logger.info(c,"[tk-sdk]setSinkId error:",b,f?f:"",k?" , element id is "+k:"  element:",k?"":a);e++;e===h&&d&&"function"===typeof d&&d(!1)})}catch(T){f=a.getAttribute("id"),L.Logger.error(c,"[tk-sdk]setSinkId err:",T,f?" , element id is "+f:
"  element:",f?"":a),e++,e===h&&d&&"function"===typeof d&&d(!1)}else f=a.getAttribute("id"),L.Logger.warning(c,"[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,f?" , element id is "+f:"  element:",f?"":a),e++,e===h&&d&&"function"===typeof d&&d(!1);else e++,e===h&&d&&"function"===typeof d&&d(!1)};if(!a){a=[];var h=document.getElementsByTagName("audio"),k=document.getElementsByTagName("video");if(h&&0<h.length)for(var g=0;g<h.length;g++){var n=h[g];a.push(n)}if(k&&
0<k.length)for(g=0;g<k.length;g++)n=k[g],a.push(n)}if(a&&(L.Utils.isArray(a)||L.Utils.isHTMLCollection(a)))if(a&&0<a.length){var p=a.length;for(g=0;g<a.length;g++){n=a[g];var m=g;f(n,m,p)}}else m=0,f(a[m],m,1);else f(a,0,1)}else d&&"function"===typeof d&&d(!1)}catch(C){L.Logger.error(c,"[tk-sdk]setElementSinkIdToAudioouputDevice error:",C),d&&"function"===typeof d&&d(!1)}}var c={fileName:"NativeAVMgr.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""},e={},m={width:1920,height:1080,
maxfps:30},u={},r={},n={},x,h={};e.onCameraSetted=null;e.onMicrophoneSetted=null;e.onSpeakerSetted=null;e.room_video_width=320;e.room_video_height=240;e.room_video_fps=10;e.onMicVolumeReportCallback=void 0;e.onDevicesSetted=null;e.onDeviceChanged=null;e.isNativeSetVideoProfile=!0;var p={},v={},E={},B=100,K={player:null},M=null,Q={testing:!1,timer:void 0};window.tknative.addEventListener("message",function(a){if(!L.Utils.isNull(a)&&!L.Utils.isNull(a.data)&&!L.Utils.isNull(a.data.name)){var b=a.data.name;
if("onEnumerateDevices"===b){var d=function(){var b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug(c,"devices in enumerateDevices(client):",a.data);var f=a.data.audioinput,h=a.data.videoinput,k=a.data.audiooutput,g=a.data.seq,n={},m={},r={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],
videoinput:[]},useDevices:{}},N=L.Utils.getBrowserInfo();N=N&&N.language&&N.language.toLowerCase().match(/zh/g)?"chinese":"english";var u={videoinput:{label:"chinese"===N?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===N?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===N?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}},x=function(a){if(null!=a&&"communications"!=a.groupId&&"communications"!=
a.deiceId&&"\u901a\u8baf"!=a.label){var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!c.label&&u[a.kind]&&(c.label=u[a.kind].label+ ++u[a.kind].num);"audioinput"===a.kind&&a.deviceId===b&&(r.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===d&&(r.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===e&&(r.useDevices[a.kind]=a.deviceId);n[a.kind]=n[a.kind]||a.deviceId;r.devices[a.kind].push(c);r.hasdevice[a.kind]=!0;"default"===a.deviceId&&(m[a.kind]=
a.deviceId)}};Array.isArray(f)&&f.forEach(function(a){x(a)});Array.isArray(h)&&h.forEach(function(a){x(a)});Array.isArray(k)&&k.forEach(function(a){x(a)});r.useDevices.audioinput||(r.useDevices.audioinput=m.audioinput||n.audioinput||"");r.useDevices.videoinput||(r.useDevices.videoinput=m.videoinput||n.videoinput||"");r.useDevices.audiooutput||(r.useDevices.audiooutput=m.audiooutput||n.audiooutput||"");f=v[g];TK.hasDevice=L.Utils.toJsonParse(L.Utils.toJsonStringify(r.hasdevice));h=void 0;f.getOldDeviceList&&
(h=L.Utils.toJsonParse(L.Utils.toJsonStringify(TK.deviceInfoMap)));TK.deviceInfoMap=L.Utils.toJsonParse(L.Utils.toJsonStringify(r.devices));L.Utils.localStorage?f.isSetlocalStorage&&(f.ignoreAudioinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,r.useDevices.audioinput),f.ignoreVideoinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,r.useDevices.videoinput),f.ignoreAudiooutputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,
r.useDevices.audiooutput)):L.Logger.error(c,"not support localStorage");r.useDevices={audioinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||"",videoinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",audiooutput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)||""};p[g]&&(p[g](r,h),delete p[g]);v[g]&&delete v[g]};TK.isTkNative&&TK.subscribe_from_native?d():navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(b){var c=
[];b.forEach(function(a){"audiooutput"===a.kind&&c.push({kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId})});a.data.audiooutput=c;d()}).catch(function(b){L.Logger.error(c,"[tk-sdk]enumerateDevices error :"+b.name+": "+b.message);a.data.audiooutput=[];d()}):(L.Logger.error(c,"[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),a.data.audiooutput=[],d())}if("onMicVolumeReport"===b){var f=a.data.volume;if(null===f||void 0===f)return;if(p["detecte-mic-callback"]&&"function"===
typeof p["detecte-mic-callback"])p["detecte-mic-callback"](f);if(e.onMicVolumeReportCallback&&"function"===typeof e.onMicVolumeReportCallback)e.onMicVolumeReportCallback(f/100,a.data.connectionId)}if("onGetSpeakerVolume"===b){f=a.data.volume;var h=a.data.seq;if("function"!==typeof p[h])return;f=Math.round(f/2.55);p[h](f);delete p[h]}if("onStartDetecteCam"===b)if(a.data.deviceId){if(h=a.data.seqId,L.Utils.isFunction(p[h]))p[h](L.Utils.nativeMediaStream({id:a.data.deviceId,kind:"video"},{id:TK.deviceInfoMap.audioinput[0],
kind:"audio"}))}else L.Logger.error(c,"[tk-sdk]Native callback Parameters onStartDetecteCam are not! ")}},!1);e.setMaxVideoProfile=function(a,b,c){m.width=a||m.width;m.height=b||m.height;m.maxfps=c||m.maxfps};e.getUseDevice=function(){};e.getVideoProfile=function(a){var b={};TK.isMultiCamera&&u.hasOwnProperty(a)?b=L.Utils.copy(u[a]):TK.isMultiCamera||(b=L.Utils.copy(u));L.Utils.getJsonLength(b)||(b=L.Utils.copy(m));return b};e.destroyVideoTrack=function(a){TK.notStopVideoTrack||TK.notStopTrack||(r[a]&&
(r[a]=null),delete r[a])};e.destroyAllVideoTrack=function(){for(var a in r)e.destroyVideoTrack(a)};e.getUseVideoProfile=function(a){a=e.getVideoProfile(a);if(a.width*a.height>m.width*m.height){var b=a.width*a.height/(m.width*m.height);a.width=Math.floor(a.width/b);a.height=Math.floor(a.height/b)}a.maxfps>m.maxfps&&(a.maxfps=m.maxfps);return a};e.getMaxVideoProfile=function(){return L.Utils.copy(m)};e.getVideoTrack=function(a,b,c){if(a)if(r[a]&&r[a].track)L.Utils.isFunction(b)&&b(r[a].track);else{TK.isMultiCamera||
(x=a);var d=e.getUseVideoProfile(a);r[a]={profile:d};e.getUserMedia({video:{deviceId:{exact:a},width:d.width,height:d.height,frameRate:d.maxfps},audio:!1},function(d){(d=d.getVideoTracks()[0])?(r[a].track=d,L.Utils.isFunction(b)&&b(r[a].track)):L.Utils.isFunction(c)&&c({code:-1,message:"Requested device not video track",name:"UnknownError"})},function(a){L.Utils.isFunction(c)&&c(a)})}else L.Utils.isFunction(c)&&c({code:8,message:"Requested device not found",name:"NotFoundError"})};e.getAudioTrack=
function(a,b,c){a?n[a]?L.Utils.isFunction(b)&&b(n[a]):e.getUserMedia({audio:{deviceId:a},video:!1},function(d){(d=d.getAudioTracks()[0])?(n[a]=d,L.Utils.isFunction(b)&&b(n[a])):L.Utils.isFunction(c)&&c({code:-1,message:"Requested device not audio track",name:"UnknownError"})},function(a){L.Utils.isFunction(c)&&c(a)}):L.Utils.isFunction(c)&&c({code:8,message:"Requested device not found",name:"NotFoundError"})};e.destroyAudioTrack=function(a){n[a]&&L.Utils.stopTrack(n[a]);n[a]=void 0;delete n[a]};e.destroyAllAudioTrack=
function(){for(var a in n)e.destroyAudioTrack(a)};e.getUserMedia=function(a,b,c,d){g(a,b,c,d)};e.setAVMgrProperty=function(a,b){b&&(E[b]=E[b]||{room_video_width:e.room_video_width,room_video_height:e.room_video_height,room_video_fps:e.room_video_fps});for(var c in a)e.hasOwnProperty(c)&&(TK.isMultiCamera&&void 0!==b||(e[c]=a[c]),b&&E[b]&&(E[b][c]=a[c]));window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:a.room_video_width,height:a.room_video_height,maxfps:a.room_video_fps},
deviceId:b})};e.setVideoProfile=function(a,b,d){TK.isMultiCamera?u[b]=a:(u=a,b=x);if(r[b]&&r[b].track)if(TK.isMultiCamera)a=e.getUseVideoProfile(b),window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:a.width,height:a.height,frameRate:a.maxfps},deviceId:b});else for(var f in r)a=e.getUseVideoProfile(f),window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:a.width,height:a.height,frameRate:a.maxfps},deviceId:f});else d(),L.Logger.info(c,"[tk-sdk]The specified track was not found locally.")};
e.startDetecteMic=function(a,b){e.stopDetectMic();window.tknative.postMessage({command:"startDetecteMic",deviceId:a});p["detecte-mic-callback"]=b};e.stopDetectMic=function(){window.tknative.postMessage({command:"stopDetecteMic"});delete p["detecte-mic-callback"]};e.startDetecteCam=function(a,b){e.stopDetecteCam();window.tknative.postMessage({command:"startDetecteCam",deviceId:a,args:b})};e.stopDetecteCam=function(){window.tknative.postMessage({command:"stopDetecteCam"})};e.setSpeaker=function(a){window.tknative.postMessage({command:"setSpeaker",
deviceId:a})};e.addDeviceChangeListener=function(a){};e.removeDeviceChangeListener=function(){};e.getSpeakerVolume=function(a){if("function"!==typeof a)L.Logger.error(c,"[tk-sdk] wrong arguments in funciton getSpeakerVolume");else{var b=B++;p[b]=a;window.tknative.postMessage({command:"getSpeakerVolume",seq:b})}};e.setSpeakerVolume=function(a){void 0===a||null===a||0>a||100<a?L.Logger.error(c,"[tk-sdk] invalid arguments in funciton setSpeakerVolume"):(a=Math.round(2.55*a),window.tknative.postMessage({command:"setSpeakerVolume",
volume:a}))};e.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};e.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};e.associateElementsToSpeaker=function(a,b,c){};e.getDevices=function(a,b){L.Logger.debug(c,
"[tk-sdk]call enumerateDevices from client!");var d=B++;p[d]=a;a=b||{};a.isSetlocalStorage=void 0===b?!1:void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;v[d]=a;window.tknative.postMessage({command:"enumerateDevices",seq:d})};e.setDevices=function(a,c){var d={},f={};a=a||{};for(var h in a)f[h]=L.Utils.localStorage.getItem(L.Constant.deviceStorage[h]),L.Constant.deviceStorage[h]&&a[h]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[h])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[h],
a[h]),d[h]=!0);d.audiooutput&&b();x=a?a.videoinput:"";if(L.Utils.isFunction(e.onDevicesSetted))e.onDevicesSetted(a,f,c)};e.setCamera=function(a,b){if(a){x=a?a:"";var f=d(L.Constant.deviceStorage.videoinput,a);if(L.Utils.isFunction(e.onCameraSetted))e.onCameraSetted(a,f,b)}else L.Logger.error(c,"[tk-sdk]Lack of key parameters!")};e.setMicrophone=function(a,b){if(a){var f=d(L.Constant.deviceStorage.audioinput,a);if(L.Utils.isFunction(e.onMicrophoneSetted))e.onMicrophoneSetted(a,f,b)}else L.Logger.error(c,
"[tk-sdk]Lack of key parameters!")};e.setSpeaker=function(a,f){if(a){var h=d(L.Constant.deviceStorage.audiooutput,a);b();if(L.Utils.isFunction(e.onSpeakerSetted))e.onSpeakerSetted(a,h,f)}else L.Logger.error(c,"[tk-sdk]Lack of key parameters!")};e.stopCameraTest=function(){var a=K.player;a&&a&&a.destroy&&a.destroy();window.tknative.postMessage({command:"stopDetecteCam"});delete K.player;K.player=null};e.startCameraTest=function(a,b,d,h){if(a)if(b){e.stopCameraTest();var k=void 0;f(b,function(a){K.player=
a;k=a.id},h,a);k?window.tknative.postMessage({command:"startDetecteCam",deviceId:a,args:{elementId:k}}):(L.Utils.isFunction(d)&&d("TK_ERR_INTERNAL_EXCEPTION"),L.Logger.error(c,"startCameraTest occurred internal exception"))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(c,"startCameraTest got invalid elementId");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(c,"startCameraTest got invalid deviceId")};e.stopMicrophoneTest=function(){e.stopDetectMic();var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);
a&&window.tknative.postMessage({command:"setMicrophone",deviceId:a})};e.startMicrophoneTest=function(a,b,d,f){a?b?(e.stopDetectMic(),e.startDetecteMic(a,d)):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error(c,"startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error(c,"startMicrophoneTest got invalid deviceId"))};e.stopSpeakerTest=function(){if(M){var a={};a.audioUrl=M;window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"stop",
options:a});M=null}(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))&&e.setSpeaker(a)};e.startSpeakerTest=function(a,b,d){a?b?(e.stopSpeakerTest(),e.setSpeaker(a),a={},a.audioUrl=b,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"play",options:a}),M=b):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(c,"startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(c,"startSpeakerTest got invalid deviceId"))};
e.checkVideoInputDevice=function(a,b){a?L.Utils.isFunction(b)&&b(!0):L.Utils.isFunction(b)&&b(!1)};e.checkAudioInputDevice=function(a,b){a?L.Utils.isFunction(b)&&b(!0):L.Utils.isFunction(b)&&b(!1)};e.stopNetworkTest=function(){Q.testing=!1;clearInterval(Q.timer);Q.timer=void 0};e.startNetworkTest=function(b,d){e.stopNetworkTest();var f=function(){TK.networkTestInfo.isConnectRoom?(e.stopNetworkTest(),L.Logger.warning(c,"[tk-sdk]The room has been connected successfully, and the startNetworkTest method is not supported after successful connection."),
L.Utils.isFunction(d)&&d("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):Q.testing?(a(TK.networkTestInfo.protocol,TK.networkTestInfo.host,TK.networkTestInfo.port,b,d),Q.timer=setInterval(function(){TK.networkTestInfo.isConnectRoom?(e.stopNetworkTest(),L.Logger.warning(c,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(d)&&d("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):Q.testing?a(TK.networkTestInfo.protocol,TK.networkTestInfo.host,
TK.networkTestInfo.port,b,d):e.stopNetworkTest()},3E3)):e.stopNetworkTest()};TK.networkTestInfo.isConnectRoom?(Q.testing=!0,f()):(Q.testing=!0,L.Utils.getWhereWebInfo(TK.networkTestInfo.protocol,"global.talk-cloud.net",function(a){Q.testing?(TK.networkTestInfo.host=L.Utils.replaceHostname(TK.networkTestInfo.host,L.Utils.trim(a.name)),f()):e.stopNetworkTest()},function(){f()}))};return e};window.TK=window.TK||{};window.L=window.L||{};window.tknative=void 0;TK.nativeCallSeq=0;TK.waitNativeToCallbackList={};
TK.NativeProxy=function(){function f(a,c,d){TK.isTkNative?void 0===a||null===a?("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.error(b,"[tk-sdk] getShareScreenProfile function got wrong arguments")):(d=k(),TK.waitNativeToCallbackList[d]=c,window.tknative.postMessage({command:"getShareScreenProfile",args:a,seq:d})):("function"===typeof d&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk]getShareScreenProfile method must be in the client environment!"))}function k(){if(void 0===TK.nativeCallSeq||
"number"!==typeof TK.nativeCallSeq)TK.nativeCallSeq=0;return++TK.nativeCallSeq}function g(a){if(!L.Utils.isNull(a)&&!L.Utils.isNull(a.data)&&!L.Utils.isNull(a.data.name))switch(a.data.name){case "onValidWindowList":var d=a.data.seq;if(void 0===d)break;if("function"!==typeof TK.waitNativeToCallbackList[d])break;TK.waitNativeToCallbackList[d](a.data.validWindows);delete TK.waitNativeToCallbackList[d];break;case "onLog":d=a.data.level;a=a.data.log;0===d&&L.Logger.debug(b,a);1===d&&L.Logger.info(b,a);
2===d&&L.Logger.warning(b,a);3===d&&L.Logger.error(b,a);break;case "onMonitorCount":var e=a.data.count;d=a.data.seq;if(void 0===d)break;if("function"!==typeof TK.waitNativeToCallbackList[d])break;TK.waitNativeToCallbackList[d](e);delete TK.waitNativeToCallbackList[d];break;case "onTakSnapshot":d=a.data.action;e=a.data.requestId;var f=a.data.total,k=a.data.now,g=a.data.code;if("function"!==typeof TK.waitNativeToCallbackList[e])break;a=L.Utils.toJsonParse(a.data.result);TK.waitNativeToCallbackList[e](d,
e,f,k,g,a);"result"===d&&delete TK.waitNativeToCallbackList[e];break;case "onGetMediaPlayPos":e=a.data.arg;e.duration=parseInt(1E3*e.duration);1<e.pos&&(e.pos=1);e.position=parseInt(e.pos*e.duration);e.position>e.duration&&(e.position=e.duration);d=a.data.seq;if("function"!==typeof TK.waitNativeToCallbackList[d])break;TK.waitNativeToCallbackList[d](e);break;case "onNativeNotification":if(L.Utils.isFunction(c.onNativeNotification))c.onNativeNotification(a.data.arg);break;case "onMicVolumeReport":if(L.Utils.isFunction(c.onMicVolumeReport))c.onMicVolumeReport(a.data);
break;case "onGetMediaFileInfo":e=a.data.arg;d=a.data.seq;e.duration&&(e.duration*=1E3);if("function"!==typeof TK.waitNativeToCallbackList[d])break;TK.waitNativeToCallbackList[d](e);delete TK.waitNativeToCallbackList[d];break;case "onLocalRecord":case "onGetOpenOrSaveFileName":case "onBrowseForFolder":case "onGetRecordingPath":case "onStartupFileTransmitter":case "getShareScreenProfile":e=a.data.arg,d=a.data.seq,"function"===typeof TK.waitNativeToCallbackList[d]&&(TK.waitNativeToCallbackList[d](e),
delete TK.waitNativeToCallbackList[d])}}function d(a,c,d){TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] getMediaFileInfo method got invalid fileName!")):(d=k(),TK.waitNativeToCallbackList[d]=c,window.tknative.postMessage({command:"getMediaFileInfo",seq:d,file:a})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] getMediaFileInfo method must be called in the native environment!"))}function a(a,c,d){TK.isTkNative?
void 0===a||null===a||"function"!==typeof c?(L.Logger.error(b,"[tk-sdk] getValidWindowList function got wrong arguments"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):(d=k(),TK.waitNativeToCallbackList[d]=c,window.tknative.postMessage({command:"getValidWindowList",type:Number(a),seq:d})):(L.Logger.warning(b,"[tk-sdk]getValidWindowList method must be in the client environment!"),L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"))}var b={fileName:"NativeProxy.js",peerid:TK.myPeerid?TK.myPeerid:"",
serial:TK.mySerial?TK.mySerial:""},c=TK.EventDispatcher({}),e=void 0,m=0,u=void 0,r=void 0;c.onNativeStartShareMediaFile=null;c.onNativeStopShareMediaFile=null;c.onNativeStartShareScreen=null;c.onNativeStopShareScreen=null;c.onNativeNotification=null;c.onMicVolumeReport=null;c.onSeekMediaFile=null;c.onNativeWindowClose=null;c.initialize=function(){window.tknative.addEventListener("message",g,!1)};c.createShareScreenWindow=function(c,d,e,f,k,g,m,r){TK.isTkNative?a(0,function(a){if((a=a[0])&&"object"===
typeof a){a=a.id;var h=e,n=f,p=c,u=d,v=k,x=g,E=0,B=r;TK.isTkNative?(a=Number(a||0),h=Number(h||0),n=Number(n||0),p=Number(p||0),u=Number(u||0),E=Number(E||0),window.tknative.postMessage({command:"updateWindowSource",id:Number(a),left:Number(h),top:Number(n),width:Number(p),height:Number(u),mixMic:v||!1,mixSpk:x||!1,type:Number(E),catchcursor:B||!1})):L.Logger.warning(b,"[tk-sdk] updateWindowSource method must be in the client environment!")}else L.Logger.error(b,"[tk-sdk]createShareScreenWindow:getValidWindowList is not data!"),
L.Utils.isFunction(m)&&m("TK_ERR_NOT_DATA")},m):(L.Logger.error(b,"[tk-sdk]createShareScreenWindow method must be in the client environment!"),L.Utils.isFunction(m)&&m("TK_ERR_NOT_INITIALIZED"))};c.destroyShareScreenWindow=function(){c.createShareScreenWindow(0,0,0,0)};c.startShareScreen=function(d){if(TK.isTkNative)if(TK.isOnlyAudioRoom)L.Logger.warning(b,"[tk-sdk]only audio room not execute method startShareScreen method !"),L.Utils.isFunction(d)&&d("TK_ERR_NOT_SUPPORT");else{var e={},h={audio:!0,
video:!0,attributes:e};if(TK.isTkNative&&2018061500<=TK.clientversion)a(0,function(a){if((a=a[0])&&"object"===typeof a)f(a,function(a){a&&"object"===typeof a&&(e.videowidth=a.width,e.videoheight=a.height,e.videofps=a.fps);if(L.Utils.isFunction(c.onNativeStartShareScreen))c.onNativeStartShareScreen(h,d)},function(a){L.Logger.warning(b,"[tk-sdk]startShareScreen:getShareScreenProfile is failure , failure info:"+a+"!");if(L.Utils.isFunction(c.onNativeStartShareScreen))c.onNativeStartShareScreen(h,d)});
else if(L.Logger.warning(b,"[tk-sdk]startShareScreen:getValidWindowList is not data!"),L.Utils.isFunction(c.onNativeStartShareScreen))c.onNativeStartShareScreen(h,d)},function(a){L.Logger.error(b,"[tk-sdk]startShareScreen:getValidWindowList error info:"+a);if(L.Utils.isFunction(c.onNativeStartShareScreen))c.onNativeStartShareScreen(h,d)});else if(L.Utils.isFunction(c.onNativeStartShareScreen))c.onNativeStartShareScreen(h,d)}else L.Logger.error(b,"[tk-sdk]startShareScreen method must be in the client environment!"),
L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED")};c.stopShareScreen=function(a){if(TK.isTkNative){if(L.Utils.isFunction(c.onNativeStopShareMediaFile))c.onNativeStopShareScreen(a);c.destroyShareScreenWindow()}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] stopShareScreen method must be called in the native environment!")};c.startShareMediaFile=function(a,e,f,k){k=k||{};TK.isTkNative?TK.isTkMacNative?(L.Utils.isFunction(f)&&f("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,
"[tk-sdk] startShareMediaFile method MAC machine is disabled!")):L.Utils.isNull(a)?(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] startShareMediaFile method got invalid fileName!")):k&&k.IgnoreElementId||!L.Utils.isNull(e)?d(a,function(d){var h=d.duration,g=d.width,n=d.height,p=d.video,r=d.audio;if(d.video||d.audio)if(TK.isOnlyAudioRoom&&d.video)L.Logger.error(b,"[tk-sdk]only audio room not execute method startShareMediaFile to video media !"),L.Utils.isFunction(f)&&
f("TK_ERR_NOT_SUPPORT");else{h={width:g,height:n,duration:h,filename:L.Utils.getFileName(a)};TK.isTkNative&&2018061500<=TK.clientversion&&(h.videowidth=g,h.videoheight=n,h.videofps=d.fps);void 0!==k.toID&&(h.toID=k.toID);if(k.attrs&&"object"===typeof k.attrs)for(var u in k.attrs)"toID"!==u&&"type"!==u&&(h[u]=k.attrs[u]);d={video:p,audio:r,attributes:h,path:a,scale:k.scale};if(L.Utils.isFunction(c.onNativeStartShareMediaFile))c.onNativeStartShareMediaFile(d,e,f,k);m=1}else L.Utils.isFunction(f)&&f("TK_ERR_INVALID_FIEL"),
L.Logger.error(b,"[tk-sdk] startShareMediaFile method got invalid file!")},f):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] startShareMediaFile method got invalid elementId!")):(L.Utils.isFunction(f)&&f("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] startShareMediaFile method must be called in the native environment!"))};c.stopShareMediaFile=function(a){if(TK.isTkNative)if(TK.isTkMacNative)L.Utils.isFunction(a)&&a("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] stopShareMediaFile method MAC machine is disabled!");
else{if(L.Utils.isFunction(c.onNativeStopShareMediaFile))c.onNativeStopShareMediaFile(a);m=0}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] stopShareMediaFile method must be called in the native environment!")};c.pauseShareMediaFile=function(a,d,e){if(TK.isTkNative)if(TK.isTkMacNative)L.Utils.isFunction(e)&&e("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] pauseShareMediaFile method MAC machine is disabled!");else if(L.Utils.isBoolean(a))if(0===m)L.Utils.isFunction(e)&&
e("TK_ERR_NOT_OPEN_MEDIA_FILE"),L.Logger.warning(b,"[tk-sdk] pauseShareMediaFile:The local media file is not open!");else{if(a&&2!==m||!a&&1!==m)if(window.tknative.postMessage({command:"pauseMediaFile",pause:a}),m=a?2:1,L.Utils.isFunction(c.onPauseMediaFile))c.onPauseMediaFile(a);L.Utils.isFunction(d)&&d(!0===a?"Paused":"Sharing")}else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error(b,"[tk-sdk] pauseShareMediaFile function got wrong arguments");else L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),
L.Logger.warning(b,"[tk-sdk] pauseShareMediaFile method must be called in the native environment!")};c.getMediaFileProgress=function(a,c){TK.isTkNative?L.Utils.isFunction(a)?0===m?(L.Utils.isFunction(c)&&c("TK_ERR_NOT_OPEN_MEDIA_FILE"),L.Logger.warning(b,"[tk-sdk] getMediaFileProgress:The local media file is not open!")):(L.Utils.isNull(r)&&(r=k()),TK.waitNativeToCallbackList[r]=a,window.tknative.postMessage({command:"getMediaPlayPos",seq:r})):(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error(b,
"[tk-sdk] getMediaFileProgress function got wrong arguments")):(L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.error(b,"[tk-sdk] getMediaFileProgress method must be called in the native environment!"))};c.registerMediaFileProgressListener=function(a,d,f){TK.isTkNative?L.Utils.isNull(a)||0>=a||!L.Utils.isFunction(d)?(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error(b,"[tk-sdk] registerMediaFileProgressListener function got wrong arguments")):(c.unregisterMediaFileProgressListener(),
1E3>a&&(a=1E3),L.Utils.isNull(u)&&(u=k()),TK.waitNativeToCallbackList[u]=d,1===m&&window.tknative.postMessage({command:"getMediaPlayPos",seq:u}),e=setInterval(function(){1===m&&window.tknative.postMessage({command:"getMediaPlayPos",seq:u})},a)):(L.Utils.isFunction(f)&&f("TK_ERR_NOT_INITIALIZED"),L.Logger.error(b,"[tk-sdk] registerMediaFileProgressListener method must be called in the native environment!"))};c.unregisterMediaFileProgressListener=function(a){TK.isTkNative?(L.Utils.isNull(e)||(clearInterval(e),
e=void 0),L.Utils.isNull(u)||(delete TK.waitNativeToCallbackList[u],u=void 0)):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.error(b,"[tk-sdk] unregisterMediaFileProgressListener method must be called in the native environment!"))};c.seekMediaFile=function(a,d){if(TK.isTkNative)if(L.Utils.isNumber(a))if(0===m)L.Utils.isFunction(d)&&d("TK_ERR_NOT_OPEN_MEDIA_FILE"),L.Logger.warning(b,"[tk-sdk] seekMediaFile:The local media file is not open!");else{if(0>a&&(a=0),1<a&&(a=1),window.tknative.postMessage({command:"seekMediaFile",
pos:a}),L.Utils.isFunction(c.onSeekMediaFile))c.onSeekMediaFile(a)}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(b,"[tk-sdk] seekShareMediaFile function got wrong arguments");else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.error(b,"[tk-sdk] seekMediaFile method must be called in the native environment!")};c.getShareableApplicationsList=function(c,d){TK.isTkNative?"function"!==typeof c?(L.Logger.error(b,"[tk-sdk] getShareableApplicationsList function got wrong arguments"),
L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):a(1,c,d):(L.Logger.warning(b,"[tk-sdk]getShareableApplicationsList method must be in the client environment!"),L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"))};c.startShareApplications=function(){};c.stopShareApplications=function(){};c.getMonitorCount=function(a,c){TK.isTkNative?"function"!==typeof a?(L.Logger.error(b,"[tk-sdk] getMonitorCount function got wrong arguments"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")):(c=k(),TK.waitNativeToCallbackList[c]=
a,window.tknative.postMessage({command:"getMonitorCount",seq:c})):(L.Logger.warning(b,"[tk-sdk]getMonitorCount method must be in the client environment!"),L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"))};c.enableViceMonitor=function(a){TK.isTkNative?(TK.subscribe_from_native=!0,window.tknative.postMessage({command:"enableViceMonitor"})):(L.Logger.warning(b,"[tk-sdk]enableViceMonitor method must be in the client environment!"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"))};c.switchMainViceMonitor=
function(a){TK.isTkNative?window.tknative.postMessage({command:"exchangeClientPosition"}):(L.Logger.warning(b,"[tk-sdk]changeMainViceMonitor method must be in the client environment!"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"))};c.nativeUploadFile=function(a,c,d,e){TK.isTkNative?"object"!==typeof d||"string"!==typeof a||"string"!==typeof c||""===a||""===c?(L.Logger.error(b,"[tk-sdk] nativeUploadFile function got wrong arguments"),"function"===typeof e&&e("TK_ERR_INVALID_ARG")):(e=k(),window.tknative.postMessage({command:"uploadFile",
seq:e,uri:a,filename:c,params:d})):(L.Logger.warning(b,"[tk-sdk]nativeUploadFile method must be in the client environment!"),"function"===typeof e&&e("TK_ERR_NOT_INITIALIZED"))};c.nativeDownloadFile=function(a,c,d){TK.isTkNative?"string"!==typeof a||"string"!==typeof c||""===a||""===c?(L.Logger.error(b,"[tk-sdk] nativeDownloadFile function got wrong arguments"),"function"===typeof d&&d("TK_ERR_INVALID_ARG")):(d=k(),window.tknative.postMessage({command:"downloadFile",seq:d,uri:a,filename:c})):(L.Logger.warning(b,
"[tk-sdk]nativeDownloadFile method must be in the client environment!"),"function"===typeof d&&d("TK_ERR_NOT_INITIALIZED"))};c.screenCaptureUpload=function(a,c,d,e){TK.isTkNative?a&&"function"===typeof c?(d=d||!1,e=k(),TK.waitNativeToCallbackList[e]=c,window.tknative.postMessage({command:"takeSnapshot",needMin:d,fileName:a,requestId:e})):(L.Logger.error(b,"[tk-sdk] screenCaptureUpload function got wrong arguments"),"function"===typeof e&&e("TK_ERR_INVALID_ARG")):("function"===typeof e&&e("TK_ERR_NOT_INITIALIZED"),
L.Logger.warning(b,"[tk-sdk]screenCaptureUpload method must be in the client environment!"))};c.browseForLocalFolder=function(a,c,d){TK.isTkNative?"object"!==typeof a||"function"!==typeof c?(L.Logger.error(b,"[tk-sdk] browseForLocalFolder function got wrong arguments ,param must is json , onSuccess must is function! "),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):(d=k(),TK.waitNativeToCallbackList[d]=c,window.tknative.postMessage({command:"browseForFolder",args:a,seq:d})):(L.Logger.warning(b,"[tk-sdk]browseForLocalFolder method must be in the client environment!"),
"function"===typeof d&&d("TK_ERR_NOT_INITIALIZED"))};c.startRecordScreen=function(a,c,d){if(TK.isTkNative)if(TK.isTkMacNative)L.Utils.isFunction(d)&&d("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] startRecordScreen method MAC machine is disabled!");else if(L.Utils.isNull(a)||L.Utils.isNull(a.filename))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] startRecordScreen function got wrong arguments");else{var e={type:1,fileName:a.filename,forcepath:!0},f;for(f in a)"type"!==
f&&"filename"!==f&&(e[f]=a[f]);a=k();TK.waitNativeToCallbackList[a]=function(a){"Recording"===a.action?L.Utils.isFunction(c)&&c({action:a.action,filename:a.filepath}):L.Utils.isFunction(d)&&d("record screen failed")};window.tknative.postMessage({command:"startLocalRecord",args:e,seq:a})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] startRecordScreen method must be called in the native environment!")};c.pauseRecordScreen=function(a,c,d){TK.isTkNative?TK.isTkMacNative?
(L.Utils.isFunction(d)&&d("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] pauseRecordScreen method MAC machine is disabled!")):L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] pauseRecordScreen function got wrong arguments")):(a={type:1,pause:a},d=k(),TK.waitNativeToCallbackList[d]=function(a){L.Utils.isFunction(c)&&c({action:a.action})},window.tknative.postMessage({command:"pauseLocalRecord",args:a,seq:d})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),
L.Logger.warning(b,"[tk-sdk] pauseRecordScreen method must be called in the native environment!"))};c.stopRecordScreen=function(a){TK.isTkNative?TK.isTkMacNative?(L.Utils.isFunction(a)&&a("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] stopRecordScreen method MAC machine is disabled!")):window.tknative.postMessage({command:"stopLocalRecord",args:{type:1}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] stopRecordScreen method must be called in the native environment!"))};
c.startRecordAudio=function(a,c,d){if(TK.isTkNative)if(TK.isTkMacNative)L.Utils.isFunction(d)&&d("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] startRecordAudio method MAC machine is disabled!");else if(L.Utils.isNull(a)||L.Utils.isNull(a.filename))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] startRecordAudio function got wrong arguments");else{var e={type:0,fileName:a.filename,forcepath:!0},f;for(f in a)"type"!==f&&"filename"!==f&&(e[f]=a[f]);a=k();TK.waitNativeToCallbackList[a]=
function(a){"Recording"===a.action?L.Utils.isFunction(c)&&c({action:a.action,filename:a.filepath}):L.Utils.isFunction(d)&&d("record screen failed")};window.tknative.postMessage({command:"startLocalRecord",args:e,seq:a})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] startRecordAudio method must be called in the native environment!")};c.pauseRecordAudio=function(a,c,d){TK.isTkNative?TK.isTkMacNative?(L.Utils.isFunction(d)&&d("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,
"[tk-sdk] pauseRecordAudio method MAC machine is disabled!")):L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] pauseRecordAudio function got wrong arguments")):(a={type:0,pause:a},d=k(),TK.waitNativeToCallbackList[d]=function(a){L.Utils.isFunction(c)&&c({action:a.action})},window.tknative.postMessage({command:"pauseLocalRecord",args:a,seq:d})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] pauseRecordAudio method must be called in the native environment!"))};
c.stopRecordAudio=function(a){TK.isTkNative?TK.isTkMacNative?(L.Utils.isFunction(a)&&a("TK_ERR_NOT_SUPPORT"),L.Logger.warning(b,"[tk-sdk] stopRecordAudio method MAC machine is disabled!")):window.tknative.postMessage({command:"stopLocalRecord",args:{type:0}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] stopRecordAudio method must be called in the native environment!"))};c.getOpenFileName=function(a,c,d){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.caption)||
L.Utils.isNull(a.filter))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] getOpenFileName function got wrong arguments");else{var e=k();TK.waitNativeToCallbackList[e]=function(a){"Activated"===a.action?L.Utils.isFunction(d)&&(d("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning(b,"[tk-sdk] getOpenFileName in progress")):L.Utils.isFunction(c)&&c(a)};window.tknative.postMessage({command:"getOpenFileName",args:a,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),
L.Logger.warning(b,"[tk-sdk] getOpenFileName method must be called in the native environment!")};c.getSaveFileName=function(a,c,d){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.caption)||L.Utils.isNull(a.filter))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning(b,"[tk-sdk] getSaveFileName function got wrong arguments");else{var e=k();TK.waitNativeToCallbackList[e]=function(a){"Activated"===a.action?L.Utils.isFunction(d)&&(d("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning(b,
"[tk-sdk] getSaveFileName in progress")):L.Utils.isFunction(c)&&c(a)};window.tknative.postMessage({command:"getSaveFileName",args:a,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(b,"[tk-sdk] getSaveFileName method must be called in the native environment!")};c.listenCloseEvent=function(){if(TK.isTkNative)try{window.talk_window&&window.talk_window.listenCloseEvent?window.talk_window.listenCloseEvent():L.Logger.error(b,"[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(n){L.Logger.error(b,
"[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning(b,"[tk-sdk]listenCloseEvent method must be in the client environment!")};c.shutdownNativeClient=function(){TK.isTkNative?window.tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning(b,"[tk-sdk]shutdownNativeClient method must be in the client environment!")};c.closeWindow=function(){try{window.talk_window&&window.talk_window.closeWindow?window.talk_window.closeWindow():L.Logger.error(b,"[tk-sdk]talk_window.closeWindow is not exist!")}catch(n){L.Logger.error(b,
"[tk-sdk] closeWindow function can not be called")}};c.clientAudioMediaPlayer=function(a,c,d){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning(b,"[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(d=d||{},c?(L.Logger.info(b,"[tk-sdk]clientAudioMediaPlayer url is "+a+" , action is "+c+" , options is"+L.Utils.toJsonStringify(d)),d.audioUrl=a,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:c,options:d})):L.Logger.error(b,
"[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning(b,"[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")};c.clientPreloadMediaFile=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning(b,"[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):Array.isArray(a)?a&&0<a.length&&window.tknative.postMessage({command:"clientPreloadMediaFile",urlArray:a}):L.Logger.error(b,"[tk-sdk]clientPreloadMediaFile args must is array!"):
L.Logger.warning(b,"[tk-sdk]clientPreloadMediaFile method must be in the client environment!")};c.clientOpenBrowserUrl=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning(b,"[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):a?window.tknative.postMessage({command:"clientOpenBrowserUrl",url:a}):L.Logger.error(b,"[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning(b,"[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")};
c.getRecordingPath=function(a,c){TK.isTkNative?("function"!==typeof a&&L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),c=k(),TK.waitNativeToCallbackList[c]=a,window.tknative.postMessage({command:"getRecordingPath",seq:c})):(L.Logger.error(b,"[tk-sdk] getRecordingPath method must be called in the native environment!"),"function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"))};c.setRecordingPath=function(a,c){TK.isTkNative?"object"!==typeof a?(L.Logger.error(b,"[tk-sdk] setRecordingPath function got wrong arguments!"),
"function"===typeof c&&c("TK_ERR_INVALID_ARG")):window.tknative.postMessage({command:"setRecordingPath",args:a}):(L.Logger.error(b,"[tk-sdk] setRecordingPath method must be called in the native environment!"),"function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"))};c.startupFileTransmitter=function(a,c,d){TK.isTkNative?"object"!==typeof a||"function"!==typeof c?(L.Logger.error(b,"[tk-sdk] startupFileTransmitter function got wrong arguments!"),"function"===typeof d&&d("TK_ERR_INVALID_ARG")):(d=k(),TK.waitNativeToCallbackList[d]=
c,window.tknative.postMessage({command:"startupFileTransmitter",args:a,seq:d})):(L.Logger.error(b,"[tk-sdk] startupFileTransmitter method must be called in the native environment!"),"function"===typeof d&&d("TK_ERR_NOT_INITIALIZED"))};c.initBroadcast=function(a,c,d,e,f){TK.isTkNative?a?(c||(c=10),d||(d=3),e&&f?window.tknative.postMessage({command:"initBroadcast",url:a.toString(),fps:Number(c),key_sec:Number(d),width:Number(e),height:Number(f)}):L.Logger.error(b,"[tk-sdk]argument width or height of initBroadcast function not exist!")):
L.Logger.error(b,"[tk-sdk]argument url of initBroadcast function not exist!"):L.Logger.warning(b,"[tk-sdk]initBroadcast method must be in the client environment!")};c.updateBroadcast=function(a,c,d,e){a||(a=10);c||(c=3);d&&e?window.tknative.postMessage({command:"updateBroadcast",fps:Number(a),key_sec:Number(c),width:Number(d),height:Number(e)}):L.Logger.error(b,"[tk-sdk]argument width or height of updateBroadcast function not exist!")};c.uninitBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"uninitBroadcast"}):
L.Logger.warning(b,"[tk-sdk]uninitBroadcast method must be in the client environment!")};c.startBroadcast=function(a){TK.isTkNative?a?window.tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error(b,"[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning(b,"[tk-sdk]startBroadcast method must be in the client environment!")};c.stopBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"stopBroadcast"}):L.Logger.warning(b,"[tk-sdk]stopBroadcast method must be in the client environment!")};
window.onNativeWindowClose=function(){if(!TK.isTkNative)L.Logger.warning(b,"[tk-sdk]window.onNativeWindowClose method must be in the client environment!");else if(L.Utils.isFunction(c.onNativeWindowClose))c.onNativeWindowClose()};return c}();
TK.NativeEntry=function(){var f=document.getElementById("tknative");f&&f.nodeName&&"embed"===f.nodeName.toLowerCase()||(f=document.createElement("embed"),document.body.appendChild(f),f.setAttribute("id","tknative"),f.setAttribute("mainentry",!0),f.setAttribute("hidden",!0),f.setAttribute("type","application/x-ppapi-proxy"));return f};TK.NativeInfo=function(){try{var f={};return f=talk_window}catch(k){return null}};
TK.CheckNativeInterfaceAvailable=function(){return"function"===typeof TK.NativeInfo&&TK.NativeInfo()&&(window.tknative=window.tknative||TK.NativeEntry(),!L.Utils.isNull(window.tknative)&&L.Utils.isFunction(window.tknative.postMessage))?!0:!1};
TK.Initialize=function(f,k){var g={fileName:"NativeProxy.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};try{if(f)TK.isTkNative=!0,m=e=c=void 0,(b=TK.NativeInfo())&&"object"===typeof b&&(c=Number(b.clientversion),m=Number(b.endtype),e=b.friendlyversion),TK.clientversion=c,TK.clientfriendlyversion=e,TK.isTkMacNative=L.Utils.isBoolean(k)?k:2===m,window.tknative=window.tknative||TK.NativeEntry(),TK.NativeProxy.initialize(),TK.isTkMacNative||(TK.DeviceMgr=null,TK.DeviceMgr=TK.NativeAVMgr()),
window.tknative.postMessage({command:"maximizeNativeClient"}),TK.subscribe_from_native=TK.isTkNative&&!TK.isTkMacNative&&2018031E3<=c,L.Logger.info(g,"[tk-sdk]Initialize finshed,clinetInfo("+TK.isTkMacNative?"macClient":"windowClient):clientVersion is "+c+",clientfriendlyversion is "+e+",endtype is "+m);else{window.tknative=void 0;TK.isTkNative=!1;TK.isTkMacNative=!1;var d=document.getElementById("tknative");if(d&&d.nodeName&&"embed"===d.nodeName.toLowerCase()){var a=d.parentNode;a&&a.removeChild(d)}var b=
TK.NativeInfo(),c=void 0,e=void 0,m=void 0;b&&"object"===typeof b&&(c=Number(b.clientversion),m=Number(b.endtype),e=b.friendlyversion,b.maxmizeWindow&&"function"===typeof b.maxmizeWindow&&b.maxmizeWindow(),L.Logger.info(g,"windowClient):clientVersion is "+c+",clientfriendlyversion is "+e+",endtype is "+m));TK.subscribe_from_native=!1;var u=L.Utils.getBrowserInfo();L.Logger.info(g,"[tk-sdk]Initialize finshed,browserInfo:"+(u.info.browserName+" "+u.info.browserVersion))}TK.DeviceMgr.getDevices()}catch(r){L.Logger.error(g,
"[tk-sdk]Initialize error:",r)}};window.TK=window.TK||{};window.L=window.L||{};
TK.NativeStream=function(f){function k(){g();if("function"!==typeof u.onSuccess){if(L.Logger.error(d,"[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),g(),void 0!==u.onFailure&&L.Utils.isFunction(u.onFailure))u.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",a.extensionId)}else u.onSuccess(m,a.extensionId),clearInterval(e),e=setInterval(function(){if(L.Utils.isFunction(u.onSuccess))u.onSuccess(m,a.extensionId);else if(L.Logger.error(d,"[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),
g(),L.Utils.isFunction(u.onFailure))u.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",a.extensionId)},u.interval)}function g(){clearInterval(e);e=void 0;m=0}var d={fileName:"NativeStream.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""},a=TK.EventDispatcher(f),b=!1,c="destroy",e=void 0,m=0;void 0!==f.video&&"number"===typeof f.video&&(f.video=0!==f.video);void 0!==f.audio&&"number"===typeof f.audio&&(f.audio=0!==f.audio);a.classInstanceName="Stream";
a.stream=f.stream;a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream);a.url=f.url;a.recording=f.recording;a.room=f.room;a.playing=!1;a.local=!1;a.video=f.video;a.audio=f.audio;a.screen=f.screen;a.scale=f.scale;a.media=f.media;a.videoSize=f.videoSize;a.videoFrameRate=f.videoFrameRate;a.extensionId=f.extensionId;a.desktopStreamId=f.desktopStreamId;a.path=f.path||"";a.videoMuted=!1;a.audioMuted=!1;a.attributes=f.attributes||{};a.isTkNative=!0;a.pushVideoMuted=!0;a.pushAudioMuted=!0;a.isInit=!1;a.audioinputDeviceId=
f.audioinputDeviceId;a.videoinputDeviceId=f.videoinputDeviceId;var u={isWaiting:!1},r=void 0,n=void 0,x=void 0;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===f.local||!0===f.local)a.local=!0;var h=function(){return a.media?1:a.attributes.isWeb?0:a.screen?2:0};a.getID=function(){return a.local&&!f.streamID?"local":f.streamID};a.id=a.getID();a.publisherId=function(){var b=a.extensionId.split(":");return b.length?b[0]:a.extensionId};
a.getAttributes=function(){return f.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var b in a)f.attributes[b]=a[b]};a.hasAudio=function(){return f.audio};a.changeAudio=function(a){f.audio=a};a.hasVideo=function(){return f.video};a.changeVideo=function(a){f.video=a};a.hasData=function(){return f.data};a.changeData=function(a){f.data=a};a.hasScreen=function(){return f.screen};a.hasMedia=function(){return f.media};
a.hasVideoPlayer=function(){return!!r};a.getVideoPlayer=function(){return r};a.hasAudioPlayer=function(){return!!n};a.getAudioPlayer=function(){return n};a.getVideoPlayerElementId=function(){return x};a.changeScreen=function(a){f.screen=a};a.sendData=function(){L.Logger.error(d,"[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(b,c,e){c=c||{};if(TK.isPlayback)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else if("video"===a.getAttributes().type&&
a.local)if(a.isIniting||a.isInit)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else{c.initDeviceId&&("object"===typeof c.initDeviceId?(c.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,c.initDeviceId.videoinput),c.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,c.initDeviceId.audioinput),c.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,c.initDeviceId.audiooutput)):
L.Logger.warning(d,"[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{if(f.audio||f.video){a.isIniting=!0;L.Logger.debug(d,"[tk-sdk]Requested access to local media");var h=f.video;!0===h||!0===f.screen?(h=!0===h?{}:h,void 0!==a.videoSize&&(h.mandatory=h.mandatory||{},h.mandatory.minWidth=a.videoSize[0],h.mandatory.minHeight=a.videoSize[1],h.mandatory.maxWidth=a.videoSize[2],h.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&
(h.optional=h.optional||[],h.optional.push({minFrameRate:a.videoFrameRate[0]}),h.optional.push({maxFrameRate:a.videoFrameRate[1]}))):!0===f.screen&&void 0===h&&(h=!0);var k=a.getUseVideoProfile(a.videoinputDeviceId),g={video:{deviceId:{exact:a.videoinputDeviceId},width:k.width,height:k.height,frameRate:k.maxfps},audio:f.audio,fake:f.fake,screen:f.screen,extensionId:a.extensionId,desktopStreamId:a.desktopStreamId},m=function(b){L.Logger.debug(d,"[tk-sdk]User has granted access to local media.");a.stream=
b;a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream);p=TK.StreamEvent({type:"access-accepted",stream:a});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(p);e&&"function"===typeof e&&e({type:"access-accepted",stream:a})},n=function(b){var c=TK.StreamEvent({type:"access-denied",stream:a,message:b});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(c);e&&"function"===typeof e&&e({type:"access-denied",message:b,stream:a})};L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?
TK.DeviceMgr.getUserMedia(g,m,n,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0}):TK.DeviceMgr.getDevices(function(a){TK.DeviceMgr.getUserMedia(g,m,n,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})},{isSetlocalStorage:!0})}else{L.Logger.warning(d,"[tk-sdk]The stream has no audio and video needs to be initialized.");var p=TK.StreamEvent({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."});
a.isInit=!0;a.isIniting=!1;a.dispatchEvent(p);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."})}}catch(I){p=TK.StreamEvent({type:"access-denied",stream:a,message:I}),a.isInit=!0,a.isIniting=!1,a.dispatchEvent(p),e&&"function"===typeof e&&e({type:"access-denied",message:I,stream:a})}}else L.Logger.warning(d,"[tk-sdk]stream init must is localStream and stream type must is video!"),e&&"function"===typeof e&&e({type:"access-denied",
stream:a})};a.create=function(){a.local?window.tknative.postMessage({command:"playStream",connectionId:a.extensionId.toString(),isLocal:!0,type:Number(h()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:a.extensionId.toString(),isLocal:!1,type:Number(h())})};a.destroy=function(){a.local||window.tknative.postMessage({command:"stopStream",connectionId:a.extensionId.toString(),
isLocal:a.local,type:Number(h())})};a.playVideo=function(f,g){function m(){g=g||{};a.elementID=f;void 0!==f&&(x=f,"living"!==c?L.Logger.warning(d,"[tk-sdk]stream.play:player life state not is living , not play stream!"):(r?(a.local&&(g.mirror=L.Utils.isBoolean(g.mirror)?g.mirror:b),r=new TK.NativeVideoPlayer({id:a.extensionId,stream:a,elementID:f,options:g,bundleId:a.extensionId}),a.playing=!0,a.local?0===h()?window.tknative.postMessage({command:"playVideo",connectionId:a.extensionId.toString(),isLocal:!0,
type:Number(h()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:a.extensionId.toString(),isLocal:!0,type:Number(h()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):0===h()?window.tknative.postMessage({command:"playVideo",connectionId:a.extensionId.toString(),
isLocal:!1,type:Number(h())}):window.tknative.postMessage({command:"playStream",connectionId:a.extensionId.toString(),isLocal:!1,type:Number(h())}),0!==h()&&a.muteAudio(!0)):(a.local&&(g.mirror=L.Utils.isBoolean(g.mirror)?g.mirror:b),r=new TK.NativeVideoPlayer({id:a.extensionId,stream:a,elementID:f,options:g,bundleId:a.extensionId}),a.local?0===h()?window.tknative.postMessage({command:"playVideo",connectionId:a.extensionId.toString(),isLocal:!0,type:Number(h()),args:{path:"string"===typeof a.path?
a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:a.extensionId.toString(),isLocal:!0,type:Number(h()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):0===h()?window.tknative.postMessage({command:"playVideo",connectionId:a.extensionId.toString(),isLocal:!1,type:Number(h())}):window.tknative.postMessage({command:"playStream",
connectionId:a.extensionId.toString(),isLocal:!1,type:Number(h())}),r?L.Logger.info(d,"[tk-sdk]stream.Video is already in play!"):a.muteVideo(!1)),TK.isOnlyAudioRoom&&r.hideVideo(),u.isWaiting&&!e&&k()))}c="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?m():(L.Logger.info(d,"[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info(d,"[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",
L.Utils.toJsonStringify(a));m()}))};a.playAudio=function(b){function f(){b=b||{};"living"!==c?L.Logger.warning(d,"[tk-sdk]stream.play:player life state not is living , not play stream!"):(n?L.Logger.warning(d,"[tk-sdk]stream.Audio is already in play!"):(n=new TK.NativeAudioPlayer({id:a.extensionId,stream:a,options:b,bundleId:a.extensionId}),a.local?0===h()?window.tknative.postMessage({command:"playAudio",connectionId:a.extensionId.toString(),isLocal:!0,type:Number(h()),args:{path:"string"===typeof a.path?
a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:a.extensionId.toString(),isLocal:!0,type:Number(h()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):0===h()?window.tknative.postMessage({command:"playAudio",connectionId:a.extensionId.toString(),isLocal:!1,type:Number(h())}):window.tknative.postMessage({command:"playStream",
connectionId:a.extensionId.toString(),isLocal:!1,type:Number(h())}),0!==h()&&a.muteVideo(!0)),a.playing=!0,TK.isOnlyAudioRoom&&r&&r.hideVideo(),u.isWaiting&&!e&&k())}c="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?f():(L.Logger.info(d,"[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info(d,"[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(a));f()}))};
a.stop=function(b){b?"video"===b?(r&&r.destroy&&r.destroy(),r=void 0,0===h()?window.tknative.postMessage({command:"unPlayVideo",connectionId:a.extensionId.toString(),isLocal:!!a.local,type:Number(h())}):window.tknative.postMessage({command:"stopStream",connectionId:a.extensionId.toString(),isLocal:!!a.local,type:Number(h())})):"audio"===b&&(n&&n.destroy&&n.destroy(),n=void 0,0===h()?window.tknative.postMessage({command:"unPlayAudio",connectionId:a.extensionId.toString(),isLocal:!!a.local,type:Number(h())}):
window.tknative.postMessage({command:"stopStream",connectionId:a.extensionId.toString(),isLocal:!!a.local,type:Number(h())})):(c="destroy",a.playing&&(r&&r.destroy(),n&&n.destroy&&n.destroy(),n=r=void 0,a.playing=!1,window.tknative.postMessage({command:"stopStream",connectionId:a.extensionId.toString(),isLocal:!!a.local,type:Number(h())})))};a.unplayVideo=function(){r&&(a.stop("video"),r=void 0);n||r||(a.stop(),r=n=void 0)};a.unplayAudio=function(){n&&(a.stop("audio"),n=void 0);n||r||(a.stop(),r=
n=void 0)};a.getVideoPlayerOptions=function(){};a.updateVideoPlayerOptions=function(a){r&&r.updateVideoPlayerOptions&&r.updateVideoPlayerOptions(a)};a.updateAudioPlayerOptions=function(a){n&&n.updateAudioPlayerOptions&&n.updateAudioPlayerOptions(a)};a.showVideo=function(){void 0!==r&&r.showVideo()};a.hideVideo=function(){void 0!==r&&r.hideVideo()};a.getAudioTrack=function(){n&&n.getAudioTrack()};a.hasAudioTrack=function(){n&&n.hasAudioTrack()};a.removeAudioTrack=function(){n&&n.removeAudioTrack()};
a.addAudioTrack=function(b){a.hasAudioTrack()&&a.removeAudioTrack();n&&n.addAudioTrack(b);g();u.isWaiting&&k()};a.getVideoTrack=function(){r&&r.getVideoTrack()};a.hasVideoTrack=function(){r&&r.hasVideoTrack()};a.removeVideoTrack=function(){r&&r.removeVideoTrack()};a.addVideoTrack=function(b){a.hasVideoTrack()&&a.removeVideoTrack();r&&r.addVideoTrack(b)};a.setMute=function(a){void 0!==n&&n.setMute&&n.setMute(a)};a.setVolume=function(a){void 0!==n&&n.setVolume&&("number"!==typeof a?L.Logger.error(d,
"[tk-sdk]Stream setVolume volume type must is number!"):n.setVolume(a))};a.getVolume=function(a){if(void 0!==n&&n.getVolume)return n.getVolume(a)};a.startIntervalGetRealtimeVolume=function(b,c,e){"function"!==typeof b?L.Logger.warning(d,"[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"):(a.stopIntervalGetRealtimeVolume(),u.isWaiting=!0,u.onSuccess=b,u.onFailure=e,u.interval="number"===typeof c?c:100,k())};a.stopIntervalGetRealtimeVolume=function(){g();u={isWaiting:!1}};a.hideLoading=
function(){void 0!==r&&r.hideLoading&&r.hideLoading()};a.showLoading=function(){void 0!==r&&r.showLoading&&r.showLoading()};var p=function(){if(void 0!==r&&void 0!==a.stream){var b=r.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),e=parseInt(c.getPropertyValue("height"),10),f=parseInt(c.getPropertyValue("left"),10);c=parseInt(c.getPropertyValue("top"),10);var h="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);
var k=document.defaultView.getComputedStyle(h);h=parseInt(k.getPropertyValue("width"),10);k=parseInt(k.getPropertyValue("height"),10);var g=document.createElement("canvas");g.id="testing";g.width=h;g.height=k;g.setAttribute("style","display: none");g.getContext("2d").drawImage(b,f,c,d,e);return g}return null};a.getVideoFrameURL=function(a){var b=p();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=p();return null!==a?a.getContext("2d").getImageData(0,0,a.width,
a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning(d,"[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning(d,"[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning(d,"[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),
b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning(d,"[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(void 0!==a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){b={qualityLayer:{spatialLayer:b,temporalLayer:c}};a.checkOptions(b,!0);a.pc.updateSpec(b,
d)};a.pushVideo=function(b){a.pushVideoMuted!=b&&(a.pushVideoMuted=b,window.tknative.postMessage({command:"pushVideo",enable:b}))};a.pushAudio=function(b){a.pushAudioMuted!=b&&(a.pushAudioMuted=b,window.tknative.postMessage({command:"pushAudio",enable:b}))};a.updateConfiguration=function(b,c){void 0!==b&&(a.pc?(a.checkOptions(b,!0),a.pc.updateSpec(b,c)):c("This stream has no peerConnection attached, ignoring"))};a.muteVideo=function(b,c){L.Logger.debug(d,"[tk-sdk]call muteVideo , video muted state:"+
b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.videoMuted=b;a.updateMuteToServer(c)};a.muteAudio=function(b,c){L.Logger.debug(d,"[tk-sdk]call muteAudio , audio muted state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.audioMuted=b;a.local&&window.tknative.postMessage({command:"enableAudio",enable:!b,connectionId:a.extensionId.toString()});void 0===
a.stream&&L.Logger.warning(d,"[tk-sdk]not deviceStream to muteAudio");a.updateMuteToServer(c)};a.onRemoteAudioVolume=function(a){m=a;if(r&&L.Utils.isFunction(r.onRemoteAudioVolume))r.onRemoteAudioVolume(a)};a.onMicVolumeReport=function(b){if(a&&a.local&&(m=b,r&&L.Utils.isFunction(r.onMicVolumeReport)))r.onMicVolumeReport(b)};a.setLocalVideoMirror=function(c){a.local&&(b=c,a.updateVideoPlayerOptions({mirror:c}))};a.getRealtimeVolume=function(a,b){L.Utils.isFunction(a)?a(m):(L.Logger.error(d,"[tk-sdk] getRealtimeVolume: onVolume is not function"),
L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"))};return a};window.TK=window.TK||{};window.L=window.L||{};
TK.PlayBackProvider=function(){var f={onSeekPlayback:null,onPausePlayback:null,onPlaybackClearAll:null,onHandlerDuration:null,onHandlerPlaybackEnd:null,onHandlerPlaybackUpdateTime:null,onJoinPlaybackRoom:null,seekPlayback:function(k,g){if(L.Utils.isFunction(f.onSeekPlayback))f.onSeekPlayback(k,g)},pausePlayback:function(k,g){if(L.Utils.isFunction(f.onPausePlayback))f.onPausePlayback(k,g)},joinPlaybackRoom:function(k,g,d,a,b,c,e){if(L.Utils.isFunction(f.onJoinPlaybackRoom))f.onJoinPlaybackRoom(k,g,
d,a,b,c,e)},playbackClearAll:function(){if(L.Utils.isFunction(f.onPlaybackClearAll))f.onPlaybackClearAll()},handlerDuration:function(k){if(L.Utils.isFunction(f.onHandlerDuration))f.onHandlerDuration(k)},handlerPlaybackEnd:function(){if(L.Utils.isFunction(f.onHandlerPlaybackEnd))f.onHandlerPlaybackEnd()},handlerPlaybackUpdateTime:function(k){if(L.Utils.isFunction(f.onHandlerPlaybackUpdateTime))f.onHandlerPlaybackUpdateTime(k)}};return f}();window.TK=window.TK||{};window.L=window.L||{};TK.MSG_TO_ALLUSER="__all";TK.MSG_TO_ALLEXCEPTSENDER="__allExceptSender";TK.MSG_TO_ALLEXCEPTAUDITOR="__allExceptAuditor";TK.MSG_TO_NONEUSER="__none";TK.STREAM_VIDEO="video";TK.STREAM_MEDIA="media";TK.STREAM_SCREEN="screen";TK.STREAM_FILE="file";TK.PUBLISH_STATE_NONE=0;TK.PUBLISH_STATE_AUDIOONLY=1;TK.PUBLISH_STATE_VIDEOONLY=2;TK.PUBLISH_STATE_BOTH=3;TK.PUBLISH_STATE_MUTEALL=4;TK.SCREENSTATE_ON=1;TK.SCREENSTATE_OFF=0;TK.MEDIAFILESTATE_ON=1;
TK.MEDIAFILESTATE_OFF=0;TK.REC_TYPE_RECFILE="0";TK.REC_TYPE_VIDEOLIST="1";TK.REC_TYPE_MP3="2";TK.REC_TYPE_MIXVIDEO="3";TK.roomInstance=void 0;TK.SDKTYPE="pc";TK.isHiFi=!1;TK.maxaveragebitrateToHifi="128000";TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;TK.connectTimer=0;TK.isRetainPublishstateOnOnlyAudioRoom=!1;TK.APPVERSION="customer";TK.isMultiCamera=!1;TK.isPlayback=!1;TK.notStopTrack=!1;TK.notStopVideoTrack=!1;TK.notStopAudioTrack=!1;TK.mySerial="";TK.myPeerid="";TK.logTs="";
TK.roomConstraint={width:"",height:"",frameRate:""};TK.SDKVERSIONS="3.2.1";TK.SDKVERSIONSTIME="20180118";console.info("[tk-sdk-version]sdk-version:"+TK.SDKVERSIONS+" , sdk-time: "+TK.SDKVERSIONSTIME);TK.getSdkVersion=function(){return TK.SDKVERSIONS};TK.Room=function(f){TK.roomInstance||(TK.roomInstance=TK.RoomInit(f));return TK.roomInstance};
TK.RoomInit=function(f){function k(a){if(L.Utils.isNull(l._myself.id))L.Logger.warning(q,"[tk-sdk]The room has not been successfully connected yet. Please try again after the connection is successful!");else{var b=l._myself.id;a&&(b+=":"+a);return fa(b)}}function g(a){l._web_protocol=a.web_protocol||l._web_protocol;l._web_host=a.web_host||l._web_host;l._web_port=a.web_port||l._web_port;l._doc_protocol=a.doc_protocol||l._doc_protocol;l._doc_host=a.doc_host||l._doc_host;l._doc_port=a.doc_port||l._doc_port;
l._socket_protocol=a.socket_protocol||l._socket_protocol;l._socket_host=a.socket_host||l._socket_host;l._socket_port=a.socket_port||l._socket_port;l._backup_doc_protocol=a.backup_doc_protocol||l._backup_doc_protocol;l._backup_doc_host=a.backup_doc_host||l._backup_doc_host;l._backup_doc_port=a.backup_doc_port||l._backup_doc_port;l._backup_doc_host_list=a.backup_doc_host_list||l._backup_doc_host_list;void 0===l._doc_host&&(l._doc_host=l._web_host);void 0===l._doc_port&&(l._doc_port=l._web_port);void 0===
l._backup_doc_host&&(l._backup_doc_host=l._web_host);void 0===l._backup_doc_port&&(l._backup_doc_port=l._web_port);l._docServerAddr||(l._doc_host=l._web_host,l._doc_port=l._web_port);l._hasDocServerAddrBackup?l._backup_doc_host_list.length||(l._backup_doc_host_list=[l._backup_doc_host]):(l._backup_doc_host=l._web_host,l._backup_doc_port=l._web_port,l._backup_doc_host_list=[l._backup_doc_host]);if(na&&na.changeCommonWhiteBoardConfigration){a=[];for(var b=0,c=l._backup_doc_host_list.length;b<c;b++)a.push({protocol:l._backup_doc_protocol,
hostname:l._backup_doc_host_list[b],port:l._backup_doc_port});na.changeCommonWhiteBoardConfigration({webAddress:{protocol:l._web_protocol,hostname:l._web_host,port:l._web_port},docAddress:{protocol:l._doc_protocol,hostname:l._doc_host,port:l._doc_port},backupDocAddressList:a})}TK.networkTestInfo.protocol=l._web_protocol;TK.networkTestInfo.host=l._socket_host||l._web_host||"global.talk-cloud.net";TK.networkTestInfo.port=l._web_port||/https/g.test(l._web_protocol)?443:80;a=TK.RoomEvent({type:TK.EVENT_TYPE.roomServerAddressUpdate,
message:{protocol:l._web_protocol,web_protocol:l._web_protocol,web_host:l._web_host,web_port:l._web_port,doc_protocol:l._doc_protocol,doc_host:l._doc_host,doc_port:l._doc_port,backup_doc_protocol:l._backup_doc_protocol,backup_doc_host:l._backup_doc_host,backup_doc_port:l._backup_doc_port,backup_doc_host_list:l._backup_doc_host_list}});t.dispatchEvent(a)}function d(a,b,c){function d(a){K(l._web_host,l._web_port,function(b,c){L.Logger.debug(q,"[tk-sdk]reconnected room:step2GetFileList result \x3d "+
b+" , message:"+L.Utils.toJsonStringify(c));if(0===b){l._room_filelist=[];if(c&&Array.isArray(c)&&c.length){b=0;for(var d=c.length;b<d;b++){var w=c[b];w&&(w.fileid=Number(w.fileid),w.pagenum=Number(w.pagenum),w.dynamicppt=Number(w.dynamicppt),w.filecategory=Number(w.filecategory),w.fileprop=Number(w.fileprop),w.type=Number(w.type),w.filetype=w.filetype&&"string"===typeof w.filetype?w.filetype.toLocaleLowerCase():w.filetype,w.isContentDocument=void 0!==w.isContentDocument&&null!==w.isContentDocument&&
"number"===typeof Number(w.isContentDocument)?Number(w.isContentDocument):0,l._room_filelist.push(w))}}c=TK.RoomEvent({type:TK.EVENT_TYPE.roomFiles,message:l._room_filelist});t.dispatchEvent(c)}else L.Logger.info(q,"[tk-sdk]"+e+":step2GetFileList code is "+b);"function"===typeof a&&a()})}var w=l._room_uri;a=a||{};a.source=a.source||"unknown source";var e=a.source;B(l._web_host,l._web_port,function(a,f){if(0!=a)L.Logger.error(q,"[tk-sdk]"+e+":step2GetConfig failure --\x3e result and responseText:",
a,f);else{if(w!==l._room_uri||"forceReconnect room"===e){t.needReconnectSocket=!0;TK.isTkNative&&(l._handlerCallbackJson=!1,window.tknative.postMessage({command:"nativeClear"}));try{H&&H.socketDisconnect&&H.socketDisconnect()}catch(Kb){L.Logger.warning(q,"[tk-sdk]"+e+":Socket already disconnected , disconnect errorInfo:",Kb)}H&&H.emptySocket&&H.emptySocket();if("select service reconnect"===e||"forceReconnect room"===e)p(),clearInterval(t._networkequipmentTimer),clearInterval(t._catonNumber),clearInterval(t.sendcatonNumber),
a=TK.RoomEvent({type:TK.EVENT_TYPE.roomDisconnected,message:"select service reconnect , need socket disconnect"}),t.dispatchEvent(a)}"forceReconnect room"===e?d(function(){L.Logger.info(q,"[tk-sdk]"+e+":room socket force reconnect room  ,room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(l._room_uri):l._room_uri)+"! ");Q()}):w!==l._room_uri?d(function(){L.Logger.info(q,"[tk-sdk]"+e+":room socket url  changed  , old room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(w):w)+"  , now room socket url:"+
(window.__TkSdkBuild__?L.Utils.encrypt(l._room_uri):l._room_uri)+"! ");Q()}):(L.Logger.info(q,"[tk-sdk]"+e+":room socket url not change  , room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(l._room_uri):l._room_uri)+"! "),"reconnected room"===e?d(function(){X(b,c)}):"select service reconnect"===e&&(L.Logger.warning(q,"[tk-sdk]room uri is not change , no need to perform a reload server"),l._isConnected&&l._users[y()]&&l._serverName!==l._myself.servername&&t.changeUserProperty(y(),"__all",{servername:l._serverName})))}},
{notSpeedNetwordk:!0,restrict:a.restrict})}function a(a,b){a=a||l._serverList;b=b||l._serverName;if("object"===typeof a&&L.Utils.getJsonLength(a)&&void 0!==b)for(var c in a)a[c].isUseServer=b===c?!0:!1}function b(a,b,d,f){a=a||oa(f);b=b||{hasvideo:l._myself.hasvideo,disablevideo:l._myself.disablevideo};d=d||{hasaudio:l._myself.hasaudio,disableaudio:l._myself.disableaudio};a>TK.PUBLISH_STATE_NONE&&Z(f)&&(b=!(b.hasvideo&&!b.disablevideo&&(a===TK.PUBLISH_STATE_VIDEOONLY||a===TK.PUBLISH_STATE_BOTH)),
a=!(d.hasaudio&&!d.disableaudio&&(a===TK.PUBLISH_STATE_AUDIOONLY||a===TK.PUBLISH_STATE_BOTH)),c(Z(f),b),e(Z(f),a))}function c(a,b){if(D.hasConnection(a.getID())){var c=D.getConnectionVideoEnabled(a.getID());b=!b;D.setConnectionVideoEnabled(a.getID(),b);b!==c&&m(a)}}function e(a,b){if(D.hasConnection(a.getID())){var c=D.getConnectionAudioEnabled(a.getID());b=!b;D.setConnectionAudioEnabled(a.getID(),b);b!==c&&m(a)}}function m(a){if(D.hasConnection(a.getID())){var b=D.getConnectionVideoEnabled(a.getID()),
c=D.getConnectionAudioEnabled(a.getID());b={muteStream:{video:!b,audio:!c}};L.Logger.info(q,"[tk-sdk]update stream mute state send message to server,stream id is "+a.getID()+",send message info:",L.Utils.toJsonStringify(b));b={streamId:a.getID(),msg:{type:"updatestream",config:b}};if(a.getAttributes().type===TK.STREAM_MEDIA||a.publisherId()!==y())b.browser=L.Utils.getBrowser();pa("signaling_message",b)}}function u(a,b,c){l._isConnected&&"failed"===b&&("publish"===c?(Ta(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_FAILED,
"publish ice failed"),r(a,"publish ice failed")):"subscribe"===c&&(kb(a,window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"subscribe ice failed"),n(a,"subscribe ice failed")))}function r(a,b){void 0===a.reconnectionNumber&&(a.reconnectionNumber=0);a.isUnpublishing=!1;a.isPublishing=!1;if(void 0===Ua||a.reconnectionNumber<Ua)L.Logger.info(q,"[tk-sdk]publishReconnection-\x3e"+b+":unpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
ra(a,function(c){c||L.Logger.warning(q,"[tk-sdk]publishReconnection-\x3e"+b+": unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");setTimeout(function(){switch(a.getAttributes().type){case TK.STREAM_VIDEO:oa(a.videoinputDeviceId)>TK.PUBLISH_STATE_NONE?(L.Logger.info(q,"[tk-sdk]publishReconnection-\x3e"+b+":republish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
a.reconnectionNumber++,Ca(a,{reconnection:!0})):h(a);break;default:a.needPublishToServer&&fa(a.extensionId)?(L.Logger.info(q,"[tk-sdk]publishReconnection-\x3e"+b+":republish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.reconnectionNumber++,Ca(a,{reconnection:!0})):h(a)}},1E3)},{reconnection:!0});else{L.Logger.info(q,"[tk-sdk]publishReconnection-\x3e"+b+":The number of republish exceeded "+Ua+" , not republish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));switch(a.getAttributes().type){case TK.STREAM_VIDEO:var c=oa(a.videoinputDeviceId);if(c>TK.PUBLISH_STATE_NONE){var d=void 0;if(c===TK.PUBLISH_STATE_VIDEOONLY||c===TK.PUBLISH_STATE_BOTH)d={},TK.isMultiCamera&&(d.deviceId=a.videoinputDeviceId),d=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_MAX_RECONNECT_COUNT,info:d}});var w=void 0;if(c===
TK.PUBLISH_STATE_AUDIOONLY||c===TK.PUBLISH_STATE_BOTH)w=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_MAX_RECONNECT_COUNT,info:{}}});t.changeUserPublish(a.publisherId(),TK.PUBLISH_STATE_NONE,a.videoinputDeviceId);d&&t.dispatchEvent(d);w&&t.dispatchEvent(w)}else ra(a);break;case TK.STREAM_SCREEN:TK.isTkNative?qa.stopShareScreen():t.stopShareScreen();break;case TK.STREAM_FILE:TK.isTkNative&&qa.stopShareMediaFile();break;default:ra(a),a.needPublishToServer=
!1,U(a.extensionId)&&ea(a.extensionId)}h(a);Ta(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_MAX_RECONNECT_COUNT,b)}}function n(a,b){void 0===a.reconnectionNumber&&(a.reconnectionNumber=0);L.Logger.info(q,"[tk-sdk]subscribeReconnection-\x3e"+b+":unsubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));Mb(a,function(c){c||L.Logger.warning(q,"[tk-sdk]subscribeReconnection-\x3e"+b+": unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");void 0===a.incremental&&(a.incremental=0);a.incremental=0===a.incremental?1:2*a.incremental;4<=a.incremental&&(a.incremental=4);clearTimeout(a.incrementalTimer);a.incrementalTimer=setTimeout(function(){t.remoteStreams[a.getID()]?(a.reconnectionNumber++,L.Logger.info(q,"[tk-sdk]subscribeReconnection-\x3e"+b+": stream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
l._nativeStatsDelivered[a.extensionId]=void 0,delete l._nativeStatsDelivered[a.extensionId],a.getAttributes().type===TK.STREAM_VIDEO?lb(a):Va(a,!1),L.Logger.info(q,"[tk-sdk]subscribeReconnection-\x3e"+b+":resubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),mb(a,{reconnection:!0})):x(a)},1E3*a.incremental)},{reconnection:!0})}function x(a){a.isCompleted=!1;a.reconnectionNumber=0;a.incremental=0;clearTimeout(a.incrementalTimer);
a.incrementalTimer=void 0}function h(a){a.isPublishing=!1;a.isUnpublishing=!1;a.isCompleted=!1;a.reconnectionNumber=0}function p(){TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;TK.connectTimer=0;TK.networkTestInfo.host="global.talk-cloud.net";l._myself&&(l._myself.publishstate=TK.PUBLISH_STATE_NONE);for(var a in t.remoteStreams)if(t.remoteStreams.hasOwnProperty(a)){var b=t.remoteStreams[a];b&&(L.Logger.info(q,"[tk-sdk]_resetRoomState--\x3estream-removed(), stream id:"+b.getID()+" , extensionId is "+
b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),D.closeConnection(b.getID()),x(b),b.getAttributes().type===TK.STREAM_VIDEO?lb(b):Va(b,!1),nb(b),delete b.report,delete t.remoteStreams[a],U(b.extensionId)&&ea(b.extensionId))}for(a in t.localStreams)t.localStreams.hasOwnProperty(a)&&(b=t.localStreams[a],D.closeConnection(b.getID()),h(b),delete b.report,delete t.localStreams[a],U(b.extensionId)&&ea(b.extensionId));for(var c in l._createStreams)b=l._createStreams[c],delete b.report,
D.closeConnection(b.getID()),h(b),U(b.extensionId)&&ea(b.extensionId);Da=[];za={};t.remoteStreams={};l._nativeStatsDelivered={};l._devicePublishInfo={};l._multiCameraAudioDevicePublishInfo={};W={duration:0,outBytes:0,inBytes:0,outPackets:0,inPackets:0,outAudioKBitRate:0,inAudioKBitRate:0,outVideoKBitRate:0,inVideoKBitRate:0,audioDelay:0,videoDelay:0};D.closeAllConnections();l._isConnected=!1;TK.networkTestInfo.isConnectRoom=!1;na&&na.changeCommonWhiteBoardConfigration&&na.changeCommonWhiteBoardConfigration({isConnectedRoom:l._isConnected});
v()}function v(){if(TK.isPlayback)for(a in l._users)l._users[a].playbackLeaved=!0;else for(var a in l._users)delete l._users[a]}function E(a,b,c,d,e,f,h,k){l._serverName=a;if(l._tk_room_test_sdk||l._useServerScreenRecording)f="";l._ipFalsification=L.Utils.trim(f);l._isIpFalsification=!!f;a=b;c=Number(c);b={};if(h&&"object"===typeof h)for(var w in h)b[w]=h[w];/https/g.test(l._socket_protocol)||(c+=1);l._testIP&&l._testPort&&(a=l._testIP,c=l._testPort);b.socket_host=a;b.socket_port=c;d&&(b.web_host=
d);e&&Array.isArray(e)&&e.length?(l._hasDocServerAddrBackup=!0,b.backup_doc_host=e[0],b.backup_doc_host_list=e):l._hasDocServerAddrBackup=!1;g(b);l._room_uri=l._socket_protocol+"://"+l._socket_host+":"+l._socket_port;L.Logger.debug(q,"[tk-sdk]privateVariableJson._room_uri \x3d "+l._room_uri);L.Utils.isFunction(k)&&k()}function B(a,b,c,d){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _step2GetConfig cannot be executed!");else{d=d||{};l._backupCourseAddrList=[];L.Logger.debug(q,
"[tk-sdk]Going to getConfig");var w=l._web_protocol+"://"+a+":"+b+"/ClientAPI/getconfig?ts\x3d"+(new Date).getTime(),e={serial:l._room_id,userrole:l._myself.role,selfip:l._myIp,restrict:0};d.restrict&&(e.restrict=1);l._useServerScreenRecording&&(e.logintype=88);L.Utils.sdkAjax({url:w,dataType:"json",type:"POST",anync:!0,data:e,success:function(b){L.Logger.debug(q,"[tk-sdk]getConfig resp \x3d ",L.Utils.toJsonStringify(b));l._configuration=b;var w=a,e="8889",f={};b.ipinfo&&"object"===typeof b.ipinfo&&
(l._ipinfo=b.ipinfo);if(l._testIP&&l._testPort)w=l._testIP,e=l._testPort;else{if(void 0!==b.courseserver){var h=b.courseserver;null!==h&&void 0!==h&&0<h.length&&(w=h)}void 0!==b.courseserverport&&(e=Number(b.courseserverport))}b.ClassDocServerAddr&&(l._docServerAddr=b.ClassDocServerAddr,f.doc_host=b.ClassDocServerAddr);if(b.newcourseaddr&&Array.isArray(b.newcourseaddr)&&b.newcourseaddr.length)if(l._backupCourseAddrList=l._backupCourseAddrList.concat(b.newcourseaddr),1<b.newcourseaddr.length)if(d&&
d.notSpeedNetwordk)h=b.newcourseaddr[0],l._backupCourseAddrList.splice(0,1),E(h.name,h.signaladdr,h.signalport,h.webaddr,h.docaddr,h.change,f,function(){c(b?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(b))});else{var k={},ma=!1;h=function(a){var d=b.newcourseaddr[a],h=d.webaddr;k[h+"_"+a]=Pb(d.webaddr,l._web_port,function(g){k[h+"_"+a]=void 0;delete k[h+"_"+a];if(0!==g||ma){if(k[h+"_"+a]=void 0,delete k[h+"_"+a],!ma){g=0;for(var Fa in k)g++;g||(Fa=[],b.ClassDocServerAddrBackup&&
Fa.push(b.ClassDocServerAddrBackup),M(w,l._webInterfaceHtmlPort,void 0,!1),E(l._serverName,w,e,void 0,Fa,l._isIpFalsification&&l._ipFalsification?l._ipFalsification:"",f,function(){c(b?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(b))}))}}else ma=!0,l._backupCourseAddrList.splice(a,1),E(d.name,d.signaladdr,d.signalport,d.webaddr,d.docaddr,d.change,f,function(){c(b?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(b))})})};for(var g=0,Fa=b.newcourseaddr.length;g<
Fa;g++)h(g)}else h=b.newcourseaddr[0],E(h.name,h.signaladdr,h.signalport,h.webaddr,h.docaddr,h.change,f,function(){c(b?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(b))});else h=[],b.ClassDocServerAddrBackup&&h.push(b.ClassDocServerAddrBackup),M(w,l._webInterfaceHtmlPort,void 0,!1),E(l._serverName,w,e,void 0,h,l._isIpFalsification&&l._ipFalsification?l._ipFalsification:"",f,function(){c(b?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(b))})},error:function(w,
e,f){L.Logger.error(q,"[tk-sdk]getConfig fail[ XHR , textStatus , errorThrown ]:",w,e,f);l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method getConfig cannot be executed!"):(l._webReconnectNumList.hasOwnProperty("getConfigReconnectNum")||(l._webReconnectNumList.getConfigReconnectNum=0),l._webReconnectNumList.getConfigReconnectNum=++l._webReconnectNumList.getConfigReconnectNum%5,clearTimeout(l._webReconnectNumList.getConfigReconnectTimer),l._webReconnectNumList.getConfigReconnectTimer=
setTimeout(function(){l._webReconnectNumList.getConfigReconnectTimer=void 0;l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method getConfig cannot be executed!"):(L.Logger.info(q,"[tk-sdk]Rerequest getConfig web interface!"),B(a,b,c,d))},1E3*l._webReconnectNumList.getConfigReconnectNum))}})}}function K(a,b,c){l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method _step2GetFileList cannot be executed!"):l._isGetFileList?(L.Logger.debug(q,"[tk-sdk]Going to getFileList"),a=l._web_protocol+
"://"+a+":"+b+"/ClientAPI/getroomfile?ts\x3d"+(new Date).getTime(),L.Utils.sdkAjax({url:a,dataType:"json",type:"POST",anync:!0,data:{serial:l._room_id},success:function(a){L.Logger.debug(q,"[tk-sdk]getFileList resp \x3d ",L.Utils.toJsonStringify(a));var b=a.result,d;0==b&&void 0!==a.roomfile?d=a.roomfile:L.Logger.info(q,"[tk-sdk]getFileList resp.roomfile is not exist , nRet:"+b);L.Utils.isFunction(c)&&c(b,d)},error:function(a,b,d){L.Logger.error(q,"[tk-sdk]getFileList fail[ XHR , textStatus , errorThrown ]:",
a,b,d);L.Utils.isFunction(c)&&c(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})):L.Utils.isFunction(c)&&c(-1,void 0)}function M(a,b,c,d){l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method _step2GetFalsificationIp cannot be executed!"):l._useServerScreenRecording?L.Utils.isFunction(c)&&c(-2,"Off-screen recording cannot perform this method"):l._tk_room_test_sdk?L.Utils.isFunction(c)&&c(-2,"tk room test sdk"):(d=L.Utils.isBoolean(d)?d:!0,/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?
l._isIpFalsification=!1:l._isIpFalsification=!0,L.Utils.getWhereWebInfo(l._web_protocol,a,function(a){a.name&&"string"===typeof a.name&&(l._ipFalsificationName=L.Utils.trim(a.name),l._serverName=l._ipFalsificationName);a.selfip&&"string"===typeof a.selfip&&(l._myIp=L.Utils.trim(a.selfip));a.ip&&"string"===typeof a.ip&&(l._ipFalsification=L.Utils.trim(a.ip));a.nochange&&(l._isIpFalsification=!1,L.Logger.info(q,"[tk-sdk]no strings change SDP  , ipFalsificationName is "+l._ipFalsificationName));L.Utils.isFunction(c)&&
c(0,a)},function(w){l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method getFalsificationIp cannot be executed!"):(l._webReconnectNumList.hasOwnProperty("getFalsificationIpReconnectNum")||(l._webReconnectNumList.getFalsificationIpReconnectNum=0),l._webReconnectNumList.getFalsificationIpReconnectNum=++l._webReconnectNumList.getFalsificationIpReconnectNum%5,clearTimeout(l._webReconnectNumList.getFalsificationIpReconnectTimer),l._webReconnectNumList.getFalsificationIpReconnectTimer=setTimeout(function(){l._webReconnectNumList.getFalsificationIpReconnectTimer=
void 0;l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method getFalsificationIp cannot be executed!"):(L.Logger.info(q,"[tk-sdk]Rerequest getFalsificationIp web interface!"),M(a,b,c,d))},1E3*l._webReconnectNumList.getFalsificationIpReconnectNum))},d))}function Q(){L.Logger.debug(q,"[tk-sdk]step3Connect");l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method _step3Connect cannot be executed!"):(L.Logger.info(q,"[tk-sdk]socket connect address:"+(window.__TkSdkBuild__?L.Utils.encrypt(l._room_uri):
l._room_uri)),l._isConnected=!1,TK.networkTestInfo.isConnectRoom=!1,na&&na.changeCommonWhiteBoardConfigration&&na.changeCommonWhiteBoardConfigration({isConnectedRoom:l._isConnected}),ta(ka._handler_connectSocketSuccess,ka._handler_connectSocketFail))}function X(a,b){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _step4Join cannot be executed!");else if(void 0==l._room_id)L.Logger.error(q,"[tk-sdk]Invalid status",l._room_id);else{if(l._myself&&(l._serverName&&(l._myself.servername=
l._serverName),l._myself.tk_ip=l._myIp,l._myself.tk_area=l._ipinfo.country+"."+l._ipinfo.city+"."+l._ipinfo.area,l._myself.tk_carrier=l._ipinfo.perators,TK.isMultiCamera)){if(!l._mainCameraDeviceId){var c=l._mainCameraDeviceId;l._mainCameraDeviceId=C();L.Logger.info(q,"[tk-sdk]change myself main camera device id,my id is "+y()+",change device id is "+l._mainCameraDeviceId+",old device id is "+c);c=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:y()!==l._local_def_ext_id?
y():"",deviceId:l._mainCameraDeviceId}});t.dispatchEvent(c)}l._myself.tk_maincamera=l._mainCameraDeviceId}c={};for(var d in l._myself)"id"!=d&&"watchStatus"!=d&&(c[d]=l._myself[d]);d=D.getMaxVideoProfile();d={userId:y(),roomId:l._room_id,maxVideo:l._room_max_videocount,videofps:d.maxfps,videowidth:d.width,videoheight:d.height,properties:c,roomtype:l._room_properties.roomtype,version:3,vcodec:"number"===typeof l._video_codec?l._video_codec:0,develop:88==c.role||-1==c.role?!l._useServerScreenRecording:
!1,questionCompatibility:yb};if(TK.isPlayback){if(!l._recordfilepath){L.Logger.error(q,"[tk-sdk]The playback file address does not exist!");return}d.recordfilepath=l._recordfilepath}2===l._myself.role&&(d.lang=l._roomJsonOptions.recordLang);l._roomJsonOptions.talk_cloud_no_auth&&(d.talk_cloud_no_auth=!0);L.Logger.info(q,"joinRoom params info:"+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(d)):L.Utils.toJsonStringify(d)));H.sendMessageSocket("joinRoom",d,function(c,d){0===c?L.Utils.isFunction(a)&&
a(c,d):L.Utils.isFunction(b)&&b(c,d)})}}function z(a,b,c,d){var w=void 0,e=!1,f=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/uploaddocument?ts\x3d"+(new Date).getTime();a&&"object"===typeof a&&"function"===typeof a.get?w=a.get("fieltype"):a&&"object"===typeof a&&void 0!==a.fieltype&&(w=a.fieltype);a&&"object"===typeof a&&"function"===typeof a.get?e=1===Number(a.get("writedb")):a&&"object"===typeof a&&void 0!==a.writedb&&(e=1===Number(a.writedb));return L.Utils.sdkAjax({url:f,dataType:"json",
type:"POST",data:a,async:!0,isupLoadFile:!0,progress:function(a){L.Utils.isFunction(c)&&a&&c(a,Math.floor(100*a.loaded/a.total))},success:function(a){L.Logger.debug(q,"[tk-sdk]uploadFile resp \x3d ",L.Utils.toJsonStringify(a));var c=a.result;if(0===c&&e){var f=L.Utils.toJsonParse(L.Utils.toJsonStringify(a));delete f.result;f.filetype=f.filetype||w;N(f,!1)}0===c?L.Utils.isFunction(b)&&b(c,a):L.Utils.isFunction(d)&&d(c,a)},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]uploadFile fail[ XHR , textStatus , errorThrown ]:",
a,b,c);L.Utils.isFunction(d)&&d(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}function N(a,b){if(a&&"object"===typeof a){var c=Number(a.fileprop),d=a.filetype&&"string"===typeof a.filetype?a.filetype.toLocaleLowerCase():a.filetype,w=1===c||2===c,e=3===c,f=!w&&!e,l=/(mp3|mp4|webm)/g.test(d);a.fileid=Number(a.fileid);a.pagenum=Number(a.pagenum);a.filecategory=void 0!==a.filecategory?Number(a.filecategory):0;a.fileprop=c;a.filetype=d;a.isContentDocument=void 0!==a.isContentDocument&&
null!==a.isContentDocument&&"number"===typeof Number(a.isContentDocument)?Number(a.isContentDocument):0;a.swfpath=w||e?a.downloadpath:a.swfpath;a.dynamicppt=w?1:0;a.currpage=1;a.pptslide=1;a.pptstep=0;a.steptotal=0;a={name:"DocumentChange",id:"DocumentChange",toID:b?"__all":"__allExceptSender",data:L.Utils.toJsonStringify({isDel:b,isGeneralFile:f,isMedia:l,isDynamicPPT:w,isH5Document:e,action:"",mediaType:l?d:"",filedata:a}),save:!1};t.pubMsg(a)}}function I(a,b,c){var d=l._web_protocol+"://"+l._web_host+
":"+l._web_port+"/ClientAPI/delroomfile?ts\x3d"+(new Date).getTime();L.Utils.sdkAjax({url:d,dataType:"json",type:"POST",anync:!0,data:{serial:l._room_properties.serial,fileid:a},success:function(d){L.Logger.debug(q,"[tk-sdk]deleteFile resp \x3d ",L.Utils.toJsonStringify(d));var w=d.result,e;a:{for(e=0;e<l._room_filelist.length;e++)if(l._room_filelist[e].fileid==a){e={file:l._room_filelist[e],index:e};break a}e=void 0}0===w&&e&&e.file&&"object"===typeof e.file&&(e=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.file)),
N(e,!0));0===w?L.Utils.isFunction(b)&&b(w,d):L.Utils.isFunction(c)&&c(w,d)},error:function(a,b,d){L.Logger.error(q,"[tk-sdk]deleteFile fail[ XHR , textStatus , errorThrown ]:",a,b,d);L.Utils.isFunction(c)&&c(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}function O(a,b){l._devicePublishInfo[a]=l._devicePublishInfo[a]||{_audiopublished_:!1,_videopublished_:!1};L.Utils.isBoolean(b)&&(l._devicePublishInfo[a]._videopublished_=b)}function F(a,b){l._devicePublishInfo[a]=
l._devicePublishInfo[a]||{_audiopublished_:!1,_videopublished_:!1};L.Utils.isBoolean(b)&&(l._devicePublishInfo[a]._audiopublished_=b)}function G(a,b){L.Utils.isBoolean(b)&&(l._multiCameraAudioDevicePublishInfo[a]=b)}function S(a){if(l._devicePublishInfo[a])return l._devicePublishInfo[a]._videopublished_}function Y(a){if(l._devicePublishInfo[a])return l._devicePublishInfo[a]._audiopublished_}function J(a){!l._devicePublishInfo[a]||l._devicePublishInfo[a]._audiopublished_||l._devicePublishInfo[a]._videopublished_||
(l._devicePublishInfo[a]=void 0,delete l._devicePublishInfo[a])}function va(a){l._multiCameraAudioDevicePublishInfo[a]||(l._multiCameraAudioDevicePublishInfo[a]=void 0,delete l._multiCameraAudioDevicePublishInfo[a])}function C(){var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput);if(L.Utils.isVideoinputDeviceIdFromDeviceList(a))return a;if(TK.deviceInfoMap&&TK.deviceInfoMap.videoinput&&TK.deviceInfoMap.videoinput.length){var b=TK.deviceInfoMap.videoinput[0]&&TK.deviceInfoMap.videoinput[0].deviceId;
a&&L.Logger.warning(q,"[tk-sdk]The host camera device id("+a+") of local storage is not in the device list, looking for other device replacements, which have an id of "+b);L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,b);return b}a&&L.Logger.warning(q,"[tk-sdk]The host camera device id("+a+') of local storage is not in the device list, looking for other device replacements, which have an id of ""');L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,"");return""}function ia(a){if(!l._isIpFalsification||
!l._ipFalsification)return a;if("offer"===a.type||"candidate"===a.type){var b=L.Utils.toJsonStringify(a),c=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;c.test(b)&&(a=L.Utils.toJsonParse(b.replace(c,"254.254.254.254")))}return a}function ca(a){if(!l._isIpFalsification||!l._ipFalsification)return a;if("answer"===a.type){var b=L.Utils.toJsonStringify(a),c=l._ipFalsification,d=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;
d.test(b)&&(a=L.Utils.toJsonParse(b.replace(d,c)))}return a}function T(a,b){var c=!1,d=!1;if(a.getAttributes().type===TK.STREAM_MEDIA||a.publisherId()!==y())d=!0;var w=0,e=0,f=0,l=0,h=w=0,k=0,g=0,ma=0,A=0,m=0,n=0,U=0,p=0,q=0,r=0,t=0,u=0,N=0,z=0,I=0,Ka=0,x=0,v=0,B=0,O=0,sa=0,F=0,G=sa=0,Ha=0,ea=0,E=0,ya=0,Ba=0,K=0,M=0,C=0,D=0,J=0,S=0,H=0,Ia=0,Q=function(a){"ssrc"===a.type&&"video"===a.mediaType?/send/g.test(a.id)?(r=Number(a.bytesSent),t=Number(a.packetsSent),m=Number(a.googRtt),u=Number(a.packetsLost),
n=Number(a.googFrameWidthSent),U=Number(a.googFrameHeightSent),q=Number(a.googFrameRateSent),p=a.timestamp,d=!1,ma=a.googFirsReceived?Number(a.googFirsReceived):0,A=a.googPlisReceived?Number(a.googPlisReceived):0):/recv/g.test(a.id)&&(N=Number(a.bytesReceived),v=Number(a.packetsReceived),z=Number(a.googCurrentDelayMs),B=Number(a.packetsLost),I=Number(a.googFrameWidthReceived),Ka=Number(a.googFrameHeightReceived),x=Number(a.googFrameRateReceived),p=a.timestamp,d=!0):"ssrc"===a.type&&"audio"===a.mediaType&&
(/send/g.test(a.id)?(ya=Number(a.bytesSent),Ba=Number(a.packetsSent),E=Number(a.googRtt),K=Number(a.packetsLost),C=Number(a.googJitterReceived),M=a.timestamp,d=!1):/recv/g.test(a.id)&&(J=Number(a.bytesReceived),S=Number(a.packetsReceived),H=Number(a.googCurrentDelayMs),Ia=Number(a.packetsLost),C=Number(a.googJitterReceived),M=a.timestamp,d=!0))},X=function(a){"video"===a.mediaType?"outbound-rtp"===a.type?(m=Number(a.Rtt)?Number(a.Rtt):0,r=Number(a.bytesSent)?Number(a.bytesSent):0,t=Number(a.packetsSent)?
Number(a.packetsSent):0,u=Number(a.nackCount)?Number(a.nackCount):0,n=Number(a.FrameWidthSent)?Number(a.FrameWidthSent):0,U=Number(a.FrameHeightSent)?Number(a.FrameWidthSent):0,q=Number(a.framerateMean)?Number(a.framerateMean):0,ma=Number(a.firCount)?Number(a.firCount):0,A=Number(a.firCount)?Number(a.pliCount):0,p=a.timestamp,d=!1):"inbound-rtp"===a.type&&(N=Number(a.bytesReceived)?Number(a.bytesReceived):0,v=Number(a.packetsReceived)?Number(a.packetsReceived):0,z=Number(a.CurrentDelayMs)?Number(a.CurrentDelayMs):
0,B=Number(a.packetsLost)?Number(a.packetsLost):0,I=Number(a.FrameWidthReceived)?Number(a.FrameWidthReceived):0,Ka=Number(a.FrameHeightReceived)?Number(a.FrameHeightReceived):0,x=Number(a.framerateMean)?Number(a.framerateMean):0,p=a.timestamp,d=!0):"audio"===a.mediaType&&("outbound-rtp"===a.type?(ya=Number(a.bytesSent)?Number(a.bytesSent):0,Ba=Number(a.packetsSent)?Number(a.packetsSent):0,E=Number(a.Rtt)?Number(a.Rtt):0,K=Number(a.nackCount)?Number(a.nackCount):0,C=1E3*Number(a.jitter)?1E3*Number(a.jitter):
0,M=a.timestamp,d=!1):"inbound-rtp"===a.type&&(J=Number(a.bytesReceived)?Number(a.bytesReceived):0,S=Number(a.packetsReceived)?Number(a.packetsReceived):0,H=Number(a.CurrentDelayMs)?Number(a.CurrentDelayMs):0,Ia=Number(a.packetsLost)?Number(a.packetsLost):0,C=1E3*Number(a.jitter)?1E3*Number(a.jitter):0,M=a.timestamp,d=!0))};if(b&&"object"===typeof b&&b.forEach)b.forEach(function(a,b){"chrome"===L.Utils.getBrowserInfo().info.browserName?Q(a):"firefox"===L.Utils.getBrowserInfo().info.browserName?X(a):
"Edge"!==L.Utils.getBrowserInfo().info.browserName&&L.Utils.getBrowserInfo()});else for(var bb in b)e=b[bb],"chrome"===L.Utils.getBrowserInfo().info.browserName?Q(e):"firefox"===L.Utils.getBrowserInfo().info.browserName?X(e):"Edge"!==L.Utils.getBrowserInfo().info.browserName&&L.Utils.getBrowserInfo();a.report||(a.report={},c=!0);a.report.timestamp=a.report.timestamp||p;a.report.audioTimestamp=a.report.audioTimestamp||M;d?(a.report.bytesReceived=a.report.bytesReceived||N,a.report.packetsReceived=a.report.packetsReceived||
v,a.report.packetsLostReceived=a.report.packetsLostReceived||B,a.report.audioBytesReceived=a.report.audioBytesReceived||J,a.report.audioPacketsReceived=a.report.audioPacketsReceived||S,a.report.audioPacketsLostReceived=a.report.audioPacketsLostReceived||Ia):(a.report.bytesSent=a.report.bytesSent||r,a.report.packetsSent=a.report.packetsSent||t,a.report.packetsLostSend=a.report.packetsLostSend||u,a.report.audioBytesSent=a.report.audioBytesSent||ya,a.report.audioPacketsSent=a.report.audioPacketsSent||
Ba,a.report.audioPacketsLostSend=a.report.audioPacketsLostSend||K);if(!c){if(a.networkStatus&&0>=p-a.report.timestamp&&0>=M-a.report.audioTimestamp)return a.networkStatus;d?(O=8*(N-a.report.bytesReceived),e=isNaN(n)?0:I,f=isNaN(U)?0:Ka,l=x,w=z,g=isNaN(w)?0:w,w=(B-a.report.packetsLostReceived)/(v-a.report.packetsReceived)*100,k=v,h=B,D=8*(J-a.report.audioBytesReceived),sa=H,ea=isNaN(sa)?0:sa,Ha=C,G=(Ia-a.report.audioPacketsLostReceived)/(S-a.report.audioPacketsReceived)*100,F=S,sa=Ia):(O=8*(r-a.report.bytesSent),
e=isNaN(n)?0:n,f=isNaN(U)?0:U,l=q,w=m,g=isNaN(w)?0:Math.round(w/2),w=(u-a.report.packetsLostSend)/(t-a.report.packetsSent)*100,k=t,h=u,D=8*(ya-a.report.audioBytesSent),sa=E,ea=isNaN(sa)?0:Math.round(sa/2),Ha=C,G=(K-a.report.audioPacketsLostSend)/(Ba-a.report.audioPacketsSent)*100,F=Ba,sa=K);b=O/((p-a.report.timestamp)/1E3);c=D/((M-a.report.audioTimestamp)/1E3);d?(a.report.bytesReceived=N,a.report.packetsReceived=v,a.report.packetsLostReceived=B,a.report.audioBytesReceived=J,a.report.audioPacketsReceived=
S,a.report.audioPacketsLostReceived=Ia):(a.report.bytesSent=r,a.report.packetsSent=t,a.report.packetsLostSend=u,a.report.audioBytesSent=ya,a.report.audioPacketsSent=Ba,a.report.audioPacketsLostSend=K);a.report.timestamp=p;a.report.audioTimestamp=M;w=isNaN(w)?0:100>=Math.round(w)?Math.round(w):100;G=isNaN(G)?0:100>=Math.round(G)?Math.round(G):100;g=isNaN(g)?0:g;ea=isNaN(ea)?0:ea;e={video:{bytesSent:Number(r),bitsPerSecond:isNaN(b)?0:Math.round(b),packetsLost:isNaN(h)?0:h,totalPackets:isNaN(k)?0:k,
packetsLostRate:w,currentDelay:g,frameRate:isNaN(l)?0:Math.round(l),frameWidth:e,frameHeight:f,timestamp:p,netquality:L.Utils.getNetLevel(w,g),googFirsCount:ma,googPlisCount:A},audio:{audioBytesSent:Number(ya),bitsPerSecond:isNaN(c)?0:Math.round(c),packetsLost:isNaN(sa)?0:sa,totalPackets:isNaN(F)?0:F,packetsLostRate:G,currentDelay:ea,jitter:isNaN(Ha)?0:Ha,timestamp:M,netquality:L.Utils.getNetLevel(G,ea)}};100<=e.video.packetsLostRate&&(e.video.packetsLostRate=100);return a.networkStatus=e}}function ha(a,
b,c){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _handlerCheckroom cannot be executed!");else{var d={},w=a.result;if(0===w){TK.isPlayback&&(a.nickname="playback",a.roomrole=-1,a.thirdid=L.Utils.generategGuid()+":playback");var e=a.room,f=a.pullinfo;a.roomrole=Number(a.roomrole);e.roomtype=Number(e.roomtype);e.maxvideo=parseInt(e.maxvideo);var h={},k={};if(f&&f.data&&f.data.pullConfigureList){var g=f.data.pullConfigureList,ma;for(ma in g){var Fa=g[ma];h[Fa.pullProtocol]=Fa.pullUrlList}}if(f&&
f.data&&f.data.pushConfigureInfo)for(ma in f=f.data.pushConfigureInfo,f)g=f[ma],k[g.pushProtocol]=g.pushUrl;e.pullConfigure=h;e.pushConfigure=k;l._room_properties=e;l._room_name=e.roomname;l._room_type=e.roomtype;l._room_max_videocount=e.maxvideo;l._video_codec=void 0!==e.vcodec&&null!==e.vcodec&&"number"===typeof Number(e.vcodec)?Number(e.vcodec):l._video_codec;d.properties={};d.properties.role=a.roomrole;d.properties.nickname=a.nickname;h=""+a.thirdid;0===a.thirdid&&(h="");d.id=c?c:void 0!==h&&
null!==h&&""!=h?h:L.Utils.generategGuid();"string"!==typeof d.id&&(d.id=""+d.id);l._myself=TK.RoomUser(d);ab();TK.isPlayback?(l._myself.hasvideo=!1,l._myself.hasaudio=!1):(L.Logger.debug(q,"[tk-sdk]call getDevices to checkroom set myself.hasvideo and  myself.hasaudio start!"),D.getDeviceMgr().getDevices(function(a){L.Logger.debug(q,"[tk-sdk]call getDevices to checkroom set myself.hasvideo and  myself.hasaudio finshed!");a=a.hasdevice;l._myself.hasvideo=a.videoinput;l._myself.hasaudio=a.audioinput}));
TK.isPlayback?(l._room_id=e.serial+"_"+y(),l._room_id&&-1===l._room_id.indexOf(":playback")&&(l._room_id+=":playback")):l._room_id=e.serial;D.setMaxVideoProfile(Number(e.videowidth),Number(e.videoheight),Number(e.videoframerate));l._roomCheckRoomInfoString=a?"string"===typeof a?a:L.Utils.toJsonStringify(a):"";TK.isTkNative&&!l._handlerCallbackJson&&(l._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",localId:y().toString(),width:Number(e.videowidth),height:Number(e.videoheight),
fps:Number(e.videoframerate),roomInfo:l._roomCheckRoomInfoString,webAddr:l._web_host.toString(),webPort:l._web_port.toString(),tk_multistream:TK.isMultiCamera}));c=l._room_properties.chairmancontrol;l._mediaFileScale=!TK.isPlayback&&c&&"string"===typeof c?1!==Number(c.substr(95,1)):!0;TK.isHiFi=c&&"string"===typeof c?1===Number(c.substr(91,1)):!1;L.Logger.info(q,"[tk-sdk]"+(TK.isPlayback?"initPlaybackInfo to checkroom finshed--\x3e":"")+"privateVariableJson._room_max_videocount:"+l._room_max_videocount,
"my id:"+y(),"room id:"+l._room_id,"room properties chairmancontrol is:"+(l._room_properties.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(l._room_properties.chairmancontrol):l._room_properties.chairmancontrol:void 0))}else L.Logger.warning(q,"[tk-sdk]checkroom failure code is "+w);L.Logger.info(q,"[tk-sdk]checkroom finshed!");b(w,d,a)}}function ta(a,k){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _connectSocket cannot be executed!");else{La=(new Date).getTime();H.connectSocket(l._room_uri);
var w=0,g=!1;H.onConnectError=function(a){La=(new Date).getTime();L.Logger.error(q,"[tk-sdk]connect_error info:",a);w++;if(!g&&l._backupCourseAddrList.length&&5<=w){var b=l._backupCourseAddrList[0];l._backupCourseAddrList.splice(0,1);L.Logger.warning(q,"[tk-sdk]Not Connected,change address reconnection, address info:"+L.Utils.toJsonStringify(b)+" ,error info: "+a);E(b.name,b.signaladdr,b.signalport,b.webaddr,b.docaddr,b.change,void 0,function(){try{H&&H.socketDisconnect&&H.socketDisconnect()}catch(ib){L.Logger.warning(q,
"[tk-sdk]Socket already disconnected , disconnect errorInfo:",ib)}H&&H.emptySocket&&H.emptySocket();t.needReconnectSocket=!0;Ma+=1;ta(ka._handler_connectSocketSuccess,ka._handler_connectSocketFail)})}};H.onConnect=function(){Na=(new Date).getTime()-La;if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. socket connect!"),H&&H.isHasSocket&&H.isHasSocket()&&t.leaveroom();else if(L.Logger.debug(q,"[tk-sdk]tk connectd"),g=!0,w=0,0===l._connectedNumber||t.needReconnectSocket)H.onAddStream=function(a){var c=
!1,d=!1;a.attributes.type===TK.STREAM_MEDIA?(c=!0,TK.isPlayback&&a.attributes.toID&&a.attributes.toID!==TK.MSG_TO_ALLUSER&&a.attributes.toID!==TK.MSG_TO_ALLEXCEPTAUDITOR&&a.attributes.toID!==a.extensionId.replace(/:media/g,"")&&(c=!1)):a.attributes.type&&(c=zb(a.extensionId)===y()?!1:!0);TK.subscribe_from_native&&c&&(d=!0);if(a.attributes.type!==TK.STREAM_MEDIA&&zb(a.extensionId)===y()){if(d=fa(a.extensionId),!d){L.Logger.error(q,"[tk-sdk]onAddStream:not find local stream,add stream arg:",L.Utils.toJsonStringify(a));
return}}else d=TK.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes,extensionId:a.extensionId,getVideoTrack:ob,getAudioTrack:pb,getRegisterAudioVolumeListener:qb},d);for(var w in t.remoteStreams)if(t.remoteStreams[w]&&t.remoteStreams[w].extensionId===d.extensionId){var e=t.remoteStreams[w];nb(e);delete t.remoteStreams[w];U(e.extensionId)&&ea(e.extensionId)}delete d.report;t.remoteStreams[a.id]=d;d.getAttributes().type===TK.STREAM_VIDEO&&
d.publisherId()===y()&&b(void 0,void 0,void 0,d.videoinputDeviceId);c&&mb(d);L.Logger.info(q,"[tk-sdk]stream-added , stream id:"+d.getID()+" , extensionId is "+d.extensionId+", attrs is "+L.Utils.toJsonStringify(d.getAttributes()));d.publisherId()===y()&&(d.getAttributes().type===TK.STREAM_VIDEO?(a=!1,c=oa(d.videoinputDeviceId),c===TK.PUBLISH_STATE_MUTEALL&&(a=!0),Wa(d,a),c===TK.PUBLISH_STATE_NONE&&!d.isUnpublishing&&t.localStreams[d.getID()]&&ra(d)):d.getAttributes().type!==TK.STREAM_MEDIA&&Va(d,
!0))},H.onSignalingMessageMediaserver=function(a){L.Logger.debug(q,"[tk-sdk]signaling_message_mediaserver",a);a.mess=ca(a.mess);if(a.peerId){var b=t.remoteStreams[a.peerId];!f.autoSubscribeAV&&a&&a.mess&&"started"===a.mess.type&&b&&(b.video&&c(b,!0),b.audio&&e(b,!0))}else b=t.localStreams[a.streamId];if(b){if(a&&a.mess&&"ready"===a.mess.type){var d=null;if(a.peerId){x(b);d={userId:b.publisherId(),type:b.getAttributes().type,source:"media server ready"};if(b.getAttributes().type===TK.STREAM_VIDEO){if((new RegExp(b.publisherId()+
":","g")).test(b.extensionId)){var w=Ga(b);d.deviceId=w}b.extensionId.split(":")[0]===t.getMySelf().id&&b&&b.needSetVideoBW&&D.setBandWidth(b.getID(),b.needSetVideoBW,function(){L.Logger.info(q,"[tk-sdk] setBandWidth success!")},function(a){L.Logger.info(q,"[tk-sdk] setBandWidth It might be a little bit of a problem!")})}d=TK.RoomEvent({type:TK.EVENT_TYPE.roomInfoNotice,message:{code:window.TK.INFO_NOTICE.INFO_SUBSCRIBE_COMPLETED,info:d}})}else h(b),d={userId:b.publisherId(),type:b.getAttributes().type,
source:"media server ready"},TK.isMultiCamera&&b.getAttributes().type===TK.STREAM_VIDEO&&(w=Ga(b),d.deviceId=w),d=TK.RoomEvent({type:TK.EVENT_TYPE.roomInfoNotice,message:{code:window.TK.INFO_NOTICE.INFO_PUBLISH_COMPLETED,info:d}});b.isCompleted=!0;TK.isTkNative&&TK.subscribe_from_native&&b&&b.hideLoading&&b.hideLoading();d&&t.dispatchEvent&&t.dispatchEvent(d)}D.hasConnection(b.getID())?Rb(a.mess,b):L.Logger.warning(q,"stream pc is not exist , Can't call processSignalingMessage method!")}else L.Logger.error(q,
"[tk-sdk]onSignalingMessageMediaserver stream is not exist,signaling_message_mediaserver info:",a)},H.onUpdateAttributeStream=function(a){var b=t.remoteStreams[a.id];if(void 0!==b){b.updateLocalAttributes(a.attrs);var c=a.attrs;a="room-user"+b.getAttributes().type+"attributes-update";var d=L.Utils.toJsonParse(L.Utils.toJsonStringify(b.getAttributes()));d.video=b.hasVideo();d.audio=b.hasAudio();c={userId:b.publisherId(),type:b.getAttributes().type,attributes:d,updateAttributes:c};b.getAttributes().type===
TK.STREAM_VIDEO&&(new RegExp(b.publisherId()+":","g")).test(b.extensionId)&&(b=Ga(b),c.deviceId=b);b=TK.RoomEvent({type:a,message:c});t.dispatchEvent(b)}else L.Logger.warning(q,"[tk-sdk]onUpdateAttributeStream stream invalid",a)},H.onPublishFailed=function(a){L.Logger.warning(q,"[tk-sdk]stream-publish_mediaserver_failed server info: "+L.Utils.toJsonStringify(a));if(a=t.localStreams[a.streamId])Ta(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_TIMEOUT,"mediaserver publish failed"),r(a,"mediaserver publish failed")},
H.onSubscribeFailed=function(a){L.Logger.warning(q,"[tk-sdk]stream-subscribe_mediaserver_failed server info: "+L.Utils.toJsonStringify(a));if(a=t.remoteStreams[a.streamId])kb(a,window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_TIMEOUT,"mediaserver subscribe failed"),n(a,"mediaserver subscribe failed")},H.onRemoveStream=function(a){var b=t.remoteStreams[a.id];if(b){var c=fa(y()+":"+TK.STREAM_SCREEN);c&&c.mediaStream&&b.mediaStream&&c.mediaStream.id===b.mediaStream.id&&t.stopShareScreen(function(){L.Logger.error(q,
"[tk-sdk]stream-removed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", stopShareScreen Failed. ")});D.closeConnection(b.getID());L.Logger.info(q,"[tk-sdk]stream-removed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes()));b.getAttributes().type===TK.STREAM_VIDEO?lb(b):Va(b,!1);Sb(b);nb(b);delete b.report;delete t.localStreams[a.id];delete t.remoteStreams[a.id];U(b.extensionId)&&ea(b.extensionId)}else L.Logger.info(q,"[tk-sdk]Received a removeStream for ",
a.id," and it has not been registered here, ignoring.")},H.onDisconnect=function(a){t.needReconnectSocket||(L.Logger.debug(q,"[tk-sdk]Socket disconnected, lost connection to TKController",a),l._isConnected&&(p(),TK.isTkNative&&(l._handlerCallbackJson=!1,window.tknative.postMessage({command:"nativeClear"})),clearInterval(t._networkequipmentTimer),clearInterval(t._catonNumber),clearInterval(t.sendcatonNumber),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomDisconnected,message:"unexpected-disconnection"}),t.dispatchEvent(a)))},
H.onReconnecting=function(a){L.Logger.debug(q,"[tk-sdk]reconnecting info:",a);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomReconnecting,message:{number:a,info:"room-reconnecting number:"+a}});t.dispatchEvent(a)},H.onParticipantLeft=ka._handler_participantLeft,H.onParticipantJoined=ka._handler_participantJoined,H.onParticipantPublished=ka._handler_participantPublished,H.onParticipantEvicted=function(a){a=a||{};L.Logger.info(q,"[tk-sdk]user evicted room  , user info: "+L.Utils.toJsonStringify(l._myself)+
" , participantEvicted  messages:"+L.Utils.toJsonStringify(a));t.leaveroom(!0);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomParticipantEvicted,message:a,user:l._myself});t.dispatchEvent(a)},H.onSendMessage=ka._handler_sendMessage,H.onMsgList=function(a){L.Logger.debug(q,"[tk-sdk]msgList info:",L.Utils.toJsonStringify(a));a=TK.RoomEvent({type:TK.EVENT_TYPE.roomMsgList,message:a});t.dispatchEvent(a)},H.onPubMsg=ka._handler_pubMsg,H.onDelMsg=ka._handler_delMsg,H.onSetProperty=ka._handler_setProperty,H.onPlaybackClearAll=
Aa.playbackClearAll,H.onDuration=Aa.handlerDuration,H.onPlaybackEnd=Aa.handlerPlaybackEnd,H.onPlaybackUpdatetime=Aa.handlerPlaybackUpdateTime,H.onForceReconnect=function(){L.Logger.info(q,"[tk-sdk]service notice forceReconnect , call reconnected room! ");d({source:"forceReconnect room"},a,k)},l._connectedNumber++,L.Logger.info(q,"[tk-sdk]connected room  , current connected number is "+l._connectedNumber+"! "),t.needReconnectSocket||L.Logger.info(q,"[tk-sdk]Reconnect Socket ,  join room start! "),
t.needReconnectSocket=!1,X(a,k);else{L.Logger.info(q,"[tk-sdk]reconnected room! ");var ma=TK.RoomEvent({type:TK.EVENT_TYPE.roomReconnected});t.dispatchEvent(ma);d({source:"reconnected room"},a,k)}}}}function pa(a,b,c,d){l._isConnected?H.socketSend(a,b,c,function(a,b){L.Utils.isFunction(d)&&d(a,b)}):L.Logger.warning(q,"[tk-sdk]Trying to send a message over a disconnected Socket")}function R(a,c){var d=oa(c);L.Logger.debug(q,"[tk-sdk]onChangeMyPublishState "+d+" to "+a);Tb(a,c);var w=Z(c,!0);a>TK.PUBLISH_STATE_NONE?
(b(a,void 0,void 0,c),w&&void 0===t.localStreams[w.getID()]&&!w.isPublishing&&Ca(w,void 0,function(){oa(c)===TK.PUBLISH_STATE_NONE&&w&&!w.isUnpublishing&&t.localStreams[w.getID()]&&ra(w)})):w&&!w.isUnpublishing&&t.localStreams[w.getID()]&&ra(w,function(){oa(c)>TK.PUBLISH_STATE_NONE&&(w=Z(c,!0))&&void 0===t.localStreams[w.getID()]&&!w.isPublishing&&Ca(w)})}function wa(a){L.Logger.debug(q,"[tk-sdk]onChangeMyDisableVideoState "+l._myself.disablevideo+" to "+a);if(l._myself.disablevideo!=a)if(l._myself.disablevideo=
a,TK.isMultiCamera)for(var c in l._myself)/publishstate:/g.test(c)&&(a=Oa(c),l._myself[c]>TK.PUBLISH_STATE_NONE&&b(l._myself[c],void 0,void 0,a));else l._myself.publishstate>TK.PUBLISH_STATE_NONE&&b(l._myself.publishstate,void 0,void 0,void 0)}function ja(a){L.Logger.debug(q,"[tk-sdk]onChangeMyDisableAudioState "+l._myself.disableaudio+" to "+a);if(l._myself.disableaudio!=a)if(l._myself.disableaudio=a,TK.isMultiCamera)for(var c in l._myself)/publishstate:/g.test(c)&&(a=Oa(c),l._myself[c]>TK.PUBLISH_STATE_NONE&&
b(l._myself[c],void 0,void 0,a));else l._myself.publishstate>TK.PUBLISH_STATE_NONE&&b(l._myself.publishstate,void 0,void 0,void 0)}function V(a){var b=!1;a&&(b=a.getAttributes().type===TK.STREAM_MEDIA?!1:a.publisherId()===y());return b}function aa(a,b,c){var d=void 0;if(b===TK.STREAM_MEDIA||b===TK.STREAM_SCREEN)for(var w in t.remoteStreams){var e=t.remoteStreams[w];if(e.extensionId===a+":"+b){d=e;break}}else if(a===y())if(b===TK.STREAM_VIDEO){var f=a;TK.isMultiCamera&&(f+=":"+c);d=l._createStreams[f]}else d=
l._createStreams[a+":"+b];else for(w in t.remoteStreams)if(e=t.remoteStreams[w],b===TK.STREAM_VIDEO){if(f=a,c&&(f+=":"+c),e.extensionId===f){d=e;break}}else if(e.extensionId===a+":"+b){d=e;break}return d}function ba(a){var b=[],c;for(c in l._createStreams)fa(c)&&fa(c).getAttributes().type===a&&b.push(fa(c));return b}function y(){return L.Utils.isNull(l._myself.id)?l._local_def_ext_id:l._myself.id}function Z(a,b){b&&(Z(a)||ua(a));return TK.isMultiCamera?l._createStreams[y()+":"+a]:l._createStreams[y()]}
function ua(a){var b=TK.isPlayback?!1:l._roomJsonOptions.audio||!1,c=TK.isPlayback?!1:l._roomJsonOptions.video||!1,d={},w;if((w=TK.isMultiCamera?l._videoStreamListAttrs[Ea(y(),TK.STREAM_VIDEO,a)]||l._videoStreamAttrs:l._videoStreamAttrs)&&"object"===typeof w)for(var e in w)d[e]=w[e];return TK.isMultiCamera?Ba("video",{video:c,audio:b,attributes:d,videoinputDeviceId:a}):Ba("video",{video:c,audio:b,attributes:d})}function fa(a){return l._createStreams[a]}function U(a){var b=!1,c=l._createStreams[a];
if(c&&c.publisherId()===y()&&c.getAttributes().type!==TK.STREAM_MEDIA)if(D.hasConnection(c.getID())||t.localStreams[c.getID()]||t.remoteStreams[c.getID()]||l._playVideoStreams[a]||l._playAudioStreams[xa(c.publisherId(),c.getAttributes().type)])b=!1;else switch(c.getAttributes().type){case TK.STREAM_VIDEO:oa(c.videoinputDeviceId)===TK.PUBLISH_STATE_NONE&&(b=!0);break;default:c.needPublishToServer||(b=!0)}return b}function ea(a){var b=l._createStreams[a];if(b){var c=l._playVideoStreams[a],d=l._playAudioStreams[xa(b.publisherId(),
b.getAttributes().type)];switch(b.getAttributes().type){case TK.STREAM_VIDEO:c&&t.unplayVideo(b.publisherId(),void 0,b.videoinputDeviceId);d&&t.unplayAudio(b.publisherId());break;case TK.STREAM_FILE:(c||d)&&t.unplayRemoteMediaFile(b.publisherId());break;case TK.STREAM_SCREEN:(c||d)&&t.unplayRemoteScreen(b.publisherId());break;default:c&&Ka(c),d&&sa(d)}delete b.report;b.destroy();if(b.getAttributes().type===TK.STREAM_VIDEO){d=c=!0;var w=ba(TK.STREAM_VIDEO);if(w&&w.length)for(var e=0,f=w.length;e<f;e++)w[e]&&
w[e].extensionId!==b.extensionId&&(w[e].videoinputDeviceId===b.videoinputDeviceId&&(c=!1),w[e].audioinputDeviceId===b.audioinputDeviceId&&(d=!1));c&&D.destroyVideoTrack(b.videoinputDeviceId);d&&D.destroyAudioTrack(b.audioinputDeviceId)}}l._createStreams[a]=void 0;delete l._createStreams[a]}function ya(a,b,d){d=d||{};b.playInfo=b.playInfo||{video:!1,audio:!1};b.playInfo.video=!TK.isOnlyAudioRoom;b.hasVideoPlayer()?a!==b.getVideoPlayerElementId()?(b.unplayVideo(),b.playVideo(a,d),l._playVideoStreams[b.extensionId]=
b):b.updateVideoPlayerOptions(d):(b.playVideo(a,d),l._playVideoStreams[b.extensionId]=b);b.video&&(b.playInfo.video?(b.updateVideoPlayerOptions(d),b.showVideo()):b.hideVideo());V(b)||b.video&&c(b,!b.playInfo.video)}function A(a,b){b=b||{};a.playInfo=a.playInfo||{video:!1,audio:!1};a.playInfo.audio=!0;a.hasAudioPlayer()?a.updateAudioPlayerOptions(b):(a.playAudio(b),l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)]=a);a.getAttributes().type!==TK.STREAM_VIDEO&&a.audio&&(a.playInfo.audio?
a.setMute(!1):a.setMute(!0));V(a)||a.audio&&e(a,!a.playInfo.audio)}function Ka(a,b){b=b||{};a.playInfo=a.playInfo||{video:!1,audio:!1};a.playInfo.video=!1;a.video&&(a.playInfo.video?a.showVideo():a.hideVideo());V(a)||a.video&&c(a,!a.playInfo.video);a.unplayVideo(b);delete l._playVideoStreams[a.extensionId];a.publisherId()===y()&&a.getAttributes().type!==TK.STREAM_MEDIA&&U(a.extensionId)&&ea(a.extensionId)}function sa(a,b){b=b||{};a.playInfo=a.playInfo||{video:!1,audio:!1};a.playInfo.audio=!1;a.getAttributes().type!==
TK.STREAM_VIDEO&&a.audio&&(a.playInfo.audio?a.setMute(!1):a.setMute(!0));V(a)||a.audio&&e(a,!a.playInfo.audio);a.unplayAudio(b);b.notDelete?l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)]=null:delete l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)];a.publisherId()===y()&&a.getAttributes().type!==TK.STREAM_MEDIA&&U(a.extensionId)&&ea(a.extensionId)}function Ba(a,b){var c={getVideoTrack:ob,getAudioTrack:pb,getRegisterAudioVolumeListener:qb};b=b||{};var d={type:a,isWeb:b.isWeb};
if(b.attributes&&"object"===typeof b.attributes)for(var e in b.attributes)"type"!==e&&(d[e]=b.attributes[e]);c.audio=b.audio||!1;c.video=b.video||!1;c.data=!1;c.attributes=d;switch(a){case TK.STREAM_VIDEO:c.screen=!1;c.media=!1;c.extensionId=y();void 0!==b.videoinputDeviceId&&(c.extensionId+=":"+b.videoinputDeviceId);break;case TK.STREAM_SCREEN:c.screen=!0;c.media=!1;c.extensionId=y()+":"+a;break;case TK.STREAM_FILE:c.screen=!1,c.media=!0,c.path=b.path,c.scale=L.Utils.isBoolean(b.scale)?b.scale:l._mediaFileScale,
c.extensionId=y()+":"+a}d=!1;TK.isTkNative&&(d=TK.isTkMacNative?a===TK.STREAM_SCREEN?TK.isTkNative:!1:TK.isTkNative);c=TK.Stream(c,d);a===TK.STREAM_VIDEO&&(c.videoinputDeviceId=void 0!==b.videoinputDeviceId?b.videoinputDeviceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),c.audioinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput));return l._createStreams[c.extensionId]=c}function Ha(a,b){if(TK.isOnlyAudioRoom!==a){TK.isOnlyAudioRoom=a;if(TK.isOnlyAudioRoom)for(var c in t.remoteStreams)(a=
t.remoteStreams[c])&&a.video&&(a.getAttributes().type===TK.STREAM_FILE&&a.publisherId()===y()?TK.isTkNative&&qa.stopShareMediaFile():a.getAttributes().type===TK.STREAM_SCREEN&&a.publisherId()===y()?TK.isTkNative?qa.stopShareScreen():t.stopShareScreen():a.getAttributes().type===TK.STREAM_MEDIA&&a.publisherId()===y()&&t.stopShareMedia());for(c in l._myself)if(!TK.isMultiCamera&&"publishstate"===c||TK.isMultiCamera&&/publishstate:/g.test(c)){var d=l._myself[c];if(d>TK.PUBLISH_STATE_NONE)if(a=void 0,
TK.isMultiCamera&&/publishstate:/g.test(c)&&(a=Oa(c)),TK.isOnlyAudioRoom)if(d!==TK.PUBLISH_STATE_AUDIOONLY){var e=void 0;if(d===TK.PUBLISH_STATE_VIDEOONLY||d===TK.PUBLISH_STATE_BOTH)d={},TK.isMultiCamera&&(d.deviceId=a),e=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_SWITCHAUDIOROOM,info:d}});TK.isMultiCamera?l._mainCameraDeviceId===a?t.changeUserPublish(y(),TK.PUBLISH_STATE_AUDIOONLY,a):t.changeUserPublish(y(),TK.PUBLISH_STATE_NONE,a):
t.changeUserPublish(y(),TK.PUBLISH_STATE_AUDIOONLY,a);e&&t.dispatchEvent(e)}else TK.isMultiCamera&&l._mainCameraDeviceId!==a&&t.changeUserPublish(y(),TK.PUBLISH_STATE_NONE,a);else if(d!==TK.PUBLISH_STATE_BOTH){e=void 0;if(d===TK.PUBLISH_STATE_AUDIOONLY||d===TK.PUBLISH_STATE_MUTEALL){d={};var w=!1;TK.isMultiCamera?l._mainCameraDeviceId===a&&(d.deviceId=a,w=!0):w=!0;w&&(e=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_PUBLISHVIDEO_BY_SWITCHAUDIOVIDEOROOM,
info:d}}))}TK.isMultiCamera?l._mainCameraDeviceId===a?t.changeUserPublish(y(),TK.PUBLISH_STATE_BOTH,a):t.changeUserPublish(y(),TK.PUBLISH_STATE_NONE,a):t.changeUserPublish(y(),TK.PUBLISH_STATE_BOTH,a);e&&t.dispatchEvent(e)}else TK.isMultiCamera&&l._mainCameraDeviceId!==a&&t.changeUserPublish(y(),TK.PUBLISH_STATE_NONE,a)}for(c in l._playVideoStreams)a=l._playVideoStreams[c],TK.isOnlyAudioRoom?a.hideVideo():a.showVideo();b=TK.RoomEvent({type:TK.EVENT_TYPE.roomAudioVideoStateSwitched,message:{fromId:b,
onlyAudio:TK.isOnlyAudioRoom}});t.dispatchEvent(b)}}function bb(a){"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));var b=a.fromID,c=a.data,d=function(a){for(var b=0;b<l._room_filelist.length;b++)if(l._room_filelist[b].fileid==a)return{file:l._room_filelist[b],index:b}}(c.filedata.fileid);if(c.isDel)d&&d.file&&(l._room_filelist.splice(d.index,1),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomDeleteFile,message:{fileid:d.file.fileid,
fileinfo:d.file,fromID:b}}),t.dispatchEvent(a));else{var e=function(a){var e=c.filedata;e.fileid=Number(e.fileid);e.pagenum=Number(e.pagenum);e.filecategory=void 0!==e.filecategory?Number(e.filecategory):0;e.isContentDocument=void 0!==e.isContentDocument&&null!==e.isContentDocument&&"number"===typeof Number(e.isContentDocument)?Number(e.isContentDocument):0;e.dynamicppt=c.isDynamicPPT?1:0;e.uploaduserid=b;e.uploadusername=a?a.nickname:"";e.companyid=l._room_properties.companyid;e.downloadpath=e.swfpath;
e.filetype=e.filetype&&"string"===typeof e.filetype?e.filetype.toLocaleLowerCase():e.filetype;e.fileprop=c.isDynamicPPT?2:c.isH5Document?3:0;e.type=0;if(d){a={};var w=!1,f;for(f in e)d.file[f]!==e[f]&&(d.file[f]=e[f],a[f]=e[f],w=!0);w&&(e=TK.RoomEvent({type:TK.EVENT_TYPE.roomUpdateFile,message:{fileid:e.fileid,updateFileinfo:a,fromID:b}}),t.dispatchEvent(e))}else l._room_filelist.push(e),e=TK.RoomEvent({type:TK.EVENT_TYPE.roomAddFile,message:{fileid:e.fileid,fromID:b}}),t.dispatchEvent(e)};t.getRoomUser(b,
function(a){e(a)},function(){e()})}}function Ia(a){if(a&&a.data){var b={associatedMsgID:"ClassBegin",id:"RemoteControl",name:"RemoteControl",toID:a.fromID};switch(a.data.type){case "getDeviceInfo":TK.DeviceMgr.getDevices(function(a){TK.isMultiCamera&&a.devices&&a.devices.videoinput&&delete a.devices.videoinput;b.data={action:"deviceManagement",type:"sendDeviceInfo",deviceData:{deviceInfo:a}};H.socketSend("pubMsg",b)},{isSetlocalStorage:!1});break;case "changeDeviceInfo":TK.DeviceMgr.setDevices(a.data.changeData.selectDeviceInfo,
function(){L.Logger.error(q,"set devices failed")})}}}function Wa(a,b){if(a.getAttributes().type===TK.STREAM_VIDEO){a.publisherId()===y()&&fa(a.extensionId)&&(a=fa(a.extensionId));var c=l._users[a.publisherId()];if(c){void 0===l._multiCameraAudioDevicePublishInfo[a.publisherId()]&&G(a.publisherId(),!1);void 0===Y(a.extensionId)&&F(a.extensionId,!1);void 0===S(a.extensionId)&&O(a.extensionId,!1);var d=Ga(a),e=Ab(c,d),w=e===TK.PUBLISH_STATE_AUDIOONLY||e===TK.PUBLISH_STATE_BOTH,f=e===TK.PUBLISH_STATE_VIDEOONLY||
e===TK.PUBLISH_STATE_BOTH;if(a.audio&&(Y(a.extensionId)!==w||b)){var h={userId:a.publisherId(),published:w,type:a.getAttributes().type,publishstate:e,attributes:a.getAttributes()},k=l._multiCameraAudioDevicePublishInfo[a.publisherId()];F(a.extensionId,h.published);var g=new RegExp(a.publisherId()+":","g");void 0!==c.tk_maincamera&&g.test(a.extensionId)?d!==c.tk_maincamera?l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)]&&sa(a,{notDelete:!0}):(G(a.publisherId(),h.published),w===k?h.published&&
null===l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)]&&A(a):(L.Logger.info(q,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:h})),c=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:h}),t.dispatchEvent(c))):(G(a.publisherId(),h.published),L.Logger.info(q,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:h})),c=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,
message:h}),t.dispatchEvent(c))}a.video&&(S(a.extensionId)!==f||b)&&(h={userId:a.publisherId(),published:f,type:a.getAttributes().type,publishstate:e,attributes:a.getAttributes()},g=new RegExp(a.publisherId()+":","g"),g.test(a.extensionId)&&(h.deviceId=d),O(a.extensionId,h.published),L.Logger.info(q,"[tk-sdk]roomUserVideoStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:h})),b=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:h}),t.dispatchEvent(b));
J(a.extensionId);va(a.publisherId())}}}function lb(a){if(a.getAttributes().type===TK.STREAM_VIDEO){a.publisherId()===y()&&fa(a.extensionId)&&(a=fa(a.extensionId));var b=l._users[a.publisherId()];if(b){void 0===l._multiCameraAudioDevicePublishInfo[a.publisherId()]&&G(a.publisherId(),!1);void 0===Y(a.extensionId)&&F(a.extensionId,!1);void 0===S(a.extensionId)&&O(a.extensionId,!1);var c=Ga(a),d=Ab(b,c);if(a.audio&&Y(a.extensionId)){var e={userId:a.publisherId(),published:!1,type:a.getAttributes().type,
publishstate:d,attributes:a.getAttributes()},f=l._multiCameraAudioDevicePublishInfo[a.publisherId()];F(a.extensionId,e.published);var w=new RegExp(a.publisherId()+":","g");void 0!==b.tk_maincamera&&w.test(a.extensionId)?c!==b.tk_maincamera?l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)]&&sa(a,{notDelete:!0}):(G(a.publisherId(),!1),!1!==f&&(L.Logger.info(q,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:e})),b=
TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:e}),t.dispatchEvent(b))):(G(a.publisherId(),!1),L.Logger.info(q,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:e})),b=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:e}),t.dispatchEvent(b))}a.video&&S(a.extensionId)&&(e={userId:a.publisherId(),published:!1,type:a.getAttributes().type,publishstate:d,attributes:a.getAttributes()},w=new RegExp(a.publisherId()+
":","g"),w.test(a.extensionId)&&(e.deviceId=c),O(a.extensionId,e.published),L.Logger.info(q,"[tk-sdk]roomUserVideoStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:e})),c=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:e}),t.dispatchEvent(c));J(a.extensionId);va(a.publisherId())}}}function Va(a,b){var c="room-user"+a.getAttributes().type+"state-changed",d=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.getAttributes()));d.video=a.hasVideo();
d.audio=a.hasAudio();d={userId:a.publisherId(),published:b,type:a.getAttributes().type,attributes:d};b?l._createStreams[a.extensionId]=a:delete l._createStreams[a.extensionId];L.Logger.info(q,"[tk-sdk]"+c+" info:"+L.Utils.toJsonStringify({type:c,message:d}));a=TK.RoomEvent({type:c,message:d});t.dispatchEvent(a)}function Ub(a){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _sendDeviceInfoToPhp cannot be executed!");else{var b=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/equipment?ts\x3d"+
(new Date).getTime(),c=L.Utils.getBrowserInfo();c={serial:l._room_properties.serial,companyid:l._room_properties.companyid,peerid:y(),peername:l._myself.nickname,peerrole:l._myself.role,ip:l._myIp,country:l._ipinfo.country,region:l._ipinfo.city,city:l._ipinfo.area,osversion:L.Utils.detectOS(),devicemodel:TK.isTkNative&&(TK.clientfriendlyversion||TK.clientversion)?TK.clientfriendlyversion||TK.clientversion:c.info.browserName+" "+c.info.browserVersion,cpuarchitecture:"x86",sdkversion:TK.SDKVERSIONS,
sdkdate:TK.SDKVERSIONSTIME,connecttime:Na,reconnectcount:Pa,isp:l._ipinfo.perators,redirectcount:Ma,routename:l._myself.servername,browsername:L.Utils.getBrowserName()};a&&(a=TK.DeviceMgr.getUseDevice())&&(c.audioinput=a.audioinput,c.videoinput=a.videoinput,c.audiooutput=a.audiooutput);L.Utils.sdkAjax({url:b,dataType:"json",type:"POST",anync:!0,data:c,success:function(a){L.Logger.debug(q,"[tk-sdk]equipment resp \x3d ",L.Utils.toJsonStringify(a))},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]equipment fail[ XHR , textStatus , errorThrown ]:",
a,b,c)}})}}function Xa(a){if(l._isConnected)L.Logger.warning(q,"[tk-sdk]Room already connected!");else if(void 0===l._web_host||void 0===l._web_port)L.Logger.warning(q,"[tk-sdk]web_host or web_port or myself is undefined , web_host is "+l._web_host+" , web_port is "+l._web_port+",myself is "+l._myself);else if(l._room_properties){t.needReconnectSocket=!0;if(TK.isMultiCamera)for(var b in l._myself)/publishstate:/g.test(b)&&l._myself[b]!==TK.PUBLISH_STATE_NONE&&(l._myself[b]=TK.PUBLISH_STATE_NONE);
else l._myself.publishstate!==TK.PUBLISH_STATE_NONE&&(l._myself.publishstate=TK.PUBLISH_STATE_NONE);if(l._userJsonOptions&&l._userJsonOptions.userProperties&&"object"===typeof l._userJsonOptions.userProperties)for(b in l._userJsonOptions.userProperties)void 0===l._myself[b]&&(l._myself[b]=l._userJsonOptions.userProperties[b]);l._roomJsonOptions&&l._roomJsonOptions.group&&(Array.isArray(l._roomJsonOptions.group)?l._myself.group=l._roomJsonOptions.group:L.Logger.warning(q,"[tk-sdk]joinroomOptions.group must is a array!"));
L.Logger.info(q,"[tk-sdk]joinroom:my device info  [hasvideo , hasaudio] is ["+l._myself.hasvideo+" ,"+l._myself.hasaudio+"]");L.Logger.debug(q,"[tk-sdk]joinroom:my room user",l._myself);l._users={};a=a||l._web_host;B(a,l._web_port,function(a,b){0!=a?(L.Logger.error(q,"[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b),b=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"getconfig",error:a,errorCode:a}}),t.dispatchEvent(b),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,
message:{source:"getconfig",error:a,errorCode:a}}),t.dispatchEvent(a)):K(l._web_host,l._web_port,function(a,b){L.Logger.debug(q,"[tk-sdk]step2GetFileList result \x3d "+a+" , message:"+L.Utils.toJsonStringify(b));if(0===a){l._room_filelist=[];if(b&&Array.isArray(b)&&b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a];d&&(d.fileid=Number(d.fileid),d.pagenum=Number(d.pagenum),d.dynamicppt=Number(d.dynamicppt),d.filecategory=Number(d.filecategory),d.fileprop=Number(d.fileprop),d.type=Number(d.type),
d.filetype=d.filetype&&"string"===typeof d.filetype?d.filetype.toLocaleLowerCase():d.filetype,d.isContentDocument=void 0!==d.isContentDocument&&null!==d.isContentDocument&&"number"===typeof Number(d.isContentDocument)?Number(d.isContentDocument):0,l._room_filelist.push(d))}}b=TK.RoomEvent({type:TK.EVENT_TYPE.roomFiles,message:l._room_filelist});t.dispatchEvent(b)}else L.Logger.info(q,"[tk-sdk]step2GetFileList code is "+a);L.Utils.isFunction(l._roomJsonOptions.awitConnectRoomCallback)?(l._roomJsonOptions.awitConnectRoomCallback(function(){Q()}),
delete l._roomJsonOptions.awitConnectRoomCallback):Q()})},{notSpeedNetwordk:!l._roomJsonOptions.autoServer})}else L.Logger.warning(q,"[tk-sdk]No checkroom cannot joinroom , room_properties is "+l._room_properties)}function Qa(a){TK.isPlayback?Xa(a):l._roomJsonOptions&&"object"===typeof l._roomJsonOptions&&void 0!==l._roomJsonOptions.video&&void 0!==l._roomJsonOptions.audio?void 0===l._myself.hasvideo||void 0===l._myself.hasaudio?(L.Logger.debug(q,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),
D.getDeviceMgr().getDevices(function(b){L.Logger.debug(q,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");b=b.hasdevice;l._myself.hasvideo=b.videoinput;l._myself.hasaudio=b.audioinput;Xa(a)})):Xa(a):void 0===l._myself.hasvideo||void 0===l._myself.hasaudio?(L.Logger.debug(q,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream start!"),D.getDeviceMgr().getDevices(function(b){L.Logger.debug(q,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream finshed!");
b=b.hasdevice;l._myself.hasvideo=b.videoinput;l._myself.hasaudio=b.audioinput;Xa(a)})):Xa(a)}function rb(a,b,c,d,e,f,h){a?b?c&&"object"!==typeof c?(L.Logger.error(q,"[tk-sdk]  "+f+" method options is not json!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):((l._playVideoStreams[Ea(a,e,h)]||l._playAudioStreams[a+":"+e])&&cb(a,void 0,e,"un"+f,h),(e=aa(a,e,h))?(ya(b,e,c),A(e,c)):(L.Logger.debug(q,"[tk-sdk]  "+f+": user has not stream, user id is "+a),L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"))):
(L.Logger.error(q,"[tk-sdk]  "+f+" method got invalid elementId!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):(L.Logger.error(q,"[tk-sdk] "+f+" method got invalid userId!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"))}function cb(a,b,c,d,e){a?((e=l._playVideoStreams[Ea(a,c,e)])||L.Logger.debug(q,"[tk-sdk] "+d+": user has not video stream, user id is "+a),(c=l._playAudioStreams[a+":"+c])||L.Logger.debug(q,"[tk-sdk] "+d+": user has not audio stream, user id is "+a),e||c?(e&&Ka(e),c&&sa(c)):
L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM")):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk] "+d+" method got invalid userId!"))}function Sb(a){if(l._roomMode===window.TK.ROOM_MODE.BIG_ROOM&&a.getAttributes().type===TK.STREAM_VIDEO&&a.publisherId()!==y()&&l._users[a.publisherId()]){var b=l._users[a.publisherId()];if(b.role!==window.TK.ROOM_ROLE.TEACHER&&b.role!==window.TK.ROOM_ROLE.ASSISTANT)for(var c in b)if(("publishstate"===c||/publishstate:/g.test(c))&&b[c]===TK.PUBLISH_STATE_NONE){delete l._users[a.publisherId()];
break}}}function sb(){if(l._roomMode===window.TK.ROOM_MODE.BIG_ROOM)for(var a in l._users){var b=l._users[a];if(a!==y()&&b.role!==window.TK.ROOM_ROLE.TEACHER&&b.role!==window.TK.ROOM_ROLE.ASSISTANT)for(var c in b)if(("publishstate"===c||/publishstate:/g.test(c))&&b[c]===TK.PUBLISH_STATE_NONE){delete l._users[a];break}}}function Ca(a,b,c){if(l._isConnected)if(a.isPublishing)L.Utils.isFunction(c)&&c(void 0,"publishing");else if(b=b||{},L.Logger.info(q,"[tk-sdk]calling publish , stream id:"+a.getID()+
" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a&&void 0===t.localStreams[a.getID()]){b.maxVideoBW=b.maxVideoBW||la.defaultVideoBW;b.maxVideoBW>la.maxVideoBW&&(b.maxVideoBW=la.maxVideoBW);if(a.getAttributes().type===TK.STREAM_SCREEN)b.maxVideoBW=la.maxScreenBW;else if(a.getAttributes().type===TK.STREAM_FILE){var d=a.getAttributes().width,e=a.getAttributes().height;if(d&&e){var f=640,w=d,k=e;a.scale||(f=1920<Math.max(d,e)?1920:d);d>=e?d>f&&(w=f,k=e/d*w):
e>f&&(k=f,w=d/e*k);w=Math.floor(w);k=Math.floor(k);a.updateLocalAttributes({width:w,height:k,videowidth:w,videoheight:k});b.maxVideoBW=L.Utils.getMaxBPS(w,30);a.scale&&b.maxVideoBW>la.maxLocalFileMediaBW&&(b.maxVideoBW=la.maxLocalFileMediaBW)}else b.maxVideoBW=la.maxLocalFileMediaBW}else a.getAttributes().type===TK.STREAM_VIDEO&&(e="",a&&a.extensionId&&a.extensionId.split&&(e=a.extensionId.split(":")[1]),d=D.getUseVideoProfile(e),e=D.getMaxVideoProfile(e),d=L.Utils.getMaxBPS(d.width,d.fps),e=L.Utils.getMaxBPS(e.width,
e.fps),d<e&&(a.needSetVideoBW=d),b.maxVideoBW=e);void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>la.maxVideoBW&&(b.minVideoBW=la.maxVideoBW);a.isPublishing=!0;var g=function(d){a.getAttributes().type===TK.STREAM_VIDEO&&oa(a.videoinputDeviceId)===TK.PUBLISH_STATE_NONE?(D.closeConnection(a.getID()),t.localStreams[a.getID()]&&ra(a),h(a),L.Utils.isFunction(c)&&c(void 0,"not need publish!")):pa("publish",{state:"ms",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),minVideoBW:b.minVideoBW,
attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:b.createOffer,metadata:b.metadata,scheme:b.scheme},void 0,function(e,f){if(0!==e)a.isPublishing=!1,a.isUnpublishing=!1,L.Logger.warning(q,"[tk-sdk]Error when publishing the stream: ",e,f),L.Logger.info(q,"[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),2===e?(h(a),Ta(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_ROOMMAXVIDEOLIMITED,"publish ack failed")):
(r(a,"publish ack failed"),Ta(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_FAILED,"publish ack failed")),L.Utils.isFunction(c)&&c(void 0,e);else{L.Logger.debug(q,"[tk-sdk]Stream assigned an Id, starting the publish process , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.getID=function(){return f};a.id=a.getID();a.setAttributes=function(b){a&&"object"===typeof b&&(t.remoteStreams[a.getID()]?(a.local&&a.updateLocalAttributes(b),H.sendMessageSocket("updateStreamAttributes",
{id:a.getID(),attrs:b})):L.Logger.warning(q,"[tk-sdk]You can not update attributes to server, because the stream does not exist on the server."))};t.localStreams[f]=a;var w={video:a.hasVideo(),maxVideoBW:b.maxVideoBW},k={audio:a.hasAudio(),maxAudioBW:b.maxAudioBW},g=function(a,b){b=ia(b);pa("signaling_message",{streamId:a,msg:b})};D.createUpConnection(a.getID(),{mediaStream:d,useNative:a.isTkNative,extraData:{video:a.hasVideo(),audio:a.hasAudio(),screen:a.hasScreen(),media:a.hasMedia(),setStreamMethod:tb,
extensionId:a.extensionId}});D.bindIceCandidate(a.getID(),function(a,b){L.Logger.debug(q,"[tk-sdk]Sending ice info(connection_id is "+a+"):",b);g(a,b)});D.bindOfferGenerated(a.getID(),function(a,b){b.sdp=L.Utils.setMaxBWToSdp(b.sdp,w,k);L.Logger.debug(q,"[tk-sdk]Sending sdp info(connection_id is "+a+"):",b);g(a,b)});D.bindIceConnectionStateChange(a.getID(),function(b,c){L.Logger.info(q,"[tk-sdk]publish ice state:"+c+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
"failed"===c&&l._isConnected&&a&&(L.Logger.warning(q,"[tk-sdk]Publishing Stream ",a.getID()," has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=a.getID(),za[a.extensionId]?za[a.extensionId].failCount++:za[a.extensionId]={peerID:a.extensionId,streamID:b,failCount:1},u(a,c,"publish"));"completed"===c&&l._isConnected&&a&&(b=a.getID(),za[a.extensionId]||(za[a.extensionId]={peerID:a.extensionId,
streamID:b,failCount:0}))});D.createOffer(a.getID());L.Utils.isFunction(c)&&c(!0,f)}})};switch(a.getAttributes().type){case TK.STREAM_VIDEO:D.getDeviceMediaStream(a.videoinputDeviceId,a.audioinputDeviceId,function(b,c,d){oa(a.videoinputDeviceId)>TK.PUBLISH_STATE_NONE&&(c&&L.Logger.info(q,"[tk-sdk]publish video track is fail, fail info:",L.Utils.toJsonStringify(c)),d&&L.Logger.info(q,"[tk-sdk]publish audio track is fail, fail info:",L.Utils.toJsonStringify(d)),g(b));U(a.extensionId)&&ea(a.extensionId)},
function(b,d){b&&L.Logger.info(q,"[tk-sdk]publish device stream is not success, video track is fail, fail info:",L.Utils.toJsonStringify(b));d&&L.Logger.info(q,"[tk-sdk]publish device stream is not success, audio track is fail, fail info:",L.Utils.toJsonStringify(d));b=oa(a.videoinputDeviceId);if(b>TK.PUBLISH_STATE_NONE){d=void 0;if(b===TK.PUBLISH_STATE_VIDEOONLY||b===TK.PUBLISH_STATE_BOTH)d={},TK.isMultiCamera&&(d.deviceId=a.videoinputDeviceId),d=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,
info:d}});var e=void 0;if(b===TK.PUBLISH_STATE_AUDIOONLY||b===TK.PUBLISH_STATE_BOTH)e=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:{}}});t.changeUserPublish(a.publisherId(),TK.PUBLISH_STATE_NONE,a.videoinputDeviceId);d&&t.dispatchEvent(d);e&&t.dispatchEvent(e)}else ra(a);U(a.extensionId)&&ea(a.extensionId);L.Utils.isFunction(c)&&c(void 0,"publish device stream not success")});break;case TK.STREAM_SCREEN:g(a.mediaStream);
break;default:g(void 0)}}else L.Logger.info(q,"[tk-sdk]Trying to publish invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.isPublishing=!1,L.Utils.isFunction(c)&&c(void 0,"Trying to publish invalid stream")}function ra(a,b,c){a.isUnpublishing?L.Utils.isFunction(b)&&b(void 0,"unpublishing"):(L.Logger.info(q,"[tk-sdk]calling unpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
a&&t.localStreams[a.getID()]?(a.isUnpublishing=!0,H.sendMessageSocket("unpublish",a.getID(),function(c,d){a.isUnpublishing=!1;a.isPublishing=!1;0!==c?(L.Logger.warning(q,"[tk-sdk]Error unpublishing stream, stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),"error info:",d),L.Logger.info(q,"[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
L.Utils.isFunction(b)&&b(void 0,d)):(L.Logger.debug(q,"[tk-sdk]Stream unpublished  , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),D.closeConnection(a.getID()),delete a.report,delete t.localStreams[a.getID()],a.getID=function(){return"local"},a.id=a.getID(),a.setAttributes=function(b){a.updateLocalAttributes(b)},U(a.extensionId)&&ea(a.extensionId),L.Utils.isFunction(b)&&b(!0))})):(L.Logger.warning(q,"[tk-sdk]unpublish warning:",
"Cannot unpublish, stream does not exist or is not local"),L.Utils.isFunction(b)&&b(void 0,"Cannot unpublish, stream does not exist or is not local")))}function mb(a,b,c){b=b||{};if(t.remoteStreams[a.getID()]){a.hasVideo()||a.hasScreen()||(b.video=!1);a.hasAudio()||(b.audio=!1);b.maxVideoBW=b.maxVideoBW||la.defaultVideoBW;b.maxVideoBW>la.maxVideoBW&&(b.maxVideoBW=la.maxVideoBW);if(a.getAttributes().type===TK.STREAM_SCREEN)b.maxVideoBW=la.maxScreenBW;else if(a.getAttributes().type===TK.STREAM_FILE){var d=
a.getAttributes().width;b.maxVideoBW=d?L.Utils.getMaxBPS(d,30):la.maxLocalFileMediaBW}L.Logger.debug(q,"[tk-sdk]Subscribing to: "+a.getID());pa("subscribe",{streamId:a.getID(),audio:b.audio,video:b.video,data:b.data,browser:L.Utils.getBrowser(),createOffer:b.createOffer,metadata:b.metadata,slideShowMode:b.slideShowMode},void 0,function(d,e){if(0!==d)L.Logger.warning(q,"[tk-sdk]Error subscribing to stream ",e),L.Logger.info(q,"[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),kb(a,window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"subscribe ack failed"),n(a,"subscribe ack failed"),L.Utils.isFunction(c)&&c(void 0,e);else{a.incremental=0;L.Logger.debug(q,"[tk-sdk]Subscriber added");var f={video:a.hasVideo(),maxVideoBW:b.maxVideoBW},w={audio:a.hasAudio(),maxAudioBW:b.maxAudioBW};D.createDownConnection(a.getID(),{useNative:TK.subscribe_from_native,extraData:{video:a.hasVideo(),audio:a.hasAudio(),screen:a.hasScreen(),
media:a.hasMedia(),extensionId:a.extensionId}});var h=function(a,b){b=ia(b);pa("signaling_message",{streamId:a,msg:b,browser:L.Utils.getBrowser()})};D.bindIceCandidate(a.getID(),function(a,b){L.Logger.debug(q,"[tk-sdk]Sending ice info(connection_id is "+a+"):",b);h(a,b)});D.bindOfferGenerated(a.getID(),function(a,b){b.sdp=L.Utils.setMaxBWToSdp(b.sdp,f,w);L.Logger.debug(q,"[tk-sdk]Sending sdp info(connection_id is "+a+"):",b);h(a,b)});D.bindAddStream(a.getID(),function(b,c){t.remoteStreams[b]?(L.Logger.debug(q,
"[tk-sdk]Stream subscribed"),L.Logger.info(q,"[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.getAttributes().type===TK.STREAM_VIDEO?(c=!1,l._users[a.publisherId()]&&l._users[a.publisherId()].publishstate===TK.PUBLISH_STATE_MUTEALL&&(c=!0),Wa(a,c),!a.hasVideoTrack()&&D.getConnectionVideoTrack(b)&&(a.addVideoTrack(D.getConnectionVideoTrack(b)),a.showVideo())):Va(a,!0)):L.Logger.info(q,"[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))});D.bindIceConnectionStateChange(a.getID(),function(b,c){L.Logger.info(q,"[tk-sdk]subscribe ice state:"+c+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===c&&l._isConnected&&a&&(L.Logger.warning(q,"[tk-sdk]Subscribing stream ",a.getID()," has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=a.getID(),za[a.extensionId]?za[a.extensionId].failCount++:za[a.extensionId]={peerID:a.extensionId,streamID:b,failCount:1},u(a,c,"subscribe"));"completed"===c&&l._isConnected&&a&&(b=a.getID(),za[a.extensionId]||(za[a.extensionId]={peerID:a.extensionId,streamID:b,failCount:0}))});D.createOffer(a.getID());L.Utils.isFunction(c)&&c(!0)}})}else L.Logger.info(q,"[tk-sdk]Cannot subscribe to invalid stream , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),L.Utils.isFunction(c)&&c(void 0,"subscribe invalid stream")}function Mb(a,b,c){t.remoteStreams[a.getID()]?H.sendMessageSocket("unsubscribe",a.getID(),function(c,d){0!==c?(L.Logger.error(q,"[tk-sdk]Error unsubscribe stream, stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),"error code is "+c+" ,error info:",d),L.Logger.info(q,"[tk-sdk]stream-unsubscribe-fail , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),L.Utils.isFunction(b)&&b(void 0,d)):(D.closeConnection(a.getID()),L.Utils.isFunction(b)&&b(!0))}):(L.Logger.info(q,"[tk-sdk]Cannot unsubscribe to invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),L.Utils.isFunction(b)&&b(void 0,"unsubscribe invalid stream"))}function ub(a,b,c,d,e,f){if(l._isLeaveRoom)L.Logger.info(q,
"[tk-sdk]The room is over. Method _checkroom cannot be executed!");else{var w=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/checkroom?ts\x3d"+(new Date).getTime(),h=!0,k="";if("string"===typeof c)k=c,TK.isPlayback&&(k+="\x26playback\x3dtrue"),k+="\x26clientType\x3d"+(TK.isTkNative?4:1);else{TK.isPlayback&&(c.playback=!0);c.clientType=TK.isTkNative?4:1;for(var g in c)h?h=!1:k+="\x26",k=k+g+"\x3d"+c[g]}L.Logger.debug(q,"[tk-sdk]Going to checkroom",k);L.Logger.info(q,"[tk-sdk]call checkroom start!");
L.Utils.sdkAjax({url:w,dataType:"json",type:"POST",anync:!0,data:k,success:function(a){L.Logger.debug(q,"[tk-sdk]checkroom resp \x3d ",L.Utils.toJsonStringify(a));ha(a,d,e)},error:function(w,h,k){L.Logger.error(q,"[tk-sdk]checkroom fail[ XHR , textStatus , errorThrown ]:",w,h,k);l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method checkroom cannot be executed!"):(l._webReconnectNumList.hasOwnProperty("checkroomReconnectNum")||(l._webReconnectNumList.checkroomReconnectNum=0),l._webReconnectNumList.checkroomReconnectNum=
++l._webReconnectNumList.checkroomReconnectNum%5,clearTimeout(l._webReconnectNumList.checkroomReconnectTimer),l._webReconnectNumList.checkroomReconnectTimer=setTimeout(function(){l._webReconnectNumList.checkroomReconnectTimer=void 0;l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method checkroom cannot be executed!"):(L.Logger.info(q,"[tk-sdk]Rerequest checkroom web interface!"),ub(a,b,c,d,e,f))},1E3*l._webReconnectNumList.checkroomReconnectNum))}})}}function Vb(a,b,c,d,e,f){if(l._isLeaveRoom)L.Logger.info(q,
"[tk-sdk]The room is over. Method _initPlaybackInfo cannot be executed!");else{var w=function(){void 0===c.roomtype||void 0===c.serial||void 0===c.recordfilepath?(L.Logger.error(q,"[tk-sdk]The params must be included [roomtype , serial , recordfilepath] ! "),L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG")):(g({web_host:a,web_port:b}),c.recordfilepath=/\//g.test(c.recordfilepath.charAt(c.recordfilepath.length-1))?c.recordfilepath:c.recordfilepath+"/",TK.isPlayback=!0,l._recordfilepath=c.recordfilepath,
l._isGetFileList=!1,ha({result:0,room:{roomtype:c.roomtype,maxvideo:void 0!==c.maxvideo?c.maxvideo:1E6,roomrole:-1,serial:c.serial,roomname:c.roomname||"Play Back",recordfilepath:c.recordfilepath,domain:c.domain,host:c.host||a,companyid:c.companyid||-1}},function(a,b,c){0===a&&d&&"function"===typeof d&&d(a,b,c)}))};if(e)w();else if(c.recordfilepath){g({web_host:a,web_port:b});c.recordfilepath=/\//g.test(c.recordfilepath.charAt(c.recordfilepath.length-1))?c.recordfilepath:c.recordfilepath+"/";TK.isPlayback=
!0;l._recordfilepath=c.recordfilepath;l._isGetFileList=!1;L.Logger.info(q,"[tk-sdk]initPlaybackInfo to checkroom start , params is "+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c))+"!");e=c.recordfilepath;var h=new RegExp(/:[0-9]{1,6}\//);h.test(e)&&(e=e.replace(h,"/"));0===e.indexOf("http")&&0!==e.indexOf("https")&&(e=e.replace(/http/,"https"));L.Utils.sdkAjax({url:e+"room.json",dataType:"json",type:"GET",async:!0,success:function(a){L.Logger.debug(q,
"[tk-sdk]getPlaybackRoomJson resp \x3d ",L.Utils.toJsonStringify(a));a&&"object"===typeof a?ha(a,function(a,b,c){0===a?d&&"function"===typeof d&&d(a,b,c):w()}):(L.Logger.error(q,"[tk-sdk]getPlaybackRoomJson resp must is json , call oldInitPlaybackInterface handler!"),w())},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]getPlaybackRoomJson fail[ XHR , textStatus , errorThrown ]:",a,b,c);w()}})}else L.Logger.error(q,"[tk-sdk]params.recordfilepath is required !"),L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG")}}
function vb(a,b,c){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _sendNetworkequipment cannot be executed!");else{(new Date).getTime();a=a[0];var d={};try{a&&(d={cpuOccupancy:a.cpuOccupancy,video:{currentDelay:(a.video?a.video.currentDelay:0)||0,videoWidth:(a.video?a.video.frameWidth:0)||0,videoHeight:(a.video?a.video.frameHeight:0)||0,frameRate:(a.video?a.video.frameRate:0)||0,videoFps:c},audio:{currentDelay:(a.audio?a.audio.currentDelay:0)||0}})}catch(Lb){L.Logger.error(q,
"[tk-sdk]setStreamStats error info:"+Lb+"!")}c={streamId:b.getID(),peerId:b.extensionId.split(":")[0],stats:d};b.extensionId.split(":")[0]===l._myself.id&&H.socketSend("setStreamStats",c)}}function wb(a,b,c,d){V(a)&&(a=fa(a.extensionId));if(a)if(D.hasConnection(a.getID()))if(D.hasNativeConnection(a.getID())){var e=l._nativeStatsDelivered[a.extensionId];e?(L.Utils.isFunction(b)&&b(e),Bb(a,e)):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA")}else try{D.getConnectionStats(a.getID(),function(e){e?(e=T(a,e))?
(L.Utils.isFunction(b)&&b(e),Bb(a,e)):d?(L.Logger.warning(q,"[tk-sdk]pc.getStats -\x3enot get data!"),L.Utils.isFunction(c)&&c("TK_ERR_UNKNOWN")):wb(a,b,c,!0):(L.Logger.warning(q,"[tk-sdk]pc.getStats -\x3e getStats not exist!"),L.Utils.isFunction(c)&&c("TK_ERR_UNKNOWN"))},function(a){L.Logger.warning(q,"[tk-sdk]pc.getStats fail,fail info:",a);L.Utils.isFunction(c)&&c(a)})}catch(jb){L.Logger.error(q,"[tk-sdk]pc.getStats error:",jb),L.Utils.isFunction(c)&&c("TK_ERR_UNKNOWN")}else L.Utils.isFunction(c)&&
c("TK_ERR_NOT_PEERCONNECTION");else L.Logger.warning(q,"[tk-sdk]stream is not exist!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")}function Cb(a){var b=void 0,c;for(c in l._createStreams)a===c&&(b=fa(c));if(!b)for(c in t.remoteStreams)a===c&&(b=t.remoteStreams[c]);return b}function Db(a,b,c){if(a&&Cb(a)&&"object"===typeof b)if(l._nativeStatsDelivered[a]=l._nativeStatsDelivered[a]||{},l._nativeStatsDelivered[a].video=l._nativeStatsDelivered[a].video||{bitsPerSecond:0,packetsLost:0,totalPackets:0,
packetsLostRate:0,currentDelay:0,frameRate:0,frameWidth:0,frameHeight:0,timestamp:0,netquality:L.Utils.getNetLevel(0,0)},l._nativeStatsDelivered[a].audio=l._nativeStatsDelivered[a].audio||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,jitter:0,timestamp:0,netquality:L.Utils.getNetLevel(0,0)},c){c=(b.packetsLost-l._nativeStatsDelivered[a].video.packetsLost)/(b.totalPackets-l._nativeStatsDelivered[a].video.totalPackets)*100;l._nativeStatsDelivered[a].video.packetsLostRate=
isNaN(c)?0:100>=Math.round(c)?Math.round(c):100;for(var d in b)"timeStamp"===d?l._nativeStatsDelivered[a].video.timestamp=b[d]:"netQuality"===d?l._nativeStatsDelivered[a].video.netquality=b[d]:l._nativeStatsDelivered[a].video[d]=b[d]}else for(d in c=(b.packetsLost-l._nativeStatsDelivered[a].audio.packetsLost)/(b.totalPackets-l._nativeStatsDelivered[a].audio.totalPackets)*100,l._nativeStatsDelivered[a].audio.packetsLostRate=isNaN(c)?0:100>=Math.round(c)?Math.round(c):100,b)"timeStamp"===d?l._nativeStatsDelivered[a].audio.timestamp=
b[d]:"netQuality"===d?l._nativeStatsDelivered[a].audio.netquality=b[d]:l._nativeStatsDelivered[a].audio[d]=b[d];else!Cb(a)&&l._nativeStatsDelivered[a]&&(l._nativeStatsDelivered[a]=void 0,delete l._nativeStatsDelivered[a])}function Bb(a,b){a.networkStatus=b;b={userId:a.publisherId(),type:a.getAttributes().type,networkStatus:b};switch(a.getAttributes().type){case TK.STREAM_VIDEO:(new RegExp(a.publisherId()+":","g")).test(a.extensionId)&&(a=Ga(a),b.deviceId=a);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserNetworkStateChanged,
message:b},!1);t.dispatchEvent(a,!1);break;case TK.STREAM_MEDIA:case TK.STREAM_FILE:case TK.STREAM_SCREEN:a=TK.RoomEvent({type:"room-"+a.getAttributes().type+"networkstate-changed",message:b},!1),t.dispatchEvent(a,!1)}}function Pb(a,b,c){return L.Utils.speedNetwordk(l._web_protocol,a,b,c)}function Rb(a,b){if(a&&b&&(L.Logger.debug(q,"[tk-sdk]Process Signaling Message:",L.Utils.toJsonStringify(a)),a.sdp&&"answer"===a.type)){var c=a.sdp,d=c.indexOf("udp");if(-1!==d){var e="";b&&(e+="stream sdp info:stream id:"+
b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())+". \n");e+="udp info:"+(window.__TkSdkBuild__?L.Utils.encrypt(c.substr(d,58)):c.substr(d,58));L.Logger.info(q,e)}TK.isHiFi&&(a.sdp=L.Utils.setHiFiToSdp(a.sdp));a.sdp=L.Utils.setMaxBWToSdp(a.sdp);L.Logger.debug(q,"[tk-sdk]Set remote and local description");L.Logger.debug(q,"[tk-sdk]Remote Description",a.sdp);D.setRemoteDescription(b.getID(),a)}}function Ga(a){if(a.publisherId()===y()&&a.videoinputDeviceId)return a.videoinputDeviceId;
var b=new RegExp(a.publisherId()+":","g");return b.test(a.extensionId)?a.extensionId.replace(b,""):""}function Ab(a,b){return a.id===y()?TK.isMultiCamera?a["publishstate:"+b]||TK.PUBLISH_STATE_NONE:a.publishstate||TK.PUBLISH_STATE_NONE:void 0!==a.tk_maincamera?a["publishstate:"+b]||TK.PUBLISH_STATE_NONE:a.publishstate||TK.PUBLISH_STATE_NONE}function oa(a){return TK.isMultiCamera?l._myself["publishstate:"+a]||TK.PUBLISH_STATE_NONE:l._myself.publishstate||TK.PUBLISH_STATE_NONE}function Eb(){return l._myself.tk_mediafilestate||
TK.MEDIAFILESTATE_OFF}function Tb(a,b){TK.isMultiCamera?l._myself["publishstate:"+b]=a:l._myself.publishstate=a}function db(a,b){b=b||a;var c=oa(a.videoinputDeviceId);c===TK.PUBLISH_STATE_NONE&&t.remoteStreams[a.getID()]?ra(a):c>TK.PUBLISH_STATE_NONE&&ra(a,function(){c>TK.PUBLISH_STATE_NONE&&(O(b,!1),F(b,!1),Ca(b))})}function Wb(a,b){var c=fa(y()+":screen");L.Utils.isNull(c)?(c=Ba("screen",{video:!0,isWeb:!0}),c.mediaStream=a,c.needPublishToServer=!0,L.Logger.info(q,"[tk-sdk]calling screenPublish stream , stream id:"+
c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),void 0===t.remoteStreams[c.getID()]?Ca(c,void 0,function(a,c){a||L.Utils.isFunction(b)&&b(c,"[tk-sdk]please install the web sharing plug-in")}):(L.Logger.error(q,"[tk-sdk]Trying to publish invalid screenStream",c),L.Utils.isFunction(b)&&b(void 0,"[tk-sdk]Trying to publish invalid screenStream"))):(L.Utils.isFunction(b)&&b("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error(q,"[tk-sdk]Share screen in progress."))}
function Xb(a){D.closeWebScreen();var b=fa(y()+":"+TK.STREAM_SCREEN);L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning(q,"[tk-sdk]Could not find the specify stream while stop sharing screen.")):(b.needPublishToServer=!1,L.Logger.info(q,"[tk-sdk]calling unpublishScreen , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),ra(b,function(b,c){b||L.Utils.isFunction(a)&&a(c);U(y()+":"+TK.STREAM_SCREEN)&&
ea(y()+":"+TK.STREAM_SCREEN)}))}function Fb(a,b){for(var c=ba(TK.STREAM_VIDEO),d=0,e=c.length;d<e;d++){var f=c[d];a===L.Constant.deviceStorage.videoinput?TK.isMultiCamera||void 0!==b&&b!==f.videoinputDeviceId&&Ya(f,b):a===L.Constant.deviceStorage.audioinput&&void 0!==b&&b!==f.audioinputDeviceId&&eb(f,b)}}function Ya(a,b,c,d){if(b!==a.videoinputDeviceId||c){var e=oa(a.videoinputDeviceId);if(TK.isMultiCamera&&b!==a.videoinputDeviceId)e===TK.PUBLISH_STATE_NONE&&t.remoteStreams[a.getID()]?ra(a):e>TK.PUBLISH_STATE_NONE&&
(c=Z(b,!0),db(a,c));else{D.hasConnection(a.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn||a.removeVideoTrack();var f=a.videoinputDeviceId;a.videoinputDeviceId=b;l._playVideoStreams[a.extensionId]||e>TK.PUBLISH_STATE_NONE?TK.DeviceMgr.getVideoTrack(b,function(b){a.removeVideoTrack();a.addVideoTrack(b);e===TK.PUBLISH_STATE_NONE&&t.remoteStreams[a.getID()]?ra(a):D.hasConnection(a.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn?D.replaceVideoTrack(a.getID(),
b):db(a);U(a.extensionId)&&ea(a.extensionId);D.destroyVideoTrack(f)},function(c){L.Logger.info(q,"[tk-sdk]updateStreamVideoinputDeviceId:getDeviceVideoTrack fail,fain info is "+L.Utils.toJsonStringify(c)+",stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));fb(c,"videoinput",b)}):e===TK.PUBLISH_STATE_NONE&&t.remoteStreams[a.getID()]&&ra(a)}}}function eb(a,b,c){if(b!==a.audioinputDeviceId||c){var d=oa(a.videoinputDeviceId);D.hasConnection(a.getID())&&
L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn||a.removeAudioTrack();a.audioinputDeviceId=b;l._playAudioStreams[xa(a.publisherId(),a.getAttributes().type)]||l._registerAudioVolumeListeners[xa(a.publisherId(),a.getAttributes().type)]||d>TK.PUBLISH_STATE_NONE?TK.DeviceMgr.getAudioTrack(b,function(b){a.removeAudioTrack();a.addAudioTrack(b);d===TK.PUBLISH_STATE_NONE&&t.remoteStreams[a.getID()]?ra(a):D.hasConnection(a.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&
!TK.customStreamFn?D.replaceAudioTrack(a.getID(),b):db(a);U(a.extensionId)&&ea(a.extensionId);D.destroyAudioTrack(a.audioinputDeviceId)},function(c){L.Logger.info(q,"[tk-sdk]updateStreamAudioinputDeviceId:getDeviceAudioTrack fail,fain info is "+L.Utils.toJsonStringify(c)+",stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));fb(c,"audioinput",b)}):d===TK.PUBLISH_STATE_NONE&&t.remoteStreams[a.getID()]&&ra(a)}}function Ja(a,b){if(TK.isMultiCamera)if(L.Utils.isVideoinputDeviceIdFromDeviceList(a))if(l._mainCameraDeviceId!==
a){b=l._mainCameraDeviceId;l._isConnected&&l._myself.tk_maincamera!==a&&t.changeUserProperty(y(),"__all",{tk_maincamera:a});var c;b=TK.isMultiCamera?oa(b):l._myself.publishstate;(c=b===TK.PUBLISH_STATE_AUDIOONLY||b===TK.PUBLISH_STATE_BOTH)&&t.unpublishAudio();b=l._mainCameraDeviceId;l._mainCameraDeviceId=a;L.Logger.info(q,"[tk-sdk]change myself main camera device id,my id is "+y()+",change device id is "+l._mainCameraDeviceId+",old device id is "+b);L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,
l._mainCameraDeviceId);c&&t.publishAudio();l._registerAudioVolumeListeners[xa(y(),TK.STREAM_VIDEO)]&&(Z(b)&&Z(b).stopIntervalGetRealtimeVolume(),Z(l._mainCameraDeviceId)&&Z(l._mainCameraDeviceId).startIntervalGetRealtimeVolume());a=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:y()!==l._local_def_ext_id?y():"",deviceId:l._mainCameraDeviceId}});t.dispatchEvent(a)}else l._isConnected&&l._myself.tk_maincamera!==l._mainCameraDeviceId&&t.changeUserProperty(y(),"__all",{tk_maincamera:l._mainCameraDeviceId});
else L.Logger.warning(q,"[tk-sdk]set main camera is fail,the device id("+a+") is not in the video device list!"),L.Utils.isFunction(b)&&b("TK_ERR_DEVICE_ID_NOT_LIST");else L.Logger.warning(q,"[tk-sdk]set main camera is fail,not in a multi-camera environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_IN_MULTI_CAMERA_ENVIRONMENT")}function zb(a){var b=a.split(":");return b.length?b[0]:a}function Gb(a,b,c,d,e,f,h){if(P(d,!0))if(l._isLeaveRoom=!1,L.Utils.isNull(a)||L.Utils.isNull(b)||L.Utils.isNull(c)||
"object"!==typeof c)L.Logger.error(q,"[tk-sdk] startPlayback function got wrong arguments"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else{l._roomJsonOptions={};l._userJsonOptions=l._userJsonOptions||{};l._userJsonOptions.userProperties={};l._roomJsonOptions.video=!0;l._roomJsonOptions.audio=!0;l._roomJsonOptions.autoServer=L.Utils.isBoolean(c.autoServer)?c.autoServer:!0;l._testIP=e;l._testPort=f;L.Logger.info(q,"[tk-sdk]call startPlayback start!");var k=!1,w=!1,g=!1,A=l._web_host;M(a,l._webInterfaceHtmlPort,
function(a){k=!0;0===a&&(A=L.Utils.replaceHostname(l._web_host,l._serverName));k&&w&&!g&&(g=!0,Qa(A))});Vb(a,b,c,function(a,b,c){w=!0;b=TK.RoomEvent({type:TK.EVENT_TYPE.roomCheckroomPlayback,message:{ret:a,userinfo:b,roominfo:c}});t.dispatchEvent(b);0===a?k&&w&&!g&&(g=!0,Qa(A)):(b=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"checkroom playback",error:a,errorCode:a}}),t.dispatchEvent(b),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"checkroom playback",error:a,errorCode:a}}),
t.dispatchEvent(a))},h,d)}}function Hb(a,b){P(b,!0)&&(TK.isPlayback?L.Utils.isBoolean(a)?a?H.socketSend("pausePlayback"):H.socketSend("Playback"):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk] pausePlayback function got wrong arguments")):(L.Logger.warning(q,"[tk-sdk]No playback environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_PLAYBACK_ENVIRONMENT")))}function P(a,b){if(Za)return!0;b&&L.Logger.error(q,"[tk-sdk]The room is not initialized and cannot execute methods on the room class. Please call the init method for initialization!");
L.Utils.isFunction(a)&&a("TK_ERR_ROOM_NOT_INIT");return!1}function da(a,b){if(l._isConnected)return!0;b&&L.Logger.error(q,"[tk-sdk]The room has not been successfully connected yet. Please try again after the connection is successful!");L.Utils.isFunction(a)&&a("TK_ERR_ROOM_NOT_CONNECTED",window.TK_ERR.ROOM_NOT_CONNECT);return!1}function Ea(a,b,c){return b===TK.STREAM_VIDEO?a===y()?TK.isMultiCamera?a+":"+c:a:c?a+":"+c:a:a+":"+b}function xa(a,b){return a+":"+b}function Oa(a){return"publishstate"===
a?"":/publishstate:/g.test(a)?a.replace(/publishstate:/g,""):""}function ob(a,b,c,d,e,f){d=d||{};c===TK.STREAM_MEDIA||c===TK.STREAM_SCREEN||b!==y()?D.hasConnection(a)?(a=D.getConnectionVideoTrack(a))?L.Utils.isFunction(e)&&e(a):L.Utils.isFunction(f)&&f("TK_ERR_NOT_VIDEOTRACK"):L.Utils.isFunction(f)&&f("TK_ERR_NOT_PEERCONNECTION"):c===TK.STREAM_VIDEO?d.videoinputDeviceId?TK.DeviceMgr.getVideoTrack(d.videoinputDeviceId,function(a){L.Utils.isFunction(e)&&e(a);d.extensionId&&U(d.extensionId)&&ea(d.extensionId)},
function(a){fb(a,"videoinput",d.videoinputDeviceId);L.Utils.isFunction(f)&&f(a)}):L.Utils.isFunction(f)&&f("TK_ERR_NOT_VIDEOTRACK"):L.Utils.isFunction(f)&&f("TK_ERR_NOT_VIDEOTRACK")}function pb(a,b,c,d,e,f){c===TK.STREAM_MEDIA||b!==y()?D.hasConnection(a)?(a=D.getConnectionAudioTrack(a))?L.Utils.isFunction(e)&&e(a):L.Utils.isFunction(f)&&f("TK_ERR_NOT_AUDIOTRACK"):L.Utils.isFunction(f)&&f("TK_ERR_NOT_PEERCONNECTION"):c===TK.STREAM_VIDEO?d.audioinputDeviceId?TK.DeviceMgr.getAudioTrack(d.audioinputDeviceId,
function(a){L.Utils.isFunction(e)&&e(a);d.extensionId&&U(d.extensionId)&&ea(d.extensionId)},function(a){fb(a,"audioinput",d.audioinputDeviceId);L.Utils.isFunction(f)&&f(a)}):L.Utils.isFunction(f)&&f("TK_ERR_NOT_AUDIOTRACK"):L.Utils.isFunction(f)&&f("TK_ERR_NOT_AUDIOTRACK")}function qb(a,b){return l._registerAudioVolumeListeners[a+":"+b]}function gb(a){var b="";a===y()?TK.isMultiCamera&&(b=l._mainCameraDeviceId):(a=l._users[a])&&void 0!==a.tk_maincamera&&(b=a.tk_maincamera);return b}function fb(a,
b,c){if(c){var d=void 0,e="",f={};if("object"===typeof a){e=a.name;for(var l in a)if("code"===l||"name"===l||"message"===l)f[l]=a[l]}a=L.Utils.getUserMediaFailCode(e);"TypeError"===e&&(d={causeCode:window.TK_ERR.DEVICE_ERROR_TypeError,causeInfo:f});L.Logger.info(q,"[tk-sdk]device-not-available , error code is "+a+"  , kind is "+b+" , deviceId is "+c+",errorInfo:"+L.Utils.toJsonStringify(f));b={kind:b,deviceId:c};d&&(b.detailsInfo=d);d=TK.RoomEvent({type:TK.EVENT_TYPE.deviceNotAvailable,message:b},
{code:a});t.dispatchEvent(d)}}function Ta(a,b,c){c={userId:a.publisherId(),type:a.getAttributes().type,source:c};TK.isMultiCamera&&a.getAttributes().type===TK.STREAM_VIDEO&&(a=Ga(a),c.deviceId=a);(b=TK.RoomEvent({type:TK.EVENT_TYPE.roomErrorNotice,message:{code:b,info:c}},{errorCode:b,errorInfo:c}))&&t.dispatchEvent&&t.dispatchEvent(b)}function kb(a,b,c){c={userId:a.publisherId(),type:a.getAttributes().type,source:c};a.getAttributes().type===TK.STREAM_VIDEO&&(new RegExp(a.publisherId()+":","g")).test(a.extensionId)&&
(a=Ga(a),c.deviceId=a);(b=TK.RoomEvent({type:TK.EVENT_TYPE.roomErrorNotice,message:{code:b,info:c}},{errorCode:b,errorInfo:c}))&&t.dispatchEvent&&t.dispatchEvent(b)}function ab(){for(var a in l._playVideoStreams){var b=l._playVideoStreams[a],c=b.publisherId();if(c!==y()){var d=a.replace(new RegExp(c,"g"),y());l._createStreams[a]||l._playAudioStreams[xa(b.publisherId(),b.getAttributes().type)]||L.Utils.isFunction(b.updateExtensionId)&&b.updateExtensionId(d);l._playVideoStreams[d]=b;l._playVideoStreams[a]=
void 0;delete l._playVideoStreams[a]}}for(var e in l._playAudioStreams)b=l._playAudioStreams[e],a=b.extensionId,c=b.publisherId(),c!==y()&&(c=e.replace(new RegExp(c,"g"),y()),l._createStreams[a]||L.Utils.isFunction(b.updateExtensionId)&&b.updateExtensionId(d),l._playAudioStreams[c]=b,l._playAudioStreams[e]=void 0,delete l._playAudioStreams[e]);for(a in l._createStreams)b=l._createStreams[a],c=b.publisherId(),c!==y()&&(d=a.replace(new RegExp(c,"g"),y()),L.Utils.isFunction(b.updateExtensionId)&&b.updateExtensionId(d),
l._createStreams[d]=b,l._createStreams[a]=void 0,delete l._createStreams[a])}function nb(a){if(a){if(a.publisherId()!==y()||a.publisherId()===y()&&a.getAttributes().type===TK.STREAM_MEDIA){a.stopIntervalGetRealtimeVolume();var b=l._registerAudioVolumeListeners[xa(a.publisherId(),a.getAttributes().type)];b&&(b.onSuccess=void 0,b.onFailure=void 0,b.interval=100,b.isWaiting=!1,l._registerAudioVolumeListeners[xa(a.publisherId(),a.getAttributes().type)]=void 0,delete l._registerAudioVolumeListeners[xa(a.publisherId(),
a.getAttributes().type)])}l._nativeStatsDelivered[a.extensionId]=void 0;delete l._nativeStatsDelivered[a.extensionId]}}function hb(a){var b=!1,c;for(c in a)if(l._sdkUserProperty.hasOwnProperty(c)||/publishstate:/g.test(c)){b=!0;break}return b}var q={fileName:"Room.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};L.Logger.info(q,"[tk-sdk]browserInfo:"+L.Utils.toJsonStringify(L.Utils.getBrowserInfo())+",detectOS:"+L.Utils.detectOS());f=f||{};"object"!==typeof f&&(L.Logger.error(q,
"[tk-sdk]TK.Room roomOptios must is json!"),f={});f.autoSubscribeAV=void 0!==f.autoSubscribeAV?f.autoSubscribeAV:!1;var la={},l={},t=TK.EventDispatcher(la),Ua=void 0,na=void 0,qa=TK.NativeProxy,H=TK.Signalling,Aa=TK.PlayBackProvider,D=window.TK_MODULE.MediaControl,ka={},Za=!1,tb=null,Na=0,Ma=0,Pa=-1,Ra="",Sa="",La=0,$a="4",yb=!1,Da=[],za={},W={duration:0,outBytes:0,inBytes:0,outPackets:0,inPackets:0,outAudioKBitRate:0,inAudioKBitRate:0,outVideoKBitRate:0,inVideoKBitRate:0,audioDelay:0,videoDelay:0},
Ib=function(){l._web_protocol="https";l._doc_protocol="https";l._socket_protocol="https";l._backup_doc_protocol="https";l._web_host=void 0;l._old_web_host=void 0;l._web_port=void 0;l._doc_host=void 0;l._doc_port=void 0;l._socket_host=void 0;l._socket_port=void 0;l._backup_doc_host=void 0;l._backup_doc_host_list=[];l._backup_doc_port=void 0;l._room_uri=void 0;l._room_id=void 0;l._room_type=0;l._room_name=void 0;l._room_properties=void 0;l._room_max_videocount=6;l._configuration=void 0;l._testIP=void 0;
l._testPort=void 0;l._myself={id:""};l._serverList={};l._ipFalsificationName=void 0;l._serverName=void 0;l._isIpFalsification=!1;l._ipFalsification=void 0;l._isGetFileList=!1;l._recordfilepath=void 0;l._webInterfaceHtmlPort=8080;l._connectedNumber=0;l._isConnected=!1;l._handlerCallbackJson=!1;l._docServerAddr=void 0;l._hasDocServerAddrBackup=!1;l._roomCheckRoomInfoString="";l._createStreams={};l._playVideoStreams={};l._playAudioStreams={};l._roomJsonOptions={};l._userJsonOptions={};l._registerAudioVolumeListeners=
{};l._autoProcessDevChangeEvent=!1;l._durationTime={};l._myIp="0.0.0.0";l._video_codec=0;l._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;l._isSendAllPublishUserNetworkequipment=!0;l._room_filelist=[];l._users={};l._local_def_ext_id="_local_default_extension_id_";l._sentAloneNetQualityBadList={};l._mediaFileScale=!0;l._nativeStatsDelivered={};l._isLocalVideoMirror=!1;l._isLocalVideoMirrorList={};l._backupCourseAddrList=[];l._isLeaveRoom=!0;l._webReconnectNumList={};l._ipinfo={};l._devicePublishInfo={};
l._multiCameraAudioDevicePublishInfo={};l._mainCameraDeviceId="";l._videoProfileList={};l.isTkInvalidAppkey=!1;l._videoStreamAttrs={};l._videoStreamListAttrs={};l._useServerScreenRecording=!1;l._sdkUserProperty={id:!0,nickname:!0,role:!0,hasvideo:!0,hasaudio:!0,publishstate:!0,tk_maincamera:!0,tk_ip:!0,tk_area:!0,tk_carrier:!0,servername:!0,disablevideo:!0,disableaudio:!0,group:!0};l._tk_room_test_sdk=!1};Ib();TK.networkTestInfo.isConnectRoom=l._isConnected;t.remoteStreams={};t.localStreams={};t.init=
function(a,b,c,d,e){L.Logger.debug(q,"[tk-sdk] room-sdk initializing.");if(Za)L.Logger.error(q,"[tk-sdk]Already initialized,can the uninit method first if you need to initialize again!"),L.Utils.isFunction(c)&&c("TK_ERR_ALREADY_INIT");else{e=e||{};var h=L.Utils.isBoolean(e.isEncryption)?e.isEncryption:!1,k=L.Utils.isBoolean(e.tk_invalidappkey)?e.tk_invalidappkey:!1;if(!k){if(L.Utils.isNull(a)){L.Logger.error(q,"[tk-sdk] the appKey can not be empty when initializing room-sdk");L.Utils.isFunction(c)&&
c("TK_ERR_INVALID_ARG");return}if(h)if(L.Utils.isFunction(e.onDecode))a=e.onDecode(a);else{L.Logger.error(q,"[tk-sdk]Cipher decode algorithm function can't be empty, please introduced to encryption function configuration items (option.onDecode)!");L.Utils.isFunction(c)&&c("TK_ERR_NOT_DECODE_ALGORITHM_FUNCTION");return}window.TK.MD5&&L.Utils.isFunction(window.TK.MD5)?Ra=window.TK.MD5(a):(L.Logger.error(q,"[tk-sdk]Encryption method missing, please check if an encrypted file is introduced,please link MD5,for example: window.TK.MD5 \x3d md5"),
L.Utils.isFunction(c)&&c("TK_ERR_NOT_MD5_ENCRYPT"));Sa=a}yb=L.Utils.isBoolean(e.tk_question_compatibility)?e.tk_question_compatibility:!1;d=L.Utils.isBoolean(d)?d:!0;f.autoSubscribeAV=void 0!==e.autoSubscribeAV?e.autoSubscribeAV:f.autoSubscribeAV;l._isGetFileList=L.Utils.isBoolean(e.isGetFileList)?e.isGetFileList:!1;TK.isMultiCamera=L.Utils.isBoolean(e.tk_multistream)?e.tk_multistream:!1;l._useServerScreenRecording=L.Utils.isBoolean(e.useServerScreenRecording)?e.useServerScreenRecording:!1;e.tk_use_secure_socket=
L.Utils.isBoolean(e.tk_use_secure_socket)?e.tk_use_secure_socket:!0;Ua=L.Utils.isNumber(e.tk_max_reconnect_count)?e.tk_max_reconnect_count:void 0;l.isTkInvalidAppkey=k;l._tk_room_test_sdk=L.Utils.isBoolean(e.tk_room_test_sdk)?e.tk_room_test_sdk:!1;e.useHttpProtocol&&(e.tk_use_secure_socket=!1);e.tk_use_secure_socket?(l._web_protocol="https",l._doc_protocol="https",l._socket_protocol="https",l._backup_doc_protocol="https",l._webInterfaceHtmlPort=8080):(l._web_protocol="http",l._doc_protocol="http",
l._socket_protocol="http",l._backup_doc_protocol="http",l._webInterfaceHtmlPort=81);e.tk_host&&(l.tk_host=e.tk_host||"global.talk-cloud.net");e.tk_port&&(l.tk_port=e.tk_port||(e.tk_use_secure_socket?443:80));D.getDeviceMgr().getDevices(function(a){var c=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);c&&(TK.isTkNative?D.getDeviceMgr().setDevices({audiooutput:c}):D.getDeviceMgr().associateElementsToSpeaker(void 0,c));e&&!1!==e.isCheckDevice&&D.checkDeviceAvailability(a,function(){var a=
L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);a&&(TK.isTkNative?D.getDeviceMgr().setDevices({audiooutput:a}):D.getDeviceMgr().associateElementsToSpeaker(void 0,a));TK.isMultiCamera&&!l._mainCameraDeviceId&&(a=l._mainCameraDeviceId,l._mainCameraDeviceId=C(),L.Logger.info(q,"[tk-sdk]change myself main camera device id,my id is "+y()+",change device id is "+l._mainCameraDeviceId+",old device id is "+a),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:y()!==
l._local_def_ext_id?y():"",deviceId:l._mainCameraDeviceId}}),t.dispatchEvent(a));Za=!0;L.Utils.isFunction(b)&&(b(),window.onunload=function(){t.uninit()})},{findAvailabilityDevice:L.Utils.isBoolean(e.findAvailabilityDevice)?!TK.isTkNative&&e.findAvailabilityDevice:!1,onVideoSuccess:function(){var a=TK.RoomEvent({type:TK.EVENT_TYPE.deviceSuccess,message:{kind:"videoinput"}});t.dispatchEvent(a)},onAudioSuccess:function(){var a=TK.RoomEvent({type:TK.EVENT_TYPE.deviceSuccess,message:{kind:"audioinput"}});
t.dispatchEvent(a)},onVideoFailure:function(a){a&&"object"===typeof a&&(a=L.Utils.getUserMediaFailCode("object"===typeof a&&a.name),a=TK.RoomEvent({type:TK.EVENT_TYPE.deviceFailure,message:{kind:"videoinput"}},{code:a}),t.dispatchEvent(a))},onAudioFailure:function(a){a&&"object"===typeof a&&(a=L.Utils.getUserMediaFailCode("object"===typeof a&&a.name),a=TK.RoomEvent({type:TK.EVENT_TYPE.deviceFailure,message:{kind:"audioinput"}},{code:a}),t.dispatchEvent(a))}})},{isSetlocalStorage:!0})}};t.uninit=function(a,
b){Za&&t.leaveroom();for(var c in l._createStreams)ea(c);D.destroyAllVideoTrack();D.destroyAllAudioTrack();TK.isPlayback=!1;Za=TK.isMultiCamera=!1;Sa=Ra="";Ua=void 0;Ma=0;Pa=-1;Na=0;tb=null;La=0;Ib();TK.networkTestInfo.isConnectRoom=l._isConnected;ab();L.Utils.isFunction(a)&&a()};t.checkInit=function(a,b){return P(a,b)};t.setLogIsDebug=function(a,b,c){a=a||!1;c=c||!1;TK.tkLogPrintConfig({debug:a},{development:a,logLevel:void 0!==b&&"number"===typeof b?b:a?L.Constant.LOGLEVEL.DEBUG:L.Constant.LOGLEVEL.INFO},
{webrtcLogDebug:a});L.Logger.setIsFormatLog(c)};t.registerLogListener=function(a){L.Logger.registerLogListener(a)};t.getFileList=function(){return l._room_filelist};t.getFileinfo=function(a){for(var b=void 0,c=0,d=l._room_filelist.length;c<d;c++)if(l._room_filelist[c]&&l._room_filelist[c].fileid==a){b=l._room_filelist[c];break}return b};t.getDeviceMgr=function(){return D.getDeviceMgr()};t.getRoomProperties=function(){return l._room_properties};t.getMySelf=function(){return l._myself};t.getUser=function(a){if(void 0!==
a)return l._users[a]};t.getUsers=function(){return l._users};t.changeUserPropertyByRole=function(a,b,c){P(void 0,!0)&&da(void 0,!0)&&(Array.isArray(a)?"object"!==typeof c?L.Logger.error(q,"[tk-sdk]changeUserPropertyByRole properties params must is json !"):t.changeUserProperty({roles:a},b,c):L.Logger.error(q,"[tk-sdk]changeUserPropertyByRole roles params must is array!"))};t.batchChangeUserProperty=function(a,b,c){if(P(void 0,!0)&&da(void 0,!0))if(Array.isArray(a))if("object"!==typeof c)L.Logger.error(q,
"[tk-sdk]batchChangeUserProperty properties params must is json !");else{if(l._roomMode!==window.TK.ROOM_MODE.BIG_ROOM)for(var d=a.length-1;0<=d;d--)a[d]&&!l._users[a[d]]&&(L.Logger.warning(q,"[tk-sdk]batchChangeUserProperty:user is not exist, user id: "+a[d]+" !"),a.splice(d,1));t.changeUserProperty({ids:a},b,c)}else L.Logger.error(q,"[tk-sdk]batchChangeUserProperty ids params must is array!")};t.changeUserProperty=function(a,b,c){if(P(void 0,!0)&&da(void 0,!0))if(void 0===c||void 0===a)L.Logger.error(q,
"[tk-sdk]changeUserProperty properties or id is not exist!");else if("object"!==typeof c)L.Logger.error(q,"[tk-sdk]changeUserProperty properties must is json !");else{if(TK.isOnlyAudioRoom)for(var d in c)"publishstate"!==d&&!/publishstate:/g.test(d)||c[d]!==TK.PUBLISH_STATE_VIDEOONLY&&c[d]!==TK.PUBLISH_STATE_BOTH||delete c[d];var e={};e.id=a;e.toID=b||"__all";c.hasOwnProperty("id")&&(L.Logger.warning(q,"[tk-sdk]Method changeUserProperty cannot modify the id properties"),delete c.id);e.properties=
c;if("object"===typeof a){if(a.hasOwnProperty("ids")&&Array.isArray(a.ids))for(var f in a.ids)if(a.ids[f]===y()){for(d in c)"publishstate"===d||/publishstate:/g.test(d)?l._myself[d]=c[d]:"tk_maincamera"===d?l._myself[d]=c[d]:"tk_screenstate"===d?l._myself[d]=c[d]:"tk_mediafilestate"===d&&(l._myself[d]=c[d]);hb(c)&&L.Logger.info(q,"[tk-sdk]change myself property,my id is "+y()+",change property:"+L.Utils.toJsonStringify(c))}if(a.hasOwnProperty("roles")&&Array.isArray(a.roles))for(f in a.roles)if(a.roles[f]===
l._myself.role){for(d in c)"publishstate"===d||/publishstate:/g.test(d)?l._myself[d]=c[d]:"tk_maincamera"===d?l._myself[d]=c[d]:"tk_screenstate"===d?l._myself[d]=c[d]:"tk_mediafilestate"===d&&(l._myself[d]=c[d]);hb(c)&&L.Logger.info(q,"[tk-sdk]change myself property,my id is "+y()+",change property:"+L.Utils.toJsonStringify(c))}}else{if(l._roomMode!==window.TK.ROOM_MODE.BIG_ROOM&&!l._users[a]){L.Logger.error(q,"[tk-sdk]changeUserProperty:user is not exist , user id: "+a+"!");return}if(a===y()){for(d in c)"publishstate"===
d||/publishstate:/g.test(d)?l._myself[d]=c[d]:"tk_maincamera"===d?l._myself[d]=c[d]:"tk_screenstate"===d?l._myself[d]=c[d]:"tk_mediafilestate"===d&&(l._myself[d]=c[d]);hb(c)&&L.Logger.info(q,"[tk-sdk]change myself property,my id is "+y()+",change property:"+L.Utils.toJsonStringify(c))}}L.Utils.getJsonLength(e.properties)&&H.sendMessageSocket("setProperty",e)}};t.sendMessage=function(a,b,c){if(P(void 0,!0)&&da(void 0,!0)){var d={};d.toID=b||"__all";b={};if("string"===typeof a){var e=L.Utils.toJsonParse(a);
"object"!==typeof e&&(e=a);a=e}if("object"===typeof a)for(var f in a)b[f]=a[f];else b.msg=a;"string"===typeof c&&(c=L.Utils.toJsonParse(c));if(c&&"object"===typeof c)for(f in c)b[f]=c[f];d.message=L.Utils.toJsonStringify(b);H.sendMessageSocket("sendMessage",d)}};t.pubMsg=function(a){if(P(void 0,!0)&&da(void 0,!0))if("object"!==typeof a)L.Logger.error(q,"[tk-sdk]pubMsg params must is json!");else{var b={};b.name=a.name||a.msgName;b.id=a.id||a.msgId||b.name;b.toID=a.toID||a.toId||"__all";b.data=a.data;
a.save||(b.do_not_save="");void 0!==a.associatedMsgID&&(b.associatedMsgID=a.associatedMsgID);void 0!==a.associatedUserID&&(b.associatedUserID=a.associatedUserID);var c={},d;for(d in a)void 0===b[d]&&void 0!==a[d]&&"save"!==d&&"name"!==d&&"msgName"!==d&&"id"!==d&&"msgId"!==d&&"toID"!==d&&"toId"!==d&&"data"!==d&&"associatedMsgID"!==d&&"associatedUserID"!==d&&(c[d]=a[d]);for(d in c)void 0===b[d]&&"save"!==d&&(b[d]=c[d]);void 0===b.name||null===b.name?L.Logger.error(q,"[tk-sdk]pubMsg name is must exist!"):
("DocumentChange"===b.name&&"__allExceptSender"===b.toID&&(a=L.Utils.toJsonParse(L.Utils.toJsonStringify(b)),a.fromID=y(),a&&a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data)),bb(a)),H.sendMessageSocket("pubMsg",b))}};t.delMsg=function(a){if(P(void 0,!0)&&da(void 0,!0))if("object"!==typeof a)L.Logger.error(q,"[tk-sdk]delMsg params must is json!");else{if(1===arguments.length&&a&&"object"===typeof a){var b=a.name||a.msgName;var c=a.id||a.msgId;var d=a.toID||a.toId;var e=a.data}else b=
arguments[0],c=arguments[1],d=arguments[2],e=arguments[3];var f={};f.name=b;f.id=c||f.name;f.toID=d||"__all";f.data=e||{};void 0===f.name||null===f.name?L.Logger.error(q,"[tk-sdk]delMsg name is must exist!"):void 0===f.id||null===f.id?L.Logger.error(q,"[tk-sdk]delMsg id is must exist!"):H.sendMessageSocket("delMsg",f)}};t.evictUser=function(a,b){if(P(void 0,!0)&&da(void 0,!0)){L.Logger.debug(q,"[tk-sdk]evictUser",a);var c={};c.id=a;if(b&&"object"===typeof b)for(var d in b)c[d]=b[d];H.sendMessageSocket("evictParticipant",
c)}};t.joinroom=function(a,b,c,d,e,f,h,k){if(P(void 0,!0))if(l._isConnected)L.Logger.warning(q,"[tk-sdk]Room already connected!");else{Ma=Na=0;Pa=-1;La=0;a=a||"global.talk-cloud.net";b=b||(/https/g.test(l._web_protocol)?443:80);L.Logger.info(q,"[tk-sdk]call joinroom start!");l._myself={id:""};ab();l._isLeaveRoom=!1;l._webReconnectNumList={};g({web_host:a,web_port:b});l._roomJsonOptions="object"===typeof e?e:{};l._userJsonOptions=l._userJsonOptions||{};l._userJsonOptions.userProperties=f||{};l._roomJsonOptions.video=
!0;l._roomJsonOptions.audio=!0;l._roomJsonOptions.autoServer=L.Utils.isBoolean(l._roomJsonOptions.autoServer)?l._roomJsonOptions.autoServer:!0;l._testIP=h;l._testPort=k;e={serial:l._roomJsonOptions.serial,password:l._roomJsonOptions.password||""};l.isTkInvalidAppkey||(e.version=1,e.authkey=Ra,e.key=Sa);c&&(e.nickname=c);var w=!1,A=!1,m=!1,n=l._web_host;M(a,l._webInterfaceHtmlPort,function(a){w=!0;0===a&&(n=L.Utils.replaceHostname(l._web_host,l._serverName));w&&A&&!m&&(m=!0,Qa(n))});l._roomJsonOptions.checkroomParamsUrl&&
!l.isTkInvalidAppkey&&(l._roomJsonOptions.checkroomParamsUrl+="\x26version\x3d1\x26authkey\x3d"+Ra+"\x26key\x3d"+Sa);ub(a,b,l._roomJsonOptions.checkroomParamsUrl?l._roomJsonOptions.checkroomParamsUrl:e,function(a,b,c){function d(a){try{var b=function(a){if(L.Utils.isArray(a)){var b="";a.forEach(function(a){b+=JSON.stringify(a)+"\n"})}a=pako.gzip(b,{to:"string"});return btoa(a)};L.Logger.getAllLog(a,function(a){if(L.Utils.isArray(a)){var c=null;(c=a.filter(function(a,b){if(a&&a.peerid)return a.peerid===
TK.myPeerid&&a.ts>TK.logTs}))&&c.length&&c[c.length-1]&&(TK.logTs=c[c.length-1].ts);c&&c.length&&(a=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/jsanalysisLog?ts\x3d"+(new Date).getTime(),L.Utils.sdkAjax({url:a,dataType:"json",type:"POST",anync:!0,data:b(c),success:function(a){L.Logger.debug(q,"[tk-sdk]send logs \x3d ",L.Utils.toJsonStringify(a))},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]send logs fail[ XHR , textStatus , errorThrown ]:",a,b,c)}}))}else L.Logger.debug(q,"[tk-sdk]getAllLog error , Because the return value is not an array!")});
L.Logger.keep(.16)}catch(Qb){L.Logger.error(q,"[tk-sdk]gzip is null or error info:",Qb)}}A=!0;var e=TK.RoomEvent({type:TK.EVENT_TYPE.roomCheckroom,message:{ret:a,userinfo:b,roominfo:c}});t.dispatchEvent(e);0===a?w&&A&&!m&&(m=!0,Qa(n)):(e=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"checkroom",error:a,errorCode:a}}),t.dispatchEvent(e),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"checkroom",error:a,errorCode:a}}),t.dispatchEvent(a));c&&c.room&&c.room.serial&&(TK.mySerial=
c.room.serial);b&&b.id&&(TK.myPeerid=b.id);q.peerid=TK.myPeerid?TK.myPeerid:"";q.serial=TK.mySerial?TK.mySerial:"";d($a);window.setInterval(function(){d($a)},18E4)},d)}};t.joinRoomEx=function(a,b,c,d){if(P(void 0,!0))if(l._isConnected)L.Logger.warning(q,"[tk-sdk]Room already connected!");else{a||L.Logger.error(q,"[tk-sdk]joinRoomEx roomId is null!");Ma=Na=0;Pa=-1;La=0;var e=l.tk_host||"global.talk-cloud.net",f=l.tk_port||(/https/g.test(l._web_protocol)?443:80);L.Logger.info(q,"[tk-sdk]call joinroom start!");
l._myself={id:""};ab();l._isLeaveRoom=!1;l._webReconnectNumList={};g({web_host:e,web_port:f});l._roomJsonOptions={thirdroomid:a};l._userJsonOptions=l._userJsonOptions||{};l._userJsonOptions.userProperties=d||{};l._roomJsonOptions.video=!0;l._roomJsonOptions.audio=!0;l._roomJsonOptions.autoServer=L.Utils.isBoolean(l._roomJsonOptions.autoServer)?l._roomJsonOptions.autoServer:!0;a={thirdroomid:l._roomJsonOptions.thirdroomid};l.isTkInvalidAppkey||(a.version=1,a.authkey=Ra,a.key=Sa);b&&(a.nickname=b);
var h=!1,k=!1,w=!1,A=l._web_host;M(e,l._webInterfaceHtmlPort,function(a){h=!0;0===a&&(A=L.Utils.replaceHostname(l._web_host,l._serverName));h&&k&&!w&&(w=!0,Qa(A))});l._roomJsonOptions.checkroomParamsUrl&&!l.isTkInvalidAppkey&&(l._roomJsonOptions.checkroomParamsUrl+="\x26version\x3d1\x26authkey\x3d"+Ra+"\x26key\x3d"+Sa);ub(e,f,l._roomJsonOptions.checkroomParamsUrl?l._roomJsonOptions.checkroomParamsUrl:a,function(a,b,c){function d(a){try{var b=function(a){if(L.Utils.isArray(a)){var b="";a.forEach(function(a){b+=
JSON.stringify(a)+"\n"})}a=pako.gzip(b,{to:"string"});return btoa(a)};L.Logger.getAllLog(a,function(a){if(L.Utils.isArray(a)){var c=null;(c=a.filter(function(a,b){if(a&&a.peerid)return a.peerid===TK.myPeerid&&a.ts>TK.logTs}))&&c.length&&c[c.length-1]&&(TK.logTs=c[c.length-1].ts);c&&c.length&&(a=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/jsanalysisLog?ts\x3d"+(new Date).getTime(),L.Utils.sdkAjax({url:a,dataType:"json",type:"POST",anync:!0,data:b(c),success:function(a){L.Logger.debug(q,
"[tk-sdk]send logs \x3d ",L.Utils.toJsonStringify(a));L.Logger.keep(.28)},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]send logs fail[ XHR , textStatus , errorThrown ]:",a,b,c)}}))}else L.Logger.debug(q,"[tk-sdk]getAllLog error , Because the return value is not an array!")})}catch(Ob){L.Logger.error(q,"[tk-sdk]gzip is null or error info:",Ob)}}k=!0;var e=TK.RoomEvent({type:TK.EVENT_TYPE.roomCheckroom,message:{ret:a,userinfo:b,roominfo:c}});t.dispatchEvent(e);0===a?h&&k&&!w&&(w=!0,Qa(A)):(e=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,
message:{source:"checkroom",error:a,errorCode:a}}),t.dispatchEvent(e),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"checkroom",error:a,errorCode:a}}),t.dispatchEvent(a));c&&c.room&&c.room.serial&&(TK.mySerial=c.room.serial);b&&b.id&&(TK.myPeerid=b.id);q.peerid=TK.myPeerid?TK.myPeerid:"";q.serial=TK.mySerial?TK.mySerial:"";d($a);window.setInterval(function(){d($a)},18E4)},c)}};t.leaveroom=function(a){if(P(void 0,!0)){a=a||!1;l._isLeaveRoom=!0;clearInterval(t._networkequipmentTimer);
clearInterval(t._catonNumber);clearInterval(t.sendcatonNumber);clearTimeout(l._webReconnectNumList.checkroomReconnectTimer);l._webReconnectNumList.checkroomReconnectTimer=void 0;clearTimeout(l._webReconnectNumList.getFalsificationIpReconnectTimer);l._webReconnectNumList.getFalsificationIpReconnectTimer=void 0;clearTimeout(l._webReconnectNumList.getConfigReconnectTimer);l._webReconnectNumList.getConfigReconnectTimer=void 0;L.Logger.debug(q,"[tk-sdk]leaveroom:Disconnection requested");p();try{H&&H.socketDisconnect&&
H.socketDisconnect()}catch(ma){L.Logger.warning(q,"[tk-sdk]Socket already disconnected , disconnect errorInfo:",ma)}H&&H.emptySocket&&H.emptySocket();l._isConnected=!1;TK.networkTestInfo.isConnectRoom=!1;Ma=Na=0;Pa=-1;La=0;na&&na.changeCommonWhiteBoardConfigration&&na.changeCommonWhiteBoardConfigration({isConnectedRoom:l._isConnected});a=TK.RoomEvent({type:TK.EVENT_TYPE.roomLeaveRoom,message:a});t.dispatchEvent(a)}};t.startServerRecord=function(a){if(P(void 0,!0)&&da(void 0,!0)){a=a||{};var b=L.Utils.isNull(a.recordType)?
TK.REC_TYPE_VIDEOLIST:a.recordType;b!==TK.REC_TYPE_RECFILE&&b!==TK.REC_TYPE_VIDEOLIST&&b!==TK.REC_TYPE_MP3&&b!==TK.REC_TYPE_MIXVIDEO&&(b=TK.REC_TYPE_VIDEOLIST);var c=void 0!==a.recordChat&&"boolean"===typeof a.recordChat?a.recordChat:!0,d=L.Utils.isNull(a.convert)?0:a.convert;a=L.Utils.isNull(a.layout)?0:a.layout;b={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{recordtype:b,convert:d,layout:a},save:!0};c&&(b.data.recordchat=!0);b.data=L.Utils.toJsonStringify(b.data);t.pubMsg(b)}};t.stopServerRecord=
function(){if(P(void 0,!0)&&da(void 0,!0)){var a={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{}};a.data=L.Utils.toJsonStringify(a.data);t.delMsg(a)}};t.uploadRoomFile=function(a,b,c,d,e,f,l){if(P(f,!0)&&da(function(a,b){L.Utils.isFunction(f)&&f(b,a)},!0)){l=l||{};l.isWritedb=L.Utils.isBoolean(l.isWritedb)?l.isWritedb:!1;if(a&&b&&c){a=t.getUploadFileParams(a,b,l.isWritedb,l.qRCodeId);b=new FormData;for(var h in a)b.append(h,a[h]);b.append("filedata",c);return z(b,d,e,f)}L.Logger.error(q,"[tk-sdk] uploadRoomFile method got invalid arguments");
L.Utils.isFunction(f)&&f(window.TK.ERROR_NOTICE.ERR_BAD_PARAMETERS,"TK_ERR_INVALID_ARG")}};t.deleteRoomFile=function(a,b,c){P(void 0,!0)&&da(function(a,b){L.Utils.isFunction(c)&&c(b,a)},!0)&&(void 0===a||null===a?(L.Logger.error(q,"[tk-sdk] deleteRoomFile method got invalid arguments"),L.Utils.isFunction(c)&&c(window.TK.ERROR_NOTICE.ERR_BAD_PARAMETERS,"TK_ERR_INVALID_ARG")):I(a,b,c))};t.setAutoProcessDeviceChangeEvent=function(a){L.Utils.isBoolean(a)&&(l._autoProcessDevChangeEvent=a)};t.requestServerList=
function(b,c,d,e,f){f=f||{};P(e,!0)&&(L.Utils.getJsonLength(l._serverList)?L.Utils.isFunction(d)&&(a(l._serverList,l._serverName),d(l._serverList)):b&&c?(L.Logger.debug(q,"[tk-sdk]Going to requestServerList"),b=(f.protocol||l._web_protocol)+"://"+b+":"+c+"/ClientAPI/getserverarea?ts\x3d"+(new Date).getTime(),L.Utils.sdkAjax({url:b,type:"post",async:!0,success:function(b){L.Logger.info(q,"[tk-sdk]webInterfaceGetserver resp \x3d ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(b)):L.Utils.toJsonStringify(b));
b=L.Utils.toJsonParse(b);var c=b.result;l._serverList={};if(0==c&&void 0!==b.serverarealist){for(var f in b.serverarealist)c=b.serverarealist[f],l._serverList[c.serverareaname]=c;L.Utils.isFunction(d)&&(a(l._serverList,l._serverName),d(l._serverList))}else L.Logger.info(q,"[tk-sdk]webInterfaceGetserver resp.serverarealist is not exist , nRet:"+c),L.Utils.isFunction(e)&&e(c,b)},error:function(a){L.Logger.error(q,"[tk-sdk]webInterfaceGetserver fail[readyState-status]:",a);L.Utils.isFunction(e)&&e(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,
"TK_ERR_HTTP_REQUEST_FAILED")}})):(L.Logger.error(q,"[tk-sdk]requestServerList host or port is not exist!"),L.Utils.isFunction(e)&&e(window.TK.ERROR_NOTICE.ERR_BAD_PARAMETERS,"TK_ERR_INVALID_ARG")))};t.switchServer=function(a){t.switchServerByName(a)};t.publishVideo=function(a){if(P(void 0,!0)&&da(void 0,!0))if(TK.isOnlyAudioRoom)L.Logger.warning(q,"[tk-sdk]only audio room not execute method publishVideo method !");else if(TK.isMultiCamera&&!L.Utils.isVideoinputDeviceIdFromDeviceList(a))L.Logger.warning(q,
"[tk-sdk]publishVideo is fail,the device id("+a+") is not in the video device list!");else{var b=oa(a);b!==TK.PUBLISH_STATE_VIDEOONLY&&b!==TK.PUBLISH_STATE_BOTH&&(b=b===TK.PUBLISH_STATE_MUTEALL||b===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_BOTH,t.changeUserPublish(y(),b,a))}};t.unpublishVideo=function(a){if(P(void 0,!0)&&da(void 0,!0))if(TK.isOnlyAudioRoom)L.Logger.warning(q,"[tk-sdk]only audio room not execute method unpublishVideo method !");else{var b=oa(a);b!==TK.PUBLISH_STATE_NONE&&
b!==TK.PUBLISH_STATE_AUDIOONLY&&(b=b===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_NONE,t.changeUserPublish(y(),b,a))}};t.publishAudio=function(){if(P(void 0,!0)&&da(void 0,!0)){var a=oa(l._mainCameraDeviceId);a!==TK.PUBLISH_STATE_AUDIOONLY&&a!==TK.PUBLISH_STATE_BOTH&&(a=a===TK.PUBLISH_STATE_MUTEALL||a===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_BOTH,t.changeUserPublish(y(),a,l._mainCameraDeviceId))}};t.unpublishAudio=function(){if(P(void 0,!0)&&da(void 0,
!0)){var a=oa(l._mainCameraDeviceId);a!==TK.PUBLISH_STATE_NONE&&a!==TK.PUBLISH_STATE_VIDEOONLY&&(a=a===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_NONE,t.changeUserPublish(y(),a,l._mainCameraDeviceId))}};t.playRemoteMedia=function(a,b,c,d){P(d,!0)&&(c=c||{},rb(a,b,c,d,TK.STREAM_MEDIA,"playRemoteMedia"))};t.unplayRemoteMedia=function(a,b){P(b,!0)&&cb(a,b,TK.STREAM_MEDIA,"unplayRemoteMedia")};t.playRemoteMediaFile=function(a,b,c,d){P(d,!0)&&(c=c||{},rb(a,b,c,d,TK.STREAM_FILE,"playRemoteMediaFile"))};
t.unplayRemoteMediaFile=function(a,b){P(b,!0)&&cb(a,b,TK.STREAM_FILE,"unplayRemoteMediaFile")};t.playRemoteScreen=function(a,b,c,d){P(d,!0)&&(a===y()?L.Utils.isFunction(d)&&d("TK_ERR_NOT_PLAY_SELF_SCREEN"):(c=c||{},rb(a,b,c,d,TK.STREAM_SCREEN,"playRemoteScreen")))};t.playVideoOnDemand=function(a,b,c){c=c||{};if(!a||!b||"string"!==typeof a||"string"!==typeof b)return L.Logger.error(q,"[tk-sdk]Illegal parameter in function playVideoOnDemand, params is:",a,b,c);var d=document.getElementById(b);if(!d)return L.Logger.error(q,
"[tk-sdk]Can not found the element by id ",b);b=document.createElement("video");var e=document.createElement("source");b.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;z-index:999;top:0;");b.setAttribute("autoplay","true");b.setAttribute("class","tk_video_on_demand");b.setAttribute("controls","true");e.setAttribute("src",a);if(c)for(var f in c)try{b.setAttribute(f,c[f])}catch(ib){L.Logger.error(q,"[tk-sdk]Catch set attribute exception,info is:"+ib)}b.appendChild(e);
d.appendChild(b)};t.stopVideoOnDemand=function(a){if(!a||"string"!==typeof a)return L.Logger.error(q,"[tk-sdk]Illegal parameter in function playVideoOnDemand, params is:",a);var b=document.getElementById(a);if(!b)return L.Logger.error(q,"[tk-sdk]Can not found the element by id ",b);a=b.getElementsByClassName("tk_video_on_demand");Array.prototype.forEach.call(a,function(a){try{b.removeChild(a)}catch(xb){L.Logger.error(q,"[tk-sdk]Catch stop video on demand exception,info is:"+xb)}})};t.unplayRemoteScreen=
function(a,b){P(b,!0)&&(a===y()?L.Utils.isFunction(b)&&b("TK_ERR_NOT_UNPLAY_SELF_SCREEN"):cb(a,b,TK.STREAM_SCREEN,"unplayRemoteScreen"))};t.setRemoteAudioVolume=function(a,b,c,d){if(P(void 0,!0))if(""===b&&(b=y()),L.Utils.isNull(b))L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk]setRemoteAudioVolume method got invalid userId!");else if("number"!==typeof a)L.Logger.error(q,"[tk-sdk] setRemoteAudioVolume method volume muset is number!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG");
else if(b===y()||l._users[b]){d=d||TK.STREAM_VIDEO;var e=void 0;d===TK.STREAM_VIDEO&&(e=gb(b));(d=aa(b,d,e))?d.setVolume(a):(L.Logger.debug(q,"[tk-sdk] setRemoteAudioVolume: user is not stream  , user id is "+b),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM"))}else L.Logger.debug(q,"[tk-sdk]setRemoteAudioVolume:user is not exist,user id is "+b+"!"),L.Utils.isFunction(c)&&c("TK_ERR_NOT_USER")};t.getAudioVolume=function(a,b,c,d){if(P(void 0,!0))if(""===a&&(a=y()),L.Utils.isNull(a))L.Utils.isFunction(c)&&
c("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk]getAudioVolume method got invalid userId!");else if(L.Utils.isFunction(b))if(a===y()||l._users[a]){d=d||TK.STREAM_VIDEO;var e=void 0;d===TK.STREAM_VIDEO&&(e=gb(a));(d=aa(a,d,e))?d.getRealtimeVolume(b,c):(L.Logger.debug(q,"[tk-sdk] getAudioVolume: user has not stream, user id is "+a),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM"))}else L.Logger.debug(q,"[tk-sdk]setRemoteAudioVolume:user is not exist,user id is "+a+"!"),L.Utils.isFunction(c)&&c("TK_ERR_NOT_USER");
else L.Logger.error(q,"[tk-sdk] getAudioVolume: onVolume is not function"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")};t.registerAudioVolumeListener=function(a,b,c,d,e){if(P(d,!0))if(""===a&&(a=y()),L.Utils.isNull(a))L.Logger.error(q,"[tk-sdk] registerAudioVolumeListener: userId is invalid"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else if("number"!==typeof b)L.Logger.error(q,"[tk-sdk] registerAudioVolumeListener: msInterval is invalid"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else if(L.Utils.isFunction(c))if(a===
y()||l._users[a]){50>b&&(b=50);var f=e||TK.STREAM_VIDEO,h=void 0;f===TK.STREAM_VIDEO&&(h=gb(a));e=aa(a,f,h);var k=function(){setTimeout(function(){var e=aa(a,f,h);e?(l._registerAudioVolumeListeners[a+":"+f]={onSuccess:c,interval:L.Utils.isNumber(b)?b:100,onFailure:d,isWaiting:!0},e.stopIntervalGetRealtimeVolume(),TK.isTkNative?e.startIntervalGetRealtimeVolume(c,b,d):e.startIntervalGetRealtimeVolume()):k()},500)};e?(l._registerAudioVolumeListeners[a+":"+f]={onSuccess:c,interval:L.Utils.isNumber(b)?
b:100,onFailure:d,isWaiting:!0},e.stopIntervalGetRealtimeVolume(),TK.isTkNative?e.startIntervalGetRealtimeVolume(c,b,d):e.startIntervalGetRealtimeVolume()):(k(),L.Logger.debug(q,"[tk-sdk] registerAudioVolumeListener: user has not stream, user id is "+a),L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"))}else L.Logger.debug(q,"[tk-sdk]registerAudioVolumeListener:user is not exist,user id is "+a+"!"),L.Utils.isFunction(d)&&d("TK_ERR_NOT_USER");else L.Logger.error(q,"[tk-sdk] registerAudioVolumeListener: onVolume is not function"),
L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")};t.unregisterAudioVolumeListener=function(a,b,c){if(P(void 0,!0))if(""===a&&(a=y()),L.Utils.isNull(a))L.Logger.error(q,"[tk-sdk] unregisterAudioVolumeListener: userId is invalid"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG");else if(a===y()||l._users[a]){c=c||TK.STREAM_VIDEO;var d=void 0;c===TK.STREAM_VIDEO&&(d=gb(a));var e=l._registerAudioVolumeListeners[a+":"+c];e&&(e.onSuccess=void 0,e.onFailure=void 0,e.interval=100,e.isWaiting=!1,l._registerAudioVolumeListeners[a+
":"+c]=void 0,delete l._registerAudioVolumeListeners[a+":"+c]);(c=aa(a,c,d))?c.stopIntervalGetRealtimeVolume():(L.Logger.debug(q,"[tk-sdk] unregisterAudioVolumeListener: user has not stream, user id is "+a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM"))}else L.Logger.debug(q,"[tk-sdk]setRemoteAudioVolume:user is not exist,user id is "+a+"!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_USER")};t.switchOnlyAudioRoom=function(a){if(P(void 0,!0)){var b={};a?(TK.needOnlyAudioRoom=1,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",
toID:"__all",data:b,save:!0},t.pubMsg(a)):(TK.needOnlyAudioRoom=2,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b},t.delMsg(a))}};t.startShareMedia=function(a,b,c,d){function e(){L.Logger.info(q,"[tk-sdk]calling startShareMedia  , url is "+a+" , isVideo is "+b+" , options is "+L.Utils.toJsonStringify(d));pa("publish",{state:"url",data:h.data,audio:h.audio,video:h.video,attributes:h.attributes,extensionId:h.extensionId,metadata:void 0,createOffer:void 0},h.url,function(b,d){0===b?L.Logger.debug(q,
"[tk-sdk]mediaStream published , stream id:"+d+" , extensionId is "+h.extensionId+", attrs is "+L.Utils.toJsonStringify(h.attributes)):(L.Logger.warning(q,"[tk-sdk]Error when publishing mediaStream",b,d),L.Logger.info(q,"[tk-sdk]stream-publish-fail , stream url:"+a+" , extensionId is "+h.extensionId+", attrs is "+L.Utils.toJsonStringify(h.attributes)),L.Utils.isFunction(c)&&c(b))})}if(P(c,!0)&&da(c,!0))if(d=d||{},b=void 0!==b?b:!1,a)if(TK.isOnlyAudioRoom&&b)L.Logger.warning(q,"[tk-sdk]only audio room not execute method startShareMedia to video media !"),
c&&"function"===typeof c&&c("TK_ERR_NOT_SUPPORT");else{var f={type:"media"};void 0!==d.toID&&(f.toID=d.toID);if(d.attrs&&"object"===typeof d.attrs)for(var l in d.attrs)"toID"!==l&&"type"!==l&&(f[l]=d.attrs[l]);var h={audio:!0,video:b,url:a,extensionId:y()+":media",attributes:f};f=!1;for(l in t.remoteStreams){var k=t.remoteStreams[l];k&&"media"===k.getAttributes().type&&(f=!0,t.stopShareMedia(function(a){e()},function(){e()}))}f||e()}else L.Logger.error(q,"[tk-fake-sdk]startShareMedia url can not be empty!"),
c&&"function"===typeof c&&c("TK_ERR_INVALID_ARG")};t.stopShareMedia=function(a,b,c){function d(c){L.Logger.info(q,"[tk-sdk]calling stopShareMedia , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));H.sendMessageSocket("unpublish",c.getID(),function(d,e){0!==d?(L.Logger.warning(q,"[tk-sdk]unpublish media stream fail, stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()),"error code is "+
d+" ,error info:",e),L.Utils.isFunction(a)&&a(e)):(L.Logger.debug(q,"[tk-sdk]meidaStream unpublished , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),L.Utils.isFunction(b)&&b())})}if(P(a,!0)&&da(a,!0)){c=c||{};var e=!1,f;for(f in t.remoteStreams){var h=t.remoteStreams[f];!h||"media"!==h.getAttributes().type||c&&"object"===typeof c&&c.onlyStopMyself&&h.publisherId()!==y()||(e=!0,d(h))}e||(L.Logger.warning(q,"[tk-sdk]No media are Shared!"),
a&&"function"===typeof a&&a("TK_ERR_NOT_MEDIA_SHARED"))}};t.pauseShareMedia=function(a,b){if(P(b,!0)&&da(b,!0))if(L.Utils.isBoolean(a)){var c=!1,d;for(d in t.remoteStreams){var e=t.remoteStreams[d];"media"===e.getAttributes().type&&(c=!0,H.controlMedia(e.getID(),{type:"pause",pause:a}))}c||(L.Logger.warning(q,"[tk-sdk]No media are Shared and the execution pauseShareMedia method is invalid!"),b&&"function"===typeof b&&b("TK_ERR_NOT_MEDIA_SHARED"))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),
L.Logger.error(q,"[tk-sdk] pauseShareMedia function got wrong arguments")};t.seekMedia=function(a,b){if(P(b,!0)&&da(b,!0))if(L.Utils.isNumber(a)){var c=!1;0>a&&(a=0);1<a&&(a=1);for(var d in t.remoteStreams){var e=t.remoteStreams[d];if("media"===e.getAttributes().type){c=!0;var f=parseInt(a*e.getAttributes().duration);f>e.getAttributes().duration&&(f=e.getAttributes().duration);H.controlMedia(e.getID(),{type:"seek",pos:f})}}c||(L.Logger.warning(q,"[tk-sdk]No media are Shared and the execution seekShareMedia method is invalid!"),
b&&"function"===typeof b&&b("TK_ERR_NOT_MEDIA_SHARED"))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk] seekShareMedia function got wrong arguments")};t.setMute=function(a,b,c){a=l._createStreams[b==TK.MEDIA_TYPE.MEDIA?a+":"+TK.STREAM_MEDIA:a+":"+TK.STREAM_FILE];void 0!=a&&a.setMute(c)};t.setVolume=function(a,b,c){a=l._createStreams[b==TK.MEDIA_TYPE.MEDIA?a+":"+TK.STREAM_MEDIA:a+":"+TK.STREAM_FILE];void 0!=a&&a.setVolume(c)};t.isPlayAudio=function(a,b,c){c={audio:!0,
isPlay:b,audioUrl:a,type:c.type,currentPage:c.currentPage};qa&&qa.clientAudioMediaPlayer(a,b?"play":"stop",c)};t.playVideo=function(a,b,c,d,e){if(P(d,!0))if(L.Logger.debug(q,"[tk-sdk] playVideo. userId:",a,";elementId:",b,";options:",c,"; videoinputDeviceId:",e),c=c||{},""===a&&(a=y()),a)if(b)if(c&&"object"!==typeof c)L.Logger.error(q,"[tk-sdk]playVideo method options must is json!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else{l._playVideoStreams[Ea(a,c&&c.mediaType||TK.STREAM_VIDEO,e)]&&
t.unplayVideo(a,void 0,e);if(a===y()){if(TK.isMultiCamera&&(!c||c.mediaType!==TK.STREAM_SCREEN)&&!L.Utils.isVideoinputDeviceIdFromDeviceList(e)){L.Logger.error(q,"[tk-sdk]playVideo is fail,the device id("+e+") is not in the video device list!");L.Utils.isFunction(d)&&d("TK_ERR_DEVICE_ID_NOT_LIST");return}c.mirror=L.Utils.isBoolean(c.mirror)?c.mirror:l._isLocalVideoMirrorList[Ea(a,c&&c.mediaType||TK.STREAM_VIDEO,e)]||l._isLocalVideoMirror;Z(e)||c&&"screen"===c.mediaType||ua(e)}else if(!l._users[a]){L.Logger.info(q,
"[tk-sdk]playVideo:user is not exist, user id is "+a);L.Utils.isFunction(d)&&d("TK_ERR_NOT_USER");return}(e=aa(a,c&&c.mediaType||TK.STREAM_VIDEO,e))?ya(b,e,c):(L.Logger.debug(q,"[tk-sdk]playVideo: user has not stream, user id is "+a),L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk]playVideo method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk]playVideo method got invalid userId!")};
t.unplayVideo=function(a,b,c,d){P(b,!0)&&(L.Logger.debug(q,"[tk-sdk] unplayVideo. userId:",a),""===a&&(a=y()),a?(c=l._playVideoStreams[Ea(a,d&&d.mediaType||TK.STREAM_VIDEO,c)])?Ka(c):(L.Logger.debug(q,"[tk-sdk]unplayVideo: user has not stream, user id is "+a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM")):(L.Logger.error(q,"[tk-sdk]unplayVideo method got invalid userId!"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")))};t.playAudio=function(a,b){if(P(b,!0))if(L.Logger.debug(q,"[tk-sdk] playAudio, userId:",
a),3===arguments.length&&"string"===typeof arguments[1]&&"function"===typeof arguments[2]&&(b=arguments[2]),a)if(a===y())L.Logger.info(q,"[tk-sdk]playAudio:play local audio are not allowed, user id is "+a),L.Utils.isFunction(b)&&b("TK_ERR_NOT_PLAY_SELF_AUDIO");else{l._playAudioStreams[a+":"+TK.STREAM_VIDEO]&&t.unplayAudio(a);var c=l._users[a];c?(c=aa(a,TK.STREAM_VIDEO,c.tk_maincamera))?A(c):(L.Logger.debug(q,"[tk-sdk]playAudio: user has not stream, user id is "+a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM")):
(L.Logger.info(q,"[tk-sdk]playAudio:user is not exist, user id is "+a),L.Utils.isFunction(b)&&b("TK_ERR_NOT_USER"))}else L.Logger.error(q,"[tk-sdk]playAudio method got invalid userId!"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")};t.unplayAudio=function(a,b){if(P(b,!0))if(L.Logger.debug(q,"[tk-sdk] unplayAudio. userId:",a),a){var c=l._playAudioStreams[a+":"+TK.STREAM_VIDEO];c?sa(c):(L.Logger.debug(q,"[tk-sdk]unplayAudio: user has not stream, user id is "+a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM"))}else L.Logger.error(q,
"[tk-sdk]unplayAudio method got invalid userId!"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")};t.setLocalVideoMirror=function(a,b){L.Utils.isBoolean(a)?(TK.isMultiCamera&&void 0!==b||(l._isLocalVideoMirror=a),TK.isMultiCamera&&(l._isLocalVideoMirrorList[Ea(y(),TK.STREAM_VIDEO,b)]=a),Z(b)&&Z(b).setLocalVideoMirror(a)):L.Logger.error(q,"[tk-sdk]The setLocalVideoMirror method parameter isMirror must be of Boolean type!")};t.getVideoProfile=function(a){return D.getVideoProfile(a)};t.setVideoProfile=
function(a,b,c){if(P(b,!0)){var d=function(){L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG");L.Logger.error(q,"[tk-sdk] setVideoProfile method got invalid arguments")};if("object"!==typeof a)d();else if("number"!==typeof a.width||"number"!==typeof a.height||"number"!==typeof a.maxfps)d();else{TK.isMultiCamera||(c=void 0);var e=k(c);D.setVideoProfile(a,c,function(){if(e){var a=D.getUseVideoProfile(c);e.maxfps=a.maxfps;var d=L.Utils.getMaxBPS(a.width,a.maxfps);isNaN(d)&&(d=1280);D.setBandWidth(e.getID(),
d,function(){L.Logger.info(q,"[tk-sdk] setBandWidth success setBandWidth info:",d)},b)}},function(){if(e){var a=D.getUseVideoProfile(c);Ya(e,e.videoinputDeviceId,!0,a.maxfps)}});D.getDeviceMgr()&&D.getDeviceMgr().isNativeSetVideoProfile||L.Logger.info(q,"[tk-sdk]setVideoProfile [width , height, fps]:"+a.width,a.height,a.maxfps+(c?" , videoinputDeviceId is "+c:""))}}};t.getRoomUserNum=function(a,b,c,d){if(P(c,!0)&&da(c,!0))if(L.Utils.isFunction(a)){var e={companyid:l._room_properties.companyid,serial:l._room_properties.serial};
void 0!==b&&Array.isArray(b)&&(e.role=b);d&&L.Utils.isString(d)&&(e.search=d);b=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/getroomusernum?ts\x3d"+(new Date).getTime();L.Utils.sdkAjax({url:b,dataType:"json",type:"GET",async:!0,data:e,success:function(b){L.Logger.debug(q,"[tk-sdk]getroomusernum resp \x3d ",L.Utils.toJsonStringify(b));0===b.result?a(L.Utils.isNumber(Number(b.num))?Number(b.num):0):(L.Logger.warning(q,"[tk-sdk]getroomusernum interface request fail , code is "+b.result),
L.Utils.isFunction(c)&&c(b.result,b))},error:function(a,b,d){L.Logger.error(q,"[tk-sdk]getroomusernum fail[ XHR , textStatus , errorThrown ]:",a,b,d);L.Utils.isFunction(c)&&c(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk] The parameter onSuccess of method getRoomUserNum must be a function")};t.getRoomUsers=function(a,b,c,d,e,f,h){if(P(e,!0)&&da(e,!0))if(L.Utils.isFunction(a)){var k={companyid:l._room_properties.companyid,
serial:l._room_properties.serial};void 0!==b&&L.Utils.isNumber(b)&&(k.start=b);void 0!==c&&L.Utils.isNumber(c)&&(k.max=c);void 0!==d&&Array.isArray(d)&&(k.role=d);f&&L.Utils.isString(f)&&(k.search=f);if(h&&Array.isArray(h)){b=[];c=0;for(d=h.length;c<d&&!("object"===typeof h[c]&&b.push(h[c]),3<=b.length);c++);b.length&&(k.order=b)}h=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/getroomusers?ts\x3d"+(new Date).getTime();L.Utils.sdkAjax({url:h,dataType:"json",type:"POST",async:!0,data:k,
success:function(b){L.Logger.debug(q,"[tk-sdk]getroomusers resp \x3d ",L.Utils.toJsonStringify(b));if(0===b.result){var c=[];if(b.userlist&&Array.isArray(b.userlist))for(var d=0,f=b.userlist.length;d<f;d++)c.push(TK.RoomUser(b.userlist[d]));a(c,b.total)}else L.Logger.warning(q,"[tk-sdk]getroomusers interface request fail , code is "+b.result),L.Utils.isFunction(e)&&e(b.result,b)},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]getroomusers fail[ XHR , textStatus , errorThrown ]:",a,b,c);L.Utils.isFunction(e)&&
e(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error(q,"[tk-sdk] The parameter onSuccess of method getRoomUsers must be a function")};t.getNativeInterface=function(a){if(TK.isTkNative)return qa;L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED");L.Logger.error(q,"[tk-sdk] getNativeInterface method must be called in the native environment!")};t.getPlaybackInterface=function(){return Aa};t.getRoomUser=function(a,
b,c){if(P(c,!0)&&da(c,!0))if(a&&L.Utils.isFunction(b))if(l._roomMode===window.TK.ROOM_MODE.NORMAL_ROOM)l._users[a]?b(l._users[a]):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA");else{var d=[];d.push(a);H.sendMessageSocket("getUser",d,function(a,d){0===a?Array.isArray(d)&&d.length&&d[0]?b(TK.RoomUser(d[0])):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA"):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA")})}else L.Logger.error(q,"[tk-sdk]getRoomUser method got invalid argument!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")};
t.setStreamProcessor=function(a){a&&L.Utils.isFunction(a)&&(tb=a)};t.getIp=function(a,b){if(L.Utils.isFunction(a))try{var c=new (window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),d=function(){},e={},f=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,h=function(b){e[b]||(L.Utils.isFunction(a)?a(b):L.Logger.error(q,"[tk-sdk] getIP method parameter is not a specified type"),e[b]=!0)};c.createDataChannel("");c.createOffer().then(function(a){a.sdp.split("\n").forEach(function(a){0>
a.indexOf("candidate")||a.match(f).forEach(h)});c.setLocalDescription(a,d,d)}).catch(function(a){L.Logger.error(q,"[tk-sdk] getip An error occurred, so handle the failure to connect")});c.onicecandidate=function(a){a&&a.candidate&&a.candidate.candidate&&a.candidate.candidate.match(f)&&a.candidate.candidate.match(f).forEach(h)}}catch(Jb){L.Utils.isFunction(b)?b(Jb):L.Logger.error(q,"[tk-sdk] getIP method parameter is not a specified type"),L.Logger.error(q,"[tk-sdk]Use a browser that supports webRTC,form")}else L.Logger.error(q,
"[tk-sdk] getIP method parameter is not a specified type")};t.getDocServerList=function(){var a=l._backupCourseAddrList.reduce(function(a,b,c,d){b.docaddr&&Array.isArray(b.docaddr)&&b.docaddr.forEach(function(b,c){a.push(b)});return a},[]);l._docServerAddr&&a.push(l._docServerAddr);return a||[]};t.setLocalStreamAttributes=function(a,b){if(a&&"object"===typeof a){if(!TK.isMultiCamera||void 0===b)for(var c in a)l._videoStreamAttrs[c]=a[c];if(TK.isMultiCamera)for(c in l._videoStreamListAttrs[Ea(y(),
TK.STREAM_VIDEO,b)]=l._isLocalVideoMirrorList[Ea(y(),TK.STREAM_VIDEO,b)]||{},a)l._videoStreamListAttrs[Ea(y(),TK.STREAM_VIDEO,b)][c]=a[c];Z(b)&&(Z(b).updateLocalAttributes(a),Z(b).setAttributes(a))}};t.liveSimulateServerCommunicationInterface=function(a){if(ka["_handler_"+a]&&"function"===typeof ka["_handler_"+a]){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);ka["_handler_"+a].apply(null,b)}};t.changeUserPublish=function(a,b,c){if(P(void 0,!0)&&da(void 0,!0))if(void 0===a)L.Logger.error(q,
"[tk-sdk]changeUserPublish method id is not exist!");else if(TK.isMultiCamera){var d={};d["publishstate:"+c]=b;t.changeUserProperty(a,"__all",d)}else t.changeUserProperty(a,"__all",{publishstate:b})};t.changeUserShare=function(a,b,c){if(!c)L.Logger.error(q,"[tk-sdk]changeUserShare method type is not exist!");else if(P(void 0,!0)&&da(void 0,!0))if(void 0===a)L.Logger.error(q,"[tk-sdk]changeUserShare method id is not exist! type:",c);else{var d={};t.changeUserProperty(a,"__all",(d[c]=b,d))}};t.changeMyDisableVideoState=
function(a){P(void 0,!0)&&da(void 0,!0)&&("boolean"!==typeof a?L.Logger.warning(q,"[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !"):t.changeUserProperty(y(),"__all",{disablevideo:a}))};t.changeMyDisableAudioState=function(a){P(void 0,!0)&&da(void 0,!0)&&("boolean"!==typeof a?L.Logger.warning(q,"[tk-sdk]changeMyDisableAudioState:disableaudio must boolean !"):t.changeUserProperty(y(),"__all",{disableaudio:a}))};t.updateVideoPlayerOptions=function(a,b,c,d,e){P(void 0,!0)&&("object"!==
typeof a?(L.Logger.error(q,"[tk-sdk] updateVideoPlayerOptions method options muset is json!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")):(d=aa(b,d||TK.STREAM_VIDEO,e))?d.updateVideoPlayerOptions(a):(L.Logger.debug(q,"[tk-sdk] updateVideoPlayerOptions: user is not stream  , user id is "+b),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM")))};t.registerRoomWhiteBoardDelegate=function(a){if(a&&"TKWhiteBoardManager"===a.className&&"function"===typeof a.registerRoomDelegate){if(na=a)if(na.registerRoomDelegate&&
na.registerRoomDelegate(t),na.changeCommonWhiteBoardConfigration){a={};l._web_protocol&&l._web_host&&void 0!==l._web_port&&(a.webAddress={protocol:l._web_protocol,hostname:l._web_host,port:l._web_port});l._doc_protocol&&l._doc_host&&void 0!==l._doc_port&&(a.docAddress={protocol:l._doc_protocol,hostname:l._doc_host,port:l._doc_port});if(l._backup_doc_host_list.length){for(var b=[],c=0,d=l._backup_doc_host_list.length;c<d;c++)b.push({protocol:l._backup_doc_protocol,hostname:l._backup_doc_host_list[c],
port:l._backup_doc_port});a.backupDocAddressList=b}a.myUserId=y();void 0!==l._myself.nickname&&(a.myName=l._myself.nickname);void 0!==l._myself.role&&(a.myRole=l._myself.role);a.isPlayback=TK.isPlayback;na.changeCommonWhiteBoardConfigration(a)}}else L.Logger.warning(q,"[tk-sdk]register whiteboardManagerInstance not is a TKWhiteBoardManager instance class , cannot execute registerRoomWhiteBoardDelegate method.")};t.stopShareLocalMedia=function(a,b,c){function d(c){L.Logger.info(q,"[tk-sdk]calling stopShareLocalMedia , stream id:"+
c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));H.sendMessageSocket("unpublish",c.getID(),function(d,e){0!==d?(L.Logger.warning(q,"[tk-sdk]Error unpublish local media stream fail, stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()),"error code is "+d+" ,error info:",e),L.Utils.isFunction(a)&&a(e)):(L.Logger.debug(q,"[tk-sdk]meidaStream unpublished , stream id:"+c.getID()+" , extensionId is "+
c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),L.Utils.isFunction(b)&&b())})}if(P(a,!0)&&da(a,!0)){c=c||{};var e=!1,f;for(f in t.remoteStreams){var h=t.remoteStreams[f];!h||"file"!==h.getAttributes().type||c&&"object"===typeof c&&c.onlyStopMyself&&h.publisherId()!==y()||(e=!0,TK.isTkNative&&h.publisherId()===y()?qa.stopShareMediaFile():d(h))}e||(L.Logger.warning(q,"[tk-sdk]No media file are Shared!"),a&&"function"===typeof a&&a("TK_ERR_NOT_LOCAL_MEDIA_FILE_SHARED"))}};t.joinPlaybackRoom=
Gb;t.seekPlayback=function(a,b){a&&L.Utils.isNumber(a)&&l._durationTime?H.socketSend("seekPlayback",a):L.Logger.error(q,"[tk-sdk]Incorrect parameter!")};t.pausePlayback=Hb;t.getUploadFileParams=function(a,b,c,d){if(P(void 0,!0))return c=void 0!==c?c:!0,a={serial:l._room_properties.serial,userid:y(),sender:l._myself.nickname,conversion:1,isconversiondone:0,writedb:c?1:0,fileoldname:a,fieltype:b,alluser:1},d&&(a.codeid=d),a};t.uploadFile=function(a,b,c){if(P(void 0,!0)&&da(void 0,!0))if(a){if(a instanceof
FormData)return z(a,b,c,function(a,c){L.Utils.isFunction(b)&&b(a,c)});if(a.filename&&a.filetype&&a.filedata){var d=t.getUploadFileParams(a.filename,a.filetype,a.isWritedb,a.qRCodeId),e=new FormData,f;for(f in d)e.append(f,d[f]);e.append("filedata",a.filedata);return z(e,b,c,function(a,c){L.Utils.isFunction(b)&&b(a,c)})}L.Logger.error(q,"[tk-sdk] uploadFile method Parameters of the lack of!")}else L.Logger.error(q,"[tk-sdk]uploadFile method Parameters of the lack of!")};t.deleteFile=function(a,b){P(void 0,
!0)&&da(void 0,!0)&&(void 0===a||null===a?L.Logger.error(q,"[tk-sdk]deleteFile fileid is required!"):I(a,b,function(a,c){L.Utils.isFunction(b)&&b(a,c)}))};t.switchServerByName=function(b){if(P(void 0,!0)){if(!L.Utils.getJsonLength(l._serverList))return L.Logger.error(q,"[tk-sdk]selectServerByName --\x3e service list not request  , list is not exist!"),!1;if(!l._serverList[b])return L.Logger.error(q,"[tk-sdk]selectServerByName --\x3e the service list  has no option name  "+b+"!"),!1;void 0!==l._web_host&&
void 0!==l._web_port?0<l._connectedNumber?(l._serverName=b,a(l._serverList,l._serverName),l._useServerScreenRecording||l._tk_room_test_sdk||/(192.168.|127.0.0.1|127.17.|localhost)/g.test(l._web_host)||!l._serverName||(void 0!==l._web_host?(b=l._web_host.indexOf("."),0<b?(b=l._web_host.substring(0,b),b=new RegExp(b),l._old_web_host=l._web_host,b=l._web_host.replace(b,l._serverName),b!==l._web_host?(L.Logger.info(q,"[tk-sdk]changeWebRequest host , old host is "+(window.__TkSdkBuild__?L.Utils.encrypt(l._old_web_host):
l._old_web_host)+", now host is "+(window.__TkSdkBuild__?L.Utils.encrypt(b):b)),g({web_host:b})):L.Logger.info(q,"[tk-sdk]changeWebRequest host , host is not change ,   host is "+(window.__TkSdkBuild__?L.Utils.encrypt(l._web_host):l._web_host))):L.Logger.error(q,"[tk-sdk]web request host not find first dot , cannot address to replace , current host is "+(window.__TkSdkBuild__?L.Utils.encrypt(l._web_host):l._web_host)+" ! ")):L.Logger.error(q,"[tk-sdk]web request host is not exist , cannot call changeWebRequestAddress ! ")),
l._old_web_host!==l._web_host?d({source:"select service reconnect",restrict:!0}):L.Logger.info(q,"[tk-sdk]web request host is not change , not need reconnect service!")):L.Logger.error(q,"[tk-sdk]selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! "):L.Logger.error(q,"[tk-sdk]selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");return!0}};t.setLogLevel=function(a){a&&($a=a)};t.getStreamStats=function(a,b){try{var c=
t.getUsers();if(a&&b){var d=[],e;for(e in t.remoteStreams)(function(c){var e=t.remoteStreams[c];e&&e.extensionId&&e.extensionId.split&&d.push(function(){return new Promise(function(d,f){H.socketSend("getStreamStats",{streamId:c,peerId:a},function(c,h){if(0==c)L.Utils.isFunction(b)?e&&e.extensionId&&e.extensionId.split?h[a]?(h[a].type=e.extensionId.split(":")[0]===a?"up":"down",h[a].userId=e.extensionId.split(":")[0],h[a].peerId=a,h[a]&&h[a].video&&(h[a].video.frameRate=e.frameRate),TK.isMultiCamera&&
e.extensionId.split(":").length&&(h[a].deviceId=e.extensionId.split(":")[1]),d(h[a])):(L.Logger.warning(q,"[tk-sdk]getStreamStats method error info : stats  not exist!"),f()):L.Logger.error(q,"[tk-sdk]be from getStreamStats method ,stream or extensionId is null!"):(L.Logger.error(q,"[tk-sdk]getStreamStats method specifies that the parameter type is incorrect!"),f());else switch(c){case 1:L.Logger.warning(q,"[tk-sdk]getStreamStats method error info :  room does not exist!"),f();case 2:L.Logger.warning(q,
"[tk-sdk]getStreamStats method error info :"+e.id+"  stream does not exist!"),f();case 3:L.Logger.warning(q,"[tk-sdk]getStreamStats method error info :"+a+" user not exist!"),f()}})})}())})(e);Promise.all(d).then(function(a){var d=null;a.forEach(function(a){for(var b in t.remoteStreams)if(t.remoteStreams[b].extensionId&&t.remoteStreams[b].extensionId.split&&(d=TK.isMultiCamera?t.remoteStreams[b].extensionId.split(":")[1]:t.remoteStreams[b].extensionId.split(":")[0]),d===a.deviceId)if(a&&a.video&&
1==a.video.videoMute?delete a.video:a&&a.video&&(a.video.videoFps&&a.video.frameRate&&(a.video.frameRate=a.video.frameRate>a.video.videoFps?a.video.videoFps:a.video.frameRate),a.video.videoWidth=t.remoteStreams[b]?t.remoteStreams[b].width?t.remoteStreams[b].width:0:0,a.video.videoHeight=t.remoteStreams[b]?t.remoteStreams[b].height?t.remoteStreams[b].height:0:0,delete a.video.videoFps),a&&a.audio&&1==a.audio.audioMute&&delete a.audio,TK.isMultiCamera){if(c[a.userId])for(var e in c[a.userId])e.split(":").length&&
e.split(":")[1]===a.deviceId&&(1==c[a.userId][e]?delete a.video:2==c[a.userId][e]&&delete a.audio)}else c[a.userId]&&(1==c[a.userId].publishstate?delete a.video:2==c[a.userId].publishstate&&delete a.audio)});b(a)}).catch(function(a){L.Logger.warning(q,"[tk-sdk]getStreamStats method promise error info :",a)})}else b(),L.Logger.warning(q,"[tk-sdk]getStreamStats method specifies that the parameter type is incorrect!")}catch(jb){L.Logger.warning(q,"[tk-sdk]getStreamStats method error info: ",jb)}};t.startShareScreen=
function(a,b){P(void 0,!0)&&da(void 0,!0)&&(TK.isOnlyAudioRoom?L.Logger.warning(q,"[tk-sdk]only audio room not execute method publishVideo method !"):TK.DeviceMgr.checkUserDesktopMediaMode(function(c){c?D.openWebScreen(a,function(a){var c=TK.SCREENSTATE_ON;c!==(l._myself.tk_screenstate||TK.SCREENSTATE_OFF)&&(t.changeUserShare(y(),c,"tk_screenstate"),Wb(a,b))},function(a){L.Logger.info(q,"[tk-sdk]No media stream from the plug-in was retrieved",a);L.Utils.isFunction(b)&&b(void 0,"[tk-sdk]No media stream from the plug-in was retrieved")},
function(a){L.Logger.info(q,"[tk-sdk]Sharing has closed data.");t.stopShareScreen()}):L.Utils.isFunction(b)&&b(window.TK_ERR.CHECK_USERDesktopMediaError,"please install the web sharing plug-in")}))};t.stopShareScreen=function(a){if(P(void 0,!0)&&da(void 0,!0)){var b=TK.SCREENSTATE_OFF;b!==(l._myself.tk_screenstate||TK.SCREENSTATE_OFF)&&(t.changeUserShare(y(),b,"tk_screenstate"),Xb(a))}};ka._handler_participantLeft=function(a,b){L.Logger.debug(q,"[tk-sdk]participantLeft userid:"+a);var c=l._users[a];
void 0===c?L.Logger.error(q,"[tk-sdk]participantLeft user is not exist , userid is "+a+"!"):(L.Logger.info(q,"[tk-sdk]user leave room  , user info: "+L.Utils.toJsonStringify(c)),TK.isPlayback&&void 0!==b&&(c.leaveTs=b),TK.isPlayback?l._users[a]&&(l._users[a].playbackLeaved=!0):delete l._users[a],a=TK.RoomEvent({type:TK.EVENT_TYPE.roomParticipantLeave,user:c}),t.dispatchEvent(a))};ka._handler_participantJoined=function(a){L.Logger.debug(q,"[tk-sdk]participantJoined userinfo:"+L.Utils.toJsonStringify(a));
var b=TK.RoomUser(a);L.Logger.info(q,"[tk-sdk]user join room  , user info: "+L.Utils.toJsonStringify(b));l._users[b.id]=b;TK.isPlayback&&l._users[b.id]&&delete l._users[b.id].playbackLeaved;TK.isPlayback&&"object"===typeof a&&(b.joinTs=a.ts);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomParticipantJoin,user:b});t.dispatchEvent(a)};ka._handler_participantPublished=function(a){L.Logger.debug(q,"[tk-sdk]participantPublished userinfo:"+L.Utils.toJsonStringify(a));if(l._roomMode===window.TK.ROOM_MODE.BIG_ROOM){var b=
TK.RoomUser(a),c=l._users[b.id];if(c)for(var d in b)c[d]=b[d];else c=b;l._users[c.id]=c;TK.isPlayback&&l._users[c.id]&&delete l._users[c.id].playbackLeaved;TK.isPlayback&&"object"===typeof a&&(c.joinTs=a.ts)}};ka._handler_sendMessage=function(a){L.Logger.debug(q,"[tk-sdk]room-text-message info:"+(a&&"object"===typeof a?L.Utils.toJsonStringify(a):a));if(a&&a.hasOwnProperty("message")){var b=l._users[a.fromID];b||(b={id:a.fromID,nickname:b?b.nickname:a.nickname,role:b?b.role:a.role});a&&a.message&&
"string"===typeof a.message&&(a.message=L.Utils.toJsonParse(a.message));TK.isPlayback&&void 0!==a.ts&&"object"===typeof a.message&&(a.message.ts=a.ts);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomTextMessage,user:b,message:a.message},{userid:a.fromID,nickname:b?b.nickname:a.nickname,role:b?b.role:a.role});t.dispatchEvent(a)}else L.Logger.error(q,"[tk-sdk]room-text-message messages or messages.message is not exist!")};ka._handler_pubMsg=function(a){L.Logger.debug(q,"[tk-sdk]pubMsg info:",L.Utils.toJsonStringify(a));
a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));if("OnlyAudioRoom"===a.name)Ha(!0,a.fromID);else{"DocumentChange"===a.name&&bb(a);"RemoteControl"===a.name&&Ia(a);if("BigRoom"===a.name){l._roomMode=window.TK.ROOM_MODE.BIG_ROOM;sb();L.Logger.info(q,"[tk-sdk]room mode changed,current mode is "+l._roomMode);var b=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:l._roomMode}});t.dispatchEvent(b)}b=TK.RoomEvent({type:TK.EVENT_TYPE.roomPubmsg,
message:a});t.dispatchEvent(b)}};ka._handler_delMsg=function(a){L.Logger.debug(q,"[tk-sdk]delMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));if("OnlyAudioRoom"===a.name)Ha(!1,a.fromID);else{"BigRoom"===a.name&&(l._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM,sb(),L.Logger.info(q,"[tk-sdk]room mode changed,current mode is "+l._roomMode),TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:l._roomMode}}));
if("ClassBegin"===a.name)try{l._useServerScreenRecording&&talkrecoder&&(L.Logger.info(q,"recoder class over,roomid is "+l._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(l._myself)),talkrecoder.over())}catch(ma){L.Logger.error(q,"[tk-sdk]talkrecoder err:",ma)}a=TK.RoomEvent({type:TK.EVENT_TYPE.roomDelmsg,message:a});t.dispatchEvent(a)}};ka._handler_setProperty=function(b){L.Logger.debug(q,"[tk-sdk]setProperty info:",L.Utils.toJsonStringify(b));var c=b.id;(c!==y()||c===y()&&y()!==b.fromID)&&
b.hasOwnProperty("properties")&&hb(b.properties)&&L.Logger.info(q,"[tk-sdk]change user property,user id is "+c+",change property:"+L.Utils.toJsonStringify(b.properties));if(b.hasOwnProperty("properties")){var d=b.properties,e=l._users[c];if(y()===c){e=l._myself;for(var f in d)if("publishstate"===f||/publishstate:/g.test(f)){var k=Oa(f),g=d[f];R(g,k);if(g>TK.PUBLISH_STATE_NONE){var A=Z(k,!0);A&&t.remoteStreams[A.getID()]&&Wa(A)}else g===TK.PUBLISH_STATE_NONE&&(A=Z(k))&&h(A);D.needRePublish(A.getID())&&
db(A)}else"disablevideo"===f?wa(d[f]):"disableaudio"===f&&ja(d[f])}if(e){g=e.servername;var m=e.tk_maincamera;for(f in d)"id"!=f&&"watchStatus"!=f&&(e[f]=d[f]);if(y()!==e.id)for(var n in d)if("publishstate"===n||/publishstate:/g.test(n))for(f in t.remoteStreams)A=t.remoteStreams[f],A.publisherId()!==y()&&A.getAttributes().type===TK.STREAM_VIDEO&&d[n]>TK.PUBLISH_STATE_NONE&&t.remoteStreams[A.getID()]&&("publishstate"===n?A.extensionId===e.id&&Wa(A):(k=Oa(n),A.extensionId===e.id+":"+k&&Wa(A)));y()===
c&&d.hasOwnProperty("tk_maincamera")&&y()!==b.fromID&&d.tk_maincamera!==m&&Ja(d.tk_maincamera,function(a){L.Logger.warning(q,"[tk-sdk]other user control set main camera fail,fail info:",a);t.changeUserProperty(y(),"__all",{tk_maincamera:m})});y()===c&&d.hasOwnProperty("servername")&&(y()!==b.fromID?d.servername&&d.servername!==g&&t.switchServerByName(d.servername):d.servername&&d.servername!==g&&(l._serverName=d.servername,a(l._serverList,l._serverName)));b=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserPropertyChanged,
user:e,message:d},{fromID:b.fromID,userId:e.id});t.dispatchEvent(b);y()!==e.id&&d.hasOwnProperty("tk_maincamera")&&(L.Logger.info(q,"[tk-sdk]change user main camera device id,user id is "+c+",change device id is "+d.tk_maincamera+",old device id is "+m),c=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:e.id,deviceId:d.tk_maincamera}}),t.dispatchEvent(c))}else l._roomMode!==window.TK.ROOM_MODE.NORMAL_ROOM&&L.Logger.info(q,"[tk-sdk]setProperty user is not exist , userid is "+
c+", change user property inof:"+L.Utils.toJsonStringify(b)+"!")}};Aa.onJoinPlaybackRoom=Gb;Aa.onSeekPlayback=function(a,b){if(P(b,!0))if(TK.isPlayback)try{var c=Math.floor(Number(a*l._durationTime));c>l._durationTime&&(c=l._durationTime);H.socketSend("seekPlayback",c)}catch(xb){L.Utils.isFunction(b)&&b("TK_ERR_UNKNOWN"),L.Logger.error(q,"[tk-sdk]The seek posttion must be a number, in milliseconds !")}else L.Logger.warning(q,"[tk-sdk]No playback environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_PLAYBACK_ENVIRONMENT")};
Aa.onPausePlayback=Hb;Aa.onPlaybackClearAll=function(){if(TK.isPlayback){l._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;L.Logger.info(q,"[tk-sdk]room mode changed,current mode is "+l._roomMode);var a=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:l._roomMode}});t.dispatchEvent(a);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackClear_all});t.dispatchEvent(a);TK.isPlayback?(v(),l._users[y()]=l._myself):L.Logger.error(q,"[tk-sdk]No playback environment, no execution playbackClearAll!")}else L.Logger.warning(q,
"[tk-sdk]No playback environment!")};Aa.onHandlerDuration=function(a){if(TK.isPlayback){var b=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackDuration,message:a});l._durationTime=a;t.dispatchEvent(b)}else L.Logger.warning(q,"[tk-sdk]No playback environment!")};Aa.onHandlerPlaybackEnd=function(){if(TK.isPlayback){try{l._useServerScreenRecording&&talkrecoder&&(L.Logger.info(q,"recoder class over,roomid is "+l._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(l._myself)),talkrecoder.over())}catch(ma){L.Logger.error(q,
"[tk-sdk]talkrecoder err:",ma)}var a=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackPlaybackEnd});t.dispatchEvent(a)}else L.Logger.warning(q,"[tk-sdk]No playback environment!")};Aa.onHandlerPlaybackUpdateTime=function(a){TK.isPlayback?(a=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackPlayback_updatetime,message:a}),t.dispatchEvent(a)):L.Logger.warning(q,"[tk-sdk]No playback environment!")};ka._handler_connectSocketSuccess=function(a,c){if(l._isLeaveRoom)L.Logger.info(q,"[tk-sdk]The room is over. Method _handler_connectSocketSuccess cannot be executed!"),
H&&H.isHasSocket&&H.isHasSocket()&&t.leaveroom();else{TK.isTkNative&&!l._handlerCallbackJson&&(l._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",localId:y().toString(),width:320,height:240,fps:10,roomInfo:l._roomCheckRoomInfoString,webAddr:l._web_host.toString(),webPort:l._web_port.toString(),tk_multistream:TK.isMultiCamera}));var d=c.roominfo,e=c.msglist,f=c.userlist;a=[];var h=d.streams||[],k=d.id;TK.networkTestInfo.protocol=l._web_protocol;TK.networkTestInfo.host=l._socket_host||
l._web_host||"global.talk-cloud.net";TK.networkTestInfo.port=l._web_port||/https/g.test(l._web_protocol)?443:80;l._isConnected=!0;TK.networkTestInfo.isConnectRoom=!0;t.iceServers=d.iceServers;la.defaultVideoBW=l._room_video_maxbps;la.maxVideoBW=l._room_video_maxbps;la.defaultScreenBW=L.Utils.getMaxBPS(1280,20);la.maxScreenBW=L.Utils.getMaxBPS(1280,20);la.defaultLocalFileMediaBW=L.Utils.getMaxBPS(640,30);la.maxLocalFileMediaBW=L.Utils.getMaxBPS(640,30);l._users={};l._users[y()]=l._myself;for(var g in l._myself)if(TK.isMultiCamera)/publishstate:/g.test(g)&&
l._myself[g]>TK.PUBLISH_STATE_NONE&&(d=Oa(g),b(l._myself[g],void 0,void 0,d),A=Z(d,!0),Ca(A));else if("publishstate"===g&&l._myself[g]>TK.PUBLISH_STATE_NONE){b(l._myself[g],void 0,void 0,void 0);var A=Z(void 0,!0);Ca(A)}for(var m in h)h.hasOwnProperty(m)&&(d=h[m],A=!1,TK.subscribe_from_native&&(A=!0),A=TK.Stream({streamID:d.id,local:!1,audio:d.audio,video:d.video,data:d.data,screen:d.screen,attributes:d.attributes,extensionId:d.extensionId,getVideoTrack:ob,getAudioTrack:pb,getRegisterAudioVolumeListener:qb},
A),a.push(A),t.remoteStreams[d.id]=A,L.Logger.info(q,"[tk-sdk]room-connected --\x3e stream info , stream id:"+A.getID()+" , extensionId is "+A.extensionId+", attrs is "+L.Utils.toJsonStringify(A.getAttributes())),mb(A));for(m in f)f.hasOwnProperty(m)&&(h=TK.RoomUser(f[m]),void 0!==h&&(l._users[h.id]=h,TK.isPlayback&&l._users[h.id]&&delete l._users[h.id].playbackLeaved,L.Logger.info(q,"[tk-sdk]room-connected --\x3e user info: "+L.Utils.toJsonStringify(h))));L.Logger.info(q,"[tk-sdk]room-connected --\x3e myself info: "+
L.Utils.toJsonStringify(l._myself));m=[];e&&"string"===typeof e&&(e=L.Utils.toJsonParse(e));e.hasOwnProperty("OnlyAudioRoom")?(Ha(!0,e.OnlyAudioRoom.fromID),2===TK.needOnlyAudioRoom&&t.switchOnlyAudioRoom(!1)):1===TK.needOnlyAudioRoom&&t.switchOnlyAudioRoom(!0);e.hasOwnProperty("BigRoom")?(l._roomMode=window.TK.ROOM_MODE.BIG_ROOM,sb()):l._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;L.Logger.info(q,"[tk-sdk]room mode changed,current mode is "+l._roomMode);f=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,
message:{roomMode:l._roomMode}});t.dispatchEvent(f);for(g in e)e.hasOwnProperty(g)&&m.push(e[g]);m.sort(function(a,b){return void 0!==a&&a.hasOwnProperty("seq")&&void 0!==b&&b.hasOwnProperty("seq")?a.seq-b.seq:0});L.Logger.debug(q,"[tk-sdk]Connected to room "+k);L.Logger.debug(q,"[tk-sdk]connected response:",L.Utils.toJsonStringify(c));L.Logger.info(q,"[tk-sdk]room-connected ,streams length is "+a.length+" , signalling list length "+m.length);if(na&&na.changeCommonWhiteBoardConfigration){c=[];g=0;
for(e=l._backup_doc_host_list.length;g<e;g++)c.push({protocol:l._backup_doc_protocol,hostname:l._backup_doc_host_list[g],port:l._backup_doc_port});na.changeCommonWhiteBoardConfigration({webAddress:{protocol:l._web_protocol,hostname:l._web_host,port:l._web_port},docAddress:{protocol:l._doc_protocol,hostname:l._doc_host,port:l._doc_port},backupDocAddressList:c,myUserId:y(),myName:l._myself.nickname,myRole:l._myself.role,isConnectedRoom:l._isConnected,isPlayback:TK.isPlayback})}Pa+=1;if(!TK.isPlayback){var n=
0;Ub("needDeviceInfo");clearInterval(t._networkequipmentTimer);clearInterval(t._catonNumber);clearInterval(t.sendcatonNumber);t._networkequipmentTimer=setInterval(function(){var a=[];n++;var b=!1;10<=n&&(n=0,l._sentAloneNetQualityBadList={},b=!0);var c=0,d;for(d in t.remoteStreams){var e=t.remoteStreams[d];e.getAttributes().type===TK.STREAM_VIDEO&&l._users[e.publisherId()]&&function(d){c++;wb(d,function(e){c--;if(e&&l._users[d.publisherId()]){var f=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.video)),
h=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.audio));delete f.packetsLostRate;delete h.packetsLostRate;h={video:f,audio:h,cpuOccupancy:0,peerId:l._users[d.publisherId()].id,peerName:l._users[d.publisherId()].nickname,streamId:d.getID()};t.remoteStreams[d.getID()].width=f.frameWidth;t.remoteStreams[d.getID()].height=f.frameHeight;t.remoteStreams[d.getID()].frameRate=f.frameRate;f=[];f.push(h);var k={};d&&d.extensionId&&d.extensionId.split&&(k=D.getVideoProfile(d.extensionId.split(":")[1]));vb(f,
d,k.maxfps);(!b&&e.audio.netquality>=window.TK.NET_QUALITY.TK_NET_QUALITY_BAD||e.video.netquality>=window.TK.NET_QUALITY.TK_NET_QUALITY_BAD)&&!l._sentAloneNetQualityBadList[d.getID()]&&(l._sentAloneNetQualityBadList[d.getID()]=!0,e=[],e.push(h),vb(e,d));b&&(l._isSendAllPublishUserNetworkequipment?a.push(h):d.publisherId()===y()&&a.push(h),0>=c&&(b=!1,vb(a,d)))}d=void 0},function(){c--})}(e)}},6E3);t._catonNumber=setInterval(function(){var a=[],b;for(b in t.remoteStreams){var c=t.remoteStreams[b];
c.getAttributes().type===TK.STREAM_VIDEO&&l._users[c.publisherId()]&&function(b){try{a.push(function(){return new Promise(function(a,c){wb(b,function(c){if(c.video&&5>c.video.frameRate){var d="",e=0;b&&b.extensionId&&b.extensionId.split&&b.extensionId.split(":")[0]!==l._myself.id&&(d=b.extensionId.split(":")[0]);d&&(Da.forEach(function(a,b){a.peerid===d&&(e+=1,a.count+=1)}),e||Da.push({peerid:d,count:0}))}b.extensionId&&b.extensionId.split&&t.getMySelf().id===b.extensionId.split(":")[0]&&(c.isMe=
!0);a(c);b=void 0})})}())}catch(Yb){L.Logger.warning(q,"[tk-sdk]catonNumber method was a slight problem with the handling.")}}(c)}Promise.all(a).then(function(a){var b=[],c=[],d=0,e=0;a.forEach(function(a){a.isMe?b.push(a):c.push(a)});W.audioDelay=0;W.videoDelay=0;b.forEach(function(a){a&&a.audio&&(W.outAudioKBitRate+=a.audio.bitsPerSecond?a.audio.bitsPerSecond:0,W.outBytes+=a.audio.audioBytesSent?a.audio.audioBytesSent:0,W.outPackets+=a.audio.totalPackets?a.audio.totalPackets:0,W.audioDelay+=a.audio.currentDelay?
a.audio.currentDelay:0,d+=1);a&&a.video&&(W.outVideoKBitRate+=a.video.bitsPerSecond?a.video.bitsPerSecond:0,W.outBytes+=a.video.bitsPerSecond?a.video.bitsPerSecond:0,W.outPackets+=a.video.totalPackets?a.video.totalPackets:0,W.videoDelay+=a.video.currentDelay?a.video.currentDelay:0,e+=1)});W.audioDelay=isNaN(parseInt(W.audioDelay/d))?0:parseInt(W.audioDelay/d);W.videoDelay=isNaN(parseInt(W.videoDelay/e))?0:parseInt(W.videoDelay/e);c.forEach(function(a){a&&a.audio&&(W.inAudioKBitRate+=a.audio.bitsPerSecond?
a.audio.bitsPerSecond:0,W.inBytes+=a.audio.audioBytesSent?a.audio.audioBytesSent:0,W.inPackets+=a.audio.totalPackets?a.audio.totalPackets:0);a&&a.video&&(W.inVideoKBitRate+=a.video.bitsPerSecond?a.video.bitsPerSecond:0,W.inBytes+=a.video.bitsPerSecond?a.video.bitsPerSecond:0,W.inPackets+=a.video.totalPackets?a.video.totalPackets:0)});a=(new Date).getTime()-TK.connectTimer;W.duration=0<=a?a:0;a=TK.RoomEvent({type:TK.EVENT_TYPE.roomRtcStatsReportEvent,message:{stats:W}});t.dispatchEvent(a)}).catch(function(a){L.Logger.warning(q,
"[tk-sdk]catonNumber promise error info :",a)})},1E3);t.sendcatonNumber=setInterval(function(){try{if(Da&&Da.length){L.Utils.isArray(Da)&&(Da=Da.filter(function(a){return a.count}));var a={serial:l._room_properties.serial,companyid:l._room_properties.companyid,peerid:l._myself.id,statistics:Da,streamstat:Object.values(za)},b=l._web_protocol+"://"+l._web_host+":"+l._web_port+"/ClientAPI/networkequipmentcount?ts\x3d"+(new Date).getTime();L.Utils.sdkAjax({url:b,dataType:"json",type:"POST",async:!0,data:a,
success:function(a){Da=[]},error:function(a,b,c){L.Logger.error(q,"[tk-sdk]sendcatonNumber fail[ XHR , textStatus , errorThrown ]:",a,b,c)}})}}catch(Zb){L.Logger.warning(q,"[tk-sdk]sendcatonNumber method was a slight problem with the handling.")}},6E4)}Na=Ma=0;try{l&&l._useServerScreenRecording&&talkrecoder&&(L.Logger.info(q,"recoder class set state,state is "+window.TK.TALKRECODER.STATE_ROOM_CONNECTED+",roomid is "+l._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(l._myself)),talkrecoder.setstate(window.TK.TALKRECODER.STATE_ROOM_CONNECTED))}catch(Nb){L.Logger.error(q,
"[tk-sdk]talkrecoder err:",Nb)}a=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnected,streams:a,message:m});t.dispatchEvent(a);TK.connectTimer=(new Date).getTime()}};ka._handler_connectSocketFail=function(a){l._isLeaveRoom?L.Logger.info(q,"[tk-sdk]The room is over. Method _handler_connectSocketFail cannot be executed!"):(L.Logger.error(q,"[tk-sdk]Not Connected! Error: "+a),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"joinRoom",error:window.TK_ERR.ROOM_JOIN_FAILED,errorCode:window.TK_ERR.ROOM_JOIN_FAILED}}),
t.dispatchEvent(a),a=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"joinRoom",error:window.TK_ERR.ROOM_JOIN_FAILED,errorCode:window.TK_ERR.ROOM_JOIN_FAILED}}),t.dispatchEvent(a))};qa.onNativeStartShareMediaFile=function(a,b,c,d){var e=TK.MEDIAFILESTATE_ON;e!==Eb()&&(t.changeUserShare(y(),e,"tk_mediafilestate"),e=fa(y()+":file"),L.Utils.isNull(e)?(e=Ba("file",a),d&&d.IgnoreElementId?(e.create(),qa.pauseShareMediaFile(!0)):e.play(b),e.needPublishToServer=!0,L.Logger.info(q,"[tk-sdk]calling localFilePublish stream , stream id:"+
e.getID()+" , extensionId is "+e.extensionId+", attrs is "+L.Utils.toJsonStringify(e.getAttributes())),e&&void 0===t.remoteStreams[e.getID()]?Ca(e,function(a,b){a||L.Utils.isFunction(c)&&c(b)}):(L.Logger.error(q,"[tk-sdk]Trying to publish invalid LocalFileStream",e),L.Utils.isFunction(c)&&c(void 0,"Trying to publish invalid LocalFileStream"))):(L.Utils.isFunction(c)&&c("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error(q,"[tk-sdk]Share media file in progress.")))};qa.onNativeStopShareMediaFile=function(a){var b=
TK.MEDIAFILESTATE_OFF;b!==Eb()&&(t.changeUserShare(y(),b,"tk_mediafilestate"),b=fa(y()+":file"),L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning(q,"[tk-sdk]Could not find the specify stream while stop sharing media file.")):(b.stop(),b.needPublishToServer=!1,L.Logger.info(q,"[tk-sdk]calling unpublishLocalFile , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),ra(b,function(b,c){b||L.Utils.isFunction(a)&&
a(c)}),U(y()+":"+TK.STREAM_FILE)&&ea(y()+":"+TK.STREAM_FILE)))};qa.onNativeStartShareScreen=function(a,b){var c=fa(y()+":screen");L.Utils.isNull(c)?(c=Ba("screen",a),c.needPublishToServer=!0,L.Logger.info(q,"[tk-sdk]calling screenPublish stream , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),void 0===t.remoteStreams[c.getID()]?Ca(c,void 0,function(a,c){a||L.Utils.isFunction(b)&&b(c)}):(L.Logger.error(q,"[tk-sdk]Trying to publish invalid screenStream",
c),L.Utils.isFunction(b)&&b(void 0,"Trying to publish invalid screenStream"))):(L.Utils.isFunction(b)&&b("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error(q,"[tk-sdk]Share screen in progress."))};qa.onNativeStopShareScreen=function(a){var b=fa(y()+":"+TK.STREAM_SCREEN);L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning(q,"[tk-sdk]Could not find the specify stream while stop sharing screen.")):(b.needPublishToServer=!1,L.Logger.info(q,"[tk-sdk]calling unpublishScreen , stream id:"+
b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),ra(b,function(b,c){b||L.Utils.isFunction(a)&&a(c)}),U(y()+":"+TK.STREAM_SCREEN)&&ea(y()+":"+TK.STREAM_SCREEN))};qa.onNativeNotification=function(a){if("object"===typeof a)switch(a.name){case "onMediaFileEnded":(a=aa(y(),"file"))&&qa.pauseShareMediaFile(!0);a=TK.RoomEvent({type:TK.EVENT_TYPE.roomClientNotificationOnMediaFileEnded});t.dispatchEvent(a);break;case "onRemoteAudioVolume":var b=a.args;
if(!L.Utils.isNull(b)&&(a=aa(b.id,b.type||TK.STREAM_VIDEO))&&L.Utils.isFunction(a.onRemoteAudioVolume))a.onRemoteAudioVolume(b.volume);break;case "onAudioStatsDelivered":a&&"object"===typeof a.args&&Db(a.args.connectionId,a.args.stats,!1);break;case "onVideoStatsDelivered":a&&"object"===typeof a.args&&Db(a.args.connectionId,a.args.stats,!0);break;default:a=TK.RoomEvent({type:TK.EVENT_TYPE.roomNativeNotification,message:a}),t.dispatchEvent(a)}};qa.onMicVolumeReport=function(a){if("object"===typeof a){var b=
aa(y(),TK.STREAM_VIDEO,l._mainCameraDeviceId);if(b&&L.Utils.isFunction(b.onMicVolumeReport))b.onMicVolumeReport(a.volume)}};qa.onPauseMediaFile=function(a){var b=aa(y(),TK.STREAM_FILE);b&&t.remoteStreams[b.getID()]&&"file"===b.getAttributes().type&&H.controlMedia(b.getID(),{type:"pause",pause:a})};qa.onSeekMediaFile=function(a){var b=aa(y(),TK.STREAM_FILE);b&&t.remoteStreams[b.getID()]&&"file"===b.getAttributes().type&&(a=parseInt(a*b.getAttributes().duration),a>b.getAttributes().duration&&(a=b.getAttributes().duration),
H.controlMedia(b.getID(),{type:"seek",pos:a}))};qa.onNativeWindowClose=function(){var a=TK.RoomEvent({type:TK.EVENT_TYPE.roomClientClose});t.dispatchEvent(a)};D.getDeviceMgr().onDevicesSetted=function(a,b,c){TK.isMultiCamera&&void 0!==a.videoinput&&a.videoinput!==l._mainCameraDeviceId&&(L.Utils.isVideoinputDeviceIdFromDeviceList(a.videoinput)?Ja(a.videoinput):(L.Logger.warning(q,"[tk-sdk]The device id("+a.videoinput+") is not in the video device list,not allow set main camera!"),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,
l._mainCameraDeviceId)));b=ba(TK.STREAM_VIDEO);c=0;for(var d=b.length;c<d;c++){var e=b[c];TK.isMultiCamera||void 0!==a.videoinput&&a.videoinput!==e.videoinputDeviceId&&Ya(e,a.videoinput);void 0!==a.audioinput&&a.audioinput!==e.audioinputDeviceId&&eb(e,a.audioinput)}};D.getDeviceMgr().onCameraSetted=function(a,b,c){TK.isMultiCamera&&void 0!==a&&a!==l._mainCameraDeviceId&&(L.Utils.isVideoinputDeviceIdFromDeviceList(a)?Ja(a):(L.Logger.warning(q,"[tk-sdk]The device id("+a+") is not in the video device list,not allow set main camera!"),
L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,l._mainCameraDeviceId)));Fb(a,L.Constant.deviceStorage.videoinput)};D.getDeviceMgr().onMicrophoneSetted=function(a,b,c){Fb(a,L.Constant.deviceStorage.audioinput)};D.getDeviceMgr().onSpeakerSetted=function(a,b,c){};D.getDeviceMgr().onDeviceChanged=function(a,b,c,d){for(var e in b)if("videoinput"===e||"audioinput"===e){var f=b[e];if(f&&f.length)for(var h=0,k=f.length;h<k;h++)if(f[h]){var g=f[h].deviceId;if("videoinput"===e){var A=Z(g);
A&&A.removeVideoTrack();D.hasDeviceVideoTrack(g)&&D.destroyVideoTrack(g)}else if("audioinput"===e){var m=ba(TK.STREAM_VIDEO),n=0;for(k=m.length;n<k;n++)A=m[n],A.audioinputDeviceId===g&&A.removeAudioTrack();D.hasDeviceAudioTrack(g)&&D.destroyAudioTrack(g)}}}for(e in a)if(("videoinput"===e||"audioinput"===e)&&(f=a[e])&&f.length)for(h=0,k=f.length;h<k;h++)if(f[h])if(g=f[h].deviceId,"videoinput"===e)(A=Z(g))&&A.videoinputDeviceId===g&&Ya(A,A.videoinputDeviceId,!0);else if("audioinput"===e)for(m=ba(TK.STREAM_VIDEO),
n=0,k=m.length;n<k;n++)A=m[n],A.audioinputDeviceId===g&&eb(A,A.audioinputDeviceId,!0);if(l._autoProcessDevChangeEvent){var U=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);D.getDeviceMgr().getDevices(function(e){var f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),h=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),k=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);U!==k&&(TK.isTkNative?D.getDeviceMgr().setDevices({audiooutput:k}):
D.getDeviceMgr().associateElementsToSpeaker(void 0,k));if(l._myself){e=e.hasdevice;k={};var g=!1;var A=l._myself.hasvideo;var m=l._myself.hasaudio;l._myself.hasvideo!==e.videoinput&&(k.hasvideo=e.videoinput,l._myself.hasvideo=k.hasvideo,g=!0);l._myself.hasaudio!==e.audioinput&&(k.hasaudio=e.audioinput,l._myself.hasaudio=k.hasaudio,g=!0);g&&(L.Logger.info(q,"[tk-sdk]change device:my old device info  [hasvideo , hasaudio] is ["+A+" ,"+m+"] , change device property is "+L.Utils.toJsonStringify(k)),l._isConnected&&
t.changeUserProperty(y(),"__all",k));A=ba(TK.STREAM_VIDEO);e=0;for(k=A.length;e<k;e++)m=A[e],h!==m.audioinputDeviceId&&eb(m,h),TK.isMultiCamera||f!==m.videoinputDeviceId&&Ya(m,f);if(TK.isMultiCamera){if(f=b.videoinput)for(e=0,k=f.length;e<k;e++)f[e]&&(h=f[e].deviceId,A=TK.isMultiCamera?oa(h):l._myself.publishstate,A!==TK.PUBLISH_STATE_VIDEOONLY&&A!==TK.PUBLISH_STATE_BOTH||t.unpublishVideo(h),h===l._mainCameraDeviceId&&Ja(C()));(f=a.videoinput)&&f.length&&(l._mainCameraDeviceId||Ja(C()))}}L.Utils.isFunction(d)&&
d(a,b,c)},{isSetlocalStorage:!0})}else{if(TK.isMultiCamera){if((e=b.videoinput)&&e.length){h=0;for(k=e.length;h<k;h++)e[h]&&e[h].deviceId===l._mainCameraDeviceId&&Ja(C());l._mainCameraDeviceId||Ja(C())}(h=a.videoinput)&&h.length&&(l._mainCameraDeviceId||Ja(C()))}L.Utils.isFunction(d)&&d(a,b,c)}};D.getDeviceMgr().getDevices();return t};window.TK=window.TK||{};window.L=window.L||{};
TK.RoomUser=function(f){var k={fileName:"RoomUser.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};if(void 0==f||void 0===f.properties)L.Logger.warning(k,"[tk-sdk]Invalidate user info",g,d);else{var g=f.id,d=f.properties;L.Logger.debug(k,"[tk-sdk]RoomUser",g,d);f={};f.id=g;f.watchStatus=0;for(var a in d)"id"!=a&&"watchStatus"!=a&&(f[a]=d[a]);f.publishstate=f.publishstate||TK.PUBLISH_STATE_NONE;f.tk_screenstate=TK.SCREENSTATE_OFF;f.tk_mediafilestate=TK.MEDIAFILESTATE_OFF;return f}};window.TK=window.TK||{};window.L=window.L||{};
TK.Signalling=function(){function f(){if(arguments.length){var a=arguments[0];if("function"===typeof k[a]){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);k[a].apply(k[a],b)}}}var k={},g=null,d={fileName:"Signalling.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};k.sendMessageSocket=function(a,b,c){L.Logger.debug(d,"[tk-sdk]sendMessageSocket",a,b);k.socketSend(a,b,c)};k.connectSocket=function(a,b){b=b||{};b.secure=L.Utils.isBoolean(b.secure)?b.secure:!0;b.reconnection=
L.Utils.isBoolean(b.reconnection)?b.reconnection:!0;b.transports=Array.isArray(b.transports)?b.transports:["websocket"];window.TK.socketIO?(g=window.TK.socketIO.connect(a,{secure:b.secure,reconnection:b.reconnection,transports:b.transports}),g.on("connect_error",f.bind(f,"onConnectError")),g.on("connect",f.bind(f,"onConnect")),g.on("onAddStream",f.bind(f,"onAddStream")),g.on("signaling_message_mediaserver",f.bind(f,"onSignalingMessageMediaserver")),g.on("onUpdateAttributeStream",f.bind(f,"onUpdateAttributeStream")),
g.on("publish_failed",f.bind(f,"onPublishFailed")),g.on("subscribe_failed",f.bind(f,"onSubscribeFailed")),g.on("onRemoveStream",f.bind(f,"onRemoveStream")),g.on("disconnect",f.bind(f,"onDisconnect")),g.on("reconnecting",f.bind(f,"onReconnecting")),g.on("participantLeft",f.bind(f,"onParticipantLeft")),g.on("participantJoined",f.bind(f,"onParticipantJoined")),g.on("participantPublished",f.bind(f,"onParticipantPublished")),g.on("participantEvicted",f.bind(f,"onParticipantEvicted")),g.on("sendMessage",
f.bind(f,"onSendMessage")),g.on("msgList",f.bind(f,"onMsgList")),g.on("pubMsg",f.bind(f,"onPubMsg")),g.on("delMsg",f.bind(f,"onDelMsg")),g.on("setProperty",f.bind(f,"onSetProperty")),g.on("playback_clearAll",f.bind(f,"onPlaybackClearAll")),g.on("duration",f.bind(f,"onDuration")),g.on("playbackEnd",f.bind(f,"onPlaybackEnd")),g.on("playback_updatetime",f.bind(f,"onPlaybackUpdatetime")),g.on("forceReconnect",f.bind(f,"onForceReconnect"))):L.Logger.error(d,"[tk-sdk]socket.io is not exist,please link socket.io,for example: window.TK.SocketIO \x3d io (io is the socket.io that you want to associate with)!")};
k.socketSend=function(){if(arguments.length&&g)if("string"===typeof arguments[0]){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);g.emit.apply(g,a)}else L.Logger.warning(d,"[tk-sdk] PARAMETER ERROR ")};k.controlMedia=function(a,b){g&&g.emit("controlmedia",a,b)};k.isHasSocket=function(){return g?!0:!1};k.emptySocket=function(){g=void 0};k.socketDisconnect=function(){g&&g.disconnect()};return k}();window.TK=window.TK||{};window.L=window.L||{};TK.Stream=function(f,k){return k?TK.NativeStream(f):TK.StreamInner(f)};
TK.StreamInner=function(f){function k(){d();g();if("function"!==typeof h.onSuccess){if(L.Logger.error(u,"[tk-sdk] intervalCallback must is function!"),L.Utils.isFunction(h.onFailure))h.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function")}else{try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext}catch(B){L.Logger.error(u,"[tk-sdk]startIntervalGetRealtimeVolume:Web Audio API(audioContext) not supported");
if(L.Utils.isFunction(h.onFailure))h.onFailure(B);return}try{if(b&&b.stop&&(b.stop(),b=void 0),b=null,a&&a.attributes&&TK.audioContext&&TK.DeviceMgr&&TK.DeviceMgr.getsSoundMeterInstance)L.Utils.isFunction(n)&&n(a.getID(),a.publisherId(),a.attributes.type,{audioinputDeviceId:a.audioinputDeviceId},function(a){b=void 0;d();L.Utils.isFunction(h.onSuccess)||g();var e=L.Utils.createMediaStream();if(e&&a)if(e.addTrack(a),(b=TK.DeviceMgr.getsSoundMeterInstance(TK.audioContext,{mediaStream:e}))&&b.connectToSource)b.connectToSource(e,
function(a){d();L.Utils.isFunction(h.onSuccess)||g();if(a){if(L.Logger.error(u,"[tk-sdk]startIntervalGetRealtimeVolume connectToSource error:",a),g(),L.Utils.isFunction(h.onFailure))h.onFailure(a)}else if(b){if(b&&b.instant&&b.instant.toFixed){if(a=Math.floor(100*b.instant.toFixed(2)),L.Utils.isFunction(h.onSuccess))h.onSuccess(a)}else if(L.Utils.isFunction(h.onSuccess))h.onSuccess(0);clearInterval(c);c=setInterval(function(){if(L.Utils.isFunction(h.onSuccess))if(b&&b.instant&&b.instant.toFixed){var a=
Math.floor(100*b.instant.toFixed(2));h.onSuccess(a)}else h.onSuccess(0);else g()},h.interval)}else if(L.Utils.isFunction(h.onSuccess))h.onSuccess(0)});else{if(L.Utils.isFunction(h.onSuccess))h.onSuccess(0)}else if(L.Utils.isFunction(h.onSuccess))h.onSuccess(0)},function(a){b=void 0;if(L.Utils.isFunction(h.onSuccess))h.onSuccess(0)});else if(L.Utils.isFunction(h.onSuccess))h.onSuccess(0)}catch(B){if(L.Logger.error(u,"[tk-sdk]startIntervalGetRealtimeVolume error :",B),L.Utils.isFunction(h.onFailure))h.onFailure(B)}}}
function g(){b&&b.stop&&b.stop();clearInterval(c);c=b=void 0;d()}function d(){L.Utils.isFunction(x)&&(h=x(a.publisherId(),a.attributes.type));h||(h={onSuccess:void 0,onFailure:void 0,interval:100,isWaiting:!1})}var a=TK.EventDispatcher(f),b=void 0,c=void 0,e=void 0,m=!1,u={fileName:"Stream.js",peerid:TK.myPeerid?TK.myPeerid:"",serial:TK.mySerial?TK.mySerial:""};void 0!==f.video&&"number"===typeof f.video&&(f.video=0!==f.video);void 0!==f.audio&&"number"===typeof f.audio&&(f.audio=0!==f.audio);a.classInstanceName=
"Stream";a.url=f.url;a.local=L.Utils.isBoolean(f.local)?f.local:!0;a.video=f.video;a.audio=f.audio;a.screen=f.screen;a.scale=f.scale;a.media=f.media;a.data=f.data;a.extensionId=f.extensionId;a.path=f.path||"";a.attributes=f.attributes||{};a.isTkNative=!1;a.streamID=f.streamID;a.audioinputDeviceId=f.audioinputDeviceId;a.videoinputDeviceId=f.videoinputDeviceId;var r=f.getVideoTrack,n=f.getAudioTrack,x=f.getRegisterAudioVolumeListener,h={onSuccess:void 0,onFailure:void 0,interval:100,isWaiting:!1},p=
void 0,v=void 0,E=void 0;a.getID=function(){return a.local&&!a.streamID?"local":a.streamID};a.id=a.getID();a.destroy=function(){a.stopIntervalGetRealtimeVolume();a.removeAudioTrack();a.removeVideoTrack();p&&a.unplayVideo();v&&a.unplayAudio()};a.publisherId=function(){var b=a.extensionId.split(":");return b.length?b[0]:a.extensionId};a.getAttributes=function(){return a.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(b){if(b&&"object"===typeof b)for(var c in b)a.attributes[c]=
b[c]};a.hasAudio=function(){return a.audio};a.hasVideo=function(){return a.video};a.hasScreen=function(){return a.screen};a.hasMedia=function(){return a.media};a.hasData=function(){return a.data};a.hasVideoPlayer=function(){return!!p};a.getVideoPlayer=function(){return p};a.hasAudioPlayer=function(){return!!v};a.getAudioPlayer=function(){return v};a.getVideoPlayerElementId=function(){return E};a.playVideo=function(b,c){c=c||{};if(void 0!==b&&(p&&a.unplayVideo(),E=b,a.local&&(c.mirror=L.Utils.isBoolean(c.mirror)?
c.mirror:m),p=new TK.VideoPlayer({id:a.extensionId,elementID:b,local:a.local,type:a.attributes.type,userid:a.publisherId(),bundleId:a.extensionId,extensionId:a.extensionId,options:c}),TK.isOnlyAudioRoom&&p.hideVideo(),L.Utils.isFunction(r))){var d="videoplayer_"+(new Date).getTime();p.videoTrackTempId=d;r(a.getID(),a.publisherId(),a.attributes.type,{videoinputDeviceId:a.videoinputDeviceId},function(a){p&&d===p.videoTrackTempId&&(p.hasVideoTrack()&&p.removeVideoTrack(),p.addVideoTrack(a))},function(a){L.Logger.debug(u,
"[tk-sdk]playVideo:getVideoTrack fail,fail info:",a)})}};a.playAudio=function(c){c=c||{};if(!document.getElementById("TKSDK_audioPlayer_list_container")){var e=document.createElement("div");e.setAttribute("id","TKSDK_audioPlayer_list_container");e.style.display="none";document.body.appendChild(e)}v&&a.unplayAudio();v=new TK.AudioPlayer({id:a.extensionId,elementID:"TKSDK_audioPlayer_list_container",local:a.local,type:a.attributes.type,userid:a.publisherId(),bundleId:a.extensionId,extensionId:a.extensionId,
options:c});if(L.Utils.isFunction(n)){var f="audioplayer_"+(new Date).getTime();v.audioTrackTempId=f;n(a.getID(),a.publisherId(),a.attributes.type,{audioinputDeviceId:a.audioinputDeviceId},function(a){v&&f===v.audioTrackTempId&&(v.hasAudioTrack()&&v.removeAudioTrack(),v.addAudioTrack(a))},function(a){L.Logger.debug(u,"[tk-sdk]playAudio:getAudioTrack fail,fail info:",a)})}a.local&&a.attributes.type===TK.STREAM_VIDEO||(d(),h.isWaiting&&void 0===b&&k())};a.unplayVideo=function(){p&&p.destroy();p=void 0;
a.local&&a.attributes.type===TK.STREAM_VIDEO||v||g()};a.unplayAudio=function(){v&&v.destroy();v=void 0;a.local&&a.attributes.type===TK.STREAM_VIDEO||g()};a.getVideoPlayerOptions=function(){if(p&&p.getVideoPlayerOptions)return p.getVideoPlayerOptions()};a.updateVideoPlayerOptions=function(a){p&&p.updateVideoPlayerOptions&&p.updateVideoPlayerOptions(a)};a.updateAudioPlayerOptions=function(a){v&&v.updateAudioPlayerOptions&&v.updateAudioPlayerOptions(a)};a.showVideo=function(){p&&p.showVideo()};a.hideVideo=
function(){p&&p.hideVideo()};a.getAudioTrack=function(){v&&v.getAudioTrack()};a.hasAudioTrack=function(){v&&v.hasAudioTrack()};a.removeAudioTrack=function(){v&&v.removeAudioTrack()};a.addAudioTrack=function(c){a.hasAudioTrack()&&a.removeAudioTrack();v&&v.addAudioTrack(c);d();g();h.isWaiting&&void 0===b&&k()};a.getVideoTrack=function(){p&&p.getVideoTrack()};a.hasVideoTrack=function(){p&&p.hasVideoTrack()};a.removeVideoTrack=function(){p&&p.removeVideoTrack()};a.addVideoTrack=function(b){a.hasVideoTrack()&&
a.removeVideoTrack();p&&p.addVideoTrack(b)};a.setMute=function(a){v&&v.setMute&&v.setMute(a)};a.setVolume=function(a){v&&v.setVolume&&("number"!==typeof a?L.Logger.error(u,"[tk-sdk]Stream setVolume volume type must is number!"):v.setVolume(a))};a.getVolume=function(a){if(v&&v.getVolume)return v.getVolume(a);L.Utils.isFunction(a)&&a(0);return 0};a.startIntervalGetRealtimeVolume=function(){a.stopIntervalGetRealtimeVolume();d();k()};a.stopIntervalGetRealtimeVolume=function(){g();d()};a.hideLoading=function(){p&&
p.hideLoading&&p.hideLoading()};a.showLoading=function(){p&&p.showLoading&&p.showLoading()};a.getVideoElement=function(){return p&&p.video};a.setLocalVideoMirror=function(b){a.local&&(m=b,a.updateVideoPlayerOptions({mirror:b}))};a.getRealtimeVolume=function(b,c){if(L.Utils.isFunction(b))try{e&&e.stop&&(e.stop(),e=void 0),window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext,a&&a.attributes&&
TK.audioContext&&TK.DeviceMgr&&TK.DeviceMgr.getsSoundMeterInstance?L.Utils.isFunction(n)&&n(a.getID(),a.publisherId(),a.attributes.type,{audioinputDeviceId:a.audioinputDeviceId},function(a){var d=L.Utils.createMediaStream();d&&a?(d.addTrack(a),(e=TK.DeviceMgr.getsSoundMeterInstance(TK.audioContext,{mediaStream:d}))&&e.connectToSource?e.connectToSource(d,function(a){a?(L.Logger.error(u,"[tk-sdk]getRealtimeVolume connectToSource error:",a),L.Utils.isFunction(c)&&c(a)):(e&&e.instant&&e.instant.toFixed?
(a=Math.floor(100*e.instant.toFixed(2)),b(a)):b(0),e&&e.stop&&(e.stop(),e=void 0))}):b(0)):b(0)},function(a){b(0)}):b(0)}catch(M){L.Logger.error(u,"[tk-sdk]getRealtimeVolume:Web Audio API(audioContext) not supported",M),L.Utils.isFunction(c)&&c(M)}else L.Logger.error(u,"[tk-sdk] getRealtimeVolume: onVolume is not function"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")};a.updateExtensionId=function(b){a.extensionId=b;p&&p.updateVideoPlayerSpec&&p.updateVideoPlayerSpec({id:a.extensionId,userid:a.publisherId(),
bundleId:a.extensionId,extensionId:a.extensionId});v&&v.updateAudioPlayerSpec&&v.updateAudioPlayerSpec({id:a.extensionId,userid:a.publisherId(),bundleId:a.extensionId,extensionId:a.extensionId})};d();return a};!function(f,k){"object"==typeof exports&&"undefined"!=typeof module?module.exports=k():"function"==typeof define&&define.amd?define(k):f.Logline=k();"undefined"!==typeof window&&(window.Logline=k())}(this,function(){function f(a,b){var d={};"string"==typeof a?d[a]=b:"[object Object]"===Object.prototype.toString.call(a)&&(d=a);c(n,d)}function k(a){h&&console.error("Logline: "+a)}function g(a,b,c){if(h&&x.get().verbose){var d;(d=window.console)[p[b.toUpperCase()]||p.INFO].apply(d,[a+" "+b.toUpperCase()].concat(r(c||
"")))}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");},b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,
c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),c=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},e=function O(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:O(a,b,c);if("value"in d)return d.value;b=d.get;if(void 0!==b)return b.call(c)},m=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},u=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},r=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},n=c({},{verbose:!0}),x=f;x.set=
f;x.get=function(a){return a?n[a]:n};var h=window.console,p={INFO:"log",WARN:"warn",ERROR:"error",CRITICAL:"error"},v=function(){function c(b){a(this,c);this._namespace=b}return b(c,[{key:"_record",value:function(a,b,c){k("method _record is not implemented.")}},{key:"info",value:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];a=[].concat(b).filter(function(a,b){return 1==b});b=[].concat(b).filter(function(a,b){return 1!=b});this._record.apply(this,["info"].concat(r(a),
[b]))}},{key:"warn",value:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];a=[].concat(b).filter(function(a,b){return 1==b});b=[].concat(b).filter(function(a,b){return 1!=b});this._record.apply(this,["warn"].concat(r(a),[b]))}},{key:"error",value:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];a=[].concat(b).filter(function(a,b){return 1==b});b=[].concat(b).filter(function(a,b){return 1!=b});this._record.apply(this,["error"].concat(r(a),
[b]))}},{key:"critical",value:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];a=[].concat(b).filter(function(a,b){return 1==b});b=[].concat(b).filter(function(a,b){return 1!=b});this._record.apply(this,["critical"].concat(r(a),[b]))}}],[{key:"init",value:function(a){return!0}},{key:"transTimeFormat",value:function(a,b){if(!a||/^\d{13}$/.test(a))return+a;if(b&&!/^\d{13}$/.test(b))throw new TypeError("relative time should be standard unix timestamp");return(b||Date.now())-
864E5*a.replace(/d$/,"")}},{key:"get",value:function(a,b,c){k("method get is not implemented.")}},{key:"keep",value:function(a){k("method keep is not implemented.")}},{key:"clean",value:function(){k("method clean is not implemented.")}},{key:"STATUS",get:function(){return{INITING:1,INITED:2,FAILED:4}}}]),c}(),E=function(){function c(){a(this,c);this._pool=[]}return b(c,[{key:"push",value:function(a,b){a.context=b;this._pool.push(a)}},{key:"consume",value:function(){for(var a;a=this._pool.shift();)a.call(a.context)}}]),
c}(),B=function(c){function f(){var b;a(this,f);for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return u(this,(b=f.__proto__||Object.getPrototypeOf(f)).call.apply(b,[this].concat(d)))}return m(f,c),b(f,[{key:"_record",value:function(a,b,c){var e=this;try{var h=function T(a){a.forEach(function(a,b){"string"!=typeof a&&a&&a.constructor?a.constructor===Array?T(a):p+=JSON.stringify(a):p+=a})};if(f.status!==v.STATUS.INITED)return f._pool.push(function(){return e._record(a,b,c)}),void(f.status!==
v.STATUS.INITING&&f.init());g(this._namespace,a,c);var m=f.db.transaction(["logs"],"readwrite");m.onerror=function(a){return k(a.target.error)};var n=m.objectStore("logs");m="2";"debug"===a?m="3":"info"===a?m="4":"warn"===a?m="5":"error"===a&&(m="6");var p="";!function(a){a.forEach(function(a,b){1>=b||("string"!=typeof a&&a&&a.constructor?a.constructor===Array?h(a):p+=JSON.stringify(a):p+=a)})}([].concat(Array.prototype.slice.call(arguments)));var r=n.add({ts:Date.now(),level:m,log:p,file:b&&b.fileName?
b.fileName:"",serial:b&&b.serial?b.serial:"",peerid:b&&b.peerid?b.peerid:"",line:null});b&&"object"===(void 0===b?"undefined":d(b))||console.warn("logLine error : The logging interface rule of the call: [Object (not displayed), normal output content...]");r.onerror=function(a){f.status=v.STATUS.FAILED;k(a.target.error)}}catch(ia){k("failed to write, "+ia.message)}}}],[{key:"init",value:function(a){var b=this;try{if(f.support||k("your platform does not support indexeddb protocol."),f.status)return!1;
f._pool=f._pool||new E;f._database=a||"logline";f.status=e(f.__proto__||Object.getPrototypeOf(f),"STATUS",this).INITING;f.request=window.indexedDB.open(f._database);f.request.onerror=function(a){return k("protocol indexeddb is prevented.")};f.request.onsuccess=function(a){f.db=a.target.result;f.status=e(f.__proto__||Object.getPrototypeOf(f),"STATUS",b).INITED;f._pool.consume();f.db.onerror=function(a){return k(a.target.error)}};f.request.onupgradeneeded=function(a){a=a.target.result.createObjectStore("logs",
{autoIncrement:!0});a.createIndex("level","level",{unique:!1});a.createIndex("file","file",{unique:!1});a.createIndex("log","log",{unique:!1});a.createIndex("line","line",{unique:!1})}}catch(F){k("failed init, "+F.message)}}},{key:"get",value:function(a,b,c){try{if(f.status!==e(f.__proto__||Object.getPrototypeOf(f),"STATUS",this).INITED)return f._pool.push(function(){return f.get(a,b,c)});a=v.transTimeFormat(a);b=v.transTimeFormat(b);var d=f._getTransactionStore(IDBTransaction.READ_ONLY);if(!d)return c([]);
if(d.getAll){var h=void 0,g=[];d.getAll().onsuccess=function(d){h=d.target.result;for(d=0;d<h.length;d++)a&&h[d].ts<a||b&&h[d].ts>b||g.push(h[d]);c(g)}}else{var m=[];d.openCursor().onsuccess=function(d){if(d=d.target.result){if(a&&d.value.ts<a||b&&d.value.ts>b)return d.continue();m.push({ts:d.value.ts,level:d.value.level,descriptor:d.value.descriptor,log:d.value.log,line:null,file:d.value.file});d.continue()}else c(m)}}}catch(va){k("failed to get logs, "+va.message)}}},{key:"keep",value:function(a){try{if(f.status!==
e(f.__proto__||Object.getPrototypeOf(f),"STATUS",this).INITED)return f._pool.push(function(){return f.keep(a)});var b=f._getTransactionStore("readwrite");if(!b)return!1;if(a){var c=Date.now()-864E5*(a||2),d=b.openCursor();d.onsuccess=function(a){(a=a.target.result)&&a.value.ts<c&&(b.delete(a.primaryKey),a.continue())};d.onerror=function(b){return k("unable to locate logs earlier than "+a+"d.")}}else b.clear().onerror=function(a){return k(a.target.error)}}catch(S){k("failed to keep logs, "+S.message)}}},
{key:"clean",value:function(){try{if(f.status!==e(f.__proto__||Object.getPrototypeOf(f),"STATUS",this).INITED)return f._pool.push(function(){return f.clean()});f.db.close();var a=window.indexedDB.deleteDatabase(f._database);a.onerror=function(a){return k(a.target.error)};a.onsuccess=function(a){delete f.status;delete f.db}}catch(O){k("failed to cleanup logs, "+O.message)}}},{key:"_getTransactionStore",value:function(a){try{if(f.db){var b=f.db.transaction(["logs"],a||"readwrite");return b.onerror=
function(a){return k(a.target.error)},b.objectStore("logs")}k("log database is not created or connections are closed, considering init it.")}catch(F){return k("failed to generate new transaction, "+F.message),!1}}},{key:"support",get:function(){return!!(window.indexedDB&&window.IDBTransaction&&window.IDBKeyRange)}}]),f}(v),K=function(c){function d(){var b;a(this,d);for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return u(this,(b=d.__proto__||Object.getPrototypeOf(d)).call.apply(b,
[this].concat(e)))}return m(d,c),b(d,[{key:"_record",value:function(a,b,c){try{var e=window.localStorage.getItem(d._database)?JSON.parse(window.localStorage.getItem(d._database)):[];e.push([Date.now(),this._namespace,a,b,c]);g(this._namespace,a,b);window.localStorage.setItem(d._database,JSON.stringify(e))}catch(S){window.localStorage.removeItem(d._database),window.localStorage.setItem(d._database,JSON.stringify([])),k("failed to write, may be localStorage is full, "+S.message)}}}],[{key:"init",value:function(a){try{d.support||
k("your platform does not support localstorage protocol."),d._database=a||"logline",window.localStorage.getItem(d._database)||window.localStorage.setItem(d._database,JSON.stringify([])),d.status=e(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED}catch(O){k("failed to init, "+O.message)}}},{key:"get",value:function(a,b,c){var e;try{var f=JSON.parse(window.localStorage.getItem(d._database));a=v.transTimeFormat(a);b=v.transTimeFormat(b);for(e=0;e<f.length;e++)a&&f[e][0]<a||b&&f[e][0]>b||(f[e]=
{time:f[e][0],namespace:f[e][1],level:f[e][2],descriptor:f[e][3],data:f[e][4]});c(f)}catch(Y){k("failed to get, "+Y.message),c([])}}},{key:"keep",value:function(a){try{var b=a?(window.localStorage.getItem(d._database)?JSON.parse(window.localStorage.getItem(d._database)):[]).filter(function(b){return b.time>=Date.now()-864E5*(a||2)}):[];window.localStorage.setItem(d._database,JSON.stringify(b))}catch(F){k("failed to keep, "+F.message)}}},{key:"clean",value:function(){try{delete d.status,window.localStorage.removeItem(d._database)}catch(I){k("failed to clean, "+
I.message)}}},{key:"support",get:function(){return"localStorage"in window}}]),d}(v),M=function(c){function d(){var b;a(this,d);for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return u(this,(b=d.__proto__||Object.getPrototypeOf(d)).call.apply(b,[this].concat(e)))}return m(d,c),b(d,[{key:"_record",value:function(a,b,c){var e=this;if(d.status!==v.STATUS.INITED)return d._pool.push(function(){return e._record(a,b,c)}),void(d.status!==v.STATUS.INITING&&d.init());try{g(this._namespace,
a,b),d._db.transaction(function(d){d.executeSql("INSERT INTO logs (time, namespace, level, descriptor, data) VALUES(?, ?, ?, ? ,?)",[Date.now(),e._namespace,a,b,void 0===c||""===c?"":JSON.stringify(c)||""],function(){},function(a,b){k("write error, "+b.message)})})}catch(S){k("error inserting record, "+S.message)}}}],[{key:"init",value:function(a){var b=this;if(d.support||k(Error("your platform does not support websql protocol.")),d.status)return!1;d._pool=d._pool||new E;d._database=a||"logline";
d.status=e(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITING;try{d._db=window.openDatabase(d._database,"1.0","cats loves logs",5085593.6),d._db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS logs (time, namespace, level, descriptor, data)",[],function(){d.status=e(d.__proto__||Object.getPrototypeOf(d),"STATUS",b).INITED;d._pool.consume()},function(a,c){d.status=e(d.__proto__||Object.getPrototypeOf(d),"STATUS",b).FAILED;k("unable to create table, "+c.message)})})}catch(F){k("unable to init log database, "+
F.message)}}},{key:"get",value:function(a,b,c){if(d.status!==e(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED)return d._pool.push(function(){return d.get(a,b,c)});a=v.transTimeFormat(a);b=v.transTimeFormat(b);try{d._db.transaction(function(d){d.executeSql("SELECT * FROM logs ORDER BY time DESC",[],function(d,e){for(var f,h=[],k=e.rows.length;0<=--k;)if(f=e.rows.item(k),!(a&&f.time<a||b&&f.time>b)){d=JSON.parse(JSON.stringify(f));try{d.data=JSON.parse(d.data)}catch(ia){}h.push(d)}c(h)},
function(a,b){k(b.message)})})}catch(G){k("unable to collect logs from database.")}}},{key:"keep",value:function(a){if(d.status!==e(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED)return d._pool.push(function(){return d.keep(a)});try{d._db.transaction(function(b){a?b.executeSql("DELETE FROM logs WHERE time \x3c ?",[Date.now()-864E5*(a||2)],function(){},function(a,b){k(b.message)}):b.executeSql("DELETE FROM logs",[],function(){},function(a,b){k(b.message)})})}catch(O){k("unable to clean logs from database.")}}},
{key:"clean",value:function(){if(d.status!==e(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED)return void d._pool.push(function(){return d.clean()});try{d._db.transaction(function(a){a.executeSql("DROP TABLE logs",[],function(){delete d.status},function(a,b){k(b.message)})})}catch(I){k("unable to clean log database.")}}},{key:"support",get:function(){return"openDatabase"in window}}]),d}(v),Q=function(){function c(b){if(a(this,c),!(this instanceof c))return new c(b);try{return c._checkProtocol(),
new c._protocol(b)}catch(I){return new v(b)}}return b(c,null,[{key:"_initProtocol",value:function(a){c._protocol=a;c._protocol.init(c._database||"logline")}},{key:"_checkProtocol",value:function(){if(!c._protocol){for(var a=Object.keys(c.PROTOCOL),b;b=c.PROTOCOL[a.shift()];)if(b.support)return void c._initProtocol(b);k("protocols "+a.join(", ").toLowerCase()+" are not supported on this platform")}}},{key:"get",value:function(a,b,d){switch(c._checkProtocol(),arguments.length){case 1:d=a;a=void 0;break;
case 2:d=b,b=void 0}c._protocol.get(a,b,d)}},{key:"all",value:function(a){c.get(a)}},{key:"keep",value:function(a){return c._checkProtocol(),c._protocol.keep(a),this}},{key:"clean",value:function(){return c._checkProtocol(),c._protocol.clean(),this}},{key:"using",value:function(a,b){return-1===[B,K,M].indexOf(a)&&k("specialfied protocol "+(a?a+" ":"")+"is not available"),c._protocol?this:(c.database(b||c._database),c._initProtocol(a),this)}},{key:"database",value:function(a){c._database=a}},{key:"config",
get:function(){return x}}]),c}();return Q.PROTOCOL={INDEXEDDB:B,LOCALSTORAGE:K,WEBSQL:M},Q.INTERFACE=Object.freeze(v),Q.env={verbose:!0},Q});!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=f();"undefined"!==typeof window&&(window.pako=f())}(function(){return function a(k,g,d){function b(e,u){if(!g[e]){if(!k[e]){var m="function"==typeof require&&require;if(!u&&m)return m(e,!0);if(c)return c(e,!0);u=Error("Cannot find module '"+e+"'");throw u.code=
"MODULE_NOT_FOUND",u;}u=g[e]={exports:{}};k[e][0].call(u.exports,function(a){return b(k[e][1][a]||a)},u,u.exports,a,k,g,d)}return g[e].exports}for(var c="function"==typeof require&&require,e=0;e<d.length;e++)b(d[e]);return b}({1:[function(k,g,d){k="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;d.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");
for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}}return a};d.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var a={arraySet:function(a,b,d,k,g){if(b.subarray&&a.subarray)a.set(b.subarray(d,d+k),g);else for(var c=0;c<k;c++)a[g+c]=b[d+c]},flattenChunks:function(a){var b,c;var d=c=0;for(b=a.length;d<b;d++)c+=a[d].length;var k=new Uint8Array(c);d=c=0;for(b=a.length;d<b;d++){var g=a[d];k.set(g,c);c+=g.length}return k}},b={arraySet:function(a,
b,d,k,g){for(var c=0;c<k;c++)a[g+c]=b[d+c]},flattenChunks:function(a){return[].concat.apply([],a)}};d.setTyped=function(c){c?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,a)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,b))};d.setTyped(k)},{}],2:[function(k,g,d){function a(a,d){if(65537>d&&(a.subarray&&e||!a.subarray&&c))return String.fromCharCode.apply(null,b.shrinkBuf(a,d));for(var k="",g=0;g<d;g++)k+=String.fromCharCode(a[g]);return k}var b=k("./common"),c=!0,e=!0;
try{String.fromCharCode.apply(null,[0])}catch(u){c=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){e=!1}var m=new b.Buf8(256);for(k=0;256>k;k++)m[k]=252<=k?6:248<=k?5:240<=k?4:224<=k?3:192<=k?2:1;m[254]=m[254]=1;d.string2buf=function(a){var c,d,e,h,k=a.length,g=0;for(e=0;e<k;e++)55296==(64512&(c=a.charCodeAt(e)))&&e+1<k&&56320==(64512&(d=a.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),g+=128>c?1:2048>c?2:65536>c?3:4;var m=new b.Buf8(g);for(e=h=0;h<g;e++)55296==(64512&
(c=a.charCodeAt(e)))&&e+1<k&&56320==(64512&(d=a.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),128>c?m[h++]=c:2048>c?(m[h++]=192|c>>>6,m[h++]=128|63&c):65536>c?(m[h++]=224|c>>>12,m[h++]=128|c>>>6&63,m[h++]=128|63&c):(m[h++]=240|c>>>18,m[h++]=128|c>>>12&63,m[h++]=128|c>>>6&63,m[h++]=128|63&c);return m};d.buf2binstring=function(b){return a(b,b.length)};d.binstring2buf=function(a){for(var c=new b.Buf8(a.length),d=0,e=c.length;d<e;d++)c[d]=a.charCodeAt(d);return c};d.buf2string=function(b,c){var d,
e,h,k=c||b.length,g=Array(2*k);for(c=d=0;c<k;)if(128>(e=b[c++]))g[d++]=e;else if(4<(h=m[e]))g[d++]=65533,c+=h-1;else{for(e&=2===h?31:3===h?15:7;1<h&&c<k;)e=e<<6|63&b[c++],h--;1<h?g[d++]=65533:65536>e?g[d++]=e:(e-=65536,g[d++]=55296|e>>10&1023,g[d++]=56320|1023&e)}return a(g,d)};d.utf8border=function(a,b){var c;(b=b||a.length)>a.length&&(b=a.length);for(c=b-1;0<=c&&128==(192&a[c]);)c--;return 0>c?b:0===c?b:c+m[a[c]]>b?c:b}},{"./common":1}],3:[function(k,g,d){g.exports=function(a,b,c,d){var e=65535&
a|0;a=a>>>16&65535|0;for(var k;0!==c;){c-=k=2E3<c?2E3:c;do a=a+(e=e+b[d++]|0)|0;while(--k);e%=65521;a%=65521}return e|a<<16|0}},{}],4:[function(k,g,d){var a=function(){for(var a,c=[],d=0;256>d;d++){a=d;for(var k=0;8>k;k++)a=1&a?3988292384^a>>>1:a>>>1;c[d]=a}return c}();g.exports=function(b,c,d,k){d=k+d;for(b^=-1;k<d;k++)b=b>>>8^a[255&(b^c[k])];return-1^b}},{}],5:[function(k,g,d){function a(a,b){return a.msg=N[b],b}function b(a){for(var b=a.length;0<=--b;)a[b]=0}function c(a){var b=a.state,c=b.pending;
c>a.avail_out&&(c=a.avail_out);0!==c&&(M.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function e(a,b){Q._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,b);a.block_start=a.strstart;c(a.strm)}function m(a,b){a.pending_buf[a.pending++]=b}function u(a,b){a.pending_buf[a.pending++]=b>>>8&255;a.pending_buf[a.pending++]=255&b}function r(a,b){var c,d,e=a.max_chain_length,
h=a.strstart,k=a.prev_length,g=a.nice_match,m=a.strstart>a.w_size-ja?a.strstart-(a.w_size-ja):0,n=a.window,p=a.w_mask,U=a.prev,r=a.strstart+wa,u=n[h+k-1],v=n[h+k];a.prev_length>=a.good_match&&(e>>=2);g>a.lookahead&&(g=a.lookahead);do if(c=b,n[c+k]===v&&n[c+k-1]===u&&n[c]===n[h]&&n[++c]===n[h+1]){h+=2;for(c++;n[++h]===n[++c]&&n[++h]===n[++c]&&n[++h]===n[++c]&&n[++h]===n[++c]&&n[++h]===n[++c]&&n[++h]===n[++c]&&n[++h]===n[++c]&&n[++h]===n[++c]&&h<r;);if(d=wa-(r-h),h=r-wa,d>k){if(a.match_start=b,k=d,
d>=g)break;u=n[h+k-1];v=n[h+k]}}while((b=U[b&p])>m&&0!=--e);return k<=a.lookahead?k:a.lookahead}function n(a){var b,c,d=a.w_size;do{if(c=a.window_size-a.lookahead-a.strstart,a.strstart>=d+(d-ja)){M.arraySet(a.window,a.window,d,d,0);a.match_start-=d;a.strstart-=d;a.block_start-=d;var e=b=a.hash_size;do{var h=a.head[--e];a.head[e]=h>=d?h-d:0}while(--b);e=b=d;do h=a.prev[--e],a.prev[e]=h>=d?h-d:0;while(--b);c+=d}if(0===a.strm.avail_in)break;e=a.strm;h=a.window;var k=a.strstart+a.lookahead,g=e.avail_in;
if(b=(g>c&&(g=c),0===g?0:(e.avail_in-=g,M.arraySet(h,e.input,e.next_in,g,k),1===e.state.wrap?e.adler=X(e.adler,h,g,k):2===e.state.wrap&&(e.adler=z(e.adler,h,g,k)),e.next_in+=g,e.total_in+=g,g)),a.lookahead+=b,a.lookahead+a.insert>=R)for(c=a.strstart-a.insert,a.ins_h=a.window[c],a.ins_h=(a.ins_h<<a.hash_shift^a.window[c+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[c+R-1])&a.hash_mask,a.prev[c&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=c,c++,a.insert--,!(a.lookahead+a.insert<R)););
}while(a.lookahead<ja&&0!==a.strm.avail_in)}function x(a,b){for(var c,d;;){if(a.lookahead<ja){if(n(a),a.lookahead<ja&&b===I)return ba;if(0===a.lookahead)break}if(c=0,a.lookahead>=R&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-ja&&(a.match_length=r(a,c)),a.match_length>=R)if(d=Q._tr_tally(a,a.strstart-a.match_start,a.match_length-R),a.lookahead-=a.match_length,a.match_length<=
a.max_lazy_match&&a.lookahead>=R){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=Q._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(e(a,!1),0===a.strm.avail_out))return ba}return a.insert=
a.strstart<R-1?a.strstart:R-1,b===O?(e(a,!0),0===a.strm.avail_out?Z:ua):a.last_lit&&(e(a,!1),0===a.strm.avail_out)?ba:y}function h(a,b){for(var c,d,h;;){if(a.lookahead<ja){if(n(a),a.lookahead<ja&&b===I)return ba;if(0===a.lookahead)break}if(c=0,a.lookahead>=R&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=R-1,0!==c&&a.prev_length<a.max_lazy_match&&
a.strstart-c<=a.w_size-ja&&(a.match_length=r(a,c),5>=a.match_length&&(a.strategy===Y||a.match_length===R&&4096<a.strstart-a.match_start)&&(a.match_length=R-1)),a.prev_length>=R&&a.match_length<=a.prev_length){h=a.strstart+a.lookahead-R;d=Q._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-R);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=h&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);
while(0!=--a.prev_length);if(a.match_available=0,a.match_length=R-1,a.strstart++,d&&(e(a,!1),0===a.strm.avail_out))return ba}else if(a.match_available){if(Q._tr_tally(a,0,a.window[a.strstart-1])&&e(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ba}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(Q._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<R-1?a.strstart:R-1,b===O?(e(a,!0),0===a.strm.avail_out?Z:ua):a.last_lit&&(e(a,!1),
0===a.strm.avail_out)?ba:y}function p(a,b,c,d,e){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d;this.func=e}function v(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=C;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=
this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new M.Buf16(2*ta);this.dyn_dtree=new M.Buf16(2*(2*T+1));this.bl_tree=new M.Buf16(2*(2*ha+1));b(this.dyn_ltree);b(this.dyn_dtree);b(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new M.Buf16(pa+1);this.heap=new M.Buf16(2*ca+1);b(this.heap);
this.heap_max=this.heap_len=0;this.depth=new M.Buf16(2*ca+1);b(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function E(b){var c;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=va,c=b.state,c.pending=0,c.pending_out=0,0>c.wrap&&(c.wrap=-c.wrap),c.status=c.wrap?V:aa,b.adler=2===c.wrap?0:1,c.last_flush=I,Q._tr_init(c),F):a(b,G)}function B(a){var c=E(a);c===F&&(a=a.state,a.window_size=2*a.w_size,
b(a.head),a.max_lazy_match=fa[a.level].max_lazy,a.good_match=fa[a.level].good_length,a.nice_match=fa[a.level].nice_length,a.max_chain_length=fa[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=R-1,a.match_available=0,a.ins_h=0);return c}function K(b,c,d,e,h,k){if(!b)return G;var g=1;if(c===S&&(c=6),0>e?(g=0,e=-e):15<e&&(g=2,e-=16),1>h||h>ia||d!==C||8>e||15<e||0>c||9<c||0>k||k>J)return a(b,G);8===e&&(e=9);var A=new v;return b.state=A,A.strm=b,A.wrap=
g,A.gzhead=null,A.w_bits=e,A.w_size=1<<A.w_bits,A.w_mask=A.w_size-1,A.hash_bits=h+7,A.hash_size=1<<A.hash_bits,A.hash_mask=A.hash_size-1,A.hash_shift=~~((A.hash_bits+R-1)/R),A.window=new M.Buf8(2*A.w_size),A.head=new M.Buf16(A.hash_size),A.prev=new M.Buf16(A.w_size),A.lit_bufsize=1<<h+6,A.pending_buf_size=4*A.lit_bufsize,A.pending_buf=new M.Buf8(A.pending_buf_size),A.d_buf=1*A.lit_bufsize,A.l_buf=3*A.lit_bufsize,A.level=c,A.strategy=k,A.method=d,B(b)}var M=k("../utils/common"),Q=k("./trees"),X=k("./adler32"),
z=k("./crc32"),N=k("./messages"),I=0,O=4,F=0,G=-2,S=-1,Y=1,J=4,va=2,C=8,ia=9,ca=286,T=30,ha=19,ta=2*ca+1,pa=15,R=3,wa=258,ja=wa+R+1,V=42,aa=113,ba=1,y=2,Z=3,ua=4;var fa=[new p(0,0,0,0,function(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(1>=a.lookahead){if(n(a),0===a.lookahead&&b===I)return ba;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,e(a,!1),0===a.strm.avail_out)||
a.strstart-a.block_start>=a.w_size-ja&&(e(a,!1),0===a.strm.avail_out))return ba}return a.insert=0,b===O?(e(a,!0),0===a.strm.avail_out?Z:ua):(a.strstart>a.block_start&&(e(a,!1),a.strm.avail_out),ba)}),new p(4,4,8,4,x),new p(4,5,16,8,x),new p(4,6,32,32,x),new p(4,4,16,16,h),new p(8,16,32,32,h),new p(8,16,128,128,h),new p(8,32,128,256,h),new p(32,128,258,1024,h),new p(32,258,258,4096,h)];d.deflateInit=function(a,b){return K(a,b,C,15,8,0)};d.deflateInit2=K;d.deflateReset=B;d.deflateResetKeep=E;d.deflateSetHeader=
function(a,b){return a&&a.state?2!==a.state.wrap?G:(a.state.gzhead=b,F):G};d.deflate=function(d,h){var k,g;if(!d||!d.state||5<h||0>h)return d?a(d,G):G;if(g=d.state,!d.output||!d.input&&0!==d.avail_in||666===g.status&&h!==O)return a(d,0===d.avail_out?-5:G);if(g.strm=d,k=g.last_flush,g.last_flush=h,g.status===V)if(2===g.wrap)d.adler=0,m(g,31),m(g,139),m(g,8),g.gzhead?(m(g,(g.gzhead.text?1:0)+(g.gzhead.hcrc?2:0)+(g.gzhead.extra?4:0)+(g.gzhead.name?8:0)+(g.gzhead.comment?16:0)),m(g,255&g.gzhead.time),
m(g,g.gzhead.time>>8&255),m(g,g.gzhead.time>>16&255),m(g,g.gzhead.time>>24&255),m(g,9===g.level?2:2<=g.strategy||2>g.level?4:0),m(g,255&g.gzhead.os),g.gzhead.extra&&g.gzhead.extra.length&&(m(g,255&g.gzhead.extra.length),m(g,g.gzhead.extra.length>>8&255)),g.gzhead.hcrc&&(d.adler=z(d.adler,g.pending_buf,g.pending,0)),g.gzindex=0,g.status=69):(m(g,0),m(g,0),m(g,0),m(g,0),m(g,0),m(g,9===g.level?2:2<=g.strategy||2>g.level?4:0),m(g,3),g.status=aa);else{var p=C+(g.w_bits-8<<4)<<8;p|=(2<=g.strategy||2>g.level?
0:6>g.level?1:6===g.level?2:3)<<6;0!==g.strstart&&(p|=32);g.status=aa;u(g,p+(31-p%31));0!==g.strstart&&(u(g,d.adler>>>16),u(g,65535&d.adler));d.adler=1}if(69===g.status)if(g.gzhead.extra){for(p=g.pending;g.gzindex<(65535&g.gzhead.extra.length)&&(g.pending!==g.pending_buf_size||(g.gzhead.hcrc&&g.pending>p&&(d.adler=z(d.adler,g.pending_buf,g.pending-p,p)),c(d),p=g.pending,g.pending!==g.pending_buf_size));)m(g,255&g.gzhead.extra[g.gzindex]),g.gzindex++;g.gzhead.hcrc&&g.pending>p&&(d.adler=z(d.adler,
g.pending_buf,g.pending-p,p));g.gzindex===g.gzhead.extra.length&&(g.gzindex=0,g.status=73)}else g.status=73;if(73===g.status)if(g.gzhead.name){p=g.pending;do{if(g.pending===g.pending_buf_size&&(g.gzhead.hcrc&&g.pending>p&&(d.adler=z(d.adler,g.pending_buf,g.pending-p,p)),c(d),p=g.pending,g.pending===g.pending_buf_size)){var r=1;break}r=g.gzindex<g.gzhead.name.length?255&g.gzhead.name.charCodeAt(g.gzindex++):0;m(g,r)}while(0!==r);g.gzhead.hcrc&&g.pending>p&&(d.adler=z(d.adler,g.pending_buf,g.pending-
p,p));0===r&&(g.gzindex=0,g.status=91)}else g.status=91;if(91===g.status)if(g.gzhead.comment){p=g.pending;do{if(g.pending===g.pending_buf_size&&(g.gzhead.hcrc&&g.pending>p&&(d.adler=z(d.adler,g.pending_buf,g.pending-p,p)),c(d),p=g.pending,g.pending===g.pending_buf_size)){r=1;break}r=g.gzindex<g.gzhead.comment.length?255&g.gzhead.comment.charCodeAt(g.gzindex++):0;m(g,r)}while(0!==r);g.gzhead.hcrc&&g.pending>p&&(d.adler=z(d.adler,g.pending_buf,g.pending-p,p));0===r&&(g.status=103)}else g.status=103;
if(103===g.status&&(g.gzhead.hcrc?(g.pending+2>g.pending_buf_size&&c(d),g.pending+2<=g.pending_buf_size&&(m(g,255&d.adler),m(g,d.adler>>8&255),d.adler=0,g.status=aa)):g.status=aa),0!==g.pending){if(c(d),0===d.avail_out)return g.last_flush=-1,F}else if(0===d.avail_in&&(h<<1)-(4<h?9:0)<=(k<<1)-(4<k?9:0)&&h!==O)return a(d,-5);if(666===g.status&&0!==d.avail_in)return a(d,-5);if(0!==d.avail_in||0!==g.lookahead||h!==I&&666!==g.status){if(2===g.strategy)a:{for(var v;;){if(0===g.lookahead&&(n(g),0===g.lookahead)){if(h===
I){var x=ba;break a}break}if(g.match_length=0,v=Q._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,v&&(e(g,!1),0===g.strm.avail_out)){x=ba;break a}}x=(g.insert=0,h===O?(e(g,!0),0===g.strm.avail_out?Z:ua):g.last_lit&&(e(g,!1),0===g.strm.avail_out)?ba:y)}else if(3===g.strategy)a:{var E,B;for(v=g.window;;){if(g.lookahead<=wa){if(n(g),g.lookahead<=wa&&h===I){x=ba;break a}if(0===g.lookahead)break}if(g.match_length=0,g.lookahead>=R&&0<g.strstart&&(B=g.strstart-1,(E=v[B])===v[++B]&&E===v[++B]&&
E===v[++B])){for(k=g.strstart+wa;E===v[++B]&&E===v[++B]&&E===v[++B]&&E===v[++B]&&E===v[++B]&&E===v[++B]&&E===v[++B]&&E===v[++B]&&B<k;);g.match_length=wa-(k-B);g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(g.match_length>=R?(x=Q._tr_tally(g,1,g.match_length-R),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(x=Q._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),x&&(e(g,!1),0===g.strm.avail_out)){x=ba;break a}}x=(g.insert=0,h===O?(e(g,!0),0===g.strm.avail_out?
Z:ua):g.last_lit&&(e(g,!1),0===g.strm.avail_out)?ba:y)}else x=fa[g.level].func(g,h);if(x!==Z&&x!==ua||(g.status=666),x===ba||x===Z)return 0===d.avail_out&&(g.last_flush=-1),F;if(x===y&&(1===h?Q._tr_align(g):5!==h&&(Q._tr_stored_block(g,0,0,!1),3===h&&(b(g.head),0===g.lookahead&&(g.strstart=0,g.block_start=0,g.insert=0))),c(d),0===d.avail_out))return g.last_flush=-1,F}return h!==O?F:0>=g.wrap?1:(2===g.wrap?(m(g,255&d.adler),m(g,d.adler>>8&255),m(g,d.adler>>16&255),m(g,d.adler>>24&255),m(g,255&d.total_in),
m(g,d.total_in>>8&255),m(g,d.total_in>>16&255),m(g,d.total_in>>24&255)):(u(g,d.adler>>>16),u(g,65535&d.adler)),c(d),0<g.wrap&&(g.wrap=-g.wrap),0!==g.pending?F:1)};d.deflateEnd=function(b){var c;return b&&b.state?(c=b.state.status)!==V&&69!==c&&73!==c&&91!==c&&103!==c&&c!==aa&&666!==c?a(b,G):(b.state=null,c===aa?a(b,-3):F):G};d.deflateSetDictionary=function(a,c){var d,e,g;var h=c.length;if(!a||!a.state||(d=a.state,2===(e=d.wrap)||1===e&&d.status!==V||d.lookahead))return G;1===e&&(a.adler=X(a.adler,
c,h,0));d.wrap=0;h>=d.w_size&&(0===e&&(b(d.head),d.strstart=0,d.block_start=0,d.insert=0),g=new M.Buf8(d.w_size),M.arraySet(g,c,h-d.w_size,d.w_size,0),c=g,h=d.w_size);g=a.avail_in;var k=a.next_in;var m=a.input;a.avail_in=h;a.next_in=0;a.input=c;for(n(d);d.lookahead>=R;){c=d.strstart;h=d.lookahead-(R-1);do d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+R-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++;while(--h);d.strstart=c;d.lookahead=R-1;n(d)}return d.strstart+=d.lookahead,d.block_start=
d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=R-1,d.match_available=0,a.next_in=k,a.input=m,a.avail_in=g,d.wrap=e,F};d.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":4,"./messages":6,"./trees":7}],6:[function(k,g,d){g.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],7:[function(k,g,d){function a(a){for(var b=
a.length;0<=--b;)a[b]=0}function b(a,b,c,d,e){this.static_tree=a;this.extra_bits=b;this.extra_base=c;this.elems=d;this.max_length=e;this.has_stree=a&&a.length}function c(a,b){this.dyn_tree=a;this.max_code=0;this.stat_desc=b}function e(a){return 256>a?ba[a]:ba[256+(a>>>7)]}function m(a,b){a.pending_buf[a.pending++]=255&b;a.pending_buf[a.pending++]=b>>>8&255}function u(a,b,c){a.bi_valid>ia-c?(a.bi_buf|=b<<a.bi_valid&65535,m(a,a.bi_buf),a.bi_buf=b>>ia-a.bi_valid,a.bi_valid+=c-ia):(a.bi_buf|=b<<a.bi_valid&
65535,a.bi_valid+=c)}function r(a,b,c){u(a,c[2*b],c[2*b+1])}function n(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(0<--b);return c>>>1}function x(a,b,c){var d,e=Array(C+1),g=0;for(d=1;d<=C;d++)e[d]=g=g+c[d-1]<<1;for(c=0;c<=b;c++)d=a[2*c+1],0!==d&&(a[2*c]=n(e[d]++,d))}function h(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<Y;b++)a.dyn_dtree[2*b]=0;for(b=0;b<J;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*ca]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function p(a){8<a.bi_valid?m(a,a.bi_buf):0<a.bi_valid&&
(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function v(a,b,c,d){var e=2*b,g=2*c;return a[e]<a[g]||a[e]===a[g]&&d[b]<=d[c]}function E(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&v(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!v(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function B(a,b,c){var d,g,h=0;if(0!==a.last_lit){do{var k=a.pending_buf[a.d_buf+2*h]<<8|a.pending_buf[a.d_buf+2*h+1];var m=a.pending_buf[a.l_buf+h];h++;0===k?r(a,m,b):(r(a,(d=y[m])+
G+1,b),0!==(g=pa[d])&&u(a,m-Z[d],g),r(a,d=e(--k),c),0!==(g=R[d])&&u(a,k-ua[d],g))}while(h<a.last_lit)}r(a,ca,b)}function K(a,b){var c,d,e=b.dyn_tree;var g=b.stat_desc.static_tree;var h=b.stat_desc.has_stree,k=b.stat_desc.elems,m=-1;a.heap_len=0;a.heap_max=va;for(c=0;c<k;c++)0!==e[2*c]?(a.heap[++a.heap_len]=m=c,a.depth[c]=0):e[2*c+1]=0;for(;2>a.heap_len;)e[2*(d=a.heap[++a.heap_len]=2>m?++m:0)]=1,a.depth[d]=0,a.opt_len--,h&&(a.static_len-=g[2*d+1]);b.max_code=m;for(c=a.heap_len>>1;1<=c;c--)E(a,e,c);
d=k;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],E(a,e,1),g=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=g,e[2*d]=e[2*c]+e[2*g],a.depth[d]=(a.depth[c]>=a.depth[g]?a.depth[c]:a.depth[g])+1,e[2*c+1]=e[2*g+1]=d,a.heap[1]=d++,E(a,e,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];var n,p,r,u,A;c=b.dyn_tree;d=b.max_code;g=b.stat_desc.static_tree;h=b.stat_desc.has_stree;k=b.stat_desc.extra_bits;var v=b.stat_desc.extra_base,y=b.stat_desc.max_length,B=0;for(r=0;r<=C;r++)a.bl_count[r]=0;c[2*
a.heap[a.heap_max]+1]=0;for(b=a.heap_max+1;b<va;b++)(r=c[2*c[2*(n=a.heap[b])+1]+1]+1)>y&&(r=y,B++),c[2*n+1]=r,n>d||(a.bl_count[r]++,u=0,n>=v&&(u=k[n-v]),A=c[2*n],a.opt_len+=A*(r+u),h&&(a.static_len+=A*(g[2*n+1]+u)));if(0!==B){do{for(r=y-1;0===a.bl_count[r];)r--;a.bl_count[r]--;a.bl_count[r+1]+=2;a.bl_count[y]--;B-=2}while(0<B);for(r=y;0!==r;r--)for(n=a.bl_count[r];0!==n;)(p=a.heap[--b])>d||(c[2*p+1]!==r&&(a.opt_len+=(r-c[2*p+1])*c[2*p],c[2*p+1]=r),n--)}x(e,m,a.bl_count)}function M(a,b,c){var d,e=
-1,g=b[1],h=0,k=7,m=4;0===g&&(k=138,m=3);b[2*(c+1)+1]=65535;for(d=0;d<=c;d++){var n=g;g=b[2*(d+1)+1];++h<k&&n===g||(h<m?a.bl_tree[2*n]+=h:0!==n?(n!==e&&a.bl_tree[2*n]++,a.bl_tree[2*T]++):10>=h?a.bl_tree[2*ha]++:a.bl_tree[2*ta]++,h=0,e=n,0===g?(k=138,m=3):n===g?(k=6,m=3):(k=7,m=4))}}function Q(a,b,c){var d,e,g=-1,h=b[1],k=0,m=7,n=4;0===h&&(m=138,n=3);for(d=0;d<=c;d++)if(e=h,h=b[2*(d+1)+1],!(++k<m&&e===h)){if(k<n){do r(a,e,a.bl_tree);while(0!=--k)}else 0!==e?(e!==g&&(r(a,e,a.bl_tree),k--),r(a,T,a.bl_tree),
u(a,k-3,2)):10>=k?(r(a,ha,a.bl_tree),u(a,k-3,3)):(r(a,ta,a.bl_tree),u(a,k-11,7));k=0;g=e;0===h?(m=138,n=3):e===h?(m=6,n=3):(m=7,n=4)}}function X(a){var b,c=4093624447;for(b=0;31>=b;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return O;for(b=32;b<G;b++)if(0!==a.dyn_ltree[2*b])return O;return I}function z(a,b,c,d){u(a,(F<<1)+(d?1:0),3);p(a);m(a,c);m(a,~c);N.arraySet(a.pending_buf,a.window,b,c,a.pending);a.pending+=c}var N=k("../utils/common"),
I=0,O=1,F=0,G=256,S=G+1+29,Y=30,J=19,va=2*S+1,C=15,ia=16,ca=256,T=16,ha=17,ta=18,pa=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],wa=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ja=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=Array(2*(S+2));a(V);var aa=Array(2*Y);a(aa);var ba=Array(512);a(ba);var y=Array(256);a(y);var Z=Array(29);a(Z);var ua=Array(Y);a(ua);var fa,U,ea,ya=!1;d._tr_init=function(a){if(!ya){var d,
e,g,k=Array(C+1);for(g=e=0;28>g;g++)for(Z[g]=e,d=0;d<1<<pa[g];d++)y[e++]=g;y[e-1]=g;for(g=e=0;16>g;g++)for(ua[g]=e,d=0;d<1<<R[g];d++)ba[e++]=g;for(e>>=7;g<Y;g++)for(ua[g]=e<<7,d=0;d<1<<R[g]-7;d++)ba[256+e++]=g;for(d=0;d<=C;d++)k[d]=0;for(d=0;143>=d;)V[2*d+1]=8,d++,k[8]++;for(;255>=d;)V[2*d+1]=9,d++,k[9]++;for(;279>=d;)V[2*d+1]=7,d++,k[7]++;for(;287>=d;)V[2*d+1]=8,d++,k[8]++;x(V,S+1,k);for(d=0;d<Y;d++)aa[2*d+1]=5,aa[2*d]=n(d,5);fa=new b(V,pa,G+1,S,C);U=new b(aa,R,0,Y,C);ea=new b([],wa,0,J,7);ya=!0}a.l_desc=
new c(a.dyn_ltree,fa);a.d_desc=new c(a.dyn_dtree,U);a.bl_desc=new c(a.bl_tree,ea);a.bi_buf=0;a.bi_valid=0;h(a)};d._tr_stored_block=z;d._tr_flush_block=function(a,b,c,d){var e,g=0;if(0<a.level){2===a.strm.data_type&&(a.strm.data_type=X(a));K(a,a.l_desc);K(a,a.d_desc);M(a,a.dyn_ltree,a.l_desc.max_code);M(a,a.dyn_dtree,a.d_desc.max_code);K(a,a.bl_desc);for(g=J-1;3<=g&&0===a.bl_tree[2*ja[g]+1];g--);g=(a.opt_len+=3*(g+1)+14,g);var k=a.opt_len+3+7>>>3;(e=a.static_len+3+7>>>3)<=k&&(k=e)}else k=e=c+5;if(c+
4<=k&&-1!==b)z(a,b,c,d);else if(4===a.strategy||e===k)u(a,2+(d?1:0),3),B(a,V,aa);else{u(a,4+(d?1:0),3);b=a.l_desc.max_code+1;c=a.d_desc.max_code+1;g+=1;u(a,b-257,5);u(a,c-1,5);u(a,g-4,4);for(e=0;e<g;e++)u(a,a.bl_tree[2*ja[e]+1],3);Q(a,a.dyn_ltree,b-1);Q(a,a.dyn_dtree,c-1);B(a,a.dyn_ltree,a.dyn_dtree)}h(a);d&&p(a)};d._tr_tally=function(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*
c]++:(a.matches++,b--,a.dyn_ltree[2*(y[c]+G+1)]++,a.dyn_dtree[2*e(b)]++),a.last_lit===a.lit_bufsize-1};d._tr_align=function(a){u(a,2,3);r(a,ca,V);16===a.bi_valid?(m(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}},{"../utils/common":1}],8:[function(k,g,d){g.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;
this.data_type=2;this.adler=0}},{}],"/lib/deflate.js":[function(k,g,d){function a(b){if(!(this instanceof a))return new a(b);b=this.options=e.assign({level:h,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},b||{});b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&16>b.windowBits&&(b.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new r;this.strm.avail_out=0;var d=c.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,
b.strategy);if(d!==x)throw Error(u[d]);if(b.header&&c.deflateSetHeader(this.strm,b.header),b.dictionary){var g;if(g="string"==typeof b.dictionary?m.string2buf(b.dictionary):"[object ArrayBuffer]"===n.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,(d=c.deflateSetDictionary(this.strm,g))!==x)throw Error(u[d]);this._dict_set=!0}}function b(b,c){c=new a(c);if(c.push(b,!0),c.err)throw c.msg||u[c.err];return c.result}var c=k("./zlib/deflate"),e=k("./utils/common"),m=k("./utils/strings"),u=
k("./zlib/messages"),r=k("./zlib/zstream"),n=Object.prototype.toString,x=0,h=-1,p=0,v=8;a.prototype.push=function(a,b){var d,g=this.strm,h=this.options.chunkSize;if(this.ended)return!1;b=b===~~b?b:!0===b?4:0;"string"==typeof a?g.input=m.string2buf(a):"[object ArrayBuffer]"===n.call(a)?g.input=new Uint8Array(a):g.input=a;g.next_in=0;g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new e.Buf8(h),g.next_out=0,g.avail_out=h),1!==(d=c.deflate(g,b))&&d!==x)return this.onEnd(d),this.ended=!0,!1;
0!==g.avail_out&&(0!==g.avail_in||4!==b&&2!==b)||("string"===this.options.to?this.onData(m.buf2binstring(e.shrinkBuf(g.output,g.next_out))):this.onData(e.shrinkBuf(g.output,g.next_out)))}while((0<g.avail_in||0===g.avail_out)&&1!==d);return 4===b?(d=c.deflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===x):2!==b||(this.onEnd(x),g.avail_out=0,!0)};a.prototype.onData=function(a){this.chunks.push(a)};a.prototype.onEnd=function(a){a===x&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=
e.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};d.Deflate=a;d.deflate=b;d.deflateRaw=function(a,c){return c=c||{},c.raw=!0,b(a,c)};d.gzip=function(a,c){return c=c||{},c.gzip=!0,b(a,c)}},{"./utils/common":1,"./utils/strings":2,"./zlib/deflate":5,"./zlib/messages":6,"./zlib/zstream":8}]},{},[])("/lib/deflate.js")});
