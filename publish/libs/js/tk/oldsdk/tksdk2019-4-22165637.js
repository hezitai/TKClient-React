"use strict";function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.TK=window.TK||{},window.L=window.L||{},window.TK_ERR={DEVICE_ERROR_UnknownError:2501,DEVICE_ERROR_NotFoundError:2502,DEVICE_ERROR_NotAllowedError:2503,DEVICE_ERROR_NotReadableError:2504,DEVICE_ERROR_OverconstrainedError:2505,DEVICE_ERROR_TypeError:2506,ROOM_JOIN_FAILED:2507,ROOM_NOT_CONNECT:2508,CHECK_USERDesktopMediaError:2509,Server_Exception:2510},window.L=window.L||{},window.TK=window.TK||{},TK.LOG_DEBUG=0,TK.LOG_TRACE=1,TK.LOG_INFO=2,TK.LOG_WARNING=3,TK.LOG_ERROR=4,TK.LOG_NONE=5,L.Logger=function(s){var d,c,u="",l=!1,o=!1,p=((new Date).getTime(),{peerid:"",serial:""});return d=function(t,e){try{var i=new Logline("[tk-sdk]");switch(e){case s.Logger.DEBUG:o?i.warn.apply(i,t):i.debug.apply(i,t);break;case s.Logger.TRACE:i.trace.apply(i,t);break;case s.Logger.INFO:o?i.warn.apply(i,t):i.info.apply(i,t);break;case s.Logger.WARNING:i.warn.apply(i,t);break;case s.Logger.ERROR:i.error.apply(i,t);break;case s.Logger.NONE:i.warn("log level is none!");break;default:o?i.warn.apply(i,t):i.log.apply(i,t)}}catch(e){console.log.apply(console,t)}},{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(e){o=e},enableLogPanel:function(){s.Logger.panel=document.createElement("textarea"),s.Logger.panel.setAttribute("id","licode-logs"),s.Logger.panel.setAttribute("style","position:fixed;left:0;top:0;width: 100%; height: 100%; display: none;z-index:9999;  user-select: text ;-webkit-user-select: text; -moz-user-select: text ; -ms-user-select: text ;"),s.Logger.panel.setAttribute("rows","20"),s.Logger.panel.setAttribute("cols","20"),s.Logger.panel.setAttribute("readOnly",!0);var e=document.createElement("button");e.innerHTML="open log",e.setAttribute("style","position:fixed;left:0;top:0;z-index:10000;background:gold;"),e.onclick=function(){"open log"===e.innerHTML?(s.Logger.panel.style.display="block",e.innerHTML="close log"):(s.Logger.panel.style.display="none",e.innerHTML="open log")},document.body.appendChild(e),document.body.appendChild(s.Logger.panel)},setLogLevel:function(e){e>s.Logger.NONE?e=s.Logger.NONE:e<s.Logger.DEBUG&&(e=s.Logger.DEBUG),s.Logger.logLevel=e},setOutputFunction:function(e){d=e},registerLogListener:function(e){c=e},setLogPrefix:function(e){u=e},setIsFormatLog:function(e){l=e},print:function(e){var t=u;if(!(e<s.Logger.logLevel)){e===s.Logger.DEBUG?t=t+"DEBUG("+(new Date).toLocaleString()+")":e===s.Logger.TRACE?t=t+"TRACE("+(new Date).toLocaleString()+")":e===s.Logger.INFO?t=t+"INFO("+(new Date).toLocaleString()+")":e===s.Logger.WARNING?t=t+"WARNING("+(new Date).toLocaleString()+")":e===s.Logger.ERROR&&(t=t+"ERROR("+(new Date).toLocaleString()+")"),t+=":";var i=[];if(void 0!==s.Logger.panel||l){for(var o=1;o<arguments.length;o++)i.push(arguments[o]);for(var n="",r=0,a=i.length;r<a;r++){n=n+("string"==typeof i[r]?i[r]:Array.isArray(i[r])?"["+i[r].join(",")+"]":"object"===Ft(i[r])?s.Utils.toJsonStringify(i[r]):i[r])+" "}(i=[t]).push(p),i.push(n)}else{i.push(t),i.push(p);for(o=1;o<arguments.length;o++)i.push(arguments[o])}void 0!==s.Logger.panel&&(s.Logger.panel.value=s.Logger.panel.value+"\n"+n),d.apply(s.Logger,[i,e]),"function"==typeof c&&c(i,e)}},debug:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.Logger.print.apply(s.Logger,[s.Logger.DEBUG].concat(e))},trace:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.Logger.print.apply(s.Logger,[s.Logger.TRACE].concat(e))},info:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.Logger.print.apply(s.Logger,[s.Logger.INFO].concat(e))},warning:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.Logger.print.apply(s.Logger,[s.Logger.WARNING].concat(e))},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.Logger.print.apply(s.Logger,[s.Logger.ERROR].concat(e))},getAllLog:function(t,i,o){Logline.all(function(e){e?s.Utils.isFunction(i)&&i(function(e,t){switch(e){case"3":break;case"4":t=t.filter(function(e,t){return"3"!=e.level});break;case"5":t=t.filter(function(e,t){return"3"!=e.level&&"4"!=e.level});break;case"6":t=t.filter(function(e,t){return"3"!=e.level&&"4"!=e.level&&"5"!=e.level})}return t}(t,e)):s.Utils.isFunction(o)&&o()})},keep:function(e){Logline.keep(e)},setLogStaicPrefix:function(e,t){e&&"string"==typeof e&&(p.peerid=e),t&&"string"==typeof t&&(p.serial=t)}}}(L),TK.tkLogPrintConfig=function(e,t,i){e=e||{},i=i||{};var o=null==(t=t||{}).development||t.development,n=null!=t.logLevel?t.logLevel:0,r=null==e.debug||e.debug,a=null==i.webrtcLogDebug||i.webrtcLogDebug;if(L.Logger.setLogDevelopment(o),L.Logger.setLogLevel(n),L&&L.Utils&&L.Utils.localStorage){var s=r?"*":"none";L.Utils.localStorage.setItem("debug",s)}else try{if(window.localStorage){s=r?"*":"none";window.localStorage.setItem("debug",s)}else console.warn("[tk-sdk]window.localStorage is not exist!")}catch(e){console.warn("[tk-sdk]Browser does not support localStorage!")}window.webrtcLogDebug=a},TK.tkLogPrintConfig({debug:!1},{development:!1,logLevel:TK.LOG_INFO},{webrtcLogDebug:!1}),TK.Logger=L.Logger,window.TK=window.TK||{},window.L=window.L||{},window.TK.TALKRECODER={STATE_ROOM_CONNECTED:0},window.TK_VIDEO_MODE={ASPECT_RATIO_CONTAIN:20001,ASPECT_RATIO_COVER:20002},window.TK.ROOM_ROLE={TEACHER:0,ASSISTANT:1,STUDENT:2,AUDIT:3,PATROL:4,SYSTEM_ADMIN:10,ENTERPRISE_ADMIN:11,ADMIN:12,PLAYBACK:-1},window.TK.ROOM_MODE={NORMAL_ROOM:"normalRoom",BIG_ROOM:"bigRoom"},window.TK.NET_QUALITY={TK_NET_QUALITY_EXCELLENT:1,TK_NET_QUALITY_GOOD:2,TK_NET_QUALITY_ACCEPTED:3,TK_NET_QUALITY_BAD:4,TK_NET_QUALITY_VERYBAD:5},window.TK.MEDIA_TYPE={DEVICE_AV:"video",FILE:"file",SCREEN:"screen",MEDIA:"media"},window.TK.EVENT_TYPE={roomConnected:"room-connected",roomCheckroom:"room-checkroom",roomCheckroomPlayback:"room-checkroom-playback",roomError:"room-error",roomConnectFail:"room-connect-fail",roomLeaveRoom:"room-leaveroom",roomServerAddressUpdate:"room-serveraddress-update",roomDisconnected:"room-disconnected",roomFiles:"room-files",roomReconnecting:"room-reconnecting",roomParticipantEvicted:"room-participant_evicted",roomMsgList:"room-msglist",roomReconnected:"room-reconnected",roomAudioVideoStateSwitched:"room-audiovideostate-switched",roomDeleteFile:"room-delete-file",roomAddFile:"room-add-file",roomUpdateFile:"room-update-file",roomUserAudioStateChanged:"room-useraudiostate-changed",roomErrorNotice:"room-error-notice",roomInfoNotice:"room-info-notice",roomWarnNotice:"room-warn-notice",roomUserNetworkStateChanged:"room-usernetworkstate-changed",roomParticipantLeave:"room-participant_leave",roomParticipantJoin:"room-participant_join",roomTextMessage:"room-text-message",roomModeChanged:"room-mode-changed",roomPubmsg:"room-pubmsg",roomDelmsg:"room-delmsg",roomUserPropertyChanged:"room-userproperty-changed",roomUserMainCameraChanged:"room-usermaincamera-changed",roomPlaybackClear_all:"room-playback-clear_all",roomPlaybackDuration:"room-playback-duration",roomPlaybackPlaybackEnd:"room-playback-playbackEnd",roomPlaybackPlayback_updatetime:"room-playback-playback_updatetime",roomClientNotificationOnMediaFileEnded:"room-clientNotification-onMediaFileEnded",roomNativeNotification:"room-native-notification",roomClientClose:"room-client-close",roomUserVideoStateChanged:"room-uservideostate-changed",roomUserMediaStateChanged:"room-usermediastate-changed",roomUserScreenStateChanged:"room-userscreenstate-changed",roomUserFileStateChanged:"room-userfilestate-changed",roomVideoNetworkStateChanged:"room-videonetworkstate-changed",roomMediaNetworkStateChanged:"room-medianetworkstate-changed",roomScreenNetworkStateChanged:"room-screennetworkstate-changed",roomFileNetworkStateChanged:"room-filenetworkstate-changed",roomConnectTime:"room-connect-time",deviceFailure:"device-failure",deviceNotAvailable:"device-not-available",deviceSuccess:"device-success",roomUserVideoAttributesUpdate:"room-uservideoattributes-update",roomUserMediaAttributesUpdate:"room-usermediaattributes-update",roomUserScreenAttributesUpdate:"room-userscreenattributes-update",roomUserFileAttributesUpdate:"room-userfileattributes-update",roomFirstVideoFrame:"room-first-video-frame",roomFirstAudioFrame:"room-first-audio-frame",getUserMediaSuccess:"getUserMedia_success",getUserMediaFailure:"getUserMedia_failure",getUserMediaFailureReGetOnlyAudioStream:"getUserMedia_failure_reGetOnlyAudioStream",getUserMediaFailureReGetOnlyVideoStream:"getUserMedia_failure_reGetOnlyVideoStream",roomRtcStatsReportEvent:"room-rtcStatsReportEvent"},window.TK.ERROR_NOTICE={ERR_OK:0,ERR_NOT_INITIALIZED:101,ERR_INVALID_STATUS:102,ERR_BAD_PARAMETERS:103,ERR_NO_THIS_USER:104,ERR_HTTP_REQUEST_FAILED:111,ERR_PUBLISH_FAILED:131,ERR_PUBLISH_TIMEOUT:132,ERR_PUBLISH_ROOMMAXVIDEOLIMITED:133,ERR_PUBLISH_MAX_RECONNECT_COUNT:134,ERR_SUBSCRIBE_FAILED:141,ERR_SUBSCRIBE_TIMEOUT:142,ERR_SUBSCRIBE_STREAM_NOTFOUND:143,ERR_SWITCH_SERVER_FAILED:151},window.TK.INFO_NOTICE={INFO_PUBLISH_COMPLETED:2001,INFO_SUBSCRIBE_COMPLETED:2002},window.TK.WARNING_NOTICE={WAR_UNPUBLISHVIDEO_BY_SWITCHAUDIOROOM:1011,WAR_PUBLISHVIDEO_BY_SWITCHAUDIOVIDEOROOM:1012,WAR_UNPUBLISHVIDEO_BY_MAX_RECONNECT_COUNT:1013,WAR_UNPUBLISHAUDIO_BY_MAX_RECONNECT_COUNT:1014,WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE:1015,WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE:1016},window.TK.DEVICE_STATE={DEVICE_REMOVE:0,DEVICE_ADD:1},window.TK.REC_TYPE={RECFILE:0,VIDEOLIST:1,MP3:2,MIXVIDEO:3},L.Constant=(L,{deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",videoinput:"videoinputDeviceId"},LOGLEVEL:{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5}}),TK.Constant=L.Constant,window.TK=window.TK||{},window.L=window.L||{},window.TK.storage={},L.aexInstance=void 0,window.TK.storage={},function(){var b={cipher:function(e,t){for(var i=t.length/4-1,o=[[],[],[],[]],n=0;n<16;n++)o[n%4][Math.floor(n/4)]=e[n];o=b.addRoundKey(o,t,0,4);for(var r=1;r<i;r++)o=b.subBytes(o,4),o=b.shiftRows(o,4),o=b.mixColumns(o,4),o=b.addRoundKey(o,t,r,4);o=b.subBytes(o,4),o=b.shiftRows(o,4),o=b.addRoundKey(o,t,i,4);var a=new Array(16);for(n=0;n<16;n++)a[n]=o[n%4][Math.floor(n/4)];return a},keyExpansion:function(e){for(var t=e.length/4,i=t+6,o=new Array(4*(i+1)),n=new Array(4),r=0;r<t;r++){var a=[e[4*r],e[4*r+1],e[4*r+2],e[4*r+3]];o[r]=a}for(r=t;r<4*(i+1);r++){o[r]=new Array(4);for(var s=0;s<4;s++)n[s]=o[r-1][s];if(r%t==0){n=b.subWord(b.rotWord(n));for(s=0;s<4;s++)n[s]^=b.rCon[r/t][s]}else 6<t&&r%t==4&&(n=b.subWord(n));for(s=0;s<4;s++)o[r][s]=o[r-t][s]^n[s]}return o},subBytes:function(e,t){for(var i=0;i<4;i++)for(var o=0;o<t;o++)e[i][o]=b.sBox[e[i][o]];return e},shiftRows:function(e,t){for(var i=new Array(4),o=1;o<4;o++){for(var n=0;n<4;n++)i[n]=e[o][(n+o)%t];for(n=0;n<4;n++)e[o][n]=i[n]}return e},mixColumns:function(e,t){for(var i=0;i<4;i++){for(var o=new Array(4),n=new Array(4),r=0;r<4;r++)o[r]=e[r][i],n[r]=128&e[r][i]?e[r][i]<<1^283:e[r][i]<<1;e[0][i]=n[0]^o[1]^n[1]^o[2]^o[3],e[1][i]=o[0]^n[1]^o[2]^n[2]^o[3],e[2][i]=o[0]^o[1]^n[2]^o[3]^n[3],e[3][i]=o[0]^n[0]^o[1]^o[2]^n[3]}return e},addRoundKey:function(e,t,i,o){for(var n=0;n<4;n++)for(var r=0;r<o;r++)e[n][r]^=t[4*i+r][n];return e},subWord:function(e){for(var t=0;t<4;t++)e[t]=b.sBox[e[t]];return e},rotWord:function(e){for(var t=e[0],i=0;i<3;i++)e[i]=e[i+1];return e[3]=t,e},sBox:[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],Ctr:{}};b.Ctr.encrypt=function(e,t,i){t=t||"talk_2018_@beijing_20180310_talk_2018_@beijing";if(128!=(i=i||256)&&192!=i&&256!=i)return"";e=w.encode(e),t=w.encode(t);for(var o=i/8,n=new Array(o),r=0;r<o;r++)n[r]=isNaN(t.charCodeAt(r))?0:t.charCodeAt(r);var a=b.cipher(n,b.keyExpansion(n));a=a.concat(a.slice(0,o-16));var s=new Array(16),d=(new Date).getTime(),c=d%1e3,u=Math.floor(d/1e3),l=Math.floor(65535*Math.random());for(r=0;r<2;r++)s[r]=c>>>8*r&255;for(r=0;r<2;r++)s[r+2]=l>>>8*r&255;for(r=0;r<4;r++)s[r+4]=u>>>8*r&255;var p="";for(r=0;r<8;r++)p+=String.fromCharCode(s[r]);for(var f=b.keyExpansion(a),m=Math.ceil(e.length/16),g=new Array(m),v=0;v<m;v++){for(var h=0;h<4;h++)s[15-h]=v>>>8*h&255;for(h=0;h<4;h++)s[15-h-4]=v/4294967296>>>8*h;var T=b.cipher(s,f),y=v<m-1?16:(e.length-1)%16+1,_=new Array(y);for(r=0;r<y;r++)_[r]=T[r]^e.charCodeAt(16*v+r),_[r]=String.fromCharCode(_[r]);g[v]=_.join("")}var k=p+g.join("");return k=S.encode(k)},b.Ctr.decrypt=function(e,t,i){t=t||"talk_2018_@beijing_20180310_talk_2018_@beijing";if(128!=(i=i||256)&&192!=i&&256!=i)return"";e=S.decode(e),t=w.encode(t);for(var o=i/8,n=new Array(o),r=0;r<o;r++)n[r]=isNaN(t.charCodeAt(r))?0:t.charCodeAt(r);var a=b.cipher(n,b.keyExpansion(n));a=a.concat(a.slice(0,o-16));var s=new Array(8),d="";d=e.slice(0,8);for(r=0;r<8;r++)s[r]=d.charCodeAt(r);for(var c=b.keyExpansion(a),u=Math.ceil((e.length-8)/16),l=new Array(u),p=0;p<u;p++)l[p]=e.slice(8+16*p,8+16*p+16);e=l;var f=new Array(e.length);for(p=0;p<u;p++){for(var m=0;m<4;m++)s[15-m]=p>>>8*m&255;for(m=0;m<4;m++)s[15-m-4]=(p+1)/4294967296-1>>>8*m&255;var g=b.cipher(s,c),v=new Array(e[p].length);for(r=0;r<e[p].length;r++)v[r]=g[r]^e[p].charCodeAt(r),v[r]=String.fromCharCode(v[r]);f[p]=v.join("")}var h=f.join("");return h=w.decode(h)};var S={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e,t){t=void 0!==t&&t;var i,o,n,r,a,s,d,c,u=[],l="",p=S.code;if(0<(s=(d=t?e.encodeUTF8():e).length%3))for(;s++<3;)l+="=",d+="\0";for(s=0;s<d.length;s+=3)o=(i=d.charCodeAt(s)<<16|d.charCodeAt(s+1)<<8|d.charCodeAt(s+2))>>18&63,n=i>>12&63,r=i>>6&63,a=63&i,u[s/3]=p.charAt(o)+p.charAt(n)+p.charAt(r)+p.charAt(a);return c=(c=u.join("")).slice(0,c.length-l.length)+l},decode:function(e,t){t=void 0!==t&&t;var i,o,n,r,a,s,d,c,u=[],l=S.code;c=t?e.decodeUTF8():e;for(var p=0;p<c.length;p+=4)i=(s=l.indexOf(c.charAt(p))<<18|l.indexOf(c.charAt(p+1))<<12|(r=l.indexOf(c.charAt(p+2)))<<6|(a=l.indexOf(c.charAt(p+3))))>>>16&255,o=s>>>8&255,n=255&s,u[p/4]=String.fromCharCode(i,o,n),64==a&&(u[p/4]=String.fromCharCode(i,o)),64==r&&(u[p/4]=String.fromCharCode(i));return d=u.join(""),t?d.decodeUTF8():d}},w={encode:function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|63&t)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|63&t)})},decode:function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2);return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(31&e.charCodeAt(0))<<6|63&e.charCodeAt(1);return String.fromCharCode(t)})}};L.aexInstance=b.Ctr}(),L.Utils=function(){var n=void 0,o={localStorage:!1,sessionStorage:!1},p="Utils";return n={handleMediaPlayOnEvent:function(t,i,e){try{if(L.Utils.removeEvent(t,"canplay",n.handleMediaPlayOnEvent.bind(null,t,i)),L.Utils.removeEvent(t,"loadedmetadata",n.handleMediaPlayOnEvent.bind(null,t,i)),L.Utils.removeEvent(t,"loadeddata",n.handleMediaPlayOnEvent.bind(null,t,i)),t&&t.play&&"function"==typeof t.play){var o=t.play();L.Utils.isFunction(e)&&e(0),o&&o.catch&&"function"==typeof o.catch&&o.catch(function(e){L.Logger.error(p,"[tk-sdk]media play err:",L.Utils.toJsonStringify(e),i?" , media element id is "+i:" media element:",i?"":t)})}}catch(e){L.Logger.error(p,"[tk-sdk]media play error:",L.Utils.toJsonStringify(e),i?" , media element id is "+i:" media element:",i?"":t)}},handleMediaPauseOnEvent:function(t,i){try{if(L.Utils.removeEvent(t,"canplay",n.handleMediaPauseOnEvent.bind(null,t,i)),L.Utils.removeEvent(t,"loadedmetadata",n.handleMediaPauseOnEvent.bind(null,t,i)),L.Utils.removeEvent(t,"loadeddata",n.handleMediaPauseOnEvent.bind(null,t,i)),t&&t.pause&&"function"==typeof t.pause){var e=t.pause();e&&e.catch&&"function"==typeof e.catch&&e.catch(function(e){L.Logger.error(p,"[tk-sdk]media pause err:",L.Utils.toJsonStringify(e),i?" , media element id is "+i:" media element:",i?"":t)})}}catch(e){L.Logger.error(p,"[tk-sdk]media pause error:",L.Utils.toJsonStringify(e),i?" , media element id is "+i:" media element:",i?"":t)}}},{addEvent:function(e,t,i,o){o=null!=o&&null!=o&&o,e.addEventListener?e.addEventListener(t,i,o):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},removeEvent:function(e,t,i,o){o=null!=o&&null!=o&&o,e.removeEventListener?e.removeEventListener(t,i,o):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null},toJsonStringify:function(e,t){if(!(t=null==t||t))return e;if(!e)return e;try{if("object"!==Ft(e))return e;var i=JSON.stringify(e);i&&(e=i)}catch(e){}return e},toJsonParse:function(e,t){if(!(t=null==t||t))return e;if(!e)return e;try{if("string"!=typeof e)return e;var i=JSON.parse(e);i&&(e=i)}catch(e){}return e},encrypt:function(e,t,i,o){if(!e)return e;i=i||TK.hexEncryptDecryptKey,o=o||TK.hexEncryptDecryptBit,t=null!=t?t:"talk_2018_@beijing";var n=L.aexInstance.encrypt(e,i,o);return n=t+n+t},decrypt:function(e,t,i,o){if(!e)return e;i=i||TK.hexEncryptDecryptKey,o=o||TK.hexEncryptDecryptBit,t=null!=t?t:"talk_2018_@beijing";var n=new RegExp(t,"gm");return e=e.replace(n,""),L.aexInstance.decrypt(e,i,o)},mediaPlay:function(e,t){var i=void 0;e&&"string"==typeof e?e=document.getElementById(e):e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&e.getAttribute&&"function"==typeof e.getAttribute&&(i=e.getAttribute("id")),e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&(0!==e.readyState?n.handleMediaPlayOnEvent(e,i,t):(L.Utils.removeEvent(e,"canplay",n.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.removeEvent(e,"loadedmetadata",n.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.removeEvent(e,"loadeddata",n.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.addEvent(e,"canplay",n.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.addEvent(e,"loadedmetadata",n.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.addEvent(e,"loadeddata",n.handleMediaPlayOnEvent.bind(null,e,i,t))))},mediaPause:function(e){var t=void 0;e&&"string"==typeof e?e=document.getElementById(e):e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&e.getAttribute&&"function"==typeof e.getAttribute&&(t=e.getAttribute("id")),e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&(0!==e.readyState?n.handleMediaPauseOnEvent(e,t):(L.Utils.removeEvent(e,"canplay",n.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.removeEvent(e,"loadedmetadata",n.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.removeEvent(e,"loadeddata",n.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.addEvent(e,"canplay",n.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.addEvent(e,"loadedmetadata",n.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.addEvent(e,"loadeddata",n.handleMediaPauseOnEvent.bind(null,e,t))))},localStorage:{setItem:function(t,i){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(t,i):L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage.setItem , key is "+t+" , value is "+i+"!"):(o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage!")),window.TK.storage[t]=i)}catch(e){o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(e))),window.TK.storage[t]=i}},getItem:function(t){try{return window.localStorage?window.localStorage.getItem?window.localStorage.getItem(t):(L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage.getItem , key is "+t+" !"),""):(o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage!")),window.TK.storage[t]||"")}catch(e){return o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(e))),window.TK.storage[t]||""}},removeItem:function(t){try{return window.localStorage?window.localStorage.removeItem?window.localStorage.removeItem(t):(L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage.removeItem , key is "+t+" !"),""):(o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage!")),window.TK.storage[t]&&delete window.TK.storage[t],"")}catch(e){return o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(e))),window.TK.storage[t]&&delete window.TK.storage[t],""}}},sessionStorage:{setItem:function(e,t){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(e,t):L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage.setItem , key is "+e+" , value is "+t+"!"):o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage!"))}catch(e){o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(e)))}},getItem:function(e){try{return window.sessionStorage?window.sessionStorage.getItem?window.sessionStorage.getItem(e):(L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage.getItem , key is "+e+" !"),""):(o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage!")),"")}catch(e){return o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(e))),""}},removeItem:function(e){try{return window.sessionStorage?window.sessionStorage.removeItem?window.sessionStorage.removeItem(e):(L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage.removeItem , key is "+e+" !"),""):(o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage!")),"")}catch(e){return o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(e))),""}}},getBrowserInfo:function(){var e,t,i=window.navigator.userAgent,o=/(msie\s|trident.*rv:)([\w.]+)/,n=/edge\/(\d+).(\d+)$/,r=/(firefox)\/([\w.]+)/,a=/(opera).+version\/([\w.]+)/,s=/(chrome)\/([\w.]+)/,d=/version\/([\w.]+).*(safari)/,c=(e=i.toLowerCase(),(t=o.exec(e))?{browser:"IE",version:t[2]||"0"}:(t=n.exec(e))?{browser:"Edge",version:t[2]||"0"}:(t=r.exec(e))?{browser:t[1]||"Firefox",version:t[2]||"0"}:(t=a.exec(e))?{browser:t[1]||"Opera",version:t[2]||"0"}:(t=s.exec(e))?{browser:t[1]||"Chrome",version:t[2]||"0"}:(t=d.exec(e))?{browser:t[2]||"Safari",version:t[1]||"0"}:{browser:"unknown",version:"unknown"}),u=navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||navigator.language;return{versions:function(){var e=navigator.userAgent;navigator.appVersion;return{edge:-1<e.indexOf("Edge"),trident:-1<e.indexOf("Trident"),presto:-1<e.indexOf("Presto"),webKit:-1<e.indexOf("AppleWebKit"),gecko:-1<e.indexOf("Gecko")&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<e.indexOf("Android")||-1<e.indexOf("Linux"),iPhone:-1<e.indexOf("iPhone"),iPad:-1<e.indexOf("iPad"),webApp:-1==e.indexOf("Safari")}}(),language:u?u.toLowerCase():void 0,info:{browserName:c.browser,browserVersion:c.version,appCodeName:navigator.appCodeName,appMinorVersion:navigator.appMinorVersion,appName:navigator.appName,appVersion:navigator.appVersion,browserLanguage:navigator.browserLanguage,cookieEnabled:navigator.cookieEnabled,cpuClass:navigator.cpuClass,onLine:navigator.onLine,platform:navigator.platform,systemLanguage:navigator.systemLanguage,userAgent:navigator.userAgent,userLanguage:navigator.userLanguage}}},getJsonLength:function(e){var t=0;if("object"===Ft(e))for(var i in e)e.hasOwnProperty(i)&&++t;return t},detectOS:function(){try{var e=navigator.userAgent,t="Win32"===navigator.platform||"Windows"===navigator.platform,i="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(i)return"Mac";if("X11"===navigator.platform&&!t&&!i)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(t){if(-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000"))return"Win2000";if(-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP"))return"WinXP";if(-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003"))return"Win2003";if(-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista"))return"WinVista";if(-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7"))return"Win7";if(-1<e.indexOf("Windows NT 6.2")||-1<e.indexOf("Windows 8"))return"Win8";if(-1<e.indexOf("Windows NT 10.0")||-1<e.indexOf("Windows 10"))return"Win10"}return"Other"}catch(e){return L.Logger.error(p,"[tk-sdk]detectOS method error:",e),"Other"}},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isBoolean:function(e){return"boolean"==typeof e},isArray:function(e){return Array.isArray(e)},isHTMLCollection:function(e){return"object"===Ft(e)&&window.HTMLCollection&&e instanceof window.HTMLCollection},isNull:function(e){return!e&&0!==e&&"boolean"!=typeof e},getFileName:function(e){if("string"!=typeof e)return"";var t=e.lastIndexOf("/"),i=e.lastIndexOf("\\"),o=Math.max(t,i);return e.substring(o+1)},copy:function(e){var t={};for(var i in e)t[i]="object"===Ft(e[i])?L.Utils.copy(e[i]):e[i];return t},stopTrack:function(e,t){t?e.stop():TK.notStopTrack||e&&"video"===e.kind&&TK.notStopVideoTrack||e&&"audio"===e.kind&&TK.notStopAudioTrack||e&&"function"==typeof e.stop&&e.stop()},cloneTrack:function(e){return e&&L.Utils.isFunction(e.clone)?e.clone():e},cloneMediaStream:function(s,d,c){if(d="boolean"!=typeof d||d,c="boolean"!=typeof c||c,!s)return s;var t=function(){var e=s&&"function"==typeof s.clone?s.clone():void 0;if(!e)return s;if(e&&0<e.getTracks().length)for(var t=e.getTracks().length-1;0<=t;t--){var i=e.getTracks()[t];L.Utils.stopTrack(i),e.removeTrack(i)}var o=e&&"function"==typeof e.clone?e.clone():void 0;if(e=void 0,!o)return s;if(d&&0<s.getAudioTracks().length){t=0;for(var n=s.getAudioTracks().length;t<n;t++){var r=s.getAudioTracks()[t];o.addTrack(L.Utils.cloneTrack(r))}}if(c&&0<s.getVideoTracks().length)for(t=0,n=s.getVideoTracks().length;t<n;t++){var a=s.getVideoTracks()[t];o.addTrack(L.Utils.cloneTrack(a))}return o};if(!window.MediaStream||"function"!=typeof window.MediaStream)return t();try{var e=new window.MediaStream;if(d&&0<s.getAudioTracks().length)for(var i=0,o=s.getAudioTracks().length;i<o;i++){var n=s.getAudioTracks()[i];e.addTrack(L.Utils.cloneTrack(n))}if(c&&0<s.getVideoTracks().length)for(i=0,o=s.getVideoTracks().length;i<o;i++){var r=s.getVideoTracks()[i];e.addTrack(L.Utils.cloneTrack(r))}return e}catch(e){return t()}},sdkAjax:function(e){var r=/\[\]$/;function a(e,t){var i,o,n,r,a,s=0;if(r=!!(o=e)&&"length"in o&&o.length,a=d(o),L.Utils.isFunction(o)||null!=(n=o)&&n===n.window||!("array"===a||0===r||"number"==typeof r&&0<r&&r-1 in o)){for(s in e)if(!1===t.call(e[s],s,e[s]))break}else for(i=e.length;s<i&&!1!==t.call(e[s],s,e[s]);s++);return e}function d(e){return null==e?e+"":"object"===Ft(e)||"function"==typeof e?{}[{}.toString.call(e)]||"object":Ft(e)}function t(e,t){var i="";return e&&"object"===Ft(e)?i=function(e,t){var i,o=[],n=function(e,t){var i=L.Utils.isFunction(t)?t():t;o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(null==e)return"";if(Array.isArray(e)||!s(e))a(e,function(){n(this.name,this.value)});else for(i in e)c(i,e[i],t,n);return o.join("&")}(e):"string"==typeof e&&(i=e),i}function s(e){var t,i;return!(!e||"[object Object]"!==toString.call(e))&&(!(t=Object.getPrototypeOf(e))||"function"==typeof(i={}.hasOwnProperty.call(t,"constructor")&&t.constructor)&&{}.hasOwnProperty.toString.call(i)==={}.hasOwnProperty.toString.call(Object))}function c(i,e,o,n){var t;if(Array.isArray(e))a(e,function(e,t){o||r.test(i)?n(i,t):c(i+"["+("object"===Ft(t)&&null!=t?e:"")+"]",t,o,n)});else if(o||"object"!==d(e))n(i,e);else for(t in e)c(i+"["+t+"]",e[t],o,n)}var i={type:e.type||"GET",url:e.url||"",data:e.data||null,async:e.async||!0,dataType:e.dataType||"text",contentType:e.contentType||"application/x-www-form-urlencoded;charset=UTF-8",isupLoadFile:e.isupLoadFile,success:e.success||function(){},error:e.error||function(){},progress:e.progress||function(){},start:e.progress||function(){},end:e.end||function(){}};if(i.type=i.type.toUpperCase(),i.success&&"function"!=typeof i.success)L.Logger.error(p,"[myAjax] success is not a function, is ",i.success);else if(i.error&&"function"!=typeof i.error)L.Logger.error(p,"[myAjax] error is not a function, is ",i.error);else if(i.progress&&"function"!=typeof i.progress)L.Logger.error(p,"[myAjax] progress is not a function, is ",i.progress);else if(i.start&&"function"!=typeof i.start)L.Logger.error(p,"[myAjax] start is not a function, is ",i.start);else{if(!i.end||"function"==typeof i.end){var o=void 0,n=void 0;window.XMLHttpRequest?o=new XMLHttpRequest:window.ActiveXObject?o=new ActiveXObject("Microsoft.XMLHTTP"):L.Logger.error(p,"[myAjax] Your browser does not support it : XMLHttpRequest and  ActiveXObject "),o.upload.onprogress=i.progress,o.onreadystatechange=function(){if(4===o.readyState)if(200<=o.status&&o.status<300||304===o.status)switch(o.upload.onprogress=null,i.dataType){case"text":case"TEXT":i.success(o.responseText);break;case"json":case"JSON":var e={};try{e=JSON.parse(o.responseText)}catch(e){L.Logger.warning(p,"[tk-sdk] xmlHttp request url : "+i.url+", result : "+o.responseText)}i.success(e);break;case"xml":case"XML":i.success(o.responseXML)}else o.upload.onprogress=null,i.error(o.status)},o.onload=function(e){},o.onerror=function(e){},o.onloadstart=function(){i.start()},o.onloadend=function(){i.end()};var u=-1===i.url.indexOf("?")?"?":"&";if(i.url.indexOf("?")===i.url.length-1&&(u=""),"GET"===i.type){var l=t(i.data);0!==l.length&&(l=u+l),n=i.url+l,o.open(i.type,n,i.async),o.send()}else"POST"===i.type&&(n=i.url,o.open(i.type,n,i.async),i.isupLoadFile?o.send(i.data):(o.setRequestHeader("Content-Type",i.contentType),o.send(t(i.data))));return o}L.Logger.error(p,"[myAjax] end is not a function, is ",i.end)}},getUserMediaFailCode:function(e){var t=window.TK_ERR.DEVICE_ERROR_UnknownError;switch(e){case"NotFoundError":case"DevicesNotFoundError":t=window.TK_ERR.DEVICE_ERROR_NotFoundError;break;case"NotAllowedError":case"PermissionDeniedError":t=window.TK_ERR.DEVICE_ERROR_NotAllowedError;break;case"NotReadableError":case"TrackStartError":t=window.TK_ERR.DEVICE_ERROR_NotReadableError;break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":t=window.TK_ERR.DEVICE_ERROR_OverconstrainedError;break;case"TypeError":t=window.TK_ERR.DEVICE_ERROR_UnknownError}return t},getMaxBPS:function(e,t){return e<=80?t<20?64:96:e<=176?t<20?128:192:e<=320?t<20?256:384:e<=640?t<20?384:512:e<=1280?t<15?1024:15<=t&&t<=20?1280:1536:t<15?1280:15<=t&&t<=20?1536:2048},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},generategGuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},getNetLevel:function(e,t){var i=L.Utils.getNetPacketsLostRateLevel(e),o=L.Utils.getNetDelayLevel(t);return Math.max(i,o)},getNetPacketsLostRateLevel:function(e){window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD;return e<1?window.TK.NET_QUALITY.TK_NET_QUALITY_EXCELLENT:e<5?window.TK.NET_QUALITY.TK_NET_QUALITY_GOOD:e<10?window.TK.NET_QUALITY.TK_NET_QUALITY_ACCEPTED:e<20?window.TK.NET_QUALITY.TK_NET_QUALITY_BAD:window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD},getNetDelayLevel:function(e){window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD;return e<80?window.TK.NET_QUALITY.TK_NET_QUALITY_EXCELLENT:e<150?window.TK.NET_QUALITY.TK_NET_QUALITY_GOOD:e<300?window.TK.NET_QUALITY.TK_NET_QUALITY_ACCEPTED:e<500?window.TK.NET_QUALITY.TK_NET_QUALITY_BAD:window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD},randomWord:function(e){e=e||1024;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=t.length,o="",n=0;n<e;n++)o+=t.charAt(Math.floor(Math.random()*i)),Math.floor(10*Math.random());return o.toLowerCase(),o},setMaxBWToSdp:function(e,t,i){var o,n;return e=L.Utils.formatSdp(e),t&&t.video&&t.maxVideoBW&&(null==(n=(e=e.replace(/b=AS:.*\r\n/g,"")).match(/m=video.*\r\n/))&&(n=e.match(/m=video.*\n/)),n&&0<n.length&&(o=n[0]+"b=AS:"+t.maxVideoBW+"\r\n",e=e.replace(n[0],o))),i&&i.audio&&i.maxAudioBW&&(null==(n=e.match(/m=audio.*\r\n/))&&(n=e.match(/m=audio.*\n/)),n&&0<n.length&&(o=n[0]+"b=AS:"+i.maxAudioBW+"\r\n",e=e.replace(n[0],o))),e},setHiFiToSdp:function(e){var t,i;(e=L.Utils.formatSdp(e),TK.isHiFi)&&(null==(i=(e=e.replace(new RegExp("a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate="+TK.maxaveragebitrateToHifi+";maxplaybackrate=48000;stereo=1\r\n","g"),"")).match(/a=rtpmap:111.*\r\n/))&&(i=e.match(/a=rtpmap:111.*\n/)),i&&0<i.length&&(t=i[0]+"a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate="+TK.maxaveragebitrateToHifi+";maxplaybackrate=48000;stereo=1\r\n",e=e.replace(i[0],t)));return e},formatSdp:function(e){return e=e.replace(/\r?\n/g,"#talkcloudFormatSdp_r_n#").replace(/#talkcloudFormatSdp_r_n#/g,"\r\n")},getBrowser:function(){var e="none";return null!==window.navigator.userAgent.match("Firefox")?e="mozilla":null!==window.navigator.userAgent.match("Bowser")?e="bowser":null!==window.navigator.userAgent.match("Chrome")?(e="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(e="electron")):null!==window.navigator.userAgent.match("Safari")?e="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(e="bowser"),e},createMediaStream:function(e,t){var i=void 0;if(window.MediaStream&&"function"==typeof window.MediaStream){i=new window.MediaStream;e&&i.addTrack(e),t&&i.addTrack(t)}else L.Logger.error(p,"[tk-sdk]The browser does not support the creation of mediaStream!");return i},getWhereWebInfo:function(e,t,i,r,a){a=!L.Utils.isBoolean(a)||a;var s=e+"://"+t+":"+(/https/g.test(e)?8080:81)+"/where.html?ts="+(new Date).getTime(),d=function(e){L.Logger.info(p,"[tk-sdk]getFalsificationIp resp :",window.__TkSdkBuild__?L.Utils.encrypt("object"===Ft(e)?L.Utils.toJsonStringify(e):e):"object"===Ft(e)?L.Utils.toJsonStringify(e):e),"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e&&"object"===Ft(e)?L.Utils.isFunction(i)&&i(e):(L.Logger.error(p,"[tk-sdk]getFalsificationIp resp not is json"),L.Utils.isFunction(r)&&r("getFalsificationIp resp not is json"))};L.Utils.sdkAjax({url:s,type:"get",async:a,success:d,error:function e(t){if(L.Logger.error(p,"[tk-sdk]getFalsificationIp fail:",t),navigator&&!0===navigator.onLine)if(-1==s.indexOf("global")){var i=s.match(/(\w+):\/\/([^/:]+)(:\d*)?([^# ]*)/)[2],o=i.split(".")[0],n=i.replace(o,"global");s=s.replace(i,n),L.Utils.sdkAjax({url:s,type:"get",async:a,success:d,error:e})}else L.Utils.isFunction(r)&&r(t);else L.Utils.isFunction(r)&&r(t)}})},replaceHostname:function(e,t){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(e)&&t&&e){var i=e.indexOf(".");if(0<i){var o=e.substring(0,i),n=new RegExp(o);e=e.replace(n,t)}}return e},speedNetwordk:function(e,t,i,o,n){(n=n||{}).infoLog=!L.Utils.isBoolean(n.infoLog)||n.infoLog,n.errorLog=!L.Utils.isBoolean(n.errorLog)||n.errorLog;var r=n.randomWordLength||512,a=(new Date).getTime(),s=e+"://"+t+":"+i+"/speed.php?ts="+a,d=L.Utils.randomWord(r);return L.Utils.sdkAjax({url:s,type:"GET",async:!0,data:{data:d},success:function(e){var t=(new Date).getTime();n.infoLog&&L.Logger.info(p,"[tk-sdk]"+(n.source||"")+"speedNetwordk finshed,url is "+s+" ,elapsed time is "+(t-a)+" ms"),L.Utils.isFunction(o)&&o(0,t-a,a,t,e)},error:function(e){var t=(new Date).getTime();n.errorLog&&L.Logger.error(p,"[tk-sdk]"+(n.source||"")+"speedNetwordk fail,url is "+s+" ,elapsed time is "+(t-a)+" ms, error info:",e),L.Utils.isFunction(o)&&o(-1,t-a,a,t,e)}})},nativeMediaStream:function(e,t){var i={},o=[],n=[];return e&&(o=[e]),t&&(n=[t]),i.getAudioTracks=function(){return n},i.getVideoTracks=function(){return o},i.addTrack=function(e){e&&e.kind&&e.id?"video"===e.kind?o.push(e):"audio"===e.kind&&n.push(e):L.Logger.error(p,"[tk-sdk]Native addTrack Parameters are not! ")},i.removeTrack=function(t){t&&t.kind&&t.id?"video"===t.kind?o=o.filter(function(e){return e.id!==t.id}):"audio"===t.kind&&(n=n.filter(function(e){return e.id!==t.id})):L.Logger.error(p,"[tk-sdk]Native addTrack Parameters are not! ")},i},isVideoinputDeviceIdFromDeviceList:function(e){var t=!1;if(TK.deviceInfoMap&&TK.deviceInfoMap.videoinput&&TK.deviceInfoMap.videoinput.length)for(var i=0,o=TK.deviceInfoMap.videoinput.length;i<o;i++)if(TK.deviceInfoMap.videoinput[i]&&TK.deviceInfoMap.videoinput[i].deviceId===e){t=!0;break}return t},isAudioinputDeviceIdFromDeviceList:function(e){var t=!1;if(TK.deviceInfoMap&&TK.deviceInfoMap.audioinput&&TK.deviceInfoMap.audioinput.length)for(var i=0,o=TK.deviceInfoMap.audioinput.length;i<o;i++)if(TK.deviceInfoMap.audioinput[i]&&TK.deviceInfoMap.audioinput[i].deviceId===e){t=!0;break}return t},isSupportMediaStreamTrackMethod:function(e){try{if(!TK.isTkNative&&window.MediaStreamTrack&&window.MediaStreamTrack.prototype)return window.MediaStreamTrack.prototype.hasOwnProperty(e)}catch(e){L.Logger.error(p,"[tk-sdk]getMediaStreamTrackSupport error:",e)}return!1},isSupportRTCRtpSenderMethod:function(e){try{if(!TK.isTkNative&&window.RTCRtpSender&&window.RTCRtpSender.prototype)return window.RTCRtpSender.prototype.hasOwnProperty(e);if(TK.isTkNative)return!0}catch(e){L.Logger.error(p,"[tk-sdk]getMediaStreamTrackSupport error:",e)}return!1},getBrowserName:function(){function e(){var n=window,e=n.navigator,t=n.document,i=n.ActiveXObject,o=t.documentMode,r=/^Apple/,a=function(){var e=3,t=document.createElement("p"),i=t.getElementsByTagName("i");for(;t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",i[0];);return 4<e?e:0}()||o||0,s=i||o,d=/Edge/i,c=/(?:Chrome\/)(\d+)(?:\.)/i,u=function(){if(s||void 0!==n.scrollMaxX||r.test(e.vendor||""))return"";if(d.test(navigator.userAgent))return"Edge";document.createElement("track"),n.chrome&&n.chrome.webstore&&Object.keys(n.chrome.webstore).length,n.chrome&&n.chrome.app&&Object.keys(n.chrome.app).length;if(/qqbrowser/.test(navigator.userAgent.toLowerCase()))return"qq";if(l(/^sogou/i,0))return"sogou";if(l(/^liebao/i,0))return"liebao";if(n.clientInformation&&n.clientInformation.languages&&2<n.clientInformation.languages.length)return"chrome";if(function(e,t){var i=navigator.mimeTypes;for(var o in i)if(i[o][e]==t)return!0;return!1}("type","application/vnd.chromium.remoting-viewer"))return"360";return""}();function l(e,t){var i=n.external||{};for(var o in i)if(e.test(t?i[o]:o))return!0;return!1}return{isIE:function(){return!!a},ieVersion:function(){return a},isEdge:function(){return"Edge"===u},isChrome:function(){return"chrome"===u},chromeVersion:function(){return e=navigator.userAgent,(t=c.exec(e))[t.length-1];var e,t},is360:function(){return"360"===u},isLiebao:function(){return"liebao"===u},isSogou:function(){return"sogou"===u},isQQ:function(){return"qq"===u}}}return(t=e()).isIE()?"IE:"+t.ieVersion():t.isEdge()?"Edge":t.isChrome()?"chrome:"+t.chromeVersion():t.is360()?"360":t.isLiebao()?"liebao":t.isSogou()?"sogou":t.isQQ()?"qq":"";var t},createTack:function(){return document.createElement("canvas").captureStream().getTracks()[0]}}}(L),window&&L.Utils.addEvent(window,"load",function(){TK&&TK.DeviceMgrImpl&&"function"==typeof TK.DeviceMgrImpl.getDevices&&TK.DeviceMgrImpl.getDevices()}),window.TK=window.TK||{},window.L=window.L||{},TK.EventDispatcher=function(a){var s={};return(a=a||{}).dispatcher={},a.dispatcher.eventListeners={},a.dispatcher.backupListerners={},s.addEventListener=function(e,t,i){null!=e&&(void 0===a.dispatcher.eventListeners[e]&&(a.dispatcher.eventListeners[e]=[]),a.dispatcher.eventListeners[e].push(t),i&&(void 0===a.dispatcher.backupListerners[i]&&(a.dispatcher.backupListerners[i]=[]),a.dispatcher.backupListerners[i].push({eventType:e,listener:t})))},s.removeEventListener=function(e,t){var i;a.dispatcher.eventListeners[e]?-1!==(i=a.dispatcher.eventListeners[e].indexOf(t))&&a.dispatcher.eventListeners[e].splice(i,1):L.Logger.info("Events","[tk-sdk]not event type: "+e)},s.removeAllEventListener=function(e){if((r=e)&&"object"===Ft(r)&&"number"==typeof r.length&&"function"==typeof r.splice&&!r.propertyIsEnumerable("length"))for(var t in e){var i=e[t];delete a.dispatcher.eventListeners[i]}else if("string"==typeof e)delete a.dispatcher.eventListeners[e];else if("object"===Ft(e))for(var o in e){i=o;var n=e[o];s.removeEventListener(i,n)}var r},s.dispatchEvent=function(e,t){var i;for(i in(t=null==t||t)&&L.Logger.debug("Events","sdk-dispatchEvent , event type: "+e.type+", evnet:",e),a.dispatcher.eventListeners[e.type])a.dispatcher.eventListeners[e.type].hasOwnProperty(i)&&a.dispatcher.eventListeners[e.type][i](e)},s.removeBackupListerner=function(e){if(e&&a.dispatcher.backupListerners[e]){for(var t=0;t<a.dispatcher.backupListerners[e].length;t++){var i=a.dispatcher.backupListerners[e][t];s.removeEventListener(i.eventType,i.listener)}a.dispatcher.backupListerners[e].length=0,delete a.dispatcher.backupListerners[e]}},s},TK.TalkEvent=function(e){var t={};return t.type=e.type,t.data=e.data,t},TK.RoomEvent=function(e,t){var i=TK.TalkEvent(e);if(i.streams=e.streams,i.message=e.message,i.user=e.user,i.userid=e.user?e.user.id:void 0,i.userId=i.userid,t&&"object"===Ft(t))for(var o in t)i[o]=t[o];return i},TK.StreamEvent=function(e,t){var i=TK.TalkEvent(e);if(i.stream=e.stream,i.message=e.message,i.bandwidth=e.bandwidth,i.attrs=e.attrs,i.userid=e.stream&&e.stream.extensionId&&e.stream.getAttributes&&e.stream.getAttributes()&&e.stream.getAttributes().type?e.stream.extensionId.replace(new RegExp(":"+e.stream.getAttributes().type,"g"),""):void 0,i.userId=i.userid,i.streamType=e.stream&&e.stream.extensionId&&e.stream.getAttributes&&e.stream.getAttributes()&&e.stream.getAttributes().type?e.stream.getAttributes().type:void 0,i.streamInfo={audio:!(!e.stream||!e.stream.hasAudio)&&e.stream.hasAudio(),video:!(!e.stream||!e.stream.hasVideo)&&e.stream.hasVideo(),attributes:e.stream&&e.stream.getAttributes?e.stream.getAttributes():{}},t&&"object"===Ft(t))for(var o in t)i[o]=t[o];return i},TK.coreEventController=TK.EventDispatcher({}),window.TK=window.TK||{},window.L=window.L||{},TK.CONNECTION_TYPE={UP:0,DOWN:1},TK.NativeConnection=function(e){var a={},n=void 0,t=e.connectionId,i=!1,o=!1,r=e.connectionType,s=e.extraData||{},d=e.extraData.extensionId,c="create_offer_success",u="create_offer_failure",l="NativeConnection",p=0,f=1,m=2,g={};function v(){return s.media?f:s.screen?m:p}function h(){var e=t;if(!t)throw Error("Invalid native-peer-connection ID");return e.toString()}function T(){var e=d;if(!d)throw Error("Invalid extensionId ID");return e.toString()}function y(e){var t=e.data.name;if(e.data.connectionId==T())if("onLocalDescription"===t){var i=e.data.sdp,o={};o.sdp=i,o.type="offer",L.Utils.isFunction(a[c])&&a[c](),delete a[c],delete a[u],L.Utils.isFunction(g.onOfferGenerated)&&g.onOfferGenerated(h(),o)}else if("onIceCandidate"===t){if(!L.Utils.isFunction(g.onIceCandidate))return;var n={type:"candidate",candidate:{}};n.candidate.sdpMLineIndex=e.data.sdpMLineIndex,n.candidate.sdpMid=e.data.sdpMid,n.candidate.candidate="a="+e.data.candidate,g.onIceCandidate(h(),n)}else if("onIceStatusChanged"===t){if(!L.Utils.isFunction(g.onIceConnectionStateChange))return;var r=e.data.state;1==r?g.onIceConnectionStateChange(h(),"checking"):2==r?g.onIceConnectionStateChange(h(),"connected"):3==r?g.onIceConnectionStateChange(h(),"completed"):4==r?g.onIceConnectionStateChange(h(),"failed"):5==r?g.onIceConnectionStateChange(h(),"disconnected"):6==r&&g.onIceConnectionStateChange(h(),"closed")}else if("onAddStream"===t){if(!L.Utils.isFunction(g.onAddStream))return;g.onAddStream(h(),{stream:{}})}else if("onRemoveStream"===t){if(!L.Utils.isFunction(g.onRemoveStream))return;g.onRemoveStream(h())}}return g.isNative=!0,g.getConnectionId=function(){return t},g.createOffer=function(e,t){var i=r===TK.CONNECTION_TYPE.UP;window.tknative.postMessage({command:"createOffer",streamId:T(),offerToSend:i}),a[c]=e,a[u]=t},g.createAnswer=function(e,t){window.tknative.postMessage({command:"createOffer",streamId:T(),offerToSend:!1}),a[c]=e,a[u]=t},g.setRemoteDescription=function(e,t,i){if(L.Utils.isNull(e))return L.Logger.error(l,"[tk-sdk] Connection::setRemoteDescription: sdp object is null"),void(L.Utils.isFunction(i)&&i("sdp object is null"));window.tknative.postMessage({command:"setRemoteDescription",sdpAnswer:e.sdp,streamId:T()}),L.Utils.isFunction(t)&&t()},g.addIceCandidate=function(e){var t=e.candidate,i=e.sdpMLineIndex;tknative.postMessage({command:"setIceCandidate",candidate:t,sdpMid:0,sdpMLineIndex:i,streamId:T()})},g.setMediaStream=function(e,t,i){if(t&&L.Utils.isFunction(t)){var o=t(e);o?e=o:L.Logger.error(l,"[tk-sdk]setStreamMethod Wrong return result.")}r===TK.CONNECTION_TYPE.UP&&(window.tknative&&window.tknative.postMessage&&window.tknative&&window.tknative.postMessage&&window.tknative.postMessage({command:"addStream",streamId:T(),type:Number(v())}),n=e)},g.getMediaStream=function(){return n},g.removeMediaStream=function(e){window.tknative.postMessage({command:"removeStream",streamId:T(),type:Number(v())})},g.getVideoTrack=function(){},g.getAudioTrack=function(){},g.addAudioTrack=function(){},g.addVideoTrack=function(){},g.removeVideoTrack=function(){},g.removeAudioTrack=function(){},g.enableVideo=function(e){i=e,r==TK.CONNECTION_TYPE.UP&&window.tknative.postMessage({command:"enableVideo",enable:e,connectionId:T()})},g.videoEnabled=function(){return i},g.enableAudio=function(e){o=e,r==TK.CONNECTION_TYPE.UP&&window.tknative.postMessage({command:"enableAudio",enable:e,connectionId:T()})},g.audioEnabled=function(){return o},g.close=function(){var e=r===TK.CONNECTION_TYPE.UP;window.tknative.postMessage({command:"closeConnection",streamId:T(),offerToSend:e,type:Number(v())}),window.tknative.removeEventListener("message",y)},g.getStats=function(e,t){L.Utils.isFunction(e)&&e(void 0,-1)},g.replaceVideoTrack=function(e,t){window.tknative.postMessage({command:"setCamera",deviceId:e.id})},g.replaceAudioTrack=function(e){window.tknative.postMessage({command:"setMicrophone",deviceId:e.id})},g.needRePublish=function(){return!1},g.onOfferGenerated=void 0,g.onIceCandidate=void 0,g.onIceConnectionStateChange=void 0,g.onAddStream=void 0,g.onRemoveStream=void 0,g.checkReplaceTrackSupport=function(){return!1},window.tknative.addEventListener("message",y,!1),g},window.TK=window.TK||{},window.L=window.L||{},TK.AudioPlayer=function(i){i.options=i.options||{};var o=TK.EventDispatcher({}),t=L.Utils.createMediaStream(),n=!1,r=100,a=!1,s="AudioPlayer";if(o.id=i.id,o.local=i.local,o.type=i.type,o.elementID=i.elementID,o.bundleId=i.bundleId,o.userid=i.userid,o.userId=o.userid,o.extensionId=i.extensionId,o.updateAudioPlayerSpec=function(e){if("object"===Ft(e))for(var t in e)if(o.hasOwnProperty(t))switch(o[t]=e[t],t){case"id":o.div&&o.div.setAttribute("id","audioplayer__"+o.id),o.audio&&o.audio.setAttribute("id","audioplayerstream_"+o.id)}},o.destroy=function(){try{if(o.audio&&(L.Utils.mediaPause(o.audio),p(o.audio)),o.div)try{o.container.removeChild(o.div)}catch(e){L.Logger.error(s,"[tk-sdk]AudioPlayer removeChild error:",e)}o.removeAudioTrack(),t=void 0}catch(e){L.Logger.error(s,"[tk-sdk]AudioPlayer destroy error , error info:",e)}},o.div=document.createElement("div"),o.div.setAttribute("id","audioplayer__"+o.id),o.div.setAttribute("class","Talk_player"),o.div.setAttribute("style","width: 100%; height: 100%; position: relative;background-color: black; overflow: hidden; display: none;"),o.audio=document.createElement("audio"),o.audio.setAttribute("id","audioplayerstream_"+o.id),o.audio.setAttribute("class","Talk_stream"),o.audio.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;"),o.audio.setAttribute("autoplay","autoplay"),o.audio.setAttribute("webkit-playsinline","true"),o.audio.setAttribute("x-webkit-airplay","true"),o.audio.setAttribute("playsinline","true"),o.audio.muted=!1,o.audio.volume=1,L.Utils.addEvent(o.audio,"canplay",u),L.Utils.addEvent(o.audio,"loadeddata",u),L.Utils.addEvent(o.audio,"loadedmetadata",u),o.hasAudioTrack=function(){var e=!1;return t&&t.getAudioTracks()&&t.getAudioTracks().length&&(e=!0),e},o.getAudioTrack=function(){if(t&&t.getAudioTracks()&&t.getAudioTracks().length)return t.getAudioTracks()[0]},o.removeAudioTrack=function(){o.hasAudioTrack()&&t&&t.removeTrack&&(t.removeTrack(o.getAudioTrack()),p(o.audio))},o.addAudioTrack=function(e){o.hasAudioTrack()&&o.removeAudioTrack(),t&&t.addTrack&&e&&(t.addTrack(e),t&&l(o.audio,t))},o.setMute=function(e){"boolean"==typeof e?(a=o.local&&o.type===TK.STREAM_VIDEO?(L.Logger.debug(s,"[tk-sdk]audioPlayer setMute:local audio must is mute!"),!0):e,o.audio&&void 0!==o.audio.muted&&(o.audio.muted=a),o.audio&&void 0!==o.audio.muted&&(o.audio.muted=a)):L.Logger.error(s,"[tk-sdk]Stream setMute isMute type must is boolean!")},o.setVolume=function(e){"number"==typeof e?(r=o.local&&o.type===TK.STREAM_VIDEO?(L.Logger.debug(s,"[tk-sdk]audioPlayer setVolume:local audio must is mute , volume must is 0!"),0):e,o.audio&&void 0!==o.audio.volume&&(o.audio.volume=r/100),o.audio&&void 0!==o.audio.volume&&(o.audio.volume=r/100)):L.Logger.error(s,"[tk-sdk]Stream setVolume volume type must is number!")},o.getVolume=function(e){return e&&"function"==typeof e?o.audio&&void 0!==o.audio.volume?(e(parseInt(100*o.audio.volume)),parseInt(100*o.audio.volume)):(L.Logger.warning(s,"[tk-sdk]audioPlayer getVolume failure , audio is not exist!"),e(r),r):(L.Logger.warning(s,"[tk-sdk]audioPlayer getVolume callback is not exist , callback must is function!"),r)},o.updateAudioPlayerOptions=function(e){},o.local&&o.type===TK.STREAM_VIDEO&&(o.setVolume(0),o.setMute(!0)),o.div.appendChild(o.audio),"string"==typeof o.elementID)if(o.container=document.getElementById(o.elementID),o.container){var e=document.getElementById("audioplayer__"+o.id);if(e)try{L.Logger.warning(s,"[tk-sdk]audioPlayer:There are other nodes in the video player that have not been released,not released element id is "+e.id+" ,element id is "+o.elementID+",id is "+o.id+",type is "+o.type+",userId is "+o.userid),o.container.removeChild(e)}catch(e){L.Logger.error(s,"[tk-sdk]audioPlayer error:",e)}o.container.appendChild(o.div)}else L.Logger.error(s,"[tk-sdk]audioPlayer error:find element,element id is "+o.elementID+",id is "+o.id+",type is "+o.type+",userId is "+o.userid);else L.Logger.error(s,"[tk-sdk]audioPlayer error:element id must is string,element id is "+o.elementID+",id is "+o.id+",type is "+o.type+",userId is "+o.userid);t&&l(o.audio,t);var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);function c(){try{if(o&&o.audio&&o.audio.play){var e=L.Utils.mediaPlay(o.audio);e&&e.catch&&e.catch(function(e){L.Logger.warning(s,"[tk-sdk]audio.play method catch error , audioPlayer id is "+o.id+" , error info:"+e)})}}catch(e){L.Logger.warning(s,"[tk-sdk]audio.play method error , audioPlayer id is "+(o?o.id:"undefined")+" !")}}function u(){if(o.audio&&(L.Utils.removeEvent(o.audio,"canplay",u),L.Utils.removeEvent(o.audio,"loadeddata",u),L.Utils.removeEvent(o.audio,"loadedmetadata",u)),!n&&(n=!0,TK.roomInstance&&!i.deviceCheck)){var e=o.userid;"_local_default_extension_id_"===e&&(e="");var t=TK.RoomEvent({type:"room-first-audio-frame",message:{userId:e,mediaType:o.type}});TK.roomInstance.dispatchEvent(t)}}function l(t,i){if(i&&i.getAudioTracks&&i.getAudioTracks()&&i.getAudioTracks().length){p(t);try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(t.srcObject=i,L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)){var o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);t.setSinkId&&t.setSinkId(o).then(function(e){L.Logger.info(s,"[tk-sdk]AudioPlayer setSinkId success:",o)}).catch(function(e){L.Logger.info(s,"[tk-sdk]AudioPlayer setSinkId error:",e)})}}else{var n=window.URL||webkitURL;t.src=n.createObjectURL(i)}}catch(e){L.Logger.warning(s,"[tk-sdk]audioPlayer attachMediaStream. attach by srcObject failed.",e,adapter.browserDetails);n=window.URL||webkitURL;t.src=n.createObjectURL(i)}}}function p(t){try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(t.srcObject&&L.Utils.isFunction(t.srcObject.removeTrack)&&L.Utils.isFunction(t.srcObject.getTracks))for(var e=t.srcObject.getTracks(),i=e.length-1;0<=i;i--)t.srcObject.removeTrack(e[i]);t.srcObject=null}else t.src=""}catch(e){t.src=""}}return o.audio&&d?TK.DeviceMgrImpl.associateElementsToSpeaker(o.audio,d,function(){c()}):c(),o},window.TK=window.TK||{},window.L=window.L||{},TK.NativeVideoPlayer=function(t){t.options=t.options||{},t.options.bar=void 0!==t.options.bar&&t.options.bar,t.options.mirror=t.options.mirror||!1,t.options.mode=t.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN,t.options.loader=!L.Utils.isBoolean(t.options.loader)||t.options.loader;var e=void 0!==t.options.audioPlayer&&t.options.audioPlayer,i=TK.EventDispatcher({}),o=t.options.loader,n="NativeVideoPlayer",r=L.Utils.nativeMediaStream();return i.id=t.id,i.local=t.stream.local,i.videoPlayerMediaStreamClone=t.stream.stream,i.type=t.stream&&t.stream.getAttributes&&t.stream.getAttributes()?t.stream.getAttributes().type:void 0,i.elementID=t.elementID,i.updateVideoPlayerSpec=function(e){if("object"===Ft(e))for(var t in e)if(i.hasOwnProperty(t))switch(i[t]=e[t],t){case"id":i.div&&i.div.setAttribute("id","player_"+i.id),i.loader&&i.loader.setAttribute("id","back_"+i.id),i.video&&i.video.setAttribute("id",i.id)}},i.destroy=function(){try{i.container&&i.div&&(i.div.parentNode===i.container?i.container.removeChild(i.div):L.Logger.warning(n,"[tk-sdk]VideoPlayer removeChild warning: Element removal warning"))}catch(e){L.Logger.error(n,"[tk-sdk]NativeVideoPlayer removeChild error:",e)}i.videoPlayerMediaStreamClone=void 0,i=r=void 0},i.hasVideoTrack=function(){var e=!1;return r&&r.getVideoTracks()&&r.getVideoTracks().length&&(e=!0),e},i.getVideoTrack=function(){if(r&&r.getVideoTracks()&&r.getVideoTracks().length)return r.getVideoTracks()[0]},i.removeVideoTrack=function(){i.hasVideoTrack()&&r&&r.removeTrack&&r.removeTrack(i.getVideoTrack())},i.addVideoTrack=function(e){i.hasVideoTrack()&&i.removeVideoTrack(),r&&r.addTrack&&e&&r.addTrack(e)},i.showVideo=function(){i.video&&(i.video.style.opacity=1),o&&(i.loader&&(i.loader.style.display=""),i.div.style.backgroundColor="")},i.hideVideo=function(){i.video&&(i.video.style.opacity=0),o&&(i.loader&&(i.loader.style.display=""),i.div.style.backgroundColor="")},i.hideLoading=function(){o=!1,i.loader&&(i.loader.style.display="none"),i.div.style.backgroundColor="transparent"},i.showLoading=function(){o=!0,i.loader&&(i.loader.style.display=""),i.div.style.backgroundColor=""},i.div=document.createElement("div"),i.div.setAttribute("id","player_"+i.id),i.div.setAttribute("class","Talk_player"),i.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(e?"  display: none;":" ")),t.options.loader&&(i.loader=document.createElement("div"),i.loader.setAttribute("id","back_"+i.id),i.loader.setAttribute("class","Talk_loader"),i.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;')),i.video=document.createElement("embed"),i.video.setAttribute("id",i.id),i.video.setAttribute("class","Talk_stream"),i.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(t.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":"")),i.video.setAttribute("tk-render-mode",t.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"),i.video.setAttribute("type","application/x-ppapi-proxy"),i.videoSupernatant=document.createElement("div"),i.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant"),i.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;"),i.updateVideoPlayerOptions=function(e){if(e&&"object"===Ft(e)&&(void 0!==e.mirror&&(t.options.mirror=e.mirror,i.video.style.webkitTransform=e.mirror?"rotateY(180deg)":"",i.video.style.mozTransform=e.mirror?"rotateY(180deg)":"",i.video.style.oTransform=e.mirror?"rotateY(180deg)":"",i.video.style.msTransform=e.mirror?"rotateY(180deg)":"",i.video.style.transform=e.mirror?"rotateY(180deg)":""),void 0!==e.mode&&(t.options.mode=e.mode,i.video.setAttribute("tk-render-mode",t.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"),window.tknative.postMessage({command:"updateRenderMode",args:{connections:[i.id],mode:t.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"}})),void 0!==e.loader))if(t.options.loader=e.loader,t.options.loader&&!i.loader)i.loader=document.createElement("div"),i.loader.setAttribute("id","back_"+i.id),i.loader.setAttribute("class","Talk_loader"),i.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'),o?i.showLoading():i.hideLoading();else if(!t.options.loader&&i.loader){try{i.div&&i.loader&&(i.loader.parentNode===i.div?i.div.removeChild(i.loader):L.Logger.warning(n,"[tk-sdk]VideoPlayer removeChild loader warning: Element removal warning"))}catch(e){L.Logger.error(n,"[tk-sdk]NativeVideoPlayer removeChild error:",e)}i.loader=void 0}},i.getVideoPlayerOptions=function(){return t.options},i.showVideoContainer=function(){},i.hideVideoContainer=function(){},TK.isOnlyAudioRoom&&i.hideVideo(),void 0!==i.elementID?"object"===Ft(i.elementID)&&"function"==typeof i.elementID.appendChild?i.container=i.elementID:i.container=document.getElementById(i.elementID):i.container=document.body,i.container.appendChild(i.div),i.loader&&(o?i.showLoading():i.hideLoading(),i.div.appendChild(i.loader)),i.div.appendChild(i.video),i.div.appendChild(i.videoSupernatant),i.containerWidth=0,i.containerHeight=0,i.hideLoading(),i},window.TK=window.TK||{},window.L=window.L||{},TK.NativeAudioPlayer=function(e){e.options=e.options||{};var t=TK.EventDispatcher({}),i=100,o="NativeAudioPlayer";t.id=e.id,t.local=e.local,t.type=e.type,t.elementID=e.elementID,t.bundleId=e.bundleId,t.userid=e.userid,t.userId=t.userid,t.extensionId=e.extensionId;var n=L.Utils.nativeMediaStream();return t.setMute=function(e){"boolean"==typeof e?(t.local&&"video"===t.type?(L.Logger.debug(o,"[tk-sdk]videoPlayer setMute:local video must is mute!"),!0):e)?window.tknative.postMessage({command:"setEmbedVolume",connectionId:t.id,volume:0}):window.tknative.postMessage({command:"setEmbedVolume",connectionId:t.id,volume:i}):L.Logger.error(o,"[tk-sdk]Stream setMute isMute type must is boolean!")},t.setVolume=function(e){"number"==typeof e?(e*=2.55,i=t.local&&t.type===TK.STREAM_VIDEO?(L.Logger.debug(o,"[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),0):e,window.tknative.postMessage({command:"setEmbedVolume",connectionId:t.id,volume:e})):L.Logger.error(o,"[tk-sdk]Stream setVolume volume type must is number!")},t.getVolume=function(e){return e&&"function"==typeof e?TK.isTkNative?(e(i),i):void 0:(L.Logger.warning(o,"[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!"),i)},t.updateAudioPlayerOptions=function(e){},t.updateAudioPlayerSpec=function(e){},t.destroy=function(){try{n=void 0}catch(e){L.Logger.error(o,"[tk-sdk]AudioPlayer destroy error , error info:",e)}},t.hasAudioTrack=function(){var e=!1;return n&&n.getAudioTracks()&&n.getAudioTracks().length&&(e=!0),e},t.getAudioTrack=function(){if(n&&n.getAudioTracks()&&n.getAudioTracks().length)return n.getAudioTracks()[0]},t.removeAudioTrack=function(){t.hasAudioTrack()&&n&&n.removeTrack&&n.removeTrack(t.getAudioTrack())},t.addAudioTrack=function(e){t.hasAudioTrack()&&t.removeAudioTrack(),n&&n.addTrack&&e&&n.addTrack(e)},t.onRemoteAudioVolume=function(e){e},t.onMicVolumeReport=function(e){t&&t.local&&e},t.local&&t.type===TK.STREAM_VIDEO&&(t.setVolume(0),t.setMute(!0)),t},window.TK=window.TK||{},window.L=window.L||{},TK.VideoPlayer=function(r){r.options=r.options||{},r.options.mirror=r.options.mirror||!1,r.options.mode=r.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN,r.options.loader=!L.Utils.isBoolean(r.options.loader)||r.options.loader;var s=TK.EventDispatcher({}),t=r.options.loader,a=!1,d=L.Utils.createMediaStream(),i="",o="",c=r.successFn,u=r.failureFn,n="VideoPlayer";if(s.id=r.id,s.local=r.local,s.type=r.type,s.elementID=r.elementID,s.bundleId=r.bundleId,s.userid=r.userid,s.userId=s.userid,s.extensionId=r.extensionId,s.isClone=r.isClone,s.div=document.createElement("div"),s.div.setAttribute("id","videoplayer_"+s.id),s.div.setAttribute("class","Talk_player"),s.div.setAttribute("style","width: 100%; height: 100%; position: relative;background-color: black; overflow: hidden;"),r.options.loader&&(s.loader=document.createElement("div"),s.loader.setAttribute("id","videoplayback_"+s.id),s.loader.setAttribute("class","Talk_loader"),s.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;')),s.video=document.createElement("video"),s.video.setAttribute("id","videoplaystream_"+s.id),s.video.setAttribute("class","Talk_stream"),s.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;"),s.video.setAttribute("autoplay","autoplay"),s.video.setAttribute("webkit-playsinline","true"),s.video.setAttribute("x-webkit-airplay","true"),s.video.setAttribute("playsinline","true"),s.video.setAttribute("x5-video-player-type","h5"),s.video.setAttribute("x5-video-player-fullscreen","true"),s.video.setAttribute("muted","muted"),s.video.muted=!0,s.video.volume=0,L.Utils.addEvent(s.video,"canplay",f),L.Utils.addEvent(s.video,"loadeddata",f),L.Utils.addEvent(s.video,"loadedmetadata",f),s.videoSupernatant=document.createElement("div"),s.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant"),s.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;"),s.video.oncanplay=function(e){L.Utils.isFunction(c)&&c(e)},s.video.onerror=function(e){L.Utils.isFunction(u)&&u(e)},s.updateVideoPlayerSpec=function(e){if("object"===Ft(e))for(var t in e)if(s.hasOwnProperty(t))switch(s[t]=e[t],t){case"id":s.div&&s.div.setAttribute("id","videoplayer_"+s.id),s.loader&&s.loader.setAttribute("id","videoplayback_"+s.id),s.video&&s.video.setAttribute("id","videoplaystream_"+s.id)}},s.destroy=function(){try{if(s.video&&(L.Utils.mediaPause(s.video),g(s.video)),s.container&&s.div)try{s.div.parentNode===s.container?s.container.removeChild(s.div):L.Logger.warning(n,"[tk-sdk]VideoPlayer removeChild warning: Element removal warning")}catch(e){L.Logger.error(n,"[tk-sdk]VideoPlayer removeChild error:",e)}s.removeVideoTrack(),d=void 0}catch(e){L.Logger.error(n,"[tk-sdk]VideoPlayer destroy error , error info:",e)}},s.updateVideoPlayerOptions=function(e){if(e&&"object"===Ft(e)&&(void 0!==e.mirror&&(r.options.mirror=e.mirror,v(s.video)),void 0!==e.mode&&(r.options.mode=e.mode,h(s.video)),void 0!==e.loader))if(r.options.loader=e.loader,r.options.loader&&!s.loader)s.loader=document.createElement("div"),s.loader.setAttribute("id","videoplayback_"+s.id),s.loader.setAttribute("class","Talk_loader"),s.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'),t?s.showLoading():s.hideLoading();else if(!r.options.loader&&s.loader){try{s.loader.parentNode===s.div?s.div.removeChild(s.loader):L.Logger.warning(n,"[tk-sdk]VideoPlayer removeChild loader warning: Element removal warning")}catch(e){L.Logger.error(n,"[tk-sdk]VideoPlayer removeChild error:",e)}s.loader=void 0}},s.getVideoPlayerOptions=function(){return r.options},s.showVideoContainer=function(){s.container&&(s.container.style.display="block")},s.hideVideoContainer=function(){s.container&&(s.container.style.display="none")},s.showVideo=function(){s.video&&(s.video.style.display="block"),t&&s.loader&&(s.loader.style.display="")},s.hideVideo=function(){s.video&&(s.video.style.display="none"),t&&s.loader&&(s.loader.style.display="")},s.hideLoading=function(){t=!1,s.loader&&(s.loader.style.display="none"),s.div.style.backgroundColor="transparent"},s.showLoading=function(){t=!0,s.loader&&(s.loader.style.display=""),s.div.style.backgroundColor=""},s.hasVideoTrack=function(){var e=!1;return d&&d.getVideoTracks&&d.getVideoTracks().length&&(e=!0),e},s.getVideoTrack=function(){if(d&&d.getVideoTracks&&d.getVideoTracks().length)return d.getVideoTracks()[0]},s.removeVideoTrack=function(){s.hasVideoTrack()&&d&&d.removeTrack&&(d.removeTrack(s.getVideoTrack()),g(s.video),h(s.video))},s.addVideoTrack=function(e){s.hasVideoTrack()&&s.removeVideoTrack(),d&&d.addTrack&&e&&(e.enabled=!0,s.local?d.addTrack(L.Utils.cloneTrack(e)):d.addTrack(e),m(s.video,d),h(s.video))},s.replaceVideoTrack=function(e){if(d&&d.addTrack&&e)if(s.hasVideoTrack()){var t=(n=d,r=e,(a={}).video=document.createElement("video"),a.video.setAttribute("id","videoplaystream_"+s.id+"."+L.Utils.randomWord(4)),a.video.setAttribute("class","Talk_stream"),a.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;"),a.video.setAttribute("autoplay","autoplay"),a.video.setAttribute("webkit-playsinline","true"),a.video.setAttribute("x-webkit-airplay","true"),a.video.setAttribute("playsinline","true"),a.video.setAttribute("x5-video-player-type","h5"),a.video.setAttribute("x5-video-player-fullscreen","true"),a.video.setAttribute("muted","muted"),a.video.muted=!0,a.video.volume=0,a.video.style.display="none",a.video.oncanplay=function(e){L.Utils.isFunction(c)&&c(e)},a.video.onerror=function(e){L.Utils.isFunction(u)&&u(e)},a.mediaStream=L.Utils.cloneMediaStream(n,!0,!1),a.mediaStream.addTrack(r),m(a.video,a.mediaStream),a),i=t?t.video:void 0,o=t?t.mediaStream:void 0;if(!i||!o)return;v(i),h(i),L.Utils.mediaPlay(i,function(e){if(0===e){i.style.zIndex=s.video.style.zIndex,i.style.display=s.video.style.display,s.div.replaceChild(i,s.video);var t=s.video;s.video=i,d=o,t.display="none",L.Utils.removeEvent(t,"canplay",f),L.Utils.removeEvent(t,"loadeddata",f),L.Utils.removeEvent(t,"loadedmetadata",f),L.Utils.addEvent(s.video,"canplay",f),L.Utils.addEvent(s.video,"loadeddata",f),L.Utils.addEvent(s.video,"loadedmetadata",f)}})}else e.enabled=!0,d.addTrack(L.Utils.cloneTrack(e)),m(s.video,d),h(s.video);var n,r,a},s.loader&&(t?s.showLoading():s.hideLoading(),s.div.appendChild(s.loader)),s.div.appendChild(s.video),s.div.appendChild(s.videoSupernatant),"string"==typeof s.elementID)if(s.container=document.getElementById(s.elementID),s.container){s.isClone&&(s.oldContainer=s.container,s.container=s.oldContainer.cloneNode(!0),s.container.style.zIndex="-1",s.oldContainer.parentNode.appendChild(s.container));var e=s.container.getElementsByClassName("Talk_player");if(e&&e.length)try{for(var l=e.length-1;0<=l;l--)L.Logger.warning(n,"[tk-sdk]videoPlayer:There are other nodes in the video player that have not been released,not released element id is "+e[l].id+" ,element id is "+s.elementID+",id is "+s.id+",type is "+s.type+",userId is "+s.userid),e[l].parentNode===s.container?s.container.removeChild(e[l]):L.Logger.warning(n,"[tk-sdk]VideoPlayer removeChild  warning -traversal: Element removal warning")}catch(e){L.Logger.error(n,"[tk-sdk]videoPlayer error:",e)}s.container.appendChild(s.div)}else L.Logger.error(n,"[tk-sdk]videoPlayer error:find element,element id is "+s.elementID+",id is "+s.id+",type is "+s.type+",userId is "+s.userid);else L.Logger.error(n,"[tk-sdk]videoPlayer error:element id must is string,element id is "+s.elementID+",id is "+s.id+",type is "+s.type+",userId is "+s.userid);d&&m(s.video,d);try{if(s&&s.video&&s.video.play){var p=L.Utils.mediaPlay(s.video);p&&p.catch&&p.catch(function(e){L.Logger.warning(n,"[tk-sdk]video.play method catch error , videoPlayer id is "+s.id+" , error info:"+e)})}}catch(e){L.Logger.warning(n,"[tk-sdk]video.play method error , videoPlayer id is "+(s?s.id:"undefined")+" !")}function f(){if(s.hideLoading(),s.video&&(L.Utils.removeEvent(s.video,"canplay",f),L.Utils.removeEvent(s.video,"loadeddata",f),L.Utils.removeEvent(s.video,"loadedmetadata",f)),!a&&s.video&&0!==s.video.readyState&&(a=!0,TK.roomInstance&&!r.deviceCheck)){var e=s.userid;"_local_default_extension_id_"===e&&(e="");var t={userId:e,mediaType:s.type,width:s.video&&s.video.videoWidth||0,height:s.video&&s.video.videoHeight||0};if(s.type===TK.STREAM_VIDEO){var i=new RegExp(s.userid+":","g");if(i.test(s.extensionId)){var o=s.extensionId.replace(i,"");t.deviceId=o}}var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomFirstVideoFrame,message:t});TK.roomInstance.dispatchEvent(n)}h(s.video)}function m(t,i){if(i&&i.getVideoTracks&&i.getVideoTracks()&&i.getVideoTracks().length){g(t);try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype)t.srcObject=i;else{var o=window.URL||webkitURL;t.src=o.createObjectURL(i)}}catch(e){L.Logger.warning(n,"[tk-sdk]videoPlayer attachMediaStream. attach by srcObject failed.",e,adapter.browserDetails);o=window.URL||webkitURL;t.src=o.createObjectURL(i)}}}function g(t){try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(t.srcObject&&L.Utils.isFunction(t.srcObject.removeTrack)&&L.Utils.isFunction(t.srcObject.getTracks))for(var e=t.srcObject.getTracks(),i=e.length-1;0<=i;i--)t.srcObject.removeTrack(e[i]);t.srcObject=null}else t.src=""}catch(e){t.src=""}}function v(e){i=r.options.mirror?"rotateY(180deg)":"";var t=o+(i?" ":"")+i;e.style.webkitTransform=t,e.style.mozTransform=t,e.style.oTransform=t,e.style.msTransform=t,e.style.transform=t}function h(e){if(e.videoWidth&&e.videoHeight&&s.div.clientWidth&&s.div.clientHeight){var t=(o=r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"translate(-50%,-50%)":"")+(i?" ":"")+i;e.style.webkitTransform=t,e.style.mozTransform=t,e.style.oTransform=t,e.style.msTransform=t,e.style.transform=t,r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?(e.style.height="100%",e.style.width="100%",e.style.top="50%",e.style.left="50%"):(e.style.height="100%",e.style.width="100%",e.style.top="0%",e.style.left="0%")}else{t=(o="")+(i?" ":"")+i;e.style.webkitTransform=t,e.style.mozTransform=t,e.style.oTransform=t,e.style.msTransform=t,e.style.transform=t,e.style.height="100%",e.style.width="100%",e.style.top="0%",e.style.left="0%",e.style.webkitObjectFit=r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.mozObjectFit=r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.oObjectFit=r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.msObjectFit=r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.objectFit=r.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":""}}return v(s.video),h(s.video),s},window.TK=window.TK||{},window.L=window.L||{},TK.SharePopUp=function(){var d={_containerStyle:{width:"610px",height:"500px",top:"0",zIndex:"99999",position:"fixed",border:"1px solid #c7c6c5",color:"#777",fontSize:"12px",background:"#fff",right:"calc( (100% - 500px) / 2)"},_tabWrapperStyle:{width:"85%",height:"350px",bottom:"15%",right:"7.5%",left:"7.5%",position:"absolute"},_tabDivStyle:{width:"100%",height:"35px",display:"flex",justifyContent:"space-around"},_tabStyle:{width:"50%",paddingTop:"5px",paddingLeft:"8px",color:"#777",fontWeight:"normal",border:"none","text-align":"center"},_activeTabStyle:{width:"50%",borderBottom:"3px solid #4285F4",color:"#4285F4",fontWeight:"bold",zIndex:"10000","text-align":"center"},_blockStyle:{width:"100%",height:"91%",display:"none",opacity:"0",position:"absolute",bottom:"0",border:"1px solid #c7c6c5","overflow-y":"scroll"},_activeBlockStyle:{width:"100%",height:"90%",display:"flex","flex-wrap":"wrap",opacity:"1",bottom:"0",position:"absolute"},_shareBtnStyle:{width:"62px",height:"30px",bottom:"2.5%",right:"17.5%",position:"absolute",border:"1px solid #c7c6c5",borderRadius:"3px",textAlign:"center",lineHeight:"30px",cursor:"default"},_cancelBtnStyle:{width:"62px",height:"30px",bottom:"2.5%",right:"5%",position:"absolute",background:"#4986EA",color:"#fff",borderRadius:"3px",textAlign:"center",lineHeight:"30px",cursor:"default"},_sourceBlockStyle:{width:"150px",height:"110px","margin-left":"10px","margin-top":"10px","margin-bottom":"15px",position:"relative",border:"3px solid #c7c6c5"},_titleStyle:{color:"#222",margin:"8px 7.5%",fontSize:"18px"},_descStyle:{color:"#222",margin:"0 7.5%",fontSize:"14px"},_spanStyle:{width:"100%",height:"50%","text-align":"center","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},r=/zh/g.test(L.Utils.getBrowserInfo().language);function e(e,t){var i;this.sources=e||[],this.option=t||{},this.windowSources=this.getSourcesByType("window")||[],this.screenSources=this.getSourcesByType("screen")||[],this.activeSource=0<this.screenSources.length&&this.screenSources[0]||0<this.windowSources.length&&this.windowSources[0];var o=t.electron||{};if(o.style)for(var n in o.style)d[n]?Object.assign(d[n],o.style[n]):d[n]=o.style[n];o.lang&&L.Utils.isString(o.lang)&&(r="zh-CN"===o.lang),this.title=this.option.title||(r?"共享屏幕":"Sharing the screen"),this.description=this.option.description||location.host+(r?"想要共享您屏幕上的内容。请选择您希望共享哪些内容。":"want to share content on your screen.Select what you want to share"),this.tabs=[],0<this.screenSources.length&&this.tabs.push({name:"screen",text:r?"您的整个屏幕":"Your entire screen",enable:!0,active:!0,onClick:this.switch.bind(this,"screen"),blacklist:[]}),0<this.windowSources.length&&this.tabs.push({name:"window",text:r?"应用窗口":"The application window",enable:!0,active:this.screenSources.length<=0,onClick:this.switch.bind(this,"window"),blacklist:o.blackwinlist&&L.Utils.isArray(o.blackwinlist)?o.blackwinlist:[]}),this.buttonMap=(Vt(i={},"share",{text:r?"分享":"Share",onClick:this.onShareBtnClick}),Vt(i,"cancel",{text:r?"取消":"Cancel",onClick:this.onCancelBtnClick}),i),this.elements={container:void 0,tabWrapper:void 0,tabDiv:void 0,tab:void 0,block:void 0,cancelBtn:void 0,shareBtn:void 0,title:void 0,desc:void 0,sourceBlock:void 0,span:void 0},this.init()}return e.prototype.init=function(){this.createDom()},e.prototype.render=function(){},e.prototype.getSourcesByType=function(e){var t=[],i=new RegExp(e);return this.sources.forEach(function(e){i.test(e.id)&&t.push(e)}),t},e.prototype.createDom=function(){var s=this;for(var e in this.elements){this.elements[e]=document.createElement("div");var t="_"+e+"Style";if(d[t]){var i=this.elements[e].style;for(var o in d[t])i.setProperty(o,d[t][o]),this.elements[e].style[o]=d[t][o]}}this.tabs.forEach(function(r){if(r.enable){var e=s.elements.tab.cloneNode(),a=s.elements.block.cloneNode();if(e.innerText=r.text,r.active){for(var t in d._activeTabStyle)e.style[t]=d._activeTabStyle[t];for(var t in d._activeBlockStyle)a.style[t]=d._activeBlockStyle[t]}e.classList.add(r.name),a.classList.add(r.name+"block"),a.classList.add("block"),e.onclick=r.onClick,s.elements.tabDiv.appendChild(e),s[r.name+"Sources"].forEach(function(e){for(var t=0;t<r.blacklist.length;t++)if(e.name===r.blacklist[t])return;var i=s.elements.sourceBlock.cloneNode(),o=s.elements.span.cloneNode();if(i.id=e.id,i.onclick=s.setActiveSource.bind(s,i.id),o.innerText=e.name,i.classList.add("s-block"),e.thumbnail){var n=new Image;n.src=e.thumbnail.toDataURL(),n.style.width="100%",n.style.height="100%",n.onclick=s.setActiveSource.bind(s,i.id),i.appendChild(n)}i.appendChild(o),a.appendChild(i)}),s.elements.tabWrapper.appendChild(a)}}),this.elements.title.innerText=this.title,this.elements.desc.innerText=this.description,this.elements.shareBtn.innerText=this.buttonMap.share.text,this.elements.cancelBtn.innerText=this.buttonMap.cancel.text,this.elements.tabWrapper.appendChild(this.elements.tabDiv),this.elements.container.appendChild(this.elements.title),this.elements.container.appendChild(this.elements.desc),this.elements.container.appendChild(this.elements.tabWrapper),this.elements.cancelBtn.onclick=this.onCancelBtnClick.bind(this),this.elements.shareBtn.onclick=this.onShareBtnClick.bind(this),this.elements.shareBtn.onmouseover=function(e){e.target.style.background="rgba(0,0,0,.05)"},this.elements.shareBtn.onmouseout=function(e){e.target.style.background="#fff"},this.elements.container.appendChild(this.elements.shareBtn),this.elements.container.appendChild(this.elements.cancelBtn),document.body.appendChild(this.elements.container)},e.prototype.destroy=function(){this.elements.container&&this.elements.container.parentNode.removeChild(this.elements.container)},e.prototype.switch=function(e){for(var t=this.elements.tabDiv.getElementsByClassName(e),i=this.elements.tabWrapper.getElementsByClassName(e+"block"),o=this.elements.tabWrapper.getElementsByClassName("block"),n=0;n<this.elements.tabDiv.children.length;n++)for(var r in d._tabStyle)this.elements.tabDiv.children[n].style[r]=d._tabStyle[r];for(n=0;n<o.length;n++)for(var r in d._blockStyle)o[n].style[r]=d._blockStyle[r];for(n=0;n<t.length;n++)for(var r in d._activeTabStyle)t[n].style[r]=d._activeTabStyle[r];for(n=0;n<i.length;n++)for(var r in d._activeBlockStyle)i[n].style[r]=d._activeBlockStyle[r]},e.prototype.setActiveSource=function(t,e){var i=this;this.sources.forEach(function(e){e.id===t&&(i.activeSource=e)});for(var o=document.getElementsByClassName("s-block"),n=0;n<o.length;n++)o[n].style.borderColor="#c7c6c5",o[n].style.borderWidth="#3px";"IMG"===e.target.tagName?(e.target.parentNode.style.borderColor="#4289F4",e.target.parentNode.style.borderWidth="3px"):e.target.style.borderColor="#4289F4"},e.prototype.onShareBtnClick=function(){this.option.shareFunc&&this.option.shareFunc(this.activeSource),this.destroy()},e.prototype.onCancelBtnClick=function(){this.option.cancelFunc&&this.option.cancelFunc(this.activeSource),this.destroy()},e}(),window.TK=window.TK||{},window.L=window.L||{},TK.deviceInfoMap=TK.deviceInfoMap||{videoinput:[],audioinput:[],audiooutput:[]},TK.hasDevice=TK.hasDevice||{videoinput:!1,audioinput:!1,audiooutput:!1},TK.networkTestInfo=TK.networkTestInfo||{protocol:"https",host:"global.talk-cloud.net",port:443,isConnectRoom:!1},TK.notStopTrack=!0,TK.notStopVideoTrack=!0,TK.notStopAudioTrack=!0,TK.defalutVideoW=1280,TK.defalutVideoH=720,TK.defalutVideoFps=30,TK.DeviceMgrImpl=function(){var u=TK.EventDispatcher({});u.videoTrackChangeProfileEventName="videotrack_changeprofile",u.onDevicesSetted=null,u.onDeviceChanged=null,u.onCameraSetted=null,u.onMicrophoneSetted=null,u.onSpeakerSetted=null,u.isNativeSetVideoProfile=!1;var l={},a={testing:!1},s={},n={testing:!1},r={testing:!1},d=void 0,c=void 0,p={testing:!1,timer:void 0},_={},f={sharing:!1,shared:!1};if(-1<navigator.userAgent.indexOf("Electron")){var e=require("electron").desktopCapturer;f.electronDesktopCapturer=e}var m={},g={width:TK.defalutVideoW,height:TK.defalutVideoH,maxfps:TK.defalutVideoFps},v={width:320,height:180,maxfps:10},h={},T={},k="AVMgr";function y(e,t,i,o,n){var r=n?"small.":""+e;if(L.Utils.isSupportMediaStreamTrackMethod("applyConstraints")&&h[r]&&h[r].track)if(h[r].profile.width!==t.width||h[r].profile.height!==t.height||o){var a={width:{ideal:t.width},height:{ideal:t.height},frameRate:{ideal:t.maxfps}},s=function(){h[r]&&(h[r].profile=t),L.Utils.isFunction(i)&&i();var e=TK.TalkEvent({type:u.videoTrackChangeProfileEventName,data:{ikey:r,videoprofile:t}});u.dispatchEvent(e)},d=h[r].track;if(L.Utils.isFunction(d.getCapabilities)){var c=d.getCapabilities();"{}"!==JSON.stringify(c)&&(c.width.max>a.width.ideal&&(a.width.max=a.width.ideal),c.height.max>a.height.ideal&&(a.height.max=a.height.ideal),c.frameRate.max>a.frameRate.ideal&&(a.frameRate.max=a.frameRate.ideal))}"mozilla"===L.Utils.getBrowser()&&delete a.frameRate,d.applyConstraints(a).then(function(){L.Logger.debug(k,"[tk-sdk]applyConstraintsToVideoTrack finshed,applyConstraints videoTrack success,apply constraints:"+L.Utils.toJsonStringify(a)),s()}).catch(function(e){L.Logger.info(k,"[tk-sdk]applyConstraintsToVideoTrack finshed,applyConstraints videoTrack fail,apply constraints:"+L.Utils.toJsonStringify(a),"reason:",L.Utils.toJsonStringify(e)),s()})}else L.Utils.isFunction(i)&&i()}function b(t,i,o){if(t.video&&"object"===Ft(t.video)&&"object"===Ft(t.video.deviceId)&&"string"==typeof t.video.deviceId.exact&&!L.Utils.isVideoinputDeviceIdFromDeviceList(t.video.deviceId.exact)||t.audio&&"object"===Ft(t.audio)&&"object"===Ft(t.audio.deviceId)&&"string"==typeof t.audio.deviceId.exact&&!L.Utils.isAudioinputDeviceIdFromDeviceList(t.audio.deviceId.exact)){var e={code:8,message:"Requested device not found",name:"NotFoundError"};return L.Logger.info(k,"[tk-sdk]getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(t),L.Utils.toJsonStringify(adapter.browserDetails)),void(L.Utils.isFunction(o)&&o(e))}var n=function(e){L.Utils.isFunction(i)&&i(e)},r=function(e){L.Utils.isFunction(o)&&o(e)};I(t,n,function(e){-1!==e.code&&t&&t.video&&"object"===Ft(t.video)&&void 0!==t.video.frameRate?(L.Logger.error(k,"[tk-sdk]getUserMedia fail,delete frameRate again getUserMedia,fail info(failInfo,constraints,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(t),L.Utils.toJsonStringify(adapter.browserDetails)),delete t.video.frameRate,I(t,n,function(e){-1!==e.code&&t&&t.video&&"object"===Ft(t.video)&&(void 0!==t.video.width||void 0!==t.video.height)?(L.Logger.error(k,"[tk-sdk]getUserMedia fail,delete width and height again getUserMedia,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(t),L.Utils.toJsonStringify(adapter.browserDetails)),delete t.video.width,delete t.video.height,I(t,n,function(e){L.Logger.error(k,"[tk-sdk]delete width and height again getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(t),L.Utils.toJsonStringify(adapter.browserDetails)),r(e)})):(L.Logger.error(k,"[tk-sdk]delete frameRate again getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(t),L.Utils.toJsonStringify(adapter.browserDetails)),r(e))})):(L.Logger.error(k,"[tk-sdk]getUserMedia failed,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(t),L.Utils.toJsonStringify(adapter.browserDetails)),r(e))})}function S(e,t,i,o,n,r){o=o||{},e?t?(e.videoPlayer&&e.videoPlayer.destroy&&e.videoPlayer.destroy(),e.videoPlayer=TK.VideoPlayer({id:"videoDeviceStream_"+(new Date).getTime(),elementID:t,deviceCheck:!0,options:o,successFn:n,failureFn:r}),e.videoPlayer.addVideoTrack(e.getVideoTracks()[0]),"function"==typeof i&&i(e.videoPlayer)):L.Logger.error(k,"[tk-sdk]playDeviceStream elementID can not be empty!"):L.Logger.error(k,"[tk-sdk]playDeviceStream mediaStream can not be empty!")}function i(e){e?e&&e.videoPlayer&&e.videoPlayer.destroy&&(e.videoPlayer.destroy(),e.videoPlayer=void 0,delete e.videoPlayer):L.Logger.error(k,"[tk-sdk]unplayDeviceStream mediaStream can not be empty!")}function o(T,y){y=y||{},L.Logger.debug(k,"[tk-sdk]call enumerateDevices!"),y.isSetlocalStorage=null!=y.isSetlocalStorage&&y.isSetlocalStorage;!function(a){var s=[];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.warning(k,"[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),a&&"function"==typeof a&&a(s);navigator.mediaDevices.enumerateDevices().then(function(e){for(var t={},i=0,o=e.length;i<o;i++){var n=e[i];if("communications"!==n.groupId&&"communications"!==n.deviceId&&"通讯"!==n.label){t[n.kind]=t[n.kind]||{};var r={kind:n.kind,label:n.label,deviceId:n.deviceId,groupId:n.groupId};t[n.kind][n.deviceId]=r,s.push(r)}}!navigator.cookieEnabled&&window.TK.storage&&"object"===Ft(window.TK.storage)&&(window.TK.storage[L.Constant.deviceStorage.audioinput]=window.TK.storage[L.Constant.deviceStorage.audioinput]||Object.keys(t.audioinput)[0]||void 0,window.TK.storage[L.Constant.deviceStorage.audiooutput]=window.TK.storage[L.Constant.deviceStorage.audiooutput]||Object.keys(t.audiooutput)[0]||void 0,window.TK.storage[L.Constant.deviceStorage.videoinput]=window.TK.storage[L.Constant.deviceStorage.videoinput]||Object.keys(t.videoinput)[0]||void 0),a&&"function"==typeof a&&a(s)}).catch(function(e){throw L.Logger.warning(k,"[tk-sdk]enumerateDevices error :"+e.name+": "+e.message),a&&"function"==typeof a&&a(s),e})}(function(e){var i=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),n=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),r={first:{},defalut:{}},a={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},t=L.Utils.getBrowserInfo(),s=t&&t.language&&t.language.toLowerCase().match(/zh/g)?"chinese":"english",d={videoinput:{label:"chinese"===s?"视频输入设备":"video input device ",num:0},audioinput:{label:"chinese"===s?"音频输入设备":"audio input device ",num:0},audiooutput:{label:"chinese"===s?"音频输入设备":"audio output device ",num:0}};e&&e.forEach&&e.forEach(function(e){if(e){var t={kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId};!t.label&&d[e.kind]&&(t.label=d[e.kind].label+ ++d[e.kind].num),"audioinput"===e.kind&&e.deviceId===i&&(a.useDevices[e.kind]=e.deviceId),"videoinput"===e.kind&&e.deviceId===o&&(a.useDevices[e.kind]=e.deviceId),"audiooutput"===e.kind&&e.deviceId===n&&(a.useDevices[e.kind]=e.deviceId),r.first[e.kind]=r.first[e.kind]||e.deviceId,a.devices[e.kind].push(t),a.hasdevice[e.kind]=!0,"default"===e.deviceId&&(r.defalut[e.kind]=e.deviceId)}}),a.useDevices.audioinput||(a.useDevices.audioinput=r.defalut.audioinput||r.first.audioinput||""),a.useDevices.videoinput||(a.useDevices.videoinput=r.defalut.videoinput||r.first.videoinput||""),a.useDevices.audiooutput||(a.useDevices.audiooutput=r.defalut.audiooutput||r.first.audiooutput||""),TK.hasDevice=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.hasdevice));var c=L.Utils.toJsonParse(L.Utils.toJsonStringify(TK.deviceInfoMap));TK.deviceInfoMap=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.devices)),L.Utils.localStorage?y.isSetlocalStorage&&(y.ignoreAudioinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,a.useDevices.audioinput),y.ignoreVideoinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,a.useDevices.videoinput),y.ignoreAudiooutputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,a.useDevices.audiooutput)):L.Logger.warning(k,"[tk-sdk]not support localStorage"),a.useDevices={audioinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||"",videoinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",audiooutput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)||""},_=a.useDevices;var u={},l={};if(y.getDeviceChangeInfo){var p=L.Utils.toJsonParse(L.Utils.toJsonStringify(TK.deviceInfoMap));for(var f in p)for(var m=c[f],g=p[f],v=m.length-1;0<=v;v--)for(var h=g.length-1;0<=h;h--)if(m[v].deviceId===g[h].deviceId){m.splice(v,1),g.splice(h,1);break}for(var f in p)p[f]&&p[f].length&&(u[f]=p[f]);for(var f in c)c[f]&&c[f].length&&(l[f]=c[f])}T&&"function"==typeof T&&T(a,y.getDeviceChangeInfo?{addDevices:u,removedDevices:l}:void 0)})}function w(e,i,r,a){a=a||{};try{if(!(i=i||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)))return void(r&&"function"==typeof r&&r(!1));var s={number:0},t=function(o,e,n){if(o&&o.nodeName&&/(audio|video)/g.test(o.nodeName.toLowerCase())&&i)if(a.speakerTest||"TKSDK_speakerTest"!==o.id)if(L.Utils.isFunction(o.setSinkId))try{o.setSinkId(i).then(function(){var e=o.getAttribute("id");L.Logger.debug(k,"[tk-sdk]Audio output device set to "+i,e?" , element id is "+e:"  element:",e?"":o),s.number++,s.number===n&&r&&"function"==typeof r&&r(!0)}).catch(function(e){var t=void 0,i=o.getAttribute("id");e&&"object"===Ft(e)&&"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device  "),L.Logger.info(k,"[tk-sdk]setSinkId error:",e,t||"",i?" , element id is "+i:"  element:",i?"":o),s.number++,s.number===n&&r&&"function"==typeof r&&r(!1)})}catch(e){var t=o.getAttribute("id");L.Logger.warning(k,"[tk-sdk]setSinkId err:",e,t?" , element id is "+t:"  element:",t?"":o),s.number++,s.number===n&&r&&"function"==typeof r&&r(!1)}else{t=o.getAttribute("id");L.Logger.warning(k,"[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",i,t?" , element id is "+t:"  element:",t?"":o),s.number++,s.number===n&&r&&"function"==typeof r&&r(!1)}else s.number++,s.number===n&&r&&"function"==typeof r&&r(!1);else s.number++,s.number===n&&r&&"function"==typeof r&&r(!1)};if(!e){e=[];var o=document.getElementsByTagName("audio"),n=document.getElementsByTagName("video");if(o&&0<o.length)for(var d=0;d<o.length;d++){var c=o[d];e.push(c)}if(n&&0<n.length)for(d=0;d<n.length;d++){c=n[d];e.push(c)}}if(e&&(L.Utils.isArray(e)||L.Utils.isHTMLCollection(e)))if(e&&0<e.length){var u=e.length;for(d=0;d<e.length;d++){c=e[d];t(c,0,u)}}else{u=1;t(e[0],0,u)}else{t(e,0,u=1)}}catch(e){L.Logger.error(k,"[tk-sdk]setElementSinkIdToAudioouputDevice error:",e),r&&"function"==typeof r&&r(!1)}}function I(e,t,i){var o=function(e){L.Utils.isFunction(t)&&t(e)},n=function(e){var t={};"object"===Ft(e)?(t.code=e.code,t.name=e.name,t.message=e.message):t={code:-1,name:"UnknownError",message:e},L.Utils.isFunction(i)&&i(t)};try{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(o).catch(n):(L.Logger.warning(k,"[tk-sdk]adapter`s getUserMedia un-defined ?!",L.Utils.toJsonStringify(adapter.browserDetails)),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia(e,o,n))}catch(e){n(e)}}function E(e,t,i,n,r){p.testing?L.Utils.speedNetwordk(e,t,i,function(e,t){if(TK.networkTestInfo.isConnectRoom)A(),p.testing=!1,L.Logger.warning(k,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(r)&&r("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT");else if(p.testing){var i=parseInt(t/2);0!==e&&(i=99999);var o=L.Utils.getNetDelayLevel(i);L.Utils.isFunction(n)&&n(o,i)}else A()},{source:"(NetworkTest)",infoLog:!1}):A()}function A(){clearInterval(p.timer),p.timer=void 0}function R(){if(n.mediaStream){(t=n.mediaStream)?t&&t.audioPlayer&&t.audioPlayer.destroy&&(t.audioPlayer.destroy(),t.audioPlayer=void 0,delete t.audioPlayer):L.Logger.error(k,"[tk-sdk]unplayDeviceStream mediaStream can not be empty!");var e=n.mediaStream.getAudioTracks();0<e.length&&n.mediaStream.removeTrack(e[0]),n.mediaStream=null}var t;n._soundMeter&&n._soundMeter.stop&&(n._soundMeter.stop(),n._soundMeter=void 0),clearInterval(n._soundMeterTimer),n._soundMeter=void 0,n._soundMeterTimer=void 0}function C(){a.mediaStream&&(i(a.mediaStream),a.mediaStream=null)}function D(e){try{if(s[e]&&s[e].mediaStream){i(s[[e]].mediaStream);var t=s[e].mediaStream.getVideoTracks();0<t.length&&s[e].mediaStream.removeTrack(t[0]),s[e].mediaStream=null}}catch(e){L.Logger.warning(k,"_stopVideoTestFromSdk Method capture error info:",e)}}function N(){var e=document.getElementById("TKSDK_speakerTest");e&&(L.Utils.mediaPause(e),e.src=""),r.audioUrl=null}function U(e,t){var i={};return i[e]=L.Utils.localStorage.getItem(e),i[e]!==t&&L.Utils.localStorage.setItem(e,t),i}return u.destroyVideoTrack=function(e){h[e]&&L.Utils.stopTrack(h[e].track),h[e]=void 0,delete h[e]},u.destroyAllVideoTrack=function(){for(var e in h)u.destroyVideoTrack(e)},u.destroyAudioTrack=function(e){T[e]&&L.Utils.stopTrack(T[e]),T[e]=void 0,delete T[e]},u.destroyAllAudioTrack=function(){for(var e in T)u.destroyAudioTrack(e)},u.hasVideoTrack=function(e){return!!h[e]},u.hasAudioTrack=function(e){return!!T[e]},u.setMaxVideoProfile=function(e,t,i){for(var o in g.width=e||g.width,g.height=t||g.height,g.maxfps=i||g.maxfps,h){var n=u.getUseVideoProfile(o);h[o].profile.width===n.width&&h[o].profile.height===n.height||y(o,u.getUseVideoProfile(o),void 0,!1)}},u.setSmallVideoProfile=function(e,t,i){v.width=e||v.width,v.height=t||v.height,v.maxfps=i||v.maxfps},u.getSmallVideoProfile=function(){return v},u.setVideoProfile=function(e,t,i){if(TK.isMultiCamera?m[t]=e:(m=e,t=l.videoinput),!h[t]||!h[t].track)return i(),void L.Logger.info(k,"[tk-sdk]The specified track was not found locally.");if(TK.isMultiCamera)y(t,u.getUseVideoProfile(t),i,!1);else for(var o in h){e=u.getUseVideoProfile(o);h[o].profile.width===e.width&&h[o].profile.height===e.height||y(o,u.getUseVideoProfile(o),void 0,!1)}},u.getVideoProfile=function(e){var t={};return TK.isMultiCamera&&m.hasOwnProperty(e)?t=L.Utils.copy(m[e]):TK.isMultiCamera||(t=L.Utils.copy(m)),L.Utils.getJsonLength(t)||(t=L.Utils.copy(g)),t},u.getMaxVideoProfile=function(){return L.Utils.copy(g)},u.getUseVideoProfile=function(e){var t=u.getVideoProfile(e);if(t.width*t.height>g.width*g.height){var i=t.width*t.height/(g.width*g.height);t.width=Math.floor(t.width/i),t.height=Math.floor(t.height/i)}return t.maxfps>g.maxfps&&(t.maxfps=g.maxfps),t},u.getVideoTrack=function(o,n,r,a){if(o){var s=a?"small.":""+o;if(h[s]&&h[s].track)L.Utils.isFunction(n)&&n(h[s].track);else{var d=L.Utils.isSupportMediaStreamTrackMethod("applyConstraints"),c=a?v:u.getUseVideoProfile(o);h[s]={profile:c},TK.isMultiCamera||(l.videoinput=o);var e={deviceId:{exact:o},width:{ideal:d?g.width:c.width},height:{ideal:d?g.height:c.height},frameRate:{ideal:d?g.maxfps:c.maxfps,max:30}};"mozilla"===L.Utils.getBrowser()&&delete e.frameRate,b({video:e,audio:!1},function(e){var t=e.getVideoTracks()[0];if(t){h[s].track=t,e.removeTrack(t);var i=function(){L.Utils.isFunction(n)&&n(h[s].track)};c=a?v:u.getUseVideoProfile(o),!d||g.width==c.width&&g.height==c.height?i():y(o,c,function(){i()},!0,a)}else L.Utils.isFunction(r)&&r({code:-1,message:"Requested device not video track",name:"UnknownError"});e=void 0},function(e){L.Utils.isFunction(r)&&r(e)})}}else L.Utils.isFunction(r)&&r({code:8,message:"Requested device not found",name:"NotFoundError"})},u.getAudioTrack=function(i,o,n){i?T[i]?L.Utils.isFunction(o)&&o(T[i]):b({audio:{deviceId:i},video:!1},function(e){var t=e.getAudioTracks()[0];t?(T[i]=t,e.removeTrack(t),L.Utils.isFunction(o)&&o(T[i])):L.Utils.isFunction(n)&&n({code:-1,message:"Requested device not audio track",name:"UnknownError"}),e=void 0},function(e){L.Utils.isFunction(n)&&n(e)}):L.Utils.isFunction(n)&&n({code:8,message:"Requested device not found",name:"NotFoundError"})},u.videoTrackapplyConstraints=function(e,t,i){if(e&&L.Utils.isSupportMediaStreamTrackMethod("applyConstraints")){var o={width:{ideal:t.width},height:{ideal:t.height},frameRate:{ideal:t.maxfps}};if(L.Utils.isFunction(e.getCapabilities)){var n=e.getCapabilities();"{}"!==JSON.stringify(n)&&(n.width.max>o.width.ideal&&(o.width.max=o.width.ideal),n.height.max>o.height.ideal&&(o.height.max=o.height.ideal),n.frameRate.max>o.frameRate.ideal&&(o.frameRate.max=o.frameRate.ideal))}"mozilla"===L.Utils.getBrowser()&&delete o.frameRate;var r=function(){L.Utils.isFunction(i)&&i()};e.applyConstraints(o).then(function(){L.Logger.debug(k,"[tk-sdk]applyConstraintsToVideoTrack finshed,applyConstraints videoTrack success,apply constraints:"+L.Utils.toJsonStringify(o)),r()}).catch(function(e){L.Logger.info(k,"[tk-sdk]applyConstraintsToVideoTrack finshed,applyConstraints videoTrack fail,apply constraints:"+L.Utils.toJsonStringify(o),"reason:",L.Utils.toJsonStringify(e)),r()})}},u.getsSoundMeterInstance=function(e,d){try{if(!e)return void L.Logger.error(k,"[tk-sdk]getsSoundMeterInstance audioContext is not exist!");return new function(e){var r=this,a=void 0,s=d&&"object"===Ft(d);return r.audioContext=e,r.instant=0,r.slow=0,r.clip=0,r.script=r.audioContext.createScriptProcessor(2048,1,1),r.script.onaudioprocess=function(e){if(!s||d&&d.mediaStream){var t,i=e.inputBuffer.getChannelData(0),o=0,n=0;for(t=0;t<i.length;++t)o+=i[t]*i[t],.99<Math.abs(i[t])&&(n+=1);r.instant=Math.sqrt(o/i.length),r.slow=.95*r.slow+.05*r.instant,r.clip=n/i.length}else r.stop();"function"==typeof a&&(a(null),a=void 0)},r.connectToSource=function(e,t){L.Logger.debug(k,"SoundMeter connecting");try{e&&e.getAudioTracks&&e.getAudioTracks().length?(r.mic=r.audioContext.createMediaStreamSource(e),r.mic.connect(r.script),r.script.connect(r.audioContext.destination),a=t):(r.stop(),"function"==typeof(a=t)&&(a(null),a=void 0))}catch(e){L.Logger.error(k,"[tk-sdk]connecToSource error:",e),void 0!==t&&t(e)}},r.stop=function(){r.mic&&r.mic.disconnect&&r.mic.disconnect(),r.script&&r.script.disconnect&&r.script.disconnect()},r}(e)}catch(e){L.Logger.error(k,"[tk-sdk]getsSoundMeterInstance errorinfo:",e)}},u.registerDeviceChangeListener=function(e){c=e},u.addDeviceChangeListener=function(e){d=e},u.stopCameraTest=function(){C(),a={testing:!1}},u.stopVideoTest=function(e,t,i){try{if(e)D(e),s[e]={},s[e].testing=!1,s[e].mediaStream=null,L.Utils.isFunction(t)&&t();else{for(var o in s)s[n=o]?(D(n),s[n].testing=!1,s[n].mediaStream=null):L.Logger.warning(k,"_stopVideoTestFromSdk This operation fails info: No specified device.");L.Utils.isFunction(t)&&t()}}catch(e){L.Utils.isFunction(i)&&i(),L.Logger.warning(k,"_stopVideoTestFromSdk Method capture error info:",e)}var n},u.startCameraTest=function(e,t,i,o,n){a.testing=!0,function(e,t,i,o,n){if(o=o||{},!e)return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),L.Logger.error(k,"startCameraTest got invalid deviceId");if(!t)return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),L.Logger.error(k,"startCameraTest got invalid elementId");C();var r={deviceId:{exact:e},width:{ideal:g.width},height:{ideal:g.height},frameRate:{ideal:g.maxfps,max:30}};"mozilla"===L.Utils.getBrowser()&&delete r.frameRate;b({video:r,audio:!1},function(e){if(!a.testing)return void C();C(),a.mediaStream=e,S(a.mediaStream,t,void 0,o,n,i)},function(e){if(!a.testing)return void C();L.Logger.info(k,"[tk-sdk] getUserMedia failed when test camera, failure info:",e),L.Utils.isFunction(i)&&i(e)})}(e,t,i,o,n)},u.startVideoTest=function(e,t,i,o,n){s[e]&&s[e].testing&&(D(e),L.Logger.warning(k,"startVideoTest Method Is testing")),s[e]={},s[e].testing=!0,function(t,i,o,n,r){if(o=o||{},!t)return L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"),L.Logger.error(k,"startCameraTest got invalid deviceId");if(!i)return L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"),L.Logger.error(k,"startCameraTest got invalid elementId");D(t);var e={deviceId:{exact:t},width:{ideal:g.width},height:{ideal:g.height},frameRate:{ideal:g.maxfps,max:30}};"mozilla"===L.Utils.getBrowser()&&delete e.frameRate;b({video:e,audio:!1},function(e){if(!s[t])return void L.Logger.error(k,"_startVideoTestFromSdk got invalid stream");if(!s[t].testing)return void D(t);D(t),s[t].mediaStream=e,S(s[t].mediaStream,i,void 0,o,n,r)},function(e){if(!s[t].testing)return void D(t);L.Logger.info(k,"[tk-sdk] getUserMedia failed when test camera, failure info:",e),L.Utils.isFunction(r)&&r(e)})}(e,t,i,o,n)},u.stopMicrophoneTest=function(){R(),n={testing:!1}},u.startMicrophoneTest=function(e,t,i,o){n.testing=!0,function(e,t,i,o){if(!e)return L.Logger.error(k,"startMicrophoneTest got invalid deviceId"),L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG");R(),b({audio:{deviceId:{exact:e}},video:!1},function(e){if(n.testing){R(),n.mediaStream=e,t&&function(e,t,i,o){if(o=o||{},!e)return L.Logger.error(k,"[tk-sdk]playDeviceStream mediaStream can not be empty!");if(!t)return L.Logger.error(k,"[tk-sdk]playDeviceStream elementID can not be empty!");e.audioPlayer&&e.audioPlayer.destroy&&e.audioPlayer.destroy();e.audioPlayer=TK.AudioPlayer({id:"audioDeviceStream_"+(new Date).getTime(),elementID:t,deviceCheck:!0,options:o}),e.audioPlayer.addAudioTrack(e.getAudioTracks()[0]),"function"==typeof i&&i(e.audioPlayer)}(n.mediaStream,t);try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext,n._soundMeter&&n._soundMeter.stop&&(n._soundMeter.stop(),n._soundMeter=void 0),TK.audioContext&&n.mediaStream&&u&&u.getsSoundMeterInstance&&(n._soundMeter=u.getsSoundMeterInstance(TK.audioContext,n),n._soundMeter&&n._soundMeter.connectToSource&&n._soundMeter.connectToSource(n.mediaStream,function(e){if(!e){if(n._soundMeter&&n._soundMeter.instant&&n._soundMeter.instant.toFixed){var t=Math.floor(100*n._soundMeter.instant.toFixed(2));L.Utils.isFunction(i)&&i(t)}else L.Utils.isFunction(i)&&i(0);clearInterval(n._soundMeterTimer),n._soundMeterTimer=setInterval(function(){if(n._soundMeter&&n._soundMeter.instant&&n._soundMeter.instant.toFixed){var e=Math.floor(100*n._soundMeter.instant.toFixed(2));L.Utils.isFunction(i)&&i(e)}else L.Utils.isFunction(i)&&i(0)},100)}}))}catch(e){L.Logger.warning(k,"[tk-sdk]startMicrophoneTest error:",e)}}else R()},function(e){n.testing?(L.Utils.isFunction(o)&&o(e),L.Logger.info(k,"[tk-sdk] getUserMedia failed when test microphone, failure info:",e)):R()})}(e,t,i,o)},u.stopSpeakerTest=function(){N(),r.testing=!1},u.startSpeakerTest=function(e,t,i){r.testing=!0,function(e,t,i){if(!e)return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),L.Logger.error(k,"startSpeakerTest got invalid deviceId");if(!t)return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),L.Logger.error(k,"startSpeakerTest got invalid audioUrl");try{var o=document.getElementById("TKSDK_speakerTest");o||((o=document.createElement("audio")).setAttribute("id","TKSDK_speakerTest"),o.setAttribute("loop","loop"),o.style.display="none",document.body.appendChild(o)),r.audioUrl=t,o.src=r.audioUrl,w([o],e,function(e){e?r.testing?L.Utils.mediaPlay(o):N():L.Utils.isFunction(i)&&i("TK_Speaker_Test_Fail")},{speakerTest:!0})}catch(e){L.Logger.warning(k,"[tk-sdk]startSpeakerTest err:",e),L.Utils.isFunction(i)&&i("TK_Speaker_Test_Fail",e)}}(e,t,i)},u.stopNetworkTest=function(){A(),p.testing=!1},u.startNetworkTest=function(e,t){p.testing=!0,function(e,t){A();var i=function(){TK.networkTestInfo.isConnectRoom?(A(),p.testing=!1,L.Logger.warning(k,"[tk-sdk]The room has been connected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(t)&&t("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):p.testing?(E(TK.networkTestInfo.protocol,TK.networkTestInfo.host,TK.networkTestInfo.port,e,t),p.timer=setInterval(function(){TK.networkTestInfo.isConnectRoom?(A(),p.testing=!1,L.Logger.warning(k,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(t)&&t("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):p.testing?E(TK.networkTestInfo.protocol,TK.networkTestInfo.host,TK.networkTestInfo.port,e,t):A()},3e3)):A()};TK.networkTestInfo.isConnectRoom?i():L.Utils.getWhereWebInfo(TK.networkTestInfo.protocol,"global.talk-cloud.net",function(e){p.testing?(TK.networkTestInfo.host=L.Utils.replaceHostname(TK.networkTestInfo.host,L.Utils.trim(e.name)),i()):A()},function(){i()})}(e,t)},u.getDevices=function(e,t){o(e,t)},u.getCameras=function(i,e){o(function(e,t){e&&e.devices&&i&&"function"==typeof i&&i(e.devices.videoinput||[],t)},e)},u.getMicrophones=function(i,e){o(function(e,t){e&&e.devices&&i&&"function"==typeof i&&i(e.devices.audioinput||[],t)},e)},u.getSpeakers=function(i,e){o(function(e,t){e&&e.devices&&i&&"function"==typeof i&&i(e.devices.audiooutput||[],t)},e)},u.setDevices=function(e,t){var i={},o={};for(var n in e=e||{})e[n]&&"undefined"!==e[n]||delete e[n],o[n]=L.Utils.localStorage.getItem(L.Constant.deviceStorage[n]),L.Constant.deviceStorage[n]&&e[n]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[n])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[n],e[n]),i[n]=!0);l.videoinput=e?e.videoinput:"",i.audiooutput&&w(),L.Utils.isFunction(u.onDevicesSetted)&&u.onDevicesSetted(e,o,t)},u.setCamera=function(e,t){if(e){l.videoinput=e||"";var i=U(L.Constant.deviceStorage.videoinput,e);L.Utils.isFunction(u.onCameraSetted)&&u.onCameraSetted(e,i,t)}else L.Logger.error(k,"[tk-sdk]Lack of key parameters!")},u.setMicrophone=function(e,t){if(e){var i=U(L.Constant.deviceStorage.audioinput,e);L.Utils.isFunction(u.onMicrophoneSetted)&&u.onMicrophoneSetted(e,i,t)}else L.Logger.error(k,"[tk-sdk]Lack of key parameters!")},u.setSpeaker=function(e,t){if(e){var i=U(L.Constant.deviceStorage.audiooutput,e);w(),L.Utils.isFunction(u.onSpeakerSetted)&&u.onSpeakerSetted(e,i,t)}else L.Logger.error(k,"[tk-sdk]Lack of key parameters!")},u.checkVideoInputDevice=function(t,i){t?u.getVideoTrack(t,function(e){u.destroyVideoTrack(t),e?L.Utils.isFunction(i)&&i(!0):L.Utils.isFunction(i)&&i(!1)},function(){L.Utils.isFunction(i)&&i(!1)}):L.Utils.isFunction(i)&&i(!1)},u.checkAudioInputDevice=function(t,i){t?u.getAudioTrack(t,function(e){u.destroyAudioTrack(t),e?L.Utils.isFunction(i)&&i(!0):L.Utils.isFunction(i)&&i(!1)},function(){L.Utils.isFunction(i)&&i(!1)}):L.Utils.isFunction(i)&&i(!1)},u.getUserDesktopMedia=function(o,n,r,a){if(o=o||{},!0!==f.sharing){u.closeUserDesktopMedia();var e=["screen","window"];if(o.types&&L.Utils.isArray(o.types)&&0<o.types.length&&(e=o.types),f.electronDesktopCapturer)return f.sharing=!0,void f.electronDesktopCapturer.getSources({types:e},function(e,t){if(e)return L.Utils.isFunction(r)&&r({code:-2,name:"ElectronDesktopCapturer",message:L.Utils.toJsonStringify(e)}),void(f.sharing=!1);0<t.length&&TK.SharePopUp&&new TK.SharePopUp(t,{shareFunc:function(e){i(e.id,!1),f.shared=!0,f.sharing=!1},cancelFunc:function(){f.shared=!1,f.sharing=!1,L.Utils.isFunction(r)&&r({code:1,name:"ElectronDesktopCapturer",message:"PermissionDeniedError"})},electron:o.electron})});f.sharing=!0,f.istimeoutForGet=!1,f.timeridForGet=setTimeout(function(){L.Logger.warning(k,"getUserDesktopMedia Do TimeOut."),f.istimeoutForGet=!0,f.shared=!1,f.sharing=!1,delete f.mediaStream,L.Utils.isFunction(r)&&r({code:-2,name:"TimeOut",message:"getUserDesktopMedia TimeOut"}),f.eventListenForGet&&(window.removeEventListener("message",f.eventListenForGet),delete f.eventListenForGet)},2e3),f.eventListenForGet&&window.removeEventListener("message",f.eventListenForGet),f.eventListenForGet=function(e){!0!==f.istimeoutForGet&&("tk-reply-clear"===e.data.type?f.timeridForGet&&clearTimeout(f.timeridForGet):"tk-reply-get"===e.data.type&&(0===e.data.error?i(e.data.msg.streamId,e.data.msg.canRequestAudioTrack):(L.Logger.warning(k,"[tk-sdk]getUserDesktopMedia tk-reply-get errorinfo:",e.data.msg),f.shared=!1,f.sharing=!1,delete f.mediaStream,L.Utils.isFunction(r)&&r({code:-1,name:e.data.type,message:e.data.msg})),window.removeEventListener("message",f.eventListenForGet),delete f.eventListenForGet))},window.addEventListener("message",f.eventListenForGet),window.postMessage({type:"get-custom-sourceId",info:e,url:document.URL},"*")}else L.Logger.warning(k,"[tk-sdk]one task getUserDesktopMedia is doing.");function i(e,t){o.audio=!1,o.video=o.video||{},o.video.mandatory=o.video.mandatory||{},o.video.mandatory.chromeMediaSource=o.video.mandatory.chromeMediaSource||"desktop",o.video.mandatory.chromeMediaSourceId=e,o.video.mandatory.maxWidth=window.screen.width,o.video.mandatory.maxHeight=window.screen.height;var i=function(){L.Utils.isFunction(a)&&a()};I(o,function(e){f.shared=!0,f.sharing=!1,(f.mediaStream=e).getVideoTracks()[0].onended=i,L.Utils.isFunction(n)&&n(e)},function(e){f.shared=!1,f.sharing=!1,delete f.mediaStream,L.Utils.isFunction(r)&&r(e)})}},u.getUseDevice=function(){return _},u.closeUserDesktopMedia=function(){if(u.cancelUserDesktopMediaDialog(),f.mediaStream){if(L.Logger.info(k,"[tk-sdk]closeUserDesktopMedia"),f.mediaStream.getVideoTracks&&"function"==typeof f.mediaStream.getVideoTracks){var e=f.mediaStream.getVideoTracks();if(e&&0<e.length)for(var t=0;t<e.length;t++)e[t]&&e[t].stop&&"function"==typeof e[t].stop&&L.Utils.stopTrack(e[t],!0)}if(f.mediaStream.getAudioTracks&&"function"==typeof f.mediaStream.getAudioTracks){var i=f.mediaStream.getAudioTracks();if(i&&0<i.length)for(var o=0;o<i.length;o++)i[o]&&i[o].stop&&"function"==typeof i[o].stop&&L.Utils.stopTrack(i[o],!0)}delete f.mediaStream}f.shared=!1},u.cancelUserDesktopMediaDialog=function(){f.electronDesktopCapturer||(L.Logger.info(k,"[tk-sdk]cancelUserDesktopMediaDialog"),window.postMessage({type:"close-select-dialog"},"*"))},u.checkUserDesktopMediaMode=function(t){f.electronDesktopCapturer?L.Utils.isFunction(t)&&t(!0):(f.istimeoutForCheck=!1,f.timeridForCheck=setTimeout(function(){L.Logger.warning(k,"checkUserDesktopMediaMode DoTimeOut."),f.istimeoutForCheck=!0,L.Utils.isFunction(t)&&t(!1),f.eventListenForCheck&&(window.removeEventListener("message",f.eventListenForCheck),delete f.eventListenForCheck)},2e3),f.eventListenForCheck&&window.removeEventListener("message",f.eventListenForCheck),f.eventListenForCheck=function(e){!0!==f.istimeoutForCheck&&"tk-reply-rtcmulticonnection"===e.data.type&&(f.timeridForCheck&&clearTimeout(f.timeridForCheck),L.Utils.isFunction(t)&&t(!0),window.removeEventListener("message",f.eventListenForCheck),delete f.eventListenForCheck)},window.addEventListener("message",f.eventListenForCheck),window.postMessage({type:"rtcmulticonnection"},"*"))},u.enumerateDevices=function(e,t){u.getDevices(e,t)},u.setElementSinkIdToAudioouputDevice=function(e,t,i){w(e,t,i)},u.associateElementsToSpeaker=function(e,t,i){w(e,t,i)},navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(n){o(function(e,t){var i={},o={};t&&t.addDevices&&(i=t.addDevices),t&&t.removedDevices&&(o=t.removedDevices),L.Logger.info(k,"[tk-sdk]device change finshed ,addDevices:"+L.Utils.toJsonStringify(i)+",removedDevices:"+L.Utils.toJsonStringify(o)),(L.Utils.getJsonLength(i)||L.Utils.getJsonLength(o))&&(L.Utils.isFunction(u.onDeviceChanged)?u.onDeviceChanged(i,o,n,d):L.Utils.isFunction(d)&&d(i,o,n),L.Utils.isFunction(c)&&(L.Utils.getJsonLength(i)&&c(i,TK.DEVICE_STATE.DEVICE_ADD),L.Utils.getJsonLength(o)&&c(o,TK.DEVICE_STATE.DEVICE_REMOVE)))},{getDeviceChangeInfo:!0})}),u}(),window.TK=window.TK||{},window.L=window.L||{},TK.DeviceMgr=function(){var e={stopVideoTest:function(e,t,i){TK.DeviceMgrImpl.stopVideoTest(e,t,i)},startVideoTest:function(e,t,i,o,n){TK.DeviceMgrImpl.startVideoTest(e,t,i,o,n)},stopMicrophoneTest:function(){TK.DeviceMgrImpl.stopMicrophoneTest()},startMicrophoneTest:function(e,t,i,o){TK.DeviceMgrImpl.startMicrophoneTest(e,t,i,o)},stopSpeakerTest:function(){TK.DeviceMgrImpl.stopSpeakerTest()},startSpeakerTest:function(e,t,i){TK.DeviceMgrImpl.startSpeakerTest(e,t,i)},stopNetworkTest:function(){TK.DeviceMgrImpl.stopNetworkTest()},startNetworkTest:function(e,t){TK.DeviceMgrImpl.startNetworkTest(e,t)},getDevices:function(e,t){TK.DeviceMgrImpl.getDevices(e,t)},getCameras:function(e){TK.DeviceMgrImpl.getCameras(e)},getMicrophones:function(e){TK.DeviceMgrImpl.getMicrophones(e)},getSpeakers:function(e){TK.DeviceMgrImpl.getSpeakers(e)},setDevices:function(e,t){TK.DeviceMgrImpl.setDevices(e,t)},setCamera:function(e,t){TK.DeviceMgrImpl.setCamera(e,t)},setMicrophone:function(e,t){TK.DeviceMgrImpl.setMicrophone(e,t)},setSpeaker:function(e,t){TK.DeviceMgrImpl.setSpeaker(e,t)},registerDeviceChangeListener:function(e){TK.DeviceMgrImpl.registerDeviceChangeListener(e)},startCameraTest:function(e,t,i,o,n){console.warn("[tk-sdk] startCameraTest and stopCameraTest will be deprecated, please use startVideoTest and stopVideoTest"),TK.DeviceMgrImpl.startCameraTest(e,t,i,o,n)},stopCameraTest:function(){console.warn("[tk-sdk] startCameraTest and stopCameraTest will be deprecated, please use startVideoTest and stopVideoTest"),TK.DeviceMgrImpl.stopCameraTest()},addDeviceChangeListener:function(e){console.warn("[tk-sdk] addDeviceChangeListener will be deprecated, please use registerDeviceChangeListener"),TK.DeviceMgrImpl.addDeviceChangeListener(e)},associateElementsToSpeaker:function(e,t,i){console.warn("[tk-sdk] associateElementsToSpeaker will be deprecated, please use startSpeakerTest and stopSpeakerTest"),TK.DeviceMgrImpl.associateElementsToSpeaker(e,t,i)},enumerateDevices:function(e,t){console.warn("[tk-sdk] enumerateDevices will be deprecated, please use getDevices or (getCameras getMicrophones getSpeakers)"),TK.DeviceMgrImpl.enumerateDevices(e,t)}};return e}(),window.TK=window.TK||{},window.L=window.L||{},TK.CONNECTION_TYPE={UP:0,DOWN:1},TK.customStreamFn=void 0,TK.Connection=function(e){var n,c="Connection";if(L.Utils.isNull(e))throw"[tk-sdk] got null parameter while creating connection";if(!e.hasOwnProperty("connectionId"))throw"[tk-sdk] got a parameter without property connectionId while creating connection";if(!e.hasOwnProperty("connectionType"))throw"[tk-sdk] got a parameter without property connectionType while creating connection";var r=void 0,a=e.connectionId,s=!0,d=!0,u=e.connectionType,l=null,t=e.extensionId,i=null,o=!1,p=null,f=null,m={};function g(t,e,i){var o=function(e){var t=void 0;switch(e){case"video":t=m.getVideoTrack();break;case"audio":t=m.getAudioTrack()}return t}(t.kind);if(!t||!o)return L.Logger.warning(c,"[tk-sdk]replaceTrack fail ( connection_id is "+a+" ) track == null!"),void(L.Utils.isFunction(i)&&i());"audio"===o.kind&&(L.Utils.stopTrack(o),t&&(t=L.Utils.cloneTrack(t))),L.Logger.debug(c,"[tk-sdk]replaceTrack(connection_id is "+a+")",o,t),Promise.resolve().then(function(){var e=n.getSenders().find(function(e){return e.track===o});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r&&r.removeTrack(o),r&&r.addTrack(t),"video"===t.kind?m.enableVideo(s):"audio"===t.kind&&m.enableAudio(d),L.Utils.isFunction(e)&&e()}).catch(function(e){L.Logger.error(c,"[tk-sdk]replaceTrack error(connection_id is "+a+"):",e),L.Utils.isFunction(i)&&i(e)})}function v(t){L.Logger.info(c,"[tk-sdk] Connection::onAddStream",a,t),r=t.stream;var e=m.getVideoTrack();m.enableVideo(s),m.enableAudio(d),"safari"!==L.Utils.getBrowserInfo().info.browserName||e?L.Utils.isFunction(m.onAddStream)&&m.onAddStream(a,t):t.stream.onaddtrack=function(e){L.Utils.isFunction(m.onAddStream)&&m.onAddStream(a,t)}}function h(e){L.Logger.info(c,"[tk-sdk] Connection::onRemoveStream",a,e),r=void 0,L.Utils.isFunction(m.onRemoveStream)&&m.onRemoveStream(a,e)}function T(e){if(L.Logger.debug(c,"[tk-sdk] Connection::onIceCandidate",a,e),L.Utils.isFunction(m.onIceCandidate)&&e.candidate){var t;e.candidate.candidate.match(/a=/)||(t="a="+e.candidate.candidate);var i={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:t};m.onIceCandidate(a,{type:"candidate",candidate:i})}}function y(e){L.Utils.isNull(n)||(L.Logger.info(c,"[tk-sdk] Connection::onIceConnectionStateChange",a,n.iceConnectionState),L.Utils.isFunction(m.onIceConnectionStateChange)&&m.onIceConnectionStateChange(a,n.iceConnectionState))}return m.setPeerConnection=function(e){(n=e).onaddstream=v,n.onremovestream=h,n.onicecandidate=T,n.oniceconnectionstatechange=y},m.getPeerConnection=function(){return n},m.getExtensionId=function(){return t},m.getConnectionId=function(){return a},m.createOffer=function(t,i){if(L.Utils.isNull(n)){if(L.Logger.error(c,"[tk-sdk] Connection::createOffer: peerconnection object is null"),L.Utils.isFunction(i)){var e=new DOMException("peerconnection object is null","createOffer-error");i(e)}}else{var o={offerToReceiveAudio:u!==TK.CONNECTION_TYPE.UP,offerToReceiveVideo:u!==TK.CONNECTION_TYPE.UP};n.createOffer(function(e){L.Logger.debug(c,"[tk-sdk]Local Description(createOffer)",e.sdp),L.Utils.isFunction(t)&&t(e),n.setLocalDescription(e,function(){L.Utils.isFunction(m.onOfferGenerated)&&m.onOfferGenerated(a,e)},function(e){L.Logger.error(c,"[tk-sdk] Connection::setLocalDescription failed",e)})},function(e){L.Logger.error(c,"[tk-sdk] Connection::createOffer failed",e),L.Utils.isFunction(i)&&i(e)},o)}},m.createAnswer=function(){n.createAnswer(function(e){n.setLocalDescription(e,function(){L.Logger.debug(c,"createAnswer setLocalDes",e),L.Utils.isFunction(m.onOfferGenerated)&&m.onOfferGenerated(a,e)},function(e){L.Logger.error(c,"createAnswer setLocalDes error")})},function(){})},m.setBandWidth=function(t,i,o){if(l){if(!s)return p=t,void(L.Utils.isFunction(i)&&i());var e={offerToReceiveAudio:u!==TK.CONNECTION_TYPE.UP,offerToReceiveVideo:u!==TK.CONNECTION_TYPE.UP};n.createOffer(function(e){L.Logger.debug(c,"[tk-sdk]Local Description(createOffer)",e.sdp),n.setLocalDescription(e,function(){var e={video:!0,maxVideoBW:t};l.sdp=L.Utils.setMaxBWToSdp(l.sdp,e,{audio:!0,maxVideoBW:null}),n.setRemoteDescription(new RTCSessionDescription(l),function(){L.Utils.isFunction(i)&&i(),L.Logger.info(c,"[tk-sdk] Connection::setRemoteDescription: success")},function(e){L.Utils.isFunction(o)&&o(e),L.Logger.info(c,"[tk-sdk] Connection::setRemoteDescription: error",e)})},function(e){L.Logger.error(c,"[tk-sdk] Connection::setLocalDescription failed",e)})},function(e){L.Logger.error(c,"[tk-sdk] Connection::createOffer failed",e),L.Utils.isFunction(o)&&o(e)},e)}else L.Logger.error(c,"[tk-sdk] setBandWidth Fn failed info Sdp inexistence")},m.setRemoteDescription=function(e,t,i){return L.Utils.isNull(n)?(L.Logger.error(c,"[tk-sdk] Connection::setRemoteDescription: peerconnection object is null"),void(L.Utils.isFunction(i)&&i("peerconnection object is null"))):L.Utils.isNull(e)?(L.Logger.error(c,"[tk-sdk] Connection::setRemoteDescription: sdp object is null"),void(L.Utils.isFunction(i)&&i("sdp object is null"))):(e.sdp=function(e){if(u===TK.CONNECTION_TYPE.DOWN&&"string"==typeof browserName&&/(firefox)/g.test(L.Utils.getBrowserInfo().info.browserName.toLowerCase())&&/^59\./g.test(L.Utils.getBrowserInfo().info.browserVersion)){L.Logger.debug(c,"[tk-sdk]firefox 59 hack,hack before sdp:"+e);for(var t=(e=L.Utils.formatSdp(e)).split("\r\n"),i=-1,o=-1,n=0,r=t.length;n<r&&(/^m=audio/.test(t[n])?i=n:/^m=video/.test(t[n])&&(o=n),-1===i||-1===o);n++);if(i<o){var a=t.slice(i,o),s=t.slice(o,t.length-1),d=t.slice(0,i);e=d.join("\r\n")+"\r\n"+s.join("\r\n")+"\r\n"+a.join("\r\n")}L.Logger.debug(c,"[tk-sdk]firefox 59 hack,hack after sdp:"+e)}return e}(e.sdp),l=e,void n.setRemoteDescription(new RTCSessionDescription(e),function(){L.Utils.isFunction(t)&&t()},function(e){L.Utils.isFunction(i)&&i(e)}))},m.addIceCandidate=function(e){var t=new RTCIceCandidate(e);n.addIceCandidate(t,function(){L.Logger.debug(c,"addIceCandidate success",a,t)},function(){L.Logger.error(c,"addIceCandidate failed",a,t)})},m.setMediaStream=function(e,t){if(e.getAudioTracks()&&0<e.getAudioTracks().length){var i=e.getAudioTracks()[0];e.removeTrack(i),e.addTrack(L.Utils.cloneTrack(i))}if(t&&L.Utils.isFunction(t)){var o=t(e);TK.customStreamFn=t,o?e=o:L.Logger.error(c,"[tk-sdk]setStreamMethod Wrong return result.")}u!==TK.CONNECTION_TYPE.UP||L.Utils.isNull(n)||L.Utils.isNull(e)||n.addStream(e),r=e},m.getMediaStream=function(){if(!L.Utils.isNull(n))return u===TK.CONNECTION_TYPE.UP?r:u===TK.CONNECTION_TYPE.DOWN?n.getRemoteStreams()[0]:void 0},m.removeMediaStream=function(e){u!==TK.CONNECTION_TYPE.UP||L.Utils.isNull(n)||L.Utils.isNull(e)||n.removeStream(e),r=void 0},m.replaceAudioTrack=function(e){m.getAudioTrack()?g(e):L.Logger.warning(c,"[tk-sdk]old track is not exist,not support addAudioTrack method!")},m.replaceVideoTrack=function(e,t){if(m.getVideoTrack()||i){if(!m.getVideoTrack()&&i)return void(o=i!==e);g(e,null,t)}else L.Logger.warning(c,"[tk-sdk]old track is not exist,not support getVideoTrack method!")},m.needRePublish=function(){return o},m.getVideoTrack=function(){return L.Utils.isNull(m.getMediaStream())?void 0:m.getMediaStream().getVideoTracks()[0]},m.getAudioTrack=function(){return L.Utils.isNull(m.getMediaStream())?void 0:m.getMediaStream().getAudioTracks()[0]},m.enableVideo=function(e){(function(e){if(u===TK.CONNECTION_TYPE.UP)e?!m.getVideoTrack()&&i&&(r.addTrack(i),f&&f.replaceTrack&&f.replaceTrack(i).then(function(e){L.Logger.debug("[tk-sdk] sender replaceTrack success")},function(e){L.Logger.error("[tk-sdk] sender replaceTrack error info:",e)}),f=i=null):(i=m.getVideoTrack()||i,n.getSenders()&&!f&&(f=n.getSenders().find(function(e){return e.track===i})),i&&r.removeTrack(i));else{var t=m.getVideoTrack();t&&t.enabled!==e&&(t.enabled=e)}})(s=e),p&&s&&(m.setBandWidth(p),p=null)},m.videoEnabled=function(){return s},m.enableAudio=function(e){var t,i;t=d=e,(i=m.getAudioTrack())&&i.enabled!==t&&(i.enabled=t)},m.audioEnabled=function(){return d},m.close=function(){L.Utils.isNull(n)||(r&&r.getTracks().forEach(function(e){"audio"===e.kind&&L.Utils.stopTrack(e),r.removeTrack(e)}),n.close(),r=null)},m.getStats=function(t,i){L.Utils.isNull(n)&&(L.Logger.error(c,"[tk-sdk] Connection::getStats: peerconnection object is null"),L.Utils.isFunction(i)&&i("peerconnection object is null")),n.getStats(null,function(e){L.Utils.isFunction(t)&&t(e)},function(e){L.Utils.isFunction(i)&&i(e)})},m.onOfferGenerated=void 0,m.onIceCandidate=void 0,m.onIceConnectionStateChange=void 0,m.onAddStream=void 0,m.onRemoveStream=void 0,m},window.TK=window.TK||{},window.L=window.L||{},TK.ConnectionMgr=function(){var a="ConnectionMgr",s={},e={createUpConnection:function(e,t){if(!L.Utils.isNull(e)){var i=!1,o=void 0,n=void 0;if(L.Utils.isNull(t)||L.Utils.isNull(t.useNative)||!L.Utils.isBoolean(t.useNative)||(i=t.useNative),!L.Utils.isNull(t)&&t.hasOwnProperty("extraData")&&(o=t.extraData),i)n=TK.NativeConnection({connectionId:e,connectionType:TK.CONNECTION_TYPE.UP,extraData:o}),!L.Utils.isNull(t)&&t.hasOwnProperty("mediaStream")&&n.setMediaStream(t.mediaStream,t.extraData.setStreamMethod,t.extraData);else{n=TK.Connection({connectionId:e,connectionType:TK.CONNECTION_TYPE.UP,extensionId:t.extraData.extensionId});var r=new RTCPeerConnection;n.setPeerConnection(r),!L.Utils.isNull(t)&&t.hasOwnProperty("mediaStream")&&n.setMediaStream(t.mediaStream,t.extraData.setStreamMethod)}return s[e]=n}L.Logger.error(a,"[tk-sdk] createUpConnection got invalid parameter")},createDownConnection:function(e,t){if(!L.Utils.isNull(e)){var i=!1,o=void 0,n=void 0;if(L.Utils.isNull(t)||L.Utils.isNull(t.useNative)||!L.Utils.isBoolean(t.useNative)||(i=t.useNative),!L.Utils.isNull(t)&&t.hasOwnProperty("extraData")&&(o=t.extraData),i)n=TK.NativeConnection({connectionId:e,connectionType:TK.CONNECTION_TYPE.DOWN,extraData:o});else{n=TK.Connection({connectionId:e,connectionType:TK.CONNECTION_TYPE.DOWN});var r=new RTCPeerConnection;n.setPeerConnection(r)}return s[e]=n}L.Logger.error(a,"[tk-sdk] createUpConnection got invalid parameter")},getConnection:function(e){return s[e]},getConnectionByExtensionId:function(e){var t=null;for(var i in s)if(s[i].getExtensionId()===e){t=s[i];break}return t},getAllConnections:function(){var e=[];for(var t in s)e.push(s[t]);return e},closeConnection:function(e){var t=s[e];t&&(t.close(),t=null,delete s[e])},closeAllConnections:function(){for(var e in s){var t=s[e];t.close(),t=null}s={}},bindIceCandidate:function(e,t){var i=s[e];i&&(i.onIceCandidate=t)},bindOfferGenerated:function(e,t){var i=s[e];i&&(i.onOfferGenerated=t)},bindIceConnectionStateChange:function(e,t){var i=s[e];i&&(i.onIceConnectionStateChange=t)},bindAddStream:function(e,t){var i=s[e];i&&(i.onAddStream=t)}};return e}(),window.TK=window.TK||{},window.L=window.L||{},window.TK_MODULE=window.TK_MODULE||{},TK.updateApplyConstraintsToCloneTrack=TK.updateApplyConstraintsToCloneTrack||{},window.TK_MODULE.MediaControl=function(){var p="MediaControl",e={},r=TK.ConnectionMgr;return e.createUpConnection=function(e,t){return t=t||{},r.createUpConnection(e,t)},e.createDownConnection=function(e,t){return r.createDownConnection(e,t)},e.closeConnection=function(e){r.closeConnection(e)},e.closeAllConnections=function(){r.closeAllConnections()},e.hasConnection=function(e){return!!r.getConnection(e)},e.replaceAudioTrack=function(e,t){var i=r.getConnection(e);i&&i.replaceAudioTrack(t)},e.replaceVideoTrack=function(e,t){var i=r.getConnection(e);i&&i.replaceVideoTrack(t)},e.openWebScreen=function(e,t,i,o){try{TK.DeviceMgrImpl.getUserDesktopMedia(e,function(e){L.Utils.isFunction(t)&&(t(e),L.Logger.info(p,"[tk-sdk]Web Screen sharing success !"))},function(e){L.Logger.warning(p,"[tk-sdk]Web Screen sharing failed !"),L.Utils.isFunction(i)&&i(e)},o)}catch(e){L.Logger.warning(p,"[tk-sdk]Web Screen sharing failed !")}},e.closeWebScreen=function(){TK.DeviceMgrImpl.closeUserDesktopMedia()},e.getVideoProfile=function(e){return TK.DeviceMgrImpl.getVideoProfile(e)},e.getDeviceMediaStream=function(e,t,i,o,n){var r,a,s,d,c=!1,u=!1,l=function(){if(c&&u)if(r||a){var e=TK.isTkNative?TK.isTkMacNative?L.Utils.createMediaStream(r,a):L.Utils.nativeMediaStream(r,a):L.Utils.createMediaStream(r,a);L.Utils.isFunction(i)&&i(e,s,d)}else L.Utils.isFunction(o)&&o(s,d)};e?TK.DeviceMgrImpl.getVideoTrack(e,function(e){c=!0,r=e,l()},function(e){c=!0,s=e,l()},n):(c=!0,l()),t?TK.DeviceMgrImpl.getAudioTrack(t,function(e){u=!0,a=e,l()},function(e){u=!0,d=e,l()}):(u=!0,l())},e.hasDeviceVideoTrack=function(e){return TK.DeviceMgrImpl.hasVideoTrack(e)},e.hasDeviceAudioTrack=function(e){return TK.DeviceMgrImpl.hasAudioTrack(e)},e.setMaxVideoProfile=function(e,t,i){TK.DeviceMgrImpl.setMaxVideoProfile(e,t,i)},e.setSmallVideoProfile=function(e,t,i){TK.DeviceMgrImpl.setSmallVideoProfile(e,t,i)},e.getSmallVideoProfile=function(){return TK.DeviceMgrImpl.getSmallVideoProfile()},e.destroyVideoTrack=function(e){TK.DeviceMgrImpl.destroyVideoTrack(e)},e.destroyAudioTrack=function(e){TK.DeviceMgrImpl.destroyAudioTrack(e)},e.destroyAllVideoTrack=function(){TK.DeviceMgrImpl.destroyAllVideoTrack()},e.destroyAllAudioTrack=function(){TK.DeviceMgrImpl.destroyAllAudioTrack()},e.getConnectionVideoTrack=function(e){var t=r.getConnection(e);return t?t.getVideoTrack():null},e.getConnectionAudioTrack=function(e){var t=r.getConnection(e);return t?t.getAudioTrack():null},e.createOffer=function(e,t,i){var o=r.getConnection(e);o?o.createOffer(t,i):L.Utils.isFunction(i)&&i("TK_ERR_NOT_PEERCONNECTION")},e.setRemoteDescription=function(e,t,i,o){var n=r.getConnection(e);n?n.setRemoteDescription(t,i,o):L.Utils.isFunction(o)&&o("TK_ERR_NOT_PEERCONNECTION")},e.setBandWidth=function(e,t,i,o){var n=r.getConnection(e);n?n.setBandWidth(t,i,o):L.Utils.isFunction(o)&&o("TK_ERR_NOT_PEERCONNECTION")},e.getStats=function(e,t,i){var o=r.getConnection(e);o?o.getStats(t,i):L.Utils.isFunction(i)&&i("TK_ERR_NOT_PEERCONNECTION")},e.bindIceCandidate=function(e,t){r.bindIceCandidate(e,t)},e.bindOfferGenerated=function(e,t){r.bindOfferGenerated(e,t)},e.bindIceConnectionStateChange=function(e,t){r.bindIceConnectionStateChange(e,t)},e.bindAddStream=function(e,i){r.bindAddStream(e,function(e,t){L.Utils.isFunction(i)&&i(e,t)})},e.getDeviceMgr=function(){return TK.DeviceMgr},e.checkDeviceAvailability=function(e,t,i){i=i||{};var o=e.devices,n=o.videoinput.slice(0),r=o.audioinput.slice(0),a=null,s=null,d=0;function c(){2<=(d+=1)&&L.Utils.isFunction(t)&&t()}if(n.length){if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput))for(var u=n.length-1;0<=u;u--){var l=n[u];if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)===l.deviceId){n.splice(u,1),n.unshift(l);break}}}else a={code:8,message:"Requested device not found",name:"NotFoundError"};if(r.length){if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput))for(u=r.length-1;0<=u;u--){l=r[u];if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)===l.deviceId){r.splice(u,1),r.unshift(l);break}}}else s={code:8,message:"Requested device not found",name:"NotFoundError"};!function(e){if(e.length){var t=e.shift();TK.DeviceMgrImpl.checkVideoInputDevice(t.deviceId,function(e){e?(i.findAvailabilityDevice&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t.deviceId),L.Utils.isFunction(i.onVideoSuccess)&&i.onVideoSuccess()):L.Logger.error(p,"[tk-sdk] The equipment is not available deviceId:",t.deviceId),c()})}else L.Utils.isFunction(i.onVideoFailure)&&(a={code:-1,message:"Requested device unknown error",name:"UnknownError"},i.onVideoFailure(a)),c()}(n),function(e){if(e.length){var t=e.shift();TK.DeviceMgrImpl.checkAudioInputDevice(t.deviceId,function(e){e?(i.findAvailabilityDevice&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,t.deviceId),L.Utils.isFunction(i.onAudioSuccess)&&i.onAudioSuccess()):L.Logger.error(p,"[tk-sdk] The equipment is not available deviceId:",t.deviceId),c()})}else L.Utils.isFunction(i.onAudioFailure)&&(s={code:-1,message:"Requested device unknown error",name:"UnknownError"},i.onAudioFailure(s)),c()}(r)},e.videoEnabled=function(e){var t=r.getConnection(e);return!!t&&t.videoEnabled()},e.audioEnabled=function(e){var t=r.getConnection(e);return!!t&&t.audioEnabled()},e.enableVideo=function(e,t){var i=r.getConnection(e);i&&i.enableVideo(t)},e.enableAudio=function(e,t){var i=r.getConnection(e);i&&i.enableAudio(t)},e.hasNativeConnection=function(e){var t=r.getConnection(e);return!(!t||!t.isNative)},e.setVideoProfile=function(e,t,i,o){TK.myPeerid;TK.isMultiCamera;var n=function(){L.Utils.isFunction(i)&&i()};TK.DeviceMgrImpl.setVideoProfile(e,t,function(){TK.DeviceMgrImpl.hasVideoTrack(t)?TK.DeviceMgrImpl.getVideoTrack(t,function(e){n()},function(){L.Utils.isFunction(o)&&o()}):n()})},e.getUseVideoProfile=function(e){return TK.DeviceMgrImpl.getUseVideoProfile(e)},e.getMaxVideoProfile=function(){return TK.DeviceMgrImpl.getMaxVideoProfile()},e.needRePublish=function(e){var t=r.getConnection(e);return!!t&&t.needRePublish()},e}(),window.TK=window.TK||{},window.L=window.L||{},TK.deviceInfoMap=TK.deviceInfoMap||{videoinput:[],audioinput:[],audiooutput:[]},TK.hasDevice=TK.hasDevice||{videoinput:!1,audioinput:!1,audiooutput:!1},TK.networkTestInfo=TK.networkTestInfo||{protocol:"https",host:"global.talk-cloud.net",port:443,isConnectRoom:!1},TK.NativeAVMgr=function(){var v="NativeAVMgr",s={},o={width:1920,height:1080,maxfps:30},n={width:320,height:180,maxfps:10},r={},a={},d={},c={},u={},l=void 0;s.onCameraSetted=null,s.onMicrophoneSetted=null,s.onSpeakerSetted=null,s.room_video_width=320,s.room_video_height=240,s.room_video_fps=10,s.onMicVolumeReportCallback=void 0,s.onDevicesSetted=null,s.onDeviceChanged=null,s.isNativeSetVideoProfile=!0;var h={},T={},p={},e=100,f=function(){return e++},m={player:null},g={audioUrl:null},y={testing:!1,timer:void 0};function _(e,t){try{if(!(e=e||{})[t]||!e[t].deviceId)return"";if("string"==typeof e[t].deviceId)return e[t].deviceId;if("object"!==Ft(e[t].deviceId))return"";if("string"==typeof e[t].deviceId.exact)return e[t].deviceId.exact}catch(e){return""}}function k(e,t){L.Logger.debug(v,"[tk-sdk]call enumerateDevices from client!");var i=f();h[i]=e;var o=t||{};o.isSetlocalStorage=void 0!==t&&(null!=t.isSetlocalStorage&&t.isSetlocalStorage),T[i]=o,window.tknative.postMessage({command:"enumerateDevices",seq:i})}function b(e,t){var i={};return i[e]=L.Utils.localStorage.getItem(e),i[e]!==t&&L.Utils.localStorage.setItem(e,t),i}function S(e,t,i,n,r){y.testing?L.Utils.speedNetwordk(e,t,i,function(e,t){if(TK.networkTestInfo.isConnectRoom)s.stopNetworkTest(),L.Logger.warning(v,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(r)&&r("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT");else if(y.testing){var i=parseInt(t/2);0!==e&&(i=99999);var o=L.Utils.getNetDelayLevel(i);L.Utils.isFunction(n)&&n(o,i)}else s.stopNetworkTest()},{source:"(NetworkTest)",infoLog:!1}):s.stopNetworkTest()}function w(e,i,r){try{if(!(i=i||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)))return void(r&&"function"==typeof r&&r(!1));if(TK.isTkNative&&TK.subscribe_from_native)i=i||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.tknative.postMessage({command:"setSpeaker",deviceId:i}),r&&"function"==typeof r&&r(!1);else{var a={number:0},t=function(o,e,n){if(o&&o.nodeName&&/(audio|video)/g.test(o.nodeName.toLowerCase())&&i)if(o.setSinkId)try{o.setSinkId(i).then(function(){var e=o.getAttribute("id");L.Logger.debug(v,"[tk-sdk]Audio output device set to "+i,e?" , element id is "+e:"  element:",e?"":o),a.number++,a.number===n&&r&&"function"==typeof r&&r(!0)}).catch(function(e){var t=void 0,i=o.getAttribute("id");e&&"object"===Ft(e)&&"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device  "),L.Logger.info(v,"[tk-sdk]setSinkId error:",e,t||"",i?" , element id is "+i:"  element:",i?"":o),a.number++,a.number===n&&r&&"function"==typeof r&&r(!1)})}catch(e){var t=o.getAttribute("id");L.Logger.error(v,"[tk-sdk]setSinkId err:",e,t?" , element id is "+t:"  element:",t?"":o),a.number++,a.number===n&&r&&"function"==typeof r&&r(!1)}else{t=o.getAttribute("id");L.Logger.warning(v,"[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",i,t?" , element id is "+t:"  element:",t?"":o),a.number++,a.number===n&&r&&"function"==typeof r&&r(!1)}else a.number++,a.number===n&&r&&"function"==typeof r&&r(!1)};if(!e){e=[];var o=document.getElementsByTagName("audio"),n=document.getElementsByTagName("video");if(o&&0<o.length)for(var s=0;s<o.length;s++){var d=o[s];e.push(d)}if(n&&0<n.length)for(s=0;s<n.length;s++){d=n[s];e.push(d)}}if(e&&(L.Utils.isArray(e)||L.Utils.isHTMLCollection(e)))if(e&&0<e.length){var c=e.length;for(s=0;s<e.length;s++){d=e[s];t(d,0,c)}}else{c=1;t(e[0],0,c)}else{t(e,0,c=1)}}}catch(e){L.Logger.error(v,"[tk-sdk]setElementSinkIdToAudioouputDevice error:",e),r&&"function"==typeof r&&r(!1)}}return window.tknative.addEventListener("message",function(g){if(!L.Utils.isNull(g)&&!L.Utils.isNull(g.data)&&!L.Utils.isNull(g.data.name)){var e=g.data.name;if("onEnumerateDevices"===e){var i=function(){var i=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),n=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug(v,"devices in enumerateDevices(client):",g.data);var e=g.data.audioinput,t=g.data.videoinput,r=g.data.audiooutput,a=g.data.seq,s={first:{},defalut:{}},d={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},c=L.Utils.getBrowserInfo(),u=c&&c.language&&c.language.toLowerCase().match(/zh/g)?"chinese":"english",l={videoinput:{label:"chinese"===u?"视频输入设备":"video input device ",num:0},audioinput:{label:"chinese"===u?"音频输入设备":"audio input device ",num:0},audiooutput:{label:"chinese"===u?"音频输入设备":"audio output device ",num:0}},p=function(e){if(null!=e&&"communications"!=e.groupId&&"communications"!=e.deiceId&&"通讯"!=e.label){var t={kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId};!t.label&&l[e.kind]&&(t.label=l[e.kind].label+ ++l[e.kind].num),"audioinput"===e.kind&&e.deviceId===i&&(d.useDevices[e.kind]=e.deviceId),"videoinput"===e.kind&&e.deviceId===o&&(d.useDevices[e.kind]=e.deviceId),"audiooutput"===e.kind&&e.deviceId===n&&(d.useDevices[e.kind]=e.deviceId),s.first[e.kind]=s.first[e.kind]||e.deviceId,d.devices[e.kind].push(t),d.hasdevice[e.kind]=!0,"default"===e.deviceId&&(s.defalut[e.kind]=e.deviceId)}};Array.isArray(e)&&e.forEach(function(e){p(e)}),Array.isArray(t)&&t.forEach(function(e){p(e)}),Array.isArray(r)&&r.forEach(function(e){p(e)}),d.useDevices.audioinput||(d.useDevices.audioinput=s.defalut.audioinput||s.first.audioinput||""),d.useDevices.videoinput||(d.useDevices.videoinput=s.defalut.videoinput||s.first.videoinput||""),d.useDevices.audiooutput||(d.useDevices.audiooutput=s.defalut.audiooutput||s.first.audiooutput||"");var f=T[a];TK.hasDevice=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.hasdevice));var m=void 0;f.getOldDeviceList&&(m=L.Utils.toJsonParse(L.Utils.toJsonStringify(TK.deviceInfoMap))),TK.deviceInfoMap=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.devices)),L.Utils.localStorage?f.isSetlocalStorage&&(f.ignoreAudioinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.useDevices.audioinput),f.ignoreVideoinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.useDevices.videoinput),f.ignoreAudiooutputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,d.useDevices.audiooutput)):L.Logger.error(v,"not support localStorage"),d.useDevices={audioinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||"",videoinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",audiooutput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)||""},h[a]&&(h[a](d,m),delete h[a]),T[a]&&delete T[a]};TK.isTkNative&&TK.subscribe_from_native?i():navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(e){var t=[];e.forEach(function(e){"audiooutput"===e.kind&&t.push({kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId})}),g.data.audiooutput=t,i()}).catch(function(e){L.Logger.error(v,"[tk-sdk]enumerateDevices error :"+e.name+": "+e.message),g.data.audiooutput=[],i()}):(L.Logger.error(v,"[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),g.data.audiooutput=[],i())}if("onMicVolumeReport"===e){if(null==(t=g.data.volume))return;h["detecte-mic-callback"]&&"function"==typeof h["detecte-mic-callback"]&&h["detecte-mic-callback"](t),s.onMicVolumeReportCallback&&"function"==typeof s.onMicVolumeReportCallback&&s.onMicVolumeReportCallback(t/100,g.data.connectionId)}if("onGetSpeakerVolume"===e){var t=g.data.volume,o=g.data.seq;if("function"!=typeof h[o])return;t=Math.round(t/2.55),h[o](t),delete h[o]}if("onStartDetecteCam"===e){if(!g.data.deviceId)return void L.Logger.error(v,"[tk-sdk]Native callback Parameters onStartDetecteCam are not! ");o=g.data.seqId,L.Utils.isFunction(h[o])&&h[o](L.Utils.nativeMediaStream({id:g.data.deviceId,kind:"video"},{id:TK.deviceInfoMap.audioinput[0],kind:"audio"}))}if("onNativeNotification"===e&&g.data.arg){var n={},r={};switch(g.data.arg.name){case"onVideoDeviceStateChanged":k(function(){g.data.arg&&g.data.arg.args.deviceState?(n.videoinput=[],n.videoinput.push({deviceId:g.data.arg.args.deviceId,kind:"videoinput"})):(r.videoinput=[],r.videoinput.push({deviceId:g.data.arg.args.deviceId,kind:"videoinput"})),L.Utils.isFunction(s.onDeviceChanged)?s.onDeviceChanged(n,r,null,l):L.Utils.isFunction(l)&&l(n,r,null)});break;case"onAudioDeviceMicStateChanged":k(function(){g.data.arg&&g.data.arg.args.deviceState?(n.audioinput=[],n.audioinput.push({deviceId:g.data.arg.args.deviceId,kind:"audioinput"})):(r.audioinput=[],r.audioinput.push({deviceId:g.data.arg.args.deviceId,kind:"audioinput"})),L.Utils.isFunction(s.onDeviceChanged)?s.onDeviceChanged(n,r,null,l):L.Utils.isFunction(l)&&l(n,r,null)});break;case"onAudioDeviceSpeakerStateChanged":k(function(){g.data.arg&&g.data.arg.args.deviceState?(n.audiooutput=[],n.audiooutput.push({deviceId:g.data.arg.args.deviceId,kind:"audiooutput"})):(r.audiooutput=[],r.audiooutput.push({deviceId:g.data.arg.args.deviceId,kind:"audiooutput"})),L.Utils.isFunction(s.onDeviceChanged)?s.onDeviceChanged(n,r,null,l):L.Utils.isFunction(l)&&l(n,r,null)})}}}},!1),s.setMaxVideoProfile=function(e,t,i){o.width=e||o.width,o.height=t||o.height,o.maxfps=i||o.maxfps},s.setSmallVideoProfile=function(e,t,i){n.width=e||n.width,n.height=t||n.height,n.maxfps=i||n.maxfps},s.getSmallVideoProfile=function(){return n},s.getUseDevice=function(){return{}},s.getVideoProfile=function(e){var t={};return TK.isMultiCamera&&r.hasOwnProperty(e)?t=L.Utils.copy(r[e]):TK.isMultiCamera||(t=L.Utils.copy(r)),L.Utils.getJsonLength(t)||(t=L.Utils.copy(o)),t},s.destroyVideoTrack=function(e){TK.notStopVideoTrack||TK.notStopTrack||(a[e]&&(a[e]=null),delete a[e])},s.destroyAllVideoTrack=function(){for(var e in a)s.destroyVideoTrack(e)},s.getUseVideoProfile=function(e){var t=s.getVideoProfile(e);if(t.width*t.height>o.width*o.height){var i=t.width*t.height/(o.width*o.height);t.width=Math.floor(t.width/i),t.height=Math.floor(t.height/i)}return t.maxfps>o.maxfps&&(t.maxfps=o.maxfps),t},s.getMaxVideoProfile=function(){return L.Utils.copy(o)},s.getVideoTrack=function(i,o,n){if(i)if(a[i]&&a[i].track)L.Utils.isFunction(o)&&o(a[i].track);else{TK.isMultiCamera||(c.videoinput=i);var e=s.getUseVideoProfile(i);a[i]={profile:e};var t={deviceId:{exact:i},width:e.width,height:e.height,frameRate:e.maxfps};s.getUserMedia({video:t,audio:!1},function(e){var t=e.getVideoTracks()[0];if(t){a[i].track=t;L.Utils.isFunction(o)&&o(a[i].track)}else L.Utils.isFunction(n)&&n({code:-1,message:"Requested device not video track",name:"UnknownError"});e=void 0},function(e){L.Utils.isFunction(n)&&n(e)})}else L.Utils.isFunction(n)&&n({code:8,message:"Requested device not found",name:"NotFoundError"})},s.getAudioTrack=function(i,o,n){i?d[i]?L.Utils.isFunction(o)&&o(d[i]):s.getUserMedia({audio:{deviceId:i},video:!1},function(e){var t=e.getAudioTracks()[0];t?(d[i]=t,L.Utils.isFunction(o)&&o(d[i])):L.Utils.isFunction(n)&&n({code:-1,message:"Requested device not audio track",name:"UnknownError"}),e=void 0},function(e){L.Utils.isFunction(n)&&n(e)}):L.Utils.isFunction(n)&&n({code:8,message:"Requested device not found",name:"NotFoundError"})},s.destroyAudioTrack=function(e){d[e]&&L.Utils.stopTrack(d[e]),d[e]=void 0,delete d[e]},s.destroyAllAudioTrack=function(){for(var e in d)s.destroyAudioTrack(e)},s.hasVideoTrack=function(e){return!!a[e]},s.hasAudioTrack=function(e){return!!d[e]},s.getUserMedia=function(e,t,i,o){var n,r,a;r=t,a=(a=i)||function(e){L.Logger.error(v,"[tk-sdk]getUserMedia error:",e)},(n=(n=e)||{audio:{},video:{}}).screen?(L.Logger.debug(v,"[tk-sdk]Screen access requested!"),r(null)):function(e){var t=_(e,"video"),i=_(e,"audio");if(t){if(!u[t]){var o=s.getUseVideoProfile(t);window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:o.width,height:o.height,frameRate:o.maxfps},deviceId:t}),u[t]=!0}window.tknative.postMessage({command:"setCamera",deviceId:t})}if(i&&window.tknative.postMessage({command:"setMicrophone",deviceId:i}),f(),L.Utils.isNull(e.video.deviceId)&&L.Utils.isNull(e.audio.deviceId)){var n={code:8,message:"Requested device not found",name:"NotFoundError"};L.Utils.isFunction(a)&&a(n),L.Logger.error(v,"[tk-sdk] getUserMedia failed.",n)}else r(L.Utils.nativeMediaStream(t?{id:t,kind:"video"}:null,i?{id:i,kind:"audio"}:null))}(n)},s.setAVMgrProperty=function(e,t){for(var i in t&&(p[t]=p[t]||{room_video_width:s.room_video_width,room_video_height:s.room_video_height,room_video_fps:s.room_video_fps}),e)s.hasOwnProperty(i)&&(TK.isMultiCamera&&void 0!==t||(s[i]=e[i]),t&&p[t]&&(p[t][i]=e[i]));window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:e.room_video_width,height:e.room_video_height,maxfps:e.room_video_fps},deviceId:t})},s.setVideoProfile=function(e,t,i){if(TK.isMultiCamera?r[t]=e:(r=e,t=c.videoinput),!a[t]||!a[t].track)return i(),void L.Logger.info(v,"[tk-sdk]The specified track was not found locally.");if(TK.isMultiCamera){n=s.getUseVideoProfile(t);window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:n.width,height:n.height,frameRate:n.maxfps},deviceId:t})}else for(var o in a){var n=s.getUseVideoProfile(o);window.tknative.postMessage({command:"setVideoProfile",VideoProfile:{width:n.width,height:n.height,frameRate:n.maxfps},deviceId:o})}},s.startDetecteMic=function(e,t){s.stopDetectMic(),window.tknative.postMessage({command:"startDetecteMic",deviceId:e}),h["detecte-mic-callback"]=t},s.stopDetectMic=function(){window.tknative.postMessage({command:"stopDetecteMic"}),delete h["detecte-mic-callback"]},s.startDetecteCam=function(e,t){s.stopDetecteCam(),window.tknative.postMessage({command:"startDetecteCam",deviceId:e,args:t})},s.stopDetecteCam=function(){window.tknative.postMessage({command:"stopDetecteCam"})},s.setSpeaker=function(e){window.tknative.postMessage({command:"setSpeaker",deviceId:e})},s.addDeviceChangeListener=function(e){l=null,l=e},s.removeDeviceChangeListener=function(){l=null},s.getSpeakerVolume=function(e){if("function"==typeof e){var t=f();h[t]=e,window.tknative.postMessage({command:"getSpeakerVolume",seq:t})}else L.Logger.error(v,"[tk-sdk] wrong arguments in funciton getSpeakerVolume")},s.setSpeakerVolume=function(e){null==e||e<0||100<e?L.Logger.error(v,"[tk-sdk] invalid arguments in funciton setSpeakerVolume"):(e=Math.round(2.55*e),window.tknative.postMessage({command:"setSpeakerVolume",volume:e}))},s.enabledStreamVideoTrack=function(e,t){if(e&&e.getVideoTracks&&"function"==typeof e.getVideoTracks){var i=e.getVideoTracks();if(i&&0<i.length)for(var o=0;o<i.length;o++)i[o].enabled!==t&&(i[o].enabled=t)}},s.enabledStreamAudioTrack=function(e,t){if(e&&e.getAudioTracks&&"function"==typeof e.getAudioTracks){var i=e.getAudioTracks();if(i&&0<i.length)for(var o=0;o<i.length;o++)i[o].enabled!==t&&(i[o].enabled=t)}},s.associateElementsToSpeaker=function(e,t,i){},s.getDevices=function(e,t){k(e,t)},s.setDevices=function(e,t){var i={},o={};for(var n in e=e||{})o[n]=L.Utils.localStorage.getItem(L.Constant.deviceStorage[n]),L.Constant.deviceStorage[n]&&e[n]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[n])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[n],e[n]),i[n]=!0);i.audiooutput&&w(),c.videoinput=e?e.videoinput:"",L.Utils.isFunction(s.onDevicesSetted)&&s.onDevicesSetted(e,o,t)},s.setCamera=function(e,t){if(e){c.videoinput=e||"";var i=b(L.Constant.deviceStorage.videoinput,e);L.Utils.isFunction(s.onCameraSetted)&&s.onCameraSetted(e,i,t)}else L.Logger.error(v,"[tk-sdk]Lack of key parameters!")},s.setMicrophone=function(e,t){if(e){var i=b(L.Constant.deviceStorage.audioinput,e);L.Utils.isFunction(s.onMicrophoneSetted)&&s.onMicrophoneSetted(e,i,t)}else L.Logger.error(v,"[tk-sdk]Lack of key parameters!")},s.setSpeaker=function(e,t){if(e){var i=b(L.Constant.deviceStorage.audiooutput,e);w(),L.Utils.isFunction(s.onSpeakerSetted)&&s.onSpeakerSetted(e,i,t)}else L.Logger.error(v,"[tk-sdk]Lack of key parameters!")},s.stopCameraTest=function(){var e;(e=m.player)&&e&&e.destroy&&(e.destroy(),e=void 0),window.tknative.postMessage({command:"stopDetecteCam"}),delete m.player,m.player=null},s.startCameraTest=function(e,t,i,o){if(!e)return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(v,"startCameraTest got invalid deviceId");if(!t)return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(v,"startCameraTest got invalid elementId");s.stopCameraTest();var n=void 0;if(function(e,t,i,o){if(i=i||{},e){var n=TK.NativeVideoPlayer({id:"videoinput_stream_player",stream:{stream:void 0},elementID:e,options:i});n.addVideoTrack(),"function"==typeof t&&t(n)}else L.Logger.error(v,"[tk-sdk]playDeviceStream elementID can not be empty!")}(t,function(e){m.player=e,n=e.id},o),!n)return L.Utils.isFunction(i)&&i("TK_ERR_INTERNAL_EXCEPTION"),void L.Logger.error(v,"startCameraTest occurred internal exception");var r={elementId:n};window.tknative.postMessage({command:"startDetecteCam",deviceId:e,args:r})},s.stopMicrophoneTest=function(){s.stopDetectMic();var e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);e&&window.tknative.postMessage({command:"setMicrophone",deviceId:e})},s.startMicrophoneTest=function(e,t,i,o){return e?t?(s.stopDetectMic(),void s.startDetecteMic(e,i)):(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.error(v,"startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.error(v,"startMicrophoneTest got invalid deviceId"))},s.stopSpeakerTest=function(){var e,t;g.audioUrl&&(e=g.audioUrl,(t={}).audioUrl=e,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"stop",options:t}),g.audioUrl=null);var i=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);i&&s.setSpeaker(i)},s.startSpeakerTest=function(e,t,i){return e?t?(s.stopSpeakerTest(),s.setSpeaker(e),(o={}).audioUrl=t,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"play",options:o}),void(g.audioUrl=t)):(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(v,"startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(v,"startSpeakerTest got invalid deviceId"));var o},s.checkVideoInputDevice=function(e,t){e?L.Utils.isFunction(t)&&t(!0):L.Utils.isFunction(t)&&t(!1)},s.checkAudioInputDevice=function(e,t){e?L.Utils.isFunction(t)&&t(!0):L.Utils.isFunction(t)&&t(!1)},s.stopNetworkTest=function(){y.testing=!1,clearInterval(y.timer),y.timer=void 0},s.startNetworkTest=function(e,t){s.stopNetworkTest();var i=function(){TK.networkTestInfo.isConnectRoom?(s.stopNetworkTest(),L.Logger.warning(v,"[tk-sdk]The room has been connected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(t)&&t("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):y.testing?(S(TK.networkTestInfo.protocol,TK.networkTestInfo.host,TK.networkTestInfo.port,e,t),y.timer=setInterval(function(){TK.networkTestInfo.isConnectRoom?(s.stopNetworkTest(),L.Logger.warning(v,"[tk-sdk]The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(t)&&t("TK_ERR_ROOM_CONNECTED_NOT_SUPPORT")):y.testing?S(TK.networkTestInfo.protocol,TK.networkTestInfo.host,TK.networkTestInfo.port,e,t):s.stopNetworkTest()},3e3)):s.stopNetworkTest()};TK.networkTestInfo.isConnectRoom?(y.testing=!0,i()):(y.testing=!0,L.Utils.getWhereWebInfo(TK.networkTestInfo.protocol,"global.talk-cloud.net",function(e){y.testing?(TK.networkTestInfo.host=L.Utils.replaceHostname(TK.networkTestInfo.host,L.Utils.trim(e.name)),i()):s.stopNetworkTest()},function(){i()}))},s},window.TK=window.TK||{},window.L=window.L||{},window.tknative=void 0,TK.nativeCallSeq=0,TK.waitNativeToCallbackList={},TK.NativeProxy=function(){var m="NativeProxy",g=TK.EventDispatcher({}),o=0,f=1,n=2,r=void 0,v=o,a=void 0,i=void 0;function s(){return void 0!==TK.nativeCallSeq&&"number"==typeof TK.nativeCallSeq||(TK.nativeCallSeq=0),++TK.nativeCallSeq}function e(e){if(!L.Utils.isNull(e)&&(!L.Utils.isNull(e.data)&&!L.Utils.isNull(e.data.name)))switch(e.data.name){case"onValidWindowList":var t=e.data.validWindows;if(void 0===(p=e.data.seq))return;if("function"!=typeof TK.waitNativeToCallbackList[p])return;TK.waitNativeToCallbackList[p](t),delete TK.waitNativeToCallbackList[p];break;case"onLog":var i=e.data.level,o=e.data.log;0===i&&L.Logger.debug(m,o),1===i&&L.Logger.info(m,o),2===i&&L.Logger.warning(m,o),3===i&&L.Logger.error(m,o);break;case"onMonitorCount":var n=e.data.count;if(void 0===(p=e.data.seq))return;if("function"!=typeof TK.waitNativeToCallbackList[p])return;TK.waitNativeToCallbackList[p](n),delete TK.waitNativeToCallbackList[p];break;case"onTakSnapshot":var r=e.data.action,a=e.data.requestId,s=e.data.total,d=e.data.now,c=e.data.code,u=e.data.result;if("function"!=typeof TK.waitNativeToCallbackList[a])return;var l=L.Utils.toJsonParse(u);TK.waitNativeToCallbackList[a](r,a,s,d,c,l),"result"===r&&delete TK.waitNativeToCallbackList[a];break;case"onGetMediaPlayPos":(f=e.data.arg).duration=parseInt(1e3*f.duration),1<f.pos&&(f.pos=1),f.position=parseInt(f.pos*f.duration),f.position>f.duration&&(f.position=f.duration);var p=e.data.seq;if("function"!=typeof TK.waitNativeToCallbackList[p])return;TK.waitNativeToCallbackList[p](f);break;case"onNativeNotification":L.Utils.isFunction(g.onNativeNotification)&&g.onNativeNotification(e.data.arg);break;case"onMicVolumeReport":L.Utils.isFunction(g.onMicVolumeReport)&&g.onMicVolumeReport(e.data);break;case"onGetMediaFileInfo":var f=e.data.arg;p=e.data.seq;if(f.duration&&(f.duration=1e3*f.duration),"function"!=typeof TK.waitNativeToCallbackList[p])return;TK.waitNativeToCallbackList[p](f),delete TK.waitNativeToCallbackList[p];break;case"onLocalRecord":case"onGetOpenOrSaveFileName":case"onBrowseForFolder":case"onGetRecordingPath":case"onStartupFileTransmitter":case"getShareScreenProfile":f=e.data.arg,p=e.data.seq;if("function"!=typeof TK.waitNativeToCallbackList[p])return;TK.waitNativeToCallbackList[p](f),delete TK.waitNativeToCallbackList[p]}}function u(e,t,i){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]getValidWindowList method must be in the client environment!"),void(L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"));if(null==e||"function"!=typeof t)return L.Logger.error(m,"[tk-sdk] getValidWindowList function got wrong arguments"),void(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"));var o=s();TK.waitNativeToCallbackList[o]=t,window.tknative.postMessage({command:"getValidWindowList",type:Number(e),seq:o})}return g.onNativeStartShareMediaFile=null,g.onNativeStopShareMediaFile=null,g.onNativeStartShareScreen=null,g.onNativeStopShareScreen=null,g.onNativeNotification=null,g.onMicVolumeReport=null,g.onSeekMediaFile=null,g.onNativeWindowClose=null,g.initialize=function(){window.tknative.addEventListener("message",e,!1)},g.createShareScreenWindow=function(i,o,n,r,a,s,d,c){if(!TK.isTkNative)return L.Logger.error(m,"[tk-sdk]createShareScreenWindow method must be in the client environment!"),void(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"));u(0,function(e){var t=e[0];t&&"object"===Ft(t)?function(e){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk] updateWindowSource method must be in the client environment!");e.id=Number(e.id||0),e.x=Number(e.x||0),e.y=Number(e.y||0),e.width=Number(e.width||0),e.height=Number(e.height||0),e.mixMic=e.mixMic||!1,e.mixSpk=e.mixSpk||!1,e.type=Number(e.type||0),e.catchcursor=e.catchcursor||!1,window.tknative.postMessage({command:"updateWindowSource",id:Number(e.id),left:Number(e.x),top:Number(e.y),width:Number(e.width),height:Number(e.height),mixMic:e.mixMic,mixSpk:e.mixSpk,type:Number(e.type),catchcursor:e.catchcursor})}({id:t.id,x:n,y:r,width:i,height:o,mixMic:a,mixSpk:s,type:0,catchcursor:c}):(L.Logger.error(m,"[tk-sdk]createShareScreenWindow:getValidWindowList is not data!"),L.Utils.isFunction(d)&&d("TK_ERR_NOT_DATA"))},d)},g.destroyShareScreenWindow=function(){g.createShareScreenWindow(0,0,0,0)},g.startShareScreen=function(i){if(!TK.isTkNative)return L.Logger.error(m,"[tk-sdk]startShareScreen method must be in the client environment!"),void(L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"));if(TK.isOnlyAudioRoom)return L.Logger.warning(m,"[tk-sdk]only audio room not execute method startShareScreen method !"),void(L.Utils.isFunction(i)&&i("TK_ERR_NOT_SUPPORT"));var o={},n={audio:!0,video:!0,attributes:o};if(TK.isTkNative&&2018061500<=TK.clientversion){u(0,function(e){var t=e[0];t&&"object"===Ft(t)?function(e,t,i){if(!TK.isTkNative)return"function"==typeof i&&i("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(m,"[tk-sdk]getShareScreenProfile method must be in the client environment!");if(null==e)return"function"==typeof i&&i("TK_ERR_INVALID_ARG"),L.Logger.error(m,"[tk-sdk] getShareScreenProfile function got wrong arguments");var o=s();TK.waitNativeToCallbackList[o]=t,window.tknative.postMessage({command:"getShareScreenProfile",args:e,seq:o})}(t,function(e){e&&"object"===Ft(e)&&(o.videowidth=e.width,o.videoheight=e.height,o.videofps=e.fps),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(n,i)},function(e){L.Logger.warning(m,"[tk-sdk]startShareScreen:getShareScreenProfile is failure , failure info:"+e+"!"),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(n,i)}):(L.Logger.warning(m,"[tk-sdk]startShareScreen:getValidWindowList is not data!"),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(n,i))},function(e){L.Logger.error(m,"[tk-sdk]startShareScreen:getValidWindowList error info:"+e),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(n,i)})}else L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(n,i)},g.stopShareScreen=function(e){if(!TK.isTkNative)return L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] stopShareScreen method must be called in the native environment!");L.Utils.isFunction(g.onNativeStopShareMediaFile)&&g.onNativeStopShareScreen(e),g.destroyShareScreenWindow()},g.startShareMediaFile=function(c,u,l,p){if(p=p||{},!TK.isTkNative)return L.Utils.isFunction(l)&&l("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] startShareMediaFile method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(l)&&l("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] startShareMediaFile method MAC machine is disabled!");if(L.Utils.isNull(c))return L.Utils.isFunction(l)&&l("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] startShareMediaFile method got invalid fileName!");if((!p||!p.IgnoreElementId)&&L.Utils.isNull(u))return L.Utils.isFunction(l)&&l("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] startShareMediaFile method got invalid elementId!");!function(e,t,i){if(!TK.isTkNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),L.Logger.warning(m,"[tk-sdk] getMediaFileInfo method must be called in the native environment!");if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),L.Logger.warning(m,"[tk-sdk] getMediaFileInfo method got invalid fileName!");var o=s();TK.waitNativeToCallbackList[o]=t,window.tknative.postMessage({command:"getMediaFileInfo",seq:o,file:e})}(c,function(e){var t=e.duration,i=e.width,o=e.height,n=e.video,r=e.audio;if(!e.video&&!e.audio)return L.Utils.isFunction(l)&&l("TK_ERR_INVALID_FIEL"),void L.Logger.error(m,"[tk-sdk] startShareMediaFile method got invalid file!");if(TK.isOnlyAudioRoom&&e.video)return L.Logger.error(m,"[tk-sdk]only audio room not execute method startShareMediaFile to video media !"),void(L.Utils.isFunction(l)&&l("TK_ERR_NOT_SUPPORT"));var a={width:i,height:o,duration:t,filename:L.Utils.getFileName(c)};if(TK.isTkNative&&2018061500<=TK.clientversion&&(a.videowidth=i,a.videoheight=o,a.videofps=e.fps),void 0!==p.toID&&(a.toID=p.toID),p.attrs&&"object"===Ft(p.attrs))for(var s in p.attrs)"toID"!==s&&"type"!==s&&(a[s]=p.attrs[s]);var d={video:n,audio:r,attributes:a,path:c,scale:p.scale};L.Utils.isFunction(g.onNativeStartShareMediaFile)&&g.onNativeStartShareMediaFile(d,u,l,p),v=f},l)},g.stopShareMediaFile=function(e){return TK.isTkNative?TK.isTkMacNative?(L.Utils.isFunction(e)&&e("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] stopShareMediaFile method MAC machine is disabled!")):(L.Utils.isFunction(g.onNativeStopShareMediaFile)&&g.onNativeStopShareMediaFile(e),void(v=o)):(L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] stopShareMediaFile method must be called in the native environment!"))},g.pauseShareMediaFile=function(e,t,i){if(!TK.isTkNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] pauseShareMediaFile method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] pauseShareMediaFile method MAC machine is disabled!");if(!L.Utils.isBoolean(e))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(m,"[tk-sdk] pauseShareMediaFile function got wrong arguments");if(v===o)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_OPEN_MEDIA_FILE"),void L.Logger.warning(m,"[tk-sdk] pauseShareMediaFile:The local media file is not open!");((e&&v!==n||!e&&v!==f)&&(window.tknative.postMessage({command:"pauseMediaFile",pause:e}),v=e?n:f,L.Utils.isFunction(g.onPauseMediaFile)&&g.onPauseMediaFile(e)),L.Utils.isFunction(t))&&t(!0===e?"Paused":"Sharing")},g.getMediaFileProgress=function(e,t){return TK.isTkNative?L.Utils.isFunction(e)?v===o?(L.Utils.isFunction(t)&&t("TK_ERR_NOT_OPEN_MEDIA_FILE"),void L.Logger.warning(m,"[tk-sdk] getMediaFileProgress:The local media file is not open!")):(L.Utils.isNull(i)&&(i=s()),TK.waitNativeToCallbackList[i]=e,void window.tknative.postMessage({command:"getMediaPlayPos",seq:i})):(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"),void L.Logger.error(m,"[tk-sdk] getMediaFileProgress function got wrong arguments")):(L.Utils.isFunction(t)&&t("TK_ERR_NOT_INITIALIZED"),void L.Logger.error(m,"[tk-sdk] getMediaFileProgress method must be called in the native environment!"))},g.registerMediaFileProgressListener=function(e,t,i){return TK.isTkNative?L.Utils.isNull(e)||e<=0||!L.Utils.isFunction(t)?(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(m,"[tk-sdk] registerMediaFileProgressListener function got wrong arguments")):(g.unregisterMediaFileProgressListener(),e<1e3&&(e=1e3),L.Utils.isNull(a)&&(a=s()),TK.waitNativeToCallbackList[a]=t,v===f&&window.tknative.postMessage({command:"getMediaPlayPos",seq:a}),void(r=setInterval(function(){v===f&&window.tknative.postMessage({command:"getMediaPlayPos",seq:a})},e))):(L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),void L.Logger.error(m,"[tk-sdk] registerMediaFileProgressListener method must be called in the native environment!"))},g.unregisterMediaFileProgressListener=function(e){if(!TK.isTkNative)return L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),void L.Logger.error(m,"[tk-sdk] unregisterMediaFileProgressListener method must be called in the native environment!");L.Utils.isNull(r)||(clearInterval(r),r=void 0),L.Utils.isNull(a)||(delete TK.waitNativeToCallbackList[a],a=void 0)},g.seekMediaFile=function(e,t){return TK.isTkNative?L.Utils.isNumber(e)?v===o?(L.Utils.isFunction(t)&&t("TK_ERR_NOT_OPEN_MEDIA_FILE"),void L.Logger.warning(m,"[tk-sdk] seekMediaFile:The local media file is not open!")):(e<0&&(e=0),1<e&&(e=1),window.tknative.postMessage({command:"seekMediaFile",pos:e}),void(L.Utils.isFunction(g.onSeekMediaFile)&&g.onSeekMediaFile(e))):(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"),void L.Logger.error(m,"[tk-sdk] seekShareMediaFile function got wrong arguments")):(L.Utils.isFunction(t)&&t("TK_ERR_NOT_INITIALIZED"),void L.Logger.error(m,"[tk-sdk] seekMediaFile method must be called in the native environment!"))},g.getShareableApplicationsList=function(e,t){return TK.isTkNative?"function"!=typeof e?(L.Logger.error(m,"[tk-sdk] getShareableApplicationsList function got wrong arguments"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"))):void u(1,e,t):(L.Logger.warning(m,"[tk-sdk]getShareableApplicationsList method must be in the client environment!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_INITIALIZED")))},g.startShareApplications=function(){},g.stopShareApplications=function(){},g.getMonitorCount=function(e,t){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]getMonitorCount method must be in the client environment!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_INITIALIZED"));if("function"!=typeof e)return L.Logger.error(m,"[tk-sdk] getMonitorCount function got wrong arguments"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));var i=s();TK.waitNativeToCallbackList[i]=e,window.tknative.postMessage({command:"getMonitorCount",seq:i})},g.enableViceMonitor=function(e){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]enableViceMonitor method must be in the client environment!"),void(L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"));TK.subscribe_from_native=!0,window.tknative.postMessage({command:"enableViceMonitor"})},g.switchMainViceMonitor=function(e){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]changeMainViceMonitor method must be in the client environment!"),void(L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"));window.tknative.postMessage({command:"exchangeClientPosition"})},g.nativeUploadFile=function(e,t,i,o){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]nativeUploadFile method must be in the client environment!"),void("function"==typeof o&&o("TK_ERR_NOT_INITIALIZED"));if("object"!==Ft(i)||"string"!=typeof e||"string"!=typeof t||""===e||""===t)return L.Logger.error(m,"[tk-sdk] nativeUploadFile function got wrong arguments"),void("function"==typeof o&&o("TK_ERR_INVALID_ARG"));var n=s();window.tknative.postMessage({command:"uploadFile",seq:n,uri:e,filename:t,params:i})},g.nativeDownloadFile=function(e,t,i){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]nativeDownloadFile method must be in the client environment!"),void("function"==typeof i&&i("TK_ERR_NOT_INITIALIZED"));if("string"!=typeof e||"string"!=typeof t||""===e||""===t)return L.Logger.error(m,"[tk-sdk] nativeDownloadFile function got wrong arguments"),void("function"==typeof i&&i("TK_ERR_INVALID_ARG"));var o=s();window.tknative.postMessage({command:"downloadFile",seq:o,uri:e,filename:t})},g.screenCaptureUpload=function(e,t,i,o){if(!TK.isTkNative)return"function"==typeof o&&o("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk]screenCaptureUpload method must be in the client environment!");if(!e||"function"!=typeof t)return L.Logger.error(m,"[tk-sdk] screenCaptureUpload function got wrong arguments"),void("function"==typeof o&&o("TK_ERR_INVALID_ARG"));i=i||!1;var n=s();TK.waitNativeToCallbackList[n]=t,window.tknative.postMessage({command:"takeSnapshot",needMin:i,fileName:e,requestId:n})},g.browseForLocalFolder=function(e,t,i){if(!TK.isTkNative)return L.Logger.warning(m,"[tk-sdk]browseForLocalFolder method must be in the client environment!"),void("function"==typeof i&&i("TK_ERR_NOT_INITIALIZED"));if("object"!==Ft(e)||"function"!=typeof t)return L.Logger.error(m,"[tk-sdk] browseForLocalFolder function got wrong arguments ,param must is json , onSuccess must is function! "),void(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"));var o=s();TK.waitNativeToCallbackList[o]=t,window.tknative.postMessage({command:"browseForFolder",args:e,seq:o})},g.startRecordScreen=function(e,i,o){if(!TK.isTkNative)return L.Utils.isFunction(o)&&o("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] startRecordScreen method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(o)&&o("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] startRecordScreen method MAC machine is disabled!");if(L.Utils.isNull(e)||L.Utils.isNull(e.filename))return L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] startRecordScreen function got wrong arguments");var t={type:1,fileName:e.filename,forcepath:!0};for(var n in e)"type"!==n&&"filename"!==n&&(t[n]=e[n]);var r=s();TK.waitNativeToCallbackList[r]=function(e){if("Recording"===e.action){if(L.Utils.isFunction(i)){var t={action:e.action,filename:e.filepath};i(t)}}else L.Utils.isFunction(o)&&o("record screen failed")},window.tknative.postMessage({command:"startLocalRecord",args:t,seq:r})},g.pauseRecordScreen=function(e,t,i){if(!TK.isTkNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] pauseRecordScreen method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] pauseRecordScreen method MAC machine is disabled!");if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] pauseRecordScreen function got wrong arguments");var o={type:1,pause:e},n=s();TK.waitNativeToCallbackList[n]=function(e){L.Utils.isFunction(t)&&t({action:e.action})},window.tknative.postMessage({command:"pauseLocalRecord",args:o,seq:n})},g.stopRecordScreen=function(e){if(!TK.isTkNative)return L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] stopRecordScreen method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(e)&&e("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] stopRecordScreen method MAC machine is disabled!");window.tknative.postMessage({command:"stopLocalRecord",args:{type:1}})},g.startRecordAudio=function(e,i,o){if(!TK.isTkNative)return L.Utils.isFunction(o)&&o("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] startRecordAudio method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(o)&&o("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] startRecordAudio method MAC machine is disabled!");if(L.Utils.isNull(e)||L.Utils.isNull(e.filename))return L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] startRecordAudio function got wrong arguments");var t={type:0,fileName:e.filename,forcepath:!0};for(var n in e)"type"!==n&&"filename"!==n&&(t[n]=e[n]);var r=s();TK.waitNativeToCallbackList[r]=function(e){if("Recording"===e.action){if(L.Utils.isFunction(i)){var t={action:e.action,filename:e.filepath};i(t)}}else L.Utils.isFunction(o)&&o("record screen failed")},window.tknative.postMessage({command:"startLocalRecord",args:t,seq:r})},g.pauseRecordAudio=function(e,t,i){if(!TK.isTkNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] pauseRecordAudio method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] pauseRecordAudio method MAC machine is disabled!");if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] pauseRecordAudio function got wrong arguments");var o={type:0,pause:e},n=s();TK.waitNativeToCallbackList[n]=function(e){L.Utils.isFunction(t)&&t({action:e.action})},window.tknative.postMessage({command:"pauseLocalRecord",args:o,seq:n})},g.stopRecordAudio=function(e){if(!TK.isTkNative)return L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] stopRecordAudio method must be called in the native environment!");if(TK.isTkMacNative)return L.Utils.isFunction(e)&&e("TK_ERR_NOT_SUPPORT"),void L.Logger.warning(m,"[tk-sdk] stopRecordAudio method MAC machine is disabled!");window.tknative.postMessage({command:"stopLocalRecord",args:{type:0}})},g.getOpenFileName=function(e,t,i){if(!TK.isTkNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] getOpenFileName method must be called in the native environment!");if(L.Utils.isNull(e)||L.Utils.isNull(e.caption)||L.Utils.isNull(e.filter))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] getOpenFileName function got wrong arguments");var o=s();TK.waitNativeToCallbackList[o]=function(e){"Activated"===e.action?L.Utils.isFunction(i)&&(i("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning(m,"[tk-sdk] getOpenFileName in progress")):L.Utils.isFunction(t)&&t(e)},window.tknative.postMessage({command:"getOpenFileName",args:e,seq:o})},g.getSaveFileName=function(e,t,i){if(!TK.isTkNative)return L.Utils.isFunction(i)&&i("TK_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"[tk-sdk] getSaveFileName method must be called in the native environment!");if(L.Utils.isNull(e)||L.Utils.isNull(e.caption)||L.Utils.isNull(e.filter))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.warning(m,"[tk-sdk] getSaveFileName function got wrong arguments");var o=s();TK.waitNativeToCallbackList[o]=function(e){"Activated"===e.action?L.Utils.isFunction(i)&&(i("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning(m,"[tk-sdk] getSaveFileName in progress")):L.Utils.isFunction(t)&&t(e)},window.tknative.postMessage({command:"getSaveFileName",args:e,seq:o})},g.listenCloseEvent=function(){if(TK.isTkNative)try{window.talk_window&&window.talk_window.listenCloseEvent?window.talk_window.listenCloseEvent():L.Logger.error(m,"[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(e){L.Logger.error(m,"[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning(m,"[tk-sdk]listenCloseEvent method must be in the client environment!")},g.shutdownNativeClient=function(){TK.isTkNative?window.tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning(m,"[tk-sdk]shutdownNativeClient method must be in the client environment!")},g.closeWindow=function(){try{window.talk_window&&window.talk_window.closeWindow?window.talk_window.closeWindow():L.Logger.error(m,"[tk-sdk]talk_window.closeWindow is not exist!")}catch(e){L.Logger.error(m,"[tk-sdk] closeWindow function can not be called")}},g.setPptAudioVolume=function(e){"number"==typeof e?window.tknative.postMessage({command:"clientAudioMediaSetVolume",vol:e}):L.Logger.error(m,"[tk-sdk]ppt MP3 setVolume volume type must is number!")},g.clientAudioMediaPlayer=function(e,t,i){TK.isTkNative?TK.clientversion<2018031e3?L.Logger.warning(m,"[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(i=i||{},t?(L.Logger.info(m,"[tk-sdk]clientAudioMediaPlayer url is "+e+" , action is "+t+" , options is"+L.Utils.toJsonStringify(i)),i.audioUrl=e,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:t,options:i})):L.Logger.error(m,"[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning(m,"[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")},g.clientPreloadMediaFile=function(e){TK.isTkNative?TK.clientversion<2018031e3?L.Logger.warning(m,"[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):Array.isArray(e)?e&&0<e.length&&window.tknative.postMessage({command:"clientPreloadMediaFile",urlArray:e}):L.Logger.error(m,"[tk-sdk]clientPreloadMediaFile args must is array!"):L.Logger.warning(m,"[tk-sdk]clientPreloadMediaFile method must be in the client environment!")},g.clientOpenBrowserUrl=function(e){TK.isTkNative?TK.clientversion<2018031e3?L.Logger.warning(m,"[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):e?window.tknative.postMessage({command:"clientOpenBrowserUrl",url:e}):L.Logger.error(m,"[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning(m,"[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")},g.getRecordingPath=function(e,t){if(!TK.isTkNative)return L.Logger.error(m,"[tk-sdk] getRecordingPath method must be called in the native environment!"),void("function"==typeof t&&t("TK_ERR_NOT_INITIALIZED"));"function"!=typeof e&&L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG");var i=s();TK.waitNativeToCallbackList[i]=e,window.tknative.postMessage({command:"getRecordingPath",seq:i})},g.setRecordingPath=function(e,t){return TK.isTkNative?"object"!==Ft(e)?(L.Logger.error(m,"[tk-sdk] setRecordingPath function got wrong arguments!"),void("function"==typeof t&&t("TK_ERR_INVALID_ARG"))):void window.tknative.postMessage({command:"setRecordingPath",args:e}):(L.Logger.error(m,"[tk-sdk] setRecordingPath method must be called in the native environment!"),void("function"==typeof t&&t("TK_ERR_NOT_INITIALIZED")))},g.startupFileTransmitter=function(e,t,i){if(!TK.isTkNative)return L.Logger.error(m,"[tk-sdk] startupFileTransmitter method must be called in the native environment!"),void("function"==typeof i&&i("TK_ERR_NOT_INITIALIZED"));if("object"!==Ft(e)||"function"!=typeof t)return L.Logger.error(m,"[tk-sdk] startupFileTransmitter function got wrong arguments!"),void("function"==typeof i&&i("TK_ERR_INVALID_ARG"));var o=s();TK.waitNativeToCallbackList[o]=t,window.tknative.postMessage({command:"startupFileTransmitter",args:e,seq:o})},g.initBroadcast=function(e,t,i,o,n){TK.isTkNative?e?(t||(t=10),i||(i=3),o&&n?window.tknative.postMessage({command:"initBroadcast",url:e.toString(),fps:Number(t),key_sec:Number(i),width:Number(o),height:Number(n)}):L.Logger.error(m,"[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error(m,"[tk-sdk]argument url of initBroadcast function not exist!"):L.Logger.warning(m,"[tk-sdk]initBroadcast method must be in the client environment!")},g.updateBroadcast=function(e,t,i,o){e||(e=10),t||(t=3),i&&o?window.tknative.postMessage({command:"updateBroadcast",fps:Number(e),key_sec:Number(t),width:Number(i),height:Number(o)}):L.Logger.error(m,"[tk-sdk]argument width or height of updateBroadcast function not exist!")},g.uninitBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"uninitBroadcast"}):L.Logger.warning(m,"[tk-sdk]uninitBroadcast method must be in the client environment!")},g.startBroadcast=function(e){TK.isTkNative?e?window.tknative.postMessage({command:"startBroadcast",streamId:e}):L.Logger.error(m,"[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning(m,"[tk-sdk]startBroadcast method must be in the client environment!")},g.stopBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"stopBroadcast"}):L.Logger.warning(m,"[tk-sdk]stopBroadcast method must be in the client environment!")},window.onNativeWindowClose=function(){TK.isTkNative?L.Utils.isFunction(g.onNativeWindowClose)&&g.onNativeWindowClose():L.Logger.warning(m,"[tk-sdk]window.onNativeWindowClose method must be in the client environment!")},g}(),TK.NativeEntry=function(){var e=document.getElementById("tknative");return e&&e.nodeName&&"embed"===e.nodeName.toLowerCase()||(e=document.createElement("embed"),document.body.appendChild(e),e.setAttribute("id","tknative"),e.setAttribute("mainentry",!0),e.setAttribute("hidden",!0),e.setAttribute("type","application/x-ppapi-proxy")),e},TK.NativeInfo=function(){try{return talk_window}catch(e){return null}},TK.CheckNativeInterfaceAvailable=function(){return!("function"!=typeof TK.NativeInfo||!TK.NativeInfo()||(window.tknative=window.tknative||TK.NativeEntry(),L.Utils.isNull(window.tknative)||!L.Utils.isFunction(window.tknative.postMessage)))},TK.Initialize=function(e,t){var i="NativeProxy";try{if(e){TK.isTkNative=!0;a=void 0,s=void 0,d=void 0;(r=TK.NativeInfo())&&"object"===Ft(r)&&(a=Number(r.clientversion),d=Number(r.endtype),s=r.friendlyversion),TK.clientversion=a,TK.clientfriendlyversion=s,TK.isTkMacNative=L.Utils.isBoolean(t)?t:2===d,window.tknative=window.tknative||TK.NativeEntry(),TK.NativeProxy.initialize(),TK.isTkMacNative||(TK.DeviceMgrImpl=null,TK.DeviceMgrImpl=TK.NativeAVMgr()),window.tknative.postMessage({command:"maximizeNativeClient"}),TK.subscribe_from_native=TK.isTkNative&&!TK.isTkMacNative&&2018031e3<=a,L.Logger.info(i,(TK.isTkMacNative,"macClient"))}else{window.tknative=void 0,TK.isTkNative=!1,TK.isTkMacNative=!1;var o=document.getElementById("tknative");if(o&&o.nodeName&&"embed"===o.nodeName.toLowerCase()){var n=o.parentNode;n&&n.removeChild(o)}var r=TK.NativeInfo(),a=void 0,s=void 0,d=void 0;r&&"object"===Ft(r)&&(a=Number(r.clientversion),d=Number(r.endtype),s=r.friendlyversion,r.maxmizeWindow&&"function"==typeof r.maxmizeWindow&&r.maxmizeWindow(),L.Logger.info(i,"[tk-sdk]clinet use browser,clinetInfo("+d===2?"macClient":"windowClient):clientVersion is "+a+",clientfriendlyversion is "+s+",endtype is "+d)),TK.subscribe_from_native=!1;var c=L.Utils.getBrowserInfo();L.Logger.info(i,"[tk-sdk]Initialize finshed,browserInfo:"+c.info.browserName+" "+c.info.browserVersion)}TK.DeviceMgrImpl.getDevices()}catch(e){L.Logger.error(i,"[tk-sdk]Initialize error:",e)}},window.TK=window.TK||{},window.L=window.L||{},TK.NativeStream=function(c){var i,u="NativeStream",l=TK.EventDispatcher(c),o=!1,n="destroy",r=void 0,a=0;void 0!==c.video&&"number"==typeof c.video&&(c.video=0!==c.video),void 0!==c.audio&&"number"==typeof c.audio&&(c.audio=0!==c.audio),l.classInstanceName="Stream",l.stream=c.stream,l.mediaStreamClone=L.Utils.cloneMediaStream(l.stream),l.url=c.url,l.recording=c.recording,l.room=c.room,l.playing=!1,l.local=!1,l.video=c.video,l.audio=c.audio,l.screen=c.screen,l.scale=c.scale,l.media=c.media,l.videoSize=c.videoSize,l.videoFrameRate=c.videoFrameRate,l.extensionId=c.extensionId,l.desktopStreamId=c.desktopStreamId,l.path=c.path||"",l.videoMuted=!1,l.audioMuted=!1,l.attributes=c.attributes||{},l.isTkNative=!0,l.pushVideoMuted=!0,l.pushAudioMuted=!0,l.isInit=!1,l.audioinputDeviceId=c.audioinputDeviceId,l.videoinputDeviceId=c.videoinputDeviceId;var s={isWaiting:!1},d=0,e=1,t=2,p=void 0,f=void 0,m=void 0;if(!(void 0===l.videoSize||l.videoSize instanceof Array&&4===l.videoSize.length))throw Error("Invalid Video Size");void 0!==c.local&&!0!==c.local||(l.local=!0);var g=function(){return l.media?e:l.attributes.isWeb?d:l.screen?t:d},v=function(){return l.extensionId};function h(){if(T(),"function"!=typeof s.onSuccess)return L.Logger.error(u,"[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),T(),void(void 0!==s.onFailure&&L.Utils.isFunction(s.onFailure)&&s.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",l.extensionId));s.onSuccess(a,l.extensionId),clearInterval(r),r=setInterval(function(){L.Utils.isFunction(s.onSuccess)?s.onSuccess(a,l.extensionId):(L.Logger.error(u,"[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),T(),L.Utils.isFunction(s.onFailure)&&s.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",l.extensionId))},s.interval)}function T(){clearInterval(r),r=void 0,a=0}return l.getID=function(){return l.local&&!c.streamID?"local":c.streamID},l.id=l.getID(),l.publisherId=function(){var e=l.extensionId.split(":");return e.length?e[0]:l.extensionId},l.getAttributes=function(){return c.attributes},l.setAttributes=function(e){l.updateLocalAttributes(e)},l.updateLocalAttributes=function(e){if(e&&"object"===Ft(e))for(var t in e)c.attributes[t]=e[t]},l.hasAudio=function(){return c.audio},l.changeAudio=function(e){c.audio=e},l.hasVideo=function(){return c.video},l.changeVideo=function(e){c.video=e},l.hasData=function(){return c.data},l.changeData=function(e){c.data=e},l.hasScreen=function(){return c.screen},l.hasMedia=function(){return c.media},l.hasVideoPlayer=function(){return!!p},l.getVideoPlayer=function(){return p},l.hasAudioPlayer=function(){return!!f},l.getAudioPlayer=function(){return f},l.getVideoPlayerElementId=function(){return m},l.changeScreen=function(e){c.screen=e},l.sendData=function(){L.Logger.error(u,"[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")},l.init=function(e,t,i){if(t=t||{},TK.isPlayback)i&&"function"==typeof i&&i({type:"access-denied",stream:l});else{if("video"!==l.getAttributes().type||!l.local)return L.Logger.warning(u,"[tk-sdk]stream init must is localStream and stream type must is video!"),void(i&&"function"==typeof i&&i({type:"access-denied",stream:l}));if(l.isIniting||l.isInit)i&&"function"==typeof i&&i({type:"access-denied",stream:l});else{var o;t.initDeviceId&&("object"===Ft(t.initDeviceId)?(t.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t.initDeviceId.videoinput),t.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,t.initDeviceId.audioinput),t.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,t.initDeviceId.audiooutput)):L.Logger.warning(u,"[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{if(c.audio||c.video){l.isIniting=!0,L.Logger.debug(u,"[tk-sdk]Requested access to local media");var n=c.video;!0===n||!0===c.screen?(n=!0===n?{}:n,void 0!==l.videoSize&&(n.mandatory=n.mandatory||{},n.mandatory.minWidth=l.videoSize[0],n.mandatory.minHeight=l.videoSize[1],n.mandatory.maxWidth=l.videoSize[2],n.mandatory.maxHeight=l.videoSize[3]),void 0!==l.videoFrameRate&&(n.optional=n.optional||[],n.optional.push({minFrameRate:l.videoFrameRate[0]}),n.optional.push({maxFrameRate:l.videoFrameRate[1]}))):!0===c.screen&&void 0===n&&(n=!0);var r=TK.DeviceMgrImpl.getUseVideoProfile(l.videoinputDeviceId),a={video:{deviceId:{exact:l.videoinputDeviceId},width:r.width,height:r.height,frameRate:r.maxfps},audio:c.audio,fake:c.fake,screen:c.screen,extensionId:l.extensionId,desktopStreamId:l.desktopStreamId},s=function(e){L.Logger.debug(u,"[tk-sdk]User has granted access to local media."),l.stream=e,l.mediaStreamClone=L.Utils.cloneMediaStream(l.stream),o=TK.StreamEvent({type:"access-accepted",stream:l}),l.isInit=!0,l.isIniting=!1,l.dispatchEvent(o),i&&"function"==typeof i&&i({type:"access-accepted",stream:l})},d=function(e){var t=TK.StreamEvent({type:"access-denied",stream:l,message:e});l.isInit=!0,l.isIniting=!1,l.dispatchEvent(t),i&&"function"==typeof i&&i({type:"access-denied",message:e,stream:l})};L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?TK.DeviceMgrImpl.getUserMedia(a,s,d,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0}):TK.DeviceMgrImpl.getDevices(function(e){TK.DeviceMgrImpl.getUserMedia(a,s,d,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})},{isSetlocalStorage:!0})}else L.Logger.warning(u,"[tk-sdk]The stream has no audio and video needs to be initialized."),o=TK.StreamEvent({type:"access-denied",stream:l,message:"The stream has no audio and video needs to be initialized."}),l.isInit=!0,l.isIniting=!1,l.dispatchEvent(o),i&&"function"==typeof i&&i({type:"access-denied",stream:l,message:"The stream has no audio and video needs to be initialized."})}catch(e){o=TK.StreamEvent({type:"access-denied",stream:l,message:e}),l.isInit=!0,l.isIniting=!1,l.dispatchEvent(o),i&&"function"==typeof i&&i({type:"access-denied",message:e,stream:l})}}}},l.create=function(){l.local?window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())})},l.destroy=function(){l.local||window.tknative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:l.local,type:Number(g())})},l.playVideo=function(e,t){function i(){if(t=t||{},void 0!==(l.elementID=e)){if(m=e,"living"!==n)return void L.Logger.warning(u,"[tk-sdk]stream.play:player life state not is living , not play stream!");p?(l.local&&(t.mirror=L.Utils.isBoolean(t.mirror)?t.mirror:o),p=new TK.NativeVideoPlayer({id:v(),stream:l,elementID:e,options:t,bundleId:l.extensionId}),l.playing=!0,l.local?g()===d?window.tknative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):g()===d?window.tknative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!1,type:Number(g())}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())}),g()===d||l.muteAudio(!0)):(l.local&&(t.mirror=L.Utils.isBoolean(t.mirror)?t.mirror:o),p=new TK.NativeVideoPlayer({id:v(),stream:l,elementID:e,options:t,bundleId:l.extensionId}),l.local?g()===d?window.tknative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):g()===d?window.tknative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!1,type:Number(g())}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())}),p?L.Logger.info(u,"[tk-sdk]stream.Video is already in play!"):l.muteVideo(!1)),TK.isOnlyAudioRoom&&p.hideVideo(),s.isWaiting&&!r&&h()}}n="living",!l.local||"video"!==l.getAttributes().type||l.isInit||TK.isPlayback?i():(L.Logger.info(u,"[tk-sdk]stream.play:my stream is not init , call stream init start!"),l.init(!0,void 0,function(e){L.Logger.info(u,"[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(e)),i()}))},l.playAudio=function(e){function t(){e=e||{},"living"===n?(f?L.Logger.warning(u,"[tk-sdk]stream.Audio is already in play!"):(f=new TK.NativeAudioPlayer({id:v(),stream:l,options:e,bundleId:l.extensionId}),l.local?g()===d?window.tknative.postMessage({command:"playAudio",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===TK.STREAM_FILE}}):g()===d?window.tknative.postMessage({command:"playAudio",connectionId:v().toString(),isLocal:!1,type:Number(g())}):window.tknative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())}),g()===d||l.muteVideo(!0)),l.playing=!0,TK.isOnlyAudioRoom&&p&&p.hideVideo(),s.isWaiting&&!r&&h()):L.Logger.warning(u,"[tk-sdk]stream.play:player life state not is living , not play stream!")}n="living",!l.local||"video"!==l.getAttributes().type||l.isInit||TK.isPlayback?t():(L.Logger.info(u,"[tk-sdk]stream.play:my stream is not init , call stream init start!"),l.init(!0,void 0,function(e){L.Logger.info(u,"[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(e)),t()}))},l.stop=function(e){e?"video"===e?(p&&p.destroy&&p.destroy(),p=void 0,g()===d?window.tknative.postMessage({command:"unPlayVideo",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())}):window.tknative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())})):"audio"===e&&(f&&f.destroy&&f.destroy(),f=void 0,g()===d?window.tknative.postMessage({command:"unPlayAudio",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())}):window.tknative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())})):(n="destroy",l.playing&&(p&&p.destroy(),f&&f.destroy&&f.destroy(),f=p=void 0,l.playing=!1,window.tknative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())})))},l.unplayVideo=function(){p&&(l.stop("video"),p=void 0),f||p||(l.stop(),p=f=void 0)},l.unplayAudio=function(){f&&(l.stop("audio"),f=void 0),f||p||(l.stop(),p=f=void 0)},l.getVideoPlayerOptions=function(){},l.updateVideoPlayerOptions=function(e){p&&p.updateVideoPlayerOptions&&p.updateVideoPlayerOptions(e)},l.updateAudioPlayerOptions=function(e){f&&f.updateAudioPlayerOptions&&f.updateAudioPlayerOptions(e)},l.showVideo=function(){void 0!==p&&p.showVideo()},l.hideVideo=function(){void 0!==p&&p.hideVideo()},l.getAudioTrack=function(){f&&f.getAudioTrack()},l.hasAudioTrack=function(){f&&f.hasAudioTrack()},l.removeAudioTrack=function(){f&&f.removeAudioTrack()},l.addAudioTrack=function(e){l.hasAudioTrack()&&l.removeAudioTrack(),f&&f.addAudioTrack(e),T(),s.isWaiting&&h()},l.getVideoTrack=function(){p&&p.getVideoTrack()},l.hasVideoTrack=function(){p&&p.hasVideoTrack()},l.removeVideoTrack=function(){p&&p.removeVideoTrack()},l.addVideoTrack=function(e){l.hasVideoTrack()&&l.removeVideoTrack(),p&&p.addVideoTrack(e)},l.setMute=function(e){void 0!==f&&f.setMute&&f.setMute(e)},l.setVolume=function(e){if(void 0!==f&&f.setVolume){if("number"!=typeof e)return void L.Logger.error(u,"[tk-sdk]Stream setVolume volume type must is number!");f.setVolume(e)}},l.getVolume=function(e){if(void 0!==f&&f.getVolume)return f.getVolume(e)},l.startIntervalGetRealtimeVolume=function(e,t,i){"function"==typeof e?(l.stopIntervalGetRealtimeVolume(),s.isWaiting=!0,s.onSuccess=e,s.onFailure=i,s.interval="number"==typeof t?t:100,h()):L.Logger.warning(u,"[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!")},l.stopIntervalGetRealtimeVolume=function(){T(),s={isWaiting:!1}},l.hideLoading=function(){void 0!==p&&p.hideLoading&&p.hideLoading()},l.showLoading=function(){void 0!==p&&p.showLoading&&p.showLoading()},i=function(){if(void 0===p||void 0===l.stream)return null;var e,t=p.video,i=document.defaultView.getComputedStyle(t),o=parseInt(i.getPropertyValue("width"),10),n=parseInt(i.getPropertyValue("height"),10),r=parseInt(i.getPropertyValue("left"),10),a=parseInt(i.getPropertyValue("top"),10);e="object"===Ft(l.elementID)&&"function"==typeof l.elementID.appendChild?l.elementID:document.getElementById(l.elementID);var s=document.defaultView.getComputedStyle(e),d=parseInt(s.getPropertyValue("width"),10),c=parseInt(s.getPropertyValue("height"),10),u=document.createElement("canvas");return u.id="testing",u.width=d,u.height=c,u.setAttribute("style","display: none"),u.getContext("2d").drawImage(t,r,a,o,n),u},l.getVideoFrameURL=function(e){var t=i();return null!==t?e?t.toDataURL(e):t.toDataURL():null},l.getVideoFrame=function(){var e=i();return null!==e?e.getContext("2d").getImageData(0,0,e.width,e.height):null},l.checkOptions=function(e,t){!0===t?(e.video||e.audio||e.screen)&&(L.Logger.warning(u,"[tk-sdk]Cannot update type of subscription"),e.video=void 0,e.audio=void 0,e.screen=void 0):!1===l.local&&(!0===e.video&&!1===l.hasVideo()&&(L.Logger.warning(u,"[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),e.video=!1),!0===e.audio&&!1===l.hasAudio()&&(L.Logger.warning(u,"[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),e.audio=!1)),!1===l.local&&(l.hasVideo()||!0!==e.slideShowMode||(L.Logger.warning(u,"[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),e.slideShowMode=!1))},l.updateMuteToServer=function(e){if(void 0!==l.pc&&l.pc.updateSpec){var t={muteStream:{video:l.videoMuted,audio:l.audioMuted}};l.checkOptions(t,!0),l.pc.updateSpec(t,e)}},l._setQualityLayer=function(e,t,i){var o={qualityLayer:{spatialLayer:e,temporalLayer:t}};l.checkOptions(o,!0),l.pc.updateSpec(o,i)},l.pushVideo=function(e){l.pushVideoMuted!=e&&(l.pushVideoMuted=e,window.tknative.postMessage({command:"pushVideo",enable:e}))},l.pushAudio=function(e){l.pushAudioMuted!=e&&(l.pushAudioMuted=e,window.tknative.postMessage({command:"pushAudio",enable:e}))},l.updateConfiguration=function(e,t){void 0!==e&&(l.pc?(l.checkOptions(e,!0),l.local,l.pc.updateSpec(e,t)):t("This stream has no peerConnection attached, ignoring"))},l.muteVideo=function(e,t){L.Logger.debug(u,"[tk-sdk]call muteVideo , video muted state:"+e+" , stream id:"+l.getID()+" , extensionId is "+l.extensionId+", attrs is "+L.Utils.toJsonStringify(l.getAttributes())),l.videoMuted=e,l.local,l.peerConnectionStream,l.updateMuteToServer(t)},l.muteAudio=function(e,t){L.Logger.debug(u,"[tk-sdk]call muteAudio , audio muted state:"+e+" , stream id:"+l.getID()+" , extensionId is "+l.extensionId+", attrs is "+L.Utils.toJsonStringify(l.getAttributes())),l.audioMuted=e,l.local&&window.tknative.postMessage({command:"enableAudio",enable:!e,connectionId:v().toString()}),void 0!==l.stream||L.Logger.warning(u,"[tk-sdk]not deviceStream to muteAudio"),l.updateMuteToServer(t)},l.onRemoteAudioVolume=function(e){a=e,p&&L.Utils.isFunction(p.onRemoteAudioVolume)&&p.onRemoteAudioVolume(e)},l.onMicVolumeReport=function(e){l&&l.local&&(a=e,p&&L.Utils.isFunction(p.onMicVolumeReport)&&p.onMicVolumeReport(e))},l.setLocalVideoMirror=function(e){l.local&&(o=e,l.updateVideoPlayerOptions({mirror:e}))},l.getRealtimeVolume=function(e,t){if(!L.Utils.isFunction(e))return L.Logger.error(u,"[tk-sdk] getRealtimeVolume: onVolume is not function"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));e(a)},l},window.TK=window.TK||{},window.L=window.L||{},TK.PlayBackProvider=function(){var s={onSeekPlayback:null,onPausePlayback:null,onPlaybackClearAll:null,onHandlerDuration:null,onHandlerPlaybackEnd:null,onHandlerPlaybackUpdateTime:null,onJoinPlaybackRoom:null,seekPlayback:function(e,t){L.Utils.isFunction(s.onSeekPlayback)&&s.onSeekPlayback(e,t)},pausePlayback:function(e,t){L.Utils.isFunction(s.onPausePlayback)&&s.onPausePlayback(e,t)},joinPlaybackRoom:function(e,t,i,o,n,r,a){L.Utils.isFunction(s.onJoinPlaybackRoom)&&s.onJoinPlaybackRoom(e,t,i,o,n,r,a)},playbackClearAll:function(){L.Utils.isFunction(s.onPlaybackClearAll)&&s.onPlaybackClearAll()},handlerDuration:function(e){L.Utils.isFunction(s.onHandlerDuration)&&s.onHandlerDuration(e)},handlerPlaybackEnd:function(){L.Utils.isFunction(s.onHandlerPlaybackEnd)&&s.onHandlerPlaybackEnd()},handlerPlaybackUpdateTime:function(e){L.Utils.isFunction(s.onHandlerPlaybackUpdateTime)&&s.onHandlerPlaybackUpdateTime(e)}};return s}(),window.TK=window.TK||{},window.L=window.L||{},TK.MSG_TO_ALLUSER="__all",TK.MSG_TO_ALLEXCEPTSENDER="__allExceptSender",TK.MSG_TO_ALLEXCEPTAUDITOR="__allExceptAuditor",TK.MSG_TO_NONEUSER="__none",TK.STREAM_VIDEO="video",TK.STREAM_MEDIA="media",TK.STREAM_SCREEN="screen",TK.STREAM_FILE="file",TK.PUBLISH_STATE_NONE=0,TK.PUBLISH_STATE_AUDIOONLY=1,TK.PUBLISH_STATE_VIDEOONLY=2,TK.PUBLISH_STATE_BOTH=3,TK.PUBLISH_STATE_MUTEALL=4,TK.SCREENSTATE_ON=1,TK.SCREENSTATE_OFF=0,TK.MEDIAFILESTATE_ON=1,TK.MEDIAFILESTATE_OFF=0,TK.ENABLEDUALSTREAM_ON=!0,TK.ENABLEDUALSTREAM_OFF=!1;var Bt=0,jt=1;function Ft(e){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if(TK.REC_TYPE_RECFILE=0,TK.REC_TYPE_VIDEOLIST=1,TK.REC_TYPE_MP3=2,TK.REC_TYPE_MIXVIDEO=3,TK.roomInstance=void 0,TK.SDKTYPE="pc",TK.isHiFi=!1,TK.maxaveragebitrateToHifi="128000",TK.isOnlyAudioRoom=!1,TK.needOnlyAudioRoom=0,TK.connectTimer=0,TK.isRetainPublishstateOnOnlyAudioRoom=!1,TK.APPVERSION="customer",TK.isMultiCamera=!1,TK.isPlayback=!1,TK.mySerial="",TK.myPeerid="",TK.logTs="",TK.roomConstraint={width:"",height:"",frameRate:""},TK.SDKVERSIONS="3.2.5",TK.SDKVERSIONSTIME="20190329",console.info("[tk-sdk-version]sdk-version:"+TK.SDKVERSIONS+" , sdk-time: "+TK.SDKVERSIONSTIME),TK.getSdkVersion=function(){return TK.SDKVERSIONS},TK.Room=function(e){return TK.roomInstance||(TK.roomInstance=TK.RoomInit(e)),TK.roomInstance},TK.RoomInit=function(s){var R="Room";L.Logger.info(R,"[tk-sdk]browserInfo:"+L.Utils.toJsonStringify(L.Utils.getBrowserInfo())+",detectOS:"+L.Utils.detectOS()),"object"!==Ft(s=s||{})&&(L.Logger.error(R,"[tk-sdk]TK.Room roomOptios must is json!"),s={}),s.autoSubscribeAV=void 0!==s.autoSubscribeAV&&s.autoSubscribeAV;var C={},D={},N=TK.EventDispatcher(C),u="/ClientAPI/checkroom",i="/ClientAPI/getconfig",n="/ClientAPI/getroomfile",f="/ClientAPI/jsanalysisLog",d=3,c=void 0,U=void 0,l=TK.NativeProxy,P=TK.Signalling,a=TK.PlayBackProvider,O=window.TK_MODULE.MediaControl,p={},m=!1,g=!1,K=Bt,v=null,M=0,x=0,F=-1,h="",T="",V=0,B=0,y="4",_=!1,j=[],J={},H={},W={duration:0,outBytes:0,inBytes:0,outPackets:0,inPackets:0,outAudioKBitRate:0,inAudioKBitRate:0,outVideoKBitRate:0,inVideoKBitRate:0,audioDelay:0,videoDelay:0},k=3,q=!1,G={checkRoomCount:0,joinRoomCount:0,getConfigCount:0,checkRoomPlaybackCount:0},o=function(){D._web_protocol="https",D._doc_protocol="https",D._socket_protocol="https",D._backup_doc_protocol="https",D._web_host=void 0,D._old_web_host=void 0,D._web_port=void 0,D._doc_host=void 0,D._doc_port=void 0,D._socket_host=void 0,D._socket_port=void 0,D._backup_doc_host=void 0,D._backup_doc_host_list=[],D._backup_doc_port=void 0,D._room_uri=void 0,D._room_id=void 0,D._room_type=0,D._room_name=void 0,D._room_properties=void 0,D._room_max_videocount=6,D._configuration=void 0,D._testIP=void 0,D._testPort=void 0,D._myself={id:""},D._serverList={},D._ipFalsificationName=void 0,D._serverName=void 0,D._isIpFalsification=!1,D._ipFalsification=void 0,D._isGetFileList=!1,D._recordfilepath=void 0,D._webInterfaceHtmlPort=8080,D._connectedNumber=0,D._isConnected=!1,D._handlerCallbackJson=!1,D._docServerAddr=void 0,D._hasDocServerAddrBackup=!1,D._roomCheckRoomInfoString="",D._createStreams={},D._playVideoStreams={},D._playAudioStreams={},D._roomJsonOptions={},D._userJsonOptions={},D._registerAudioVolumeListeners={},D._autoProcessDevChangeEvent=!1,D._durationTime={},D._myIp="0.0.0.0",D._video_codec=0,D._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM,D._isSendAllPublishUserNetworkequipment=!0,D._room_filelist=[],D._users={},D._local_def_ext_id="_local_default_extension_id_",D._sentAloneNetQualityBadList={},D._mediaFileScale=!0,D._nativeStatsDelivered={},D._isLocalVideoMirror=!1,D._isLocalVideoMirrorList={},D._backupCourseAddrList=[],D._isLeaveRoom=!0,D._webReconnectNumList={},D._ipinfo={},D._devicePublishInfo={},D._multiCameraAudioDevicePublishInfo={},D._mainCameraDeviceId="",D._videoProfileList={},D.isTkInvalidAppkey=!1,D._videoStreamAttrs={},D._videoStreamListAttrs={},D._useServerScreenRecording=!1,D._sdkUserProperty={id:!0,nickname:!0,role:!0,hasvideo:!0,hasaudio:!0,publishstate:!0,tk_maincamera:!0,tk_ip:!0,tk_area:!0,tk_carrier:!0,servername:!0,disablevideo:!0,disableaudio:!0,group:!0},D._tk_room_test_sdk=!1};function b(e){if(D._web_protocol=e.web_protocol||D._web_protocol,D._web_host=e.web_host||D._web_host,D._web_port=e.web_port||D._web_port,D._doc_protocol=e.doc_protocol||D._doc_protocol,D._doc_host=e.doc_host||D._doc_host,D._doc_port=e.doc_port||D._doc_port,D._socket_protocol=e.socket_protocol||D._socket_protocol,D._socket_host=e.socket_host||D._socket_host,D._socket_port=e.socket_port||D._socket_port,D._backup_doc_protocol=e.backup_doc_protocol||D._backup_doc_protocol,D._backup_doc_host=e.backup_doc_host||D._backup_doc_host,D._backup_doc_port=e.backup_doc_port||D._backup_doc_port,D._backup_doc_host_list=e.backup_doc_host_list||D._backup_doc_host_list,void 0===D._doc_host&&(D._doc_host=D._web_host),void 0===D._doc_port&&(D._doc_port=D._web_port),void 0===D._backup_doc_host&&(D._backup_doc_host=D._web_host),void 0===D._backup_doc_port&&(D._backup_doc_port=D._web_port),D._docServerAddr||(D._doc_host=D._web_host,D._doc_port=D._web_port),D._hasDocServerAddrBackup?D._backup_doc_host_list.length||(D._backup_doc_host_list=[D._backup_doc_host]):(D._backup_doc_host=D._web_host,D._backup_doc_port=D._web_port,D._backup_doc_host_list=[D._backup_doc_host]),U&&U.changeCommonWhiteBoardConfigration){for(var t=[],i=0,o=D._backup_doc_host_list.length;i<o;i++)t.push({protocol:D._backup_doc_protocol,hostname:D._backup_doc_host_list[i],port:D._backup_doc_port});U.changeCommonWhiteBoardConfigration({webAddress:{protocol:D._web_protocol,hostname:D._web_host,port:D._web_port},docAddress:{protocol:D._doc_protocol,hostname:D._doc_host,port:D._doc_port},backupDocAddressList:t})}TK.networkTestInfo.protocol=D._web_protocol,TK.networkTestInfo.host=D._socket_host||D._web_host||"global.talk-cloud.net",TK.networkTestInfo.port=D._web_port||/https/g.test(D._web_protocol)?443:80;var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomServerAddressUpdate,message:{protocol:D._web_protocol,web_protocol:D._web_protocol,web_host:D._web_host,web_port:D._web_port,doc_protocol:D._doc_protocol,doc_host:D._doc_host,doc_port:D._doc_port,backup_doc_protocol:D._backup_doc_protocol,backup_doc_host:D._backup_doc_host,backup_doc_port:D._backup_doc_port,backup_doc_host_list:D._backup_doc_host_list}});N.dispatchEvent(n)}function S(e,o,n){var r=D._room_uri;(e=e||{}).source=e.source||"unknown source";var s=e.source;function a(a){oe(D._web_host,D._web_port,function(e,t){if(L.Logger.debug(R,"[tk-sdk]reconnected room:step2GetFileList result = "+e+" , message:"+L.Utils.toJsonStringify(t)),0===e){if(D._room_filelist=[],t&&Array.isArray(t)&&t.length)for(var i=0,o=t.length;i<o;i++){var n=t[i];n&&(n.fileid=Number(n.fileid),n.pagenum=Number(n.pagenum),n.dynamicppt=Number(n.dynamicppt),n.filecategory=Number(n.filecategory),n.fileprop=Number(n.fileprop),n.type=Number(n.type),n.filetype=n.filetype&&"string"==typeof n.filetype?n.filetype.toLocaleLowerCase():n.filetype,n.isContentDocument=void 0!==n.isContentDocument&&null!==n.isContentDocument&&"number"==typeof Number(n.isContentDocument)?Number(n.isContentDocument):0,D._room_filelist.push(n))}var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomFiles,message:D._room_filelist});N.dispatchEvent(r)}else L.Logger.info(R,"[tk-sdk]"+s+":step2GetFileList code is "+e);"function"==typeof a&&a()})}0<D._connectedNumber&&(B=Date.now()),ie(D._web_host,D._web_port,function(e,t){if(0!=e)L.Logger.error(R,"[tk-sdk]"+s+":step2GetConfig failure --\x3e result and responseText:",e,t);else{if(r!==D._room_uri||"forceReconnect room"===s){N.needReconnectSocket=!0,TK.isTkNative&&(D._handlerCallbackJson=!1,window.tknative.postMessage({command:"nativeClear"}));try{P&&P.socketDisconnect&&P.socketDisconnect()}catch(e){L.Logger.warning(R,"[tk-sdk]"+s+":Socket already disconnected , disconnect errorInfo:",e)}if(P&&P.emptySocket&&P.emptySocket(),"select service reconnect"===s||"forceReconnect room"===s){$(),clearInterval(N._networkequipmentTimer),clearInterval(N._catonNumber),clearInterval(N.sendcatonNumber);var i=TK.RoomEvent({type:TK.EVENT_TYPE.roomDisconnected,message:"select service reconnect , need socket disconnect"});N.dispatchEvent(i)}}"forceReconnect room"===s?a(function(){L.Logger.info(R,"[tk-sdk]"+s+":room socket force reconnect room  ,room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(D._room_uri):D._room_uri)+"! "),re()}):r!==D._room_uri?a(function(){L.Logger.info(R,"[tk-sdk]"+s+":room socket url  changed  , old room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(r):r)+"  , now room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(D._room_uri):D._room_uri)+"! "),re()}):(L.Logger.info(R,"[tk-sdk]"+s+":room socket url not change  , room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(D._room_uri):D._room_uri)+"! "),"reconnected room"===s?a(function(){ae(o,n)}):"select service reconnect"===s&&(L.Logger.warning(R,"[tk-sdk]room uri is not change , no need to perform a reload server"),D._isConnected&&D._users[Re()]&&D._serverName!==D._myself.servername&&N.changeUserProperty(Re(),"__all",{servername:D._serverName})))}},{notSpeedNetwordk:!0,restrict:e.restrict})}function w(e,t){if(e=e||D._serverList,t=t||D._serverName,"object"===Ft(e)&&L.Utils.getJsonLength(e)&&void 0!==t)for(var i in e)e[i].isUseServer=t===i}function Y(e,t,i,o){if(e=e||ft(o),t=t||{hasvideo:D._myself.hasvideo,disablevideo:D._myself.disablevideo},i=i||{hasaudio:D._myself.hasaudio,disableaudio:D._myself.disableaudio},e>TK.PUBLISH_STATE_NONE&&De(o)){var n=!(t.hasvideo&&!t.disablevideo&&(e===TK.PUBLISH_STATE_VIDEOONLY||e===TK.PUBLISH_STATE_BOTH)),r=!(i.hasaudio&&!i.disableaudio&&(e===TK.PUBLISH_STATE_AUDIOONLY||e===TK.PUBLISH_STATE_BOTH));I(Ce(o),n),E(Ce(o),r),g&&(I(Ce(o,!1,g),n),E(Ce(o,!1,g),r))}}function I(e,t){if(O.hasConnection(e.getID())){var i=O.videoEnabled(e.getID()),o=!t;O.enableVideo(e.getID(),o),o!==i&&r(e)}}function E(e,t,i){if(O.hasConnection(e.getID())){var o=O.audioEnabled(e.getID()),n=!t;O.enableAudio(e.getID(),n),n===o||i||r(e)}}function r(e){if(O.hasConnection(e.getID())){var t={muteStream:{video:!O.videoEnabled(e.getID()),audio:!O.audioEnabled(e.getID())}};L.Logger.info(R,"[tk-sdk]update stream mute state send message to server,stream id is "+e.getID()+",send message info:",L.Utils.toJsonStringify(t));var i={streamId:e.getID(),msg:{type:"updatestream",config:t}};e.getAttributes().type!==TK.STREAM_MEDIA&&e.publisherId()===Re()||(i.browser=L.Utils.getBrowser()),Le("signaling_message",i)}}function A(e,t,i){D._isConnected&&"failed"===t&&("publish"===i?(Ut(e,window.TK.ERROR_NOTICE.ERR_PUBLISH_FAILED,"publish ice failed"),z(e,"publish ice failed")):"subscribe"===i&&(Pt(e,window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"subscribe ice failed"),Q(e,"subscribe ice failed")))}function z(t,i){if(void 0===t.reconnectionNumber&&(t.reconnectionNumber=0),t.isUnpublishing=!1,t.isPublishing=!1,void 0===c||t.reconnectionNumber<c)L.Logger.info(R,"[tk-sdk]publishReconnection->"+i+":unpublish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),tt(t,function(e){e||L.Logger.warning(R,"[tk-sdk]publishReconnection->"+i+": unpublish in not success , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())+" !"),setTimeout(function(){switch(t.getAttributes().type){case TK.STREAM_VIDEO:ft(t.videoinputDeviceId)>TK.PUBLISH_STATE_NONE?(L.Logger.info(R,"[tk-sdk]publishReconnection->"+i+":republish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.reconnectionNumber++,et(t,{reconnection:!0})):Z(t);break;default:t.needPublishToServer&&Ue(t.extensionId)?(L.Logger.info(R,"[tk-sdk]publishReconnection->"+i+":republish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.reconnectionNumber++,et(t,{reconnection:!0})):Z(t)}},1e3)},{reconnection:!0});else{switch(L.Logger.info(R,"[tk-sdk]publishReconnection->"+i+":The number of republish exceeded "+c+" , not republish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.getAttributes().type){case TK.STREAM_VIDEO:var e=ft(t.videoinputDeviceId);if(e>TK.PUBLISH_STATE_NONE){var o=void 0;if(e===TK.PUBLISH_STATE_VIDEOONLY||e===TK.PUBLISH_STATE_BOTH){var n={};TK.isMultiCamera&&(n.deviceId=t.videoinputDeviceId),o=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_MAX_RECONNECT_COUNT,info:n}})}var r=void 0;e!==TK.PUBLISH_STATE_AUDIOONLY&&e!==TK.PUBLISH_STATE_BOTH||(r=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_MAX_RECONNECT_COUNT,info:{}}})),N.changeUserPublish(t.publisherId(),TK.PUBLISH_STATE_NONE,t.videoinputDeviceId),o&&N.dispatchEvent(o),r&&N.dispatchEvent(r)}else tt(t);break;case TK.STREAM_SCREEN:TK.isTkNative?l.stopShareScreen():N.stopShareScreen();break;case TK.STREAM_FILE:TK.isTkNative&&l.stopShareMediaFile();break;default:tt(t),t.needPublishToServer=!1,Pe(t.extensionId)&&Oe(t.extensionId)}Z(t),Ut(t,window.TK.ERROR_NOTICE.ERR_PUBLISH_MAX_RECONNECT_COUNT,i)}}function Q(t,i){void 0===t.reconnectionNumber&&(t.reconnectionNumber=0),L.Logger.info(R,"[tk-sdk]subscribeReconnection->"+i+":unsubscribe , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),ot(t,function(e){e||L.Logger.warning(R,"[tk-sdk]subscribeReconnection->"+i+": unsubscribe in not success , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())+" !"),void 0===t.incremental&&(t.incremental=0),t.incremental=0===t.incremental?1:2*t.incremental,4<=t.incremental&&(t.incremental=4),clearTimeout(t.incrementalTimer),t.incrementalTimer=setTimeout(function(){N.remoteStreams[t.getID()]?(t.reconnectionNumber++,L.Logger.info(R,"[tk-sdk]subscribeReconnection->"+i+": stream-removed(initiative) , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),D._nativeStatsDelivered[t.extensionId]=void 0,delete D._nativeStatsDelivered[t.extensionId],t.getAttributes().type===TK.STREAM_VIDEO?He(t):We(t,!1),L.Logger.info(R,"[tk-sdk]subscribeReconnection->"+i+":resubscribe , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),it(t,{reconnection:!0})):X(t)},1e3*t.incremental)},{reconnection:!0})}function X(e){e.isCompleted=!1,e.reconnectionNumber=0,e.incremental=0,clearTimeout(e.incrementalTimer),e.incrementalTimer=void 0}function Z(e){e.isPublishing=!1,e.isUnpublishing=!1,e.isCompleted=!1,e.reconnectionNumber=0}function $(){for(var e in TK.isOnlyAudioRoom=!1,TK.needOnlyAudioRoom=0,TK.connectTimer=0,TK.networkTestInfo.host="global.talk-cloud.net",D._myself&&(D._myself.publishstate=TK.PUBLISH_STATE_NONE),N.remoteStreams){if(N.remoteStreams.hasOwnProperty(e))(t=N.remoteStreams[e])&&(L.Logger.info(R,"[tk-sdk]_resetRoomState--\x3estream-removed(), stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),O.closeConnection(t.getID()),X(t),t.getAttributes().type===TK.STREAM_VIDEO?He(t):We(t,!1),Kt(t),delete t.report,delete N.remoteStreams[e],Pe(t.extensionId)&&Oe(t.extensionId))}for(var e in N.localStreams)if(N.localStreams.hasOwnProperty(e)){var t=N.localStreams[e];O.closeConnection(t.getID()),Z(t),delete t.report,delete N.localStreams[e],Pe(t.extensionId)&&Oe(t.extensionId)}for(var i in D._createStreams){delete(t=D._createStreams[i]).report,O.closeConnection(t.getID()),Z(t),Pe(t.extensionId)&&Oe(t.extensionId)}j=[],H={},N.remoteStreams={},D._nativeStatsDelivered={},D._devicePublishInfo={},D._multiCameraAudioDevicePublishInfo={},W={duration:0,outBytes:0,inBytes:0,outPackets:0,inPackets:0,outAudioKBitRate:0,inAudioKBitRate:0,outVideoKBitRate:0,inVideoKBitRate:0,audioDelay:0,videoDelay:0},O.closeAllConnections(),D._isConnected=!1,TK.networkTestInfo.isConnectRoom=!1,U&&U.changeCommonWhiteBoardConfigration&&U.changeCommonWhiteBoardConfigration({isConnectedRoom:D._isConnected}),ee()}function ee(){if(TK.isPlayback)for(var e in D._users)D._users[e].playbackLeaved=!0;else for(var e in D._users)delete D._users[e]}function te(e,t,i,o,n,r,a,s){D._serverName=e,(D._tk_room_test_sdk||D._useServerScreenRecording)&&(r=""),D._ipFalsification=L.Utils.trim(r),D._isIpFalsification=!!r;var d=t,c=Number(i),u={};if(a&&"object"===Ft(a))for(var l in a)u[l]=a[l];/https/g.test(D._socket_protocol)||(c+=1),D._testIP&&D._testPort&&(d=D._testIP,c=D._testPort),u.socket_host=d,u.socket_port=c,o&&(u.web_host=o),n&&Array.isArray(n)&&n.length?(D._hasDocServerAddrBackup=!0,u.backup_doc_host=n[0],u.backup_doc_host_list=n):D._hasDocServerAddrBackup=!1,b(u),D._room_uri=D._socket_protocol+"://"+D._socket_host+":"+D._socket_port,L.Logger.debug(R,"[tk-sdk]privateVariableJson._room_uri = "+D._room_uri),L.Utils.isFunction(s)&&s()}function ie(l,o,p,f){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _step2GetConfig cannot be executed!");else{f=f||{},D._backupCourseAddrList=[],L.Logger.debug(R,"[tk-sdk]Going to getConfig");var e=D._web_protocol+"://"+l+":"+o+i+"?ts="+(new Date).getTime(),t={serial:D._room_id,userrole:D._myself.role,selfip:D._myIp,restrict:0};f.restrict&&(t.restrict=1),D._useServerScreenRecording&&(t.logintype=88),L.Utils.sdkAjax({url:e,dataType:"json",type:"POST",anync:!0,data:t,success:function(a){L.Logger.debug(R,"[tk-sdk]getConfig resp = ",L.Utils.toJsonStringify(a)),D._configuration=a;var s=l,d="8889",c={};if(a.ipinfo&&"object"===Ft(a.ipinfo)&&(D._ipinfo=a.ipinfo),D._testIP&&D._testPort)s=D._testIP,d=D._testPort;else{if(void 0!==a.courseserver){var e=a.courseserver;null!=e&&0<e.length&&(s=e)}void 0!==a.courseserverport&&(d=Number(a.courseserverport))}a.ClassDocServerAddr&&(D._docServerAddr=a.ClassDocServerAddr,c.doc_host=a.ClassDocServerAddr);var t={},i=[],o=0;if(a.newcourseaddr&&Array.isArray(a.newcourseaddr)&&a.newcourseaddr.length&&(t={retrycount:0,addrs:a.newcourseaddr,speedNetwordkXhrJson:{},isSpeedNetwordkFinshed:!1},o+=a.newcourseaddr.length),a.backcourseaddr&&Array.isArray(a.backcourseaddr)&&a.backcourseaddr.length&&(i=a.backcourseaddr),0<o)if(f&&f.notSpeedNetwordk||1==o){t.addrs&&0<t.addrs.length&&(D._backupCourseAddrList=D._backupCourseAddrList.concat(t.addrs));var n=D._backupCourseAddrList[0];1==D._backupCourseAddrList.length?(D._backupCourseAddrList.splice(0,1),i.length&&(D._backupCourseAddrList=D._backupCourseAddrList.concat(i)),D._backupCourseAddrList.push(n)):(D._backupCourseAddrList.splice(0,1),D._backupCourseAddrList.push(n),i.length&&(D._backupCourseAddrList=D._backupCourseAddrList.concat(i))),te(n.name,n.signaladdr,n.signalport,n.webaddr,n.docaddr,n.change,c,function(){p(a?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(a))})}else{var u=function(o,n,r,a){var e,t,i,s=o.speedNetwordkXhrJson,d=o.addrs[n],c=d.webaddr;s[c+"_"+n]=(e=d.webaddr,t=D._web_port,i=function(e){if(o.speedNetwordkXhrJson[c+"_"+n]=void 0,delete o.speedNetwordkXhrJson[c+"_"+n],0!==e||o.isSpeedNetwordkFinshed){if(!o.isSpeedNetwordkFinshed){var t=0;for(var i in o.speedNetwordkXhrJson)t++;t||a(o)}}else o.isSpeedNetwordkFinshed=!0,r(o,n)},L.Utils.speedNetwordk(D._web_protocol,e,t,i))};!function t(e,o){if(e.addrs&&0<e.addrs.length){if(2<=e.retrycount){D._backupCourseAddrList=D._backupCourseAddrList.concat(e.addrs),o.length&&(D._backupCourseAddrList=D._backupCourseAddrList.concat(o));var i=[];return a.ClassDocServerAddrBackup&&i.push(a.ClassDocServerAddrBackup),ne(s,D._webInterfaceHtmlPort,void 0,!1),void te(D._serverName,s,d,void 0,i,D._isIpFalsification&&D._ipFalsification?D._ipFalsification:"",c,function(){p(a?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(a))})}e.retrycount++,e.speedNetwordkXhrJson={},e.isSpeedNetwordkFinshed=!1;for(var n=0,r=e.addrs.length;n<r;n++)u(e,n,function(e,t){var i=e.addrs[t];e.addrs.splice(t,1),e.addrs.push(i),D._backupCourseAddrList=D._backupCourseAddrList.concat(e.addrs),o.length&&(D._backupCourseAddrList=D._backupCourseAddrList.concat(o)),te(i.name,i.signaladdr,i.signalport,i.webaddr,i.docaddr,i.change,c,function(){p(a?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(a))})},function(e){t(e,o)})}}(t,i)}else{i.length&&(D._backupCourseAddrList=D._backupCourseAddrList.concat(i));var r=[];a.ClassDocServerAddrBackup&&r.push(a.ClassDocServerAddrBackup),ne(s,D._webInterfaceHtmlPort,void 0,!1),te(D._serverName,s,d,void 0,r,D._isIpFalsification&&D._ipFalsification?D._ipFalsification:"",c,function(){p(a?0:window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(a))})}},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]getConfig fail[ XHR , textStatus , errorThrown ]:",e,t,i),D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method getConfig cannot be executed!"):(D._webReconnectNumList.hasOwnProperty("getConfigReconnectNum")||(D._webReconnectNumList.getConfigReconnectNum=0),D._webReconnectNumList.getConfigReconnectNum=++D._webReconnectNumList.getConfigReconnectNum%5,clearTimeout(D._webReconnectNumList.getConfigReconnectTimer),D._webReconnectNumList.getConfigReconnectTimer=setTimeout(function(){D._webReconnectNumList.getConfigReconnectTimer=void 0,D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method getConfig cannot be executed!"):(L.Logger.info(R,"[tk-sdk]Rerequest getConfig web interface!"),ie(l,o,p,f))},1e3*D._webReconnectNumList.getConfigReconnectNum))}})}}function oe(e,t,o){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _step2GetFileList cannot be executed!");else if(D._isGetFileList){L.Logger.debug(R,"[tk-sdk]Going to getFileList");var i=D._web_protocol+"://"+e+":"+t+n+"?ts="+(new Date).getTime();L.Utils.sdkAjax({url:i,dataType:"json",type:"POST",anync:!0,data:{serial:D._room_id},success:function(e){L.Logger.debug(R,"[tk-sdk]getFileList resp = ",L.Utils.toJsonStringify(e));var t,i=e.result;0==i&&void 0!==e.roomfile?t=e.roomfile:L.Logger.info(R,"[tk-sdk]getFileList resp.roomfile is not exist , nRet:"+i),L.Utils.isFunction(o)&&o(i,t)},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]getFileList fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(o)&&o(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}else L.Utils.isFunction(o)&&o(-1,void 0)}function ne(t,i,o,n){D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method _step2GetFalsificationIp cannot be executed!"):D._useServerScreenRecording?L.Utils.isFunction(o)&&o(-2,"Off-screen recording cannot perform this method"):D._tk_room_test_sdk?L.Utils.isFunction(o)&&o(-2,"tk room test sdk"):(n=!L.Utils.isBoolean(n)||n,/(192.168.|127.0.0.1|127.17.|localhost)/g.test(t)?D._isIpFalsification=!1:D._isIpFalsification=!0,L.Utils.getWhereWebInfo(D._web_protocol,t,function(e){e.name&&"string"==typeof e.name&&(D._ipFalsificationName=L.Utils.trim(e.name),D._serverName=D._ipFalsificationName),e.selfip&&"string"==typeof e.selfip&&(D._myIp=L.Utils.trim(e.selfip)),e.ip&&"string"==typeof e.ip&&(D._ipFalsification=L.Utils.trim(e.ip)),e.nochange&&(D._isIpFalsification=!1,L.Logger.info(R,"[tk-sdk]no strings change SDP  , ipFalsificationName is "+D._ipFalsificationName)),L.Utils.isFunction(o)&&o(0,e)},function(e){D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method getFalsificationIp cannot be executed!"):(D._webReconnectNumList.hasOwnProperty("getFalsificationIpReconnectNum")||(D._webReconnectNumList.getFalsificationIpReconnectNum=0),D._webReconnectNumList.getFalsificationIpReconnectNum=++D._webReconnectNumList.getFalsificationIpReconnectNum%5,clearTimeout(D._webReconnectNumList.getFalsificationIpReconnectTimer),D._webReconnectNumList.getFalsificationIpReconnectTimer=setTimeout(function(){D._webReconnectNumList.getFalsificationIpReconnectTimer=void 0,D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method getFalsificationIp cannot be executed!"):(L.Logger.info(R,"[tk-sdk]Rerequest getFalsificationIp web interface!"),ne(t,i,o,n))},1e3*D._webReconnectNumList.getFalsificationIpReconnectNum))},n))}function re(){L.Logger.debug(R,"[tk-sdk]step3Connect"),D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method _step3Connect cannot be executed!"):(L.Logger.info(R,"[tk-sdk]socket connect address:"+(window.__TkSdkBuild__?L.Utils.encrypt(D._room_uri):D._room_uri)),D._isConnected=!1,TK.networkTestInfo.isConnectRoom=!1,U&&U.changeCommonWhiteBoardConfigration&&U.changeCommonWhiteBoardConfigration({isConnectedRoom:D._isConnected}),function i(o,n){if(D._isLeaveRoom)return void L.Logger.info(R,"[tk-sdk]The room is over. Method _connectSocket cannot be executed!");V=(new Date).getTime();P.connectSocket(D._room_uri);var r=0;P.onConnectError=function(e){if(V=(new Date).getTime(),L.Logger.error(R,"[tk-sdk]connect_error info:",e),r++,1<D._backupCourseAddrList.length&&2<=r){var t=D._backupCourseAddrList[0];D._backupCourseAddrList.splice(0,1),D._backupCourseAddrList.push(t),L.Logger.warning(R,"[tk-sdk]Not Connected,change address reconnection, address info:"+L.Utils.toJsonStringify(t)+" ,error info: "+e),te(t.name,t.signaladdr,t.signalport,t.webaddr,t.docaddr,t.change,void 0,function(){try{P&&P.socketDisconnect&&P.socketDisconnect()}catch(e){L.Logger.warning(R,"[tk-sdk]Socket already disconnected , disconnect errorInfo:",e)}P&&P.emptySocket&&P.emptySocket(),N.needReconnectSocket=!0,x+=1,i(p._handler_connectSocketSuccess,p._handler_connectSocketFail)})}};P.onConnect=function(){if(M=(new Date).getTime()-V,D._isLeaveRoom)return L.Logger.info(R,"[tk-sdk]The room is over. socket connect!"),void(P&&P.isHasSocket&&P.isHasSocket()&&N.leaveroom());if(L.Logger.debug(R,"[tk-sdk]tk connectd"),(r=0)===D._connectedNumber||N.needReconnectSocket)P.onAddStream=function(e){var t=!1,i=!1,o="",n="",r="";if(e.attributes.type===TK.STREAM_MEDIA)t=!0,TK.isPlayback&&e.attributes.toID&&e.attributes.toID!==TK.MSG_TO_ALLUSER&&e.attributes.toID!==TK.MSG_TO_ALLEXCEPTAUDITOR&&e.attributes.toID!==e.extensionId.replace(/\:media/g,"")&&(t=!1);else if(e.attributes.type){var a=kt(e.extensionId);a===Re()||kt(e.extensionId)===Re()?t=!1:(t=!0,o=N.getUser(kt(e.extensionId)),n=kt(e.extensionId,1),r="tksmall"===kt(e.extensionId,2),o&&(o["Dual:"+n]&&o["Dual:"+n]!=r?t=!1:o.tk_enabledualstream&&r!=K&&(t=!1)))}TK.subscribe_from_native&&t&&(i=!0);var s=void 0;if(e.attributes.type!==TK.STREAM_MEDIA&&kt(e.extensionId)===Re()){if(!(s=Ue(e.extensionId)))return void L.Logger.error(R,"[tk-sdk]onAddStream:not find local stream,add stream arg:",L.Utils.toJsonStringify(e))}else s=TK.Stream({streamID:e.id,local:!1,audio:e.audio,video:e.video,data:e.data,screen:e.screen,attributes:e.attributes,extensionId:e.extensionId,getVideoTrack:At,getAudioTrack:Rt,getRegisterAudioVolumeListener:Ct},i);for(var d in N.remoteStreams)if(N.remoteStreams[d]&&N.remoteStreams[d].extensionId===s.extensionId){var c=N.remoteStreams[d];Kt(c),delete N.remoteStreams[d],Pe(c.extensionId)&&Oe(c.extensionId)}if(delete s.report,(N.remoteStreams[e.id]=s).getAttributes().type===TK.STREAM_VIDEO&&s.publisherId()===Re()&&Y(void 0,void 0,void 0,s.videoinputDeviceId),t&&it(s),L.Logger.info(R,"[tk-sdk]stream-added , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),s.publisherId()===Re())if(s.getAttributes().type===TK.STREAM_VIDEO){var u=!1,l=ft(s.videoinputDeviceId);l===TK.PUBLISH_STATE_MUTEALL&&(u=!0),Je(s,u),l===TK.PUBLISH_STATE_NONE&&!s.isUnpublishing&&N.localStreams[s.getID()]&&tt(s)}else s.getAttributes().type!==TK.STREAM_MEDIA&&We(s,!0)},P.onSignalingMessageMediaserver=function(e){var t;if(L.Logger.debug(R,"[tk-sdk]signaling_message_mediaserver",e),e.mess=_e(e.mess),e.peerId?(t=N.remoteStreams[e.peerId],!s.autoSubscribeAV&&e&&e.mess&&"started"===e.mess.type&&t&&(t.video&&I(t,!0),t.audio&&E(t,!0))):t=N.localStreams[e.streamId],t){if(L.Logger.info(R,"[tk-sdk] onSignalingMessageMediaserver info: stream id is",t.getID(),", stream extensionId is",t.extensionId,", arg.mess.type is",e.mess.type),e&&e.mess&&"ready"===e.mess.type){var i=null;if(e.peerId){X(t);var o={userId:t.publisherId(),type:t.getAttributes().type,source:"media server ready"};if(t.getAttributes().type===TK.STREAM_VIDEO){var n=new RegExp(t.publisherId()+":","g");if(n.test(t.extensionId)){var r=lt(t);o.deviceId=r}t.extensionId.split(":")[0]===N.getMySelf().id&&t&&t.needSetVideoBW&&O.setBandWidth(t.getID(),t.needSetVideoBW,function(){L.Logger.info(R,"[tk-sdk] setBandWidth success!")},function(e){L.Logger.info(R,"[tk-sdk] setBandWidth It might be a little bit of a problem!")})}i=TK.RoomEvent({type:TK.EVENT_TYPE.roomInfoNotice,message:{code:window.TK.INFO_NOTICE.INFO_SUBSCRIBE_COMPLETED,info:o}})}else{Z(t);var o={userId:t.publisherId(),type:t.getAttributes().type,source:"media server ready"};if(TK.isMultiCamera&&t.getAttributes().type===TK.STREAM_VIDEO){var r=lt(t);o.deviceId=r}i=TK.RoomEvent({type:TK.EVENT_TYPE.roomInfoNotice,message:{code:window.TK.INFO_NOTICE.INFO_PUBLISH_COMPLETED,info:o}})}t.isCompleted=!0,TK.isTkNative&&TK.subscribe_from_native&&t&&t.hideLoading&&t.hideLoading(),i&&N.dispatchEvent&&N.dispatchEvent(i)}O.hasConnection(t.getID())?ut(e.mess,t):L.Logger.warning(R,"stream pc is not exist , Can't call processSignalingMessage method!")}else L.Logger.error(R,"[tk-sdk]onSignalingMessageMediaserver stream is not exist,signaling_message_mediaserver info:",e)},P.onUpdateAttributeStream=function(e){var t=N.remoteStreams[e.id];void 0!==t?(t.updateLocalAttributes(e.attrs),qe(t,e.attrs)):L.Logger.warning(R,"[tk-sdk]onUpdateAttributeStream stream invalid",e)},P.onPublishFailed=function(e){L.Logger.warning(R,"[tk-sdk]stream-publish_mediaserver_failed server info: "+L.Utils.toJsonStringify(e));var t=N.localStreams[e.streamId];t&&(Ut(t,window.TK.ERROR_NOTICE.ERR_PUBLISH_TIMEOUT,"mediaserver publish failed"),z(t,"mediaserver publish failed"))},P.onSubscribeFailed=function(e){L.Logger.warning(R,"[tk-sdk]stream-subscribe_mediaserver_failed server info: "+L.Utils.toJsonStringify(e));var t=N.remoteStreams[e.streamId];t&&(Pt(t,window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_TIMEOUT,"mediaserver subscribe failed"),Q(t,"mediaserver subscribe failed"))},P.onRemoveStream=function(e){var t=N.remoteStreams[e.id];if(t){var i=Ue(Re()+":"+TK.STREAM_SCREEN);i&&i.mediaStream&&t.mediaStream&&i.mediaStream.id===t.mediaStream.id&&N.stopShareScreen(function(){L.Logger.error(R,"[tk-sdk]stream-removed , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", stopShareScreen Failed. ")}),O.closeConnection(t.getID()),L.Logger.info(R,"[tk-sdk]stream-removed , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.getAttributes().type===TK.STREAM_VIDEO?He(t):We(t,!1),Ze(t),Kt(t),delete t.report,delete N.localStreams[e.id],delete N.remoteStreams[e.id],Pe(t.extensionId)&&Oe(t.extensionId)}else L.Logger.info(R,"[tk-sdk]Received a removeStream for ",e.id," and it has not been registered here, ignoring.")},P.onDisconnect=function(e){if(!N.needReconnectSocket&&(L.Logger.debug(R,"[tk-sdk]Socket disconnected, lost connection to TKController",e),D._isConnected)){$(),TK.isTkNative&&(D._handlerCallbackJson=!1,window.tknative.postMessage({command:"nativeClear"})),clearInterval(N._networkequipmentTimer),clearInterval(N._catonNumber),clearInterval(N.sendcatonNumber);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomDisconnected,message:"unexpected-disconnection"});N.dispatchEvent(t)}},P.onReconnecting=function(e){L.Logger.debug(R,"[tk-sdk]reconnecting info:",e);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomReconnecting,message:{number:e,info:"room-reconnecting number:"+e}});N.dispatchEvent(t)},P.onParticipantLeft=p._handler_participantLeft,P.onParticipantJoined=p._handler_participantJoined,P.onParticipantPublished=p._handler_participantPublished,P.onParticipantEvicted=function(e){e=e||{},L.Logger.info(R,"[tk-sdk]user evicted room  , user info: "+L.Utils.toJsonStringify(D._myself)+" , participantEvicted  messages:"+L.Utils.toJsonStringify(e)),N.leaveroom(!0);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomParticipantEvicted,message:e,user:D._myself});N.dispatchEvent(t)},P.onSendMessage=p._handler_sendMessage,P.onMsgList=function(e){L.Logger.debug(R,"[tk-sdk]msgList info:",L.Utils.toJsonStringify(e));var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomMsgList,message:e});N.dispatchEvent(t)},P.onPubMsg=p._handler_pubMsg,P.onDelMsg=p._handler_delMsg,P.onSetProperty=p._handler_setProperty,P.onPlaybackClearAll=a.playbackClearAll,P.onDuration=a.handlerDuration,P.onPlaybackEnd=a.handlerPlaybackEnd,P.onPlaybackUpdatetime=a.handlerPlaybackUpdateTime,P.onForceReconnect=function(){L.Logger.info(R,"[tk-sdk]service notice forceReconnect , call reconnected room! ");var e={source:"forceReconnect room"};S(e,o,n)},D._connectedNumber++,L.Logger.info(R,"[tk-sdk]connected room  , current connected number is "+D._connectedNumber+"! "),N.needReconnectSocket||L.Logger.info(R,"[tk-sdk]Reconnect Socket ,  join room start! "),N.needReconnectSocket=!1,ae(o,n);else{L.Logger.info(R,"[tk-sdk]reconnected room! ");var e=TK.RoomEvent({type:TK.EVENT_TYPE.roomReconnected});N.dispatchEvent(e);var t={source:"reconnected room"};S(t,o,n)}}}(p._handler_connectSocketSuccess,p._handler_connectSocketFail))}function ae(i,o){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _step4Join cannot be executed!");else if(null!=D._room_id){if(D._myself&&(D._serverName&&(D._myself.servername=D._serverName),D._myself.tk_ip=D._myIp,D._myself.tk_area=D._ipinfo.country+"."+D._ipinfo.city+"."+D._ipinfo.area,D._myself.tk_carrier=D._ipinfo.perators,TK.isMultiCamera)){if(!D._mainCameraDeviceId){var e=D._mainCameraDeviceId;D._mainCameraDeviceId=Te(),L.Logger.info(R,"[tk-sdk]change myself main camera device id,my id is "+Re()+",change device id is "+D._mainCameraDeviceId+",old device id is "+e);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:Re()!==D._local_def_ext_id?Re():"",deviceId:D._mainCameraDeviceId}});N.dispatchEvent(t)}D._myself.tk_maincamera=D._mainCameraDeviceId}var n={};for(var r in D._myself)"id"!=r&&"watchStatus"!=r&&(n[r]=D._myself[r]);var a=O.getMaxVideoProfile(),s={userId:Re(),roomId:D._room_id,maxVideo:D._room_max_videocount,videofps:a.maxfps,videowidth:a.width,videoheight:a.height,properties:n,roomtype:D._room_properties.roomtype,version:d,vcodec:"number"==typeof D._video_codec?D._video_codec:0,develop:(88==n.role||-1==n.role)&&!D._useServerScreenRecording,questionCompatibility:_};if(TK.isPlayback){if(!D._recordfilepath)return void L.Logger.error(R,"[tk-sdk]The playback file address does not exist!");s.recordfilepath=D._recordfilepath}2===D._myself.role&&(s.lang=D._roomJsonOptions.recordLang),D._roomJsonOptions.talk_cloud_no_auth&&(s.talk_cloud_no_auth=!0),L.Logger.info(R,"joinRoom params info:"+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(s)):L.Utils.toJsonStringify(s))),P.sendMessageSocket("joinRoom",s,function(e,t){0===e?L.Utils.isFunction(i)&&(q=!0,i(e,t)):L.Utils.isFunction(o)&&o(e,t)})}else L.Logger.error(R,"[tk-sdk]Invalid status",D._room_id)}function se(e,o,n,r){var a=void 0,s=!1,t=D._web_protocol+"://"+D._web_host+":"+D._web_port+"/ClientAPI/uploaddocument?ts="+(new Date).getTime();return e&&"object"===Ft(e)&&"function"==typeof e.get?a=e.get("fieltype"):e&&"object"===Ft(e)&&void 0!==e.fieltype&&(a=e.fieltype),e&&"object"===Ft(e)&&"function"==typeof e.get?s=1===Number(e.get("writedb")):e&&"object"===Ft(e)&&void 0!==e.writedb&&(s=1===Number(e.writedb)),L.Utils.sdkAjax({url:t,dataType:"json",type:"POST",data:e,async:!0,isupLoadFile:!0,progress:function(e){if(L.Utils.isFunction(n)&&e){var t=e.loaded,i=e.total,o=Math.floor(100*t/i);n(e,o)}},success:function(e){L.Logger.debug(R,"[tk-sdk]uploadFile resp = ",L.Utils.toJsonStringify(e));var t=e.result;if(0===t&&s){var i=L.Utils.toJsonParse(L.Utils.toJsonStringify(e));delete i.result,i.filetype=i.filetype||a,de(i,!1)}0===t?L.Utils.isFunction(o)&&o(t,e):L.Utils.isFunction(r)&&r(t,e)},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]uploadFile fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(r)&&r(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}function de(e,t){if(e&&"object"===Ft(e)){var i=Number(e.fileprop),o=e.filetype&&"string"==typeof e.filetype?e.filetype.toLocaleLowerCase():e.filetype,n=1===i||2===i,r=3===i,a=!n&&!r,s=/(mp3|mp4|webm)/g.test(o),d=e;d.fileid=Number(e.fileid),d.pagenum=Number(e.pagenum),d.filecategory=void 0!==e.filecategory?Number(e.filecategory):0,d.fileprop=i,d.filetype=o,d.isContentDocument=void 0!==e.isContentDocument&&null!==e.isContentDocument&&"number"==typeof Number(e.isContentDocument)?Number(e.isContentDocument):0,d.swfpath=n||r?e.downloadpath:e.swfpath,d.dynamicppt=n?1:0,d.currpage=1,d.pptslide=1,d.pptstep=0,d.steptotal=0;var c={name:"DocumentChange",id:"DocumentChange",toID:t?"__all":"__allExceptSender",data:L.Utils.toJsonStringify({isDel:t,isGeneralFile:a,isMedia:s,isDynamicPPT:n,isH5Document:r,action:"",mediaType:s?o:"",filedata:d}),save:!1};N.pubMsg(c)}}function ce(o,n,r){var e=D._web_protocol+"://"+D._web_host+":"+D._web_port+"/ClientAPI/delroomfile?ts="+(new Date).getTime(),t={serial:D._room_properties.serial,fileid:o};L.Utils.sdkAjax({url:e,dataType:"json",type:"POST",anync:!0,data:t,success:function(e){L.Logger.debug(R,"[tk-sdk]deleteFile resp = ",L.Utils.toJsonStringify(e));var t=e.result,i=function(e){for(var t=0;t<D._room_filelist.length;t++)if(D._room_filelist[t].fileid==e)return{file:D._room_filelist[t],index:t}}(o);0===t&&i&&i.file&&"object"===Ft(i.file)&&de(L.Utils.toJsonParse(L.Utils.toJsonStringify(i.file)),!0);0===t?L.Utils.isFunction(n)&&n(t,e):L.Utils.isFunction(r)&&r(t,e)},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]deleteFile fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(r)&&r(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}function ue(e,t){D._devicePublishInfo[e]=D._devicePublishInfo[e]||{_audiopublished_:!1,_videopublished_:!1},L.Utils.isBoolean(t)&&(D._devicePublishInfo[e]._videopublished_=t)}function le(e,t){D._devicePublishInfo[e]=D._devicePublishInfo[e]||{_audiopublished_:!1,_videopublished_:!1},L.Utils.isBoolean(t)&&(D._devicePublishInfo[e]._audiopublished_=t)}function pe(e,t){L.Utils.isBoolean(t)&&(D._multiCameraAudioDevicePublishInfo[e]=t)}function fe(e){if(D._devicePublishInfo[e])return D._devicePublishInfo[e]._videopublished_}function me(e){if(D._devicePublishInfo[e])return D._devicePublishInfo[e]._audiopublished_}function ge(e){return D._multiCameraAudioDevicePublishInfo[e]}function ve(e){D._devicePublishInfo[e]&&(D._devicePublishInfo[e]._audiopublished_||D._devicePublishInfo[e]._videopublished_||(D._devicePublishInfo[e]=void 0,delete D._devicePublishInfo[e]))}function he(e){D._multiCameraAudioDevicePublishInfo[e]||(D._multiCameraAudioDevicePublishInfo[e]=void 0,delete D._multiCameraAudioDevicePublishInfo[e])}function Te(){var e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput);if(L.Utils.isVideoinputDeviceIdFromDeviceList(e))return e;if(TK.deviceInfoMap&&TK.deviceInfoMap.videoinput&&TK.deviceInfoMap.videoinput.length){var t=TK.deviceInfoMap.videoinput[0]&&TK.deviceInfoMap.videoinput[0].deviceId;return e&&L.Logger.warning(R,"[tk-sdk]The host camera device id("+e+") of local storage is not in the device list, looking for other device replacements, which have an id of "+t),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t),t}return e&&L.Logger.warning(R,"[tk-sdk]The host camera device id("+e+') of local storage is not in the device list, looking for other device replacements, which have an id of ""'),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,""),""}function ye(e){if(!D._isIpFalsification||!D._ipFalsification)return e;if("offer"===e.type||"candidate"===e.type){var t=L.Utils.toJsonStringify(e),i=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;i.test(t)&&(e=L.Utils.toJsonParse(t.replace(i,"254.254.254.254")))}return e}function _e(e){if(!D._isIpFalsification||!D._ipFalsification)return e;if("answer"===e.type){var t=L.Utils.toJsonStringify(e),i=D._ipFalsification,o=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;o.test(t)&&(e=L.Utils.toJsonParse(t.replace(o,i)))}return e}function ke(e,t,i){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _handlerCheckroom cannot be executed!");else{var o={},n=e.result;if(0===n){TK.isPlayback&&(e.nickname="playback",e.roomrole=-1,e.thirdid=L.Utils.generategGuid()+":playback");var r=e.room,a=e.pullinfo;e.roomrole=Number(e.roomrole),r.roomtype=Number(r.roomtype),r.maxvideo=parseInt(r.maxvideo);var s={},d={};if(a&&a.data&&a.data.pullConfigureList){var c=a.data.pullConfigureList;for(var u in c){var l=c[u];s[l.pullProtocol]=l.pullUrlList}}if(a&&a.data&&a.data.pushConfigureInfo){var p=a.data.pushConfigureInfo;for(var u in p){var f=p[u];d[f.pushProtocol]=f.pushUrl}}r.pullConfigure=s,r.pushConfigure=d,D._room_properties=r,D._room_name=r.roomname,D._room_type=r.roomtype,D._room_max_videocount=r.maxvideo,D._video_codec=void 0!==r.vcodec&&null!==r.vcodec&&"number"==typeof Number(r.vcodec)?Number(r.vcodec):D._video_codec,o.properties={},o.properties.role=e.roomrole,o.properties.nickname=e.nickname;var m=""+e.thirdid;0===e.thirdid&&(m=""),o.id=i||(null!=m&&""!=m?m:L.Utils.generategGuid()),"string"!=typeof o.id&&(o.id=""+o.id),D._myself=TK.RoomUser(o),Ot(),TK.isPlayback?(D._myself.hasvideo=!1,D._myself.hasaudio=!1):(L.Logger.debug(R,"[tk-sdk]call getDevices to checkroom set myself.hasvideo and  myself.hasaudio start!"),O.getDeviceMgr().getDevices(function(e){L.Logger.debug(R,"[tk-sdk]call getDevices to checkroom set myself.hasvideo and  myself.hasaudio finshed!");var t=e.hasdevice;D._myself.hasvideo=t.videoinput,D._myself.hasaudio=t.audioinput})),TK.isPlayback?(D._room_id=r.serial+"_"+Re(),D._room_id&&-1===D._room_id.indexOf(":playback")&&(D._room_id+=":playback")):D._room_id=r.serial,O.setMaxVideoProfile(Number(r.videowidth),Number(r.videoheight),Number(r.videoframerate)),D._roomCheckRoomInfoString=e?"string"==typeof e?e:L.Utils.toJsonStringify(e):"",TK.isTkNative&&!D._handlerCallbackJson&&(D._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",localId:Re().toString(),width:Number(r.videowidth),height:Number(r.videoheight),fps:Number(r.videoframerate),roomInfo:D._roomCheckRoomInfoString,webAddr:D._web_host.toString(),webPort:D._web_port.toString(),tk_multistream:TK.isMultiCamera}));var g=D._room_properties.chairmancontrol;D._mediaFileScale=!(!TK.isPlayback&&g&&"string"==typeof g)||1!==Number(g.substr(95,1)),TK.isHiFi=!(!g||"string"!=typeof g)&&1===Number(g.substr(91,1)),L.Logger.info(R,"[tk-sdk]"+(TK.isPlayback?"initPlaybackInfo to checkroom finshed--\x3e":"")+"privateVariableJson._room_max_videocount:"+D._room_max_videocount,"my id:"+Re(),"room id:"+D._room_id,"room properties chairmancontrol is:"+(D._room_properties.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(D._room_properties.chairmancontrol):D._room_properties.chairmancontrol:void 0))}else L.Logger.warning(R,"[tk-sdk]checkroom failure code is "+n);L.Logger.info(R,"[tk-sdk]checkroom finshed!"),t(n,o,e)}}function Le(e,t,i,o){D._isConnected?P.socketSend(e,t,i,function(e,t){L.Utils.isFunction(o)&&o(e,t)}):L.Logger.warning(R,"[tk-sdk]Trying to send a message over a disconnected Socket")}function be(e,t){var i,o,n=ft(t);L.Logger.debug(R,"[tk-sdk]onChangeMyPublishState "+n+" to "+e),i=e,o=t,TK.isMultiCamera?D._myself["publishstate:"+o]=i:D._myself.publishstate=i;var r=[];r.push(Ce(t,!0)),g&&r.push(Ce(t,!0,g)),e>TK.PUBLISH_STATE_NONE?(Y(e,void 0,void 0,t),r.forEach(function(e){e&&void 0===N.localStreams[e.getID()]&&!e.isPublishing&&et(e,void 0,function(){ft(t)===TK.PUBLISH_STATE_NONE&&e&&!e.isUnpublishing&&N.localStreams[e.getID()]&&tt(e)})})):r.forEach(function(e){e&&!e.isUnpublishing&&N.localStreams[e.getID()]&&tt(e,function(){ft(t)>TK.PUBLISH_STATE_NONE&&(e=Ce(t,!0))&&void 0===N.localStreams[e.getID()]&&!e.isPublishing&&et(e)})})}function Se(e){if(L.Logger.debug(R,"[tk-sdk]onChangeMyDisableVideoState "+D._myself.disablevideo+" to "+e),D._myself.disablevideo!=e)if(D._myself.disablevideo=e,TK.isMultiCamera){for(var t in D._myself)if(/publishstate:/g.test(t)){var i=Et(t);D._myself[t]>TK.PUBLISH_STATE_NONE&&Y(D._myself[t],void 0,void 0,i)}}else D._myself.publishstate>TK.PUBLISH_STATE_NONE&&Y(D._myself.publishstate,void 0,void 0,void 0)}function we(e){if(L.Logger.debug(R,"[tk-sdk]onChangeMyDisableAudioState "+D._myself.disableaudio+" to "+e),D._myself.disableaudio!=e)if(D._myself.disableaudio=e,TK.isMultiCamera){for(var t in D._myself)if(/publishstate:/g.test(t)){var i=Et(t);D._myself[t]>TK.PUBLISH_STATE_NONE&&Y(D._myself[t],void 0,void 0,i)}}else D._myself.publishstate>TK.PUBLISH_STATE_NONE&&Y(D._myself.publishstate,void 0,void 0,void 0)}function Ie(e){var t=!1;return e&&(t=e.getAttributes().type!==TK.STREAM_MEDIA&&e.publisherId()===Re()),t}function Ee(e,t,i){var o=void 0;if(t===TK.STREAM_MEDIA||t===TK.STREAM_SCREEN)for(var n in N.remoteStreams){if((a=N.remoteStreams[n]).extensionId===e+":"+t){o=a;break}}else if(e===Re())if(t===TK.STREAM_VIDEO){var r=e;TK.isMultiCamera&&(r+=":"+i),o=D._createStreams[r]}else o=D._createStreams[e+":"+t];else for(var n in N.remoteStreams){var a=N.remoteStreams[n];if(t===TK.STREAM_VIDEO){r=e;if(i&&(r+=":"+i),-1!==a.extensionId.indexOf(r)&&e==a.publisherId()&&N.remoteStreams[n].subscribed){o=a;break}}else if(a.extensionId===e+":"+t){o=a;break}}return o}function Ae(e){var t=[];for(var i in D._createStreams)Ue(i)&&Ue(i).getAttributes().type===e&&t.push(Ue(i));return t}function Re(){return L.Utils.isNull(D._myself.id)?D._local_def_ext_id:D._myself.id}function Ce(e,t,i){return t&&(De(e)||Ne(e),i&&!De(e,i)&&Ne(e,i)),TK.isMultiCamera?i?D._createStreams[Re()+":"+e+":tksmall"]:D._createStreams[Re()+":"+e]:i?D._createStreams[Re()+":tksmall"]:D._createStreams[Re()]}function De(e,t){return!!Ce(e,!1,t)}function Ne(e,t){var i=!TK.isPlayback&&(D._roomJsonOptions.audio||!1),o=!TK.isPlayback&&(D._roomJsonOptions.video||!1),n={},r=void 0;if((r=TK.isMultiCamera&&D._videoStreamListAttrs[wt(Re(),TK.STREAM_VIDEO,e)]||D._videoStreamAttrs)&&"object"===Ft(r))for(var a in r)n[a]=r[a];return TK.isMultiCamera?(t&&Ve("video",{video:o,audio:i,attributes:n,videoinputDeviceId:e,enableDualStream:t}),Ve("video",{video:o,audio:i,attributes:n,videoinputDeviceId:e,enableDualStream:t})):(t&&Ve("video",{video:o,audio:i,attributes:n,enableDualStream:t}),Ve("video",{video:o,audio:i,attributes:n,enableDualStream:t}))}function Ue(e){return D._createStreams[e]}function Pe(e){var t=!1,i=D._createStreams[e];if(i&&i.publisherId()===Re()&&i.getAttributes().type!==TK.STREAM_MEDIA)if(O.hasConnection(i.getID())||N.localStreams[i.getID()]||N.remoteStreams[i.getID()]||D._playVideoStreams[e]||D._playAudioStreams[It(i.publisherId(),i.getAttributes().type)])t=!1;else switch(i.getAttributes().type){case TK.STREAM_VIDEO:ft(i.videoinputDeviceId)===TK.PUBLISH_STATE_NONE&&(t=!0);break;default:i.needPublishToServer||(t=!0)}return t}function Oe(e){var t=D._createStreams[e];if(t){var i=D._playVideoStreams[e],o=D._playAudioStreams[It(t.publisherId(),t.getAttributes().type)];switch(t.getAttributes().type){case TK.STREAM_VIDEO:i&&N.unplayVideo(t.publisherId(),void 0,t.videoinputDeviceId),o&&N.unplayAudio(t.publisherId());break;case TK.STREAM_FILE:(i||o)&&N.unplayRemoteMediaFile(t.publisherId());break;case TK.STREAM_SCREEN:(i||o)&&N.unplayRemoteScreen(t.publisherId());break;default:i&&xe(i),o&&Fe(o)}if(delete t.report,t.destroy(),t.getAttributes().type===TK.STREAM_VIDEO){var n=!0,r=!0,a=Ae(TK.STREAM_VIDEO);if(a&&a.length)for(var s=0,d=a.length;s<d;s++)a[s]&&a[s].extensionId!==t.extensionId&&(a[s].videoinputDeviceId===t.videoinputDeviceId&&(n=!1),a[s].audioinputDeviceId===t.audioinputDeviceId&&(r=!1));n&&O.destroyVideoTrack(t.videoinputDeviceId),r&&O.destroyAudioTrack(t.audioinputDeviceId)}}D._createStreams[e]=void 0,delete D._createStreams[e]}function Ke(e,t,i){i=i||{},t.playInfo=t.playInfo||{video:!1,audio:!1},t.playInfo.video=!TK.isOnlyAudioRoom,t.hasVideoPlayer()?e!==t.getVideoPlayerElementId()?(t.unplayVideo(),t.playVideo(e,i),D._playVideoStreams[t.extensionId]=t):t.updateVideoPlayerOptions(i):(t.playVideo(e,i),D._playVideoStreams[t.extensionId]=t),t.video&&(t.playInfo.video?(t.updateVideoPlayerOptions(i),t.showVideo()):t.hideVideo()),Ie(t)||t.video&&I(t,!t.playInfo.video)}function Me(e,t,i){t=t||{},e.playInfo=e.playInfo||{video:!1,audio:!1},e.playInfo.audio=!0,e.hasAudioPlayer()?e.updateAudioPlayerOptions(t):(e.playAudio(t),D._playAudioStreams[It(e.publisherId(),e.getAttributes().type)]=e),e.getAttributes().type!==TK.STREAM_VIDEO&&e.audio&&(e.playInfo.audio?e.setMute(!1):e.setMute(!0)),Ie(e)||e.audio&&E(e,!e.playInfo.audio,i)}function xe(e,t){t=t||{},e.playInfo=e.playInfo||{video:!1,audio:!1},e.playInfo.video=!1,e.video&&(e.playInfo.video?e.showVideo():e.hideVideo()),Ie(e)||e.video&&I(e,!e.playInfo.video),e.unplayVideo(t),delete D._playVideoStreams[e.extensionId],e.publisherId()===Re()&&e.getAttributes().type!==TK.STREAM_MEDIA&&Pe(e.extensionId)&&Oe(e.extensionId)}function Fe(e,t,i){t=t||{},e.playInfo=e.playInfo||{video:!1,audio:!1},e.playInfo.audio=!1,e.getAttributes().type!==TK.STREAM_VIDEO&&e.audio&&(e.playInfo.audio?e.setMute(!1):e.setMute(!0)),Ie(e)||e.audio&&E(e,!e.playInfo.audio,i),e.unplayAudio(t),t.notDelete?D._playAudioStreams[It(e.publisherId(),e.getAttributes().type)]=null:delete D._playAudioStreams[It(e.publisherId(),e.getAttributes().type)],e.publisherId()===Re()&&e.getAttributes().type!==TK.STREAM_MEDIA&&Pe(e.extensionId)&&Oe(e.extensionId)}function Ve(e,t){var i={getVideoTrack:At,getAudioTrack:Rt,getRegisterAudioVolumeListener:Ct},o={type:e,isWeb:(t=t||{}).isWeb};if(t.attributes&&"object"===Ft(t.attributes))for(var n in t.attributes)"type"!==n&&(o[n]=t.attributes[n]);switch(i.audio=t.audio||!1,i.video=t.video||!1,i.data=!1,i.attributes=o,e){case TK.STREAM_VIDEO:i.screen=!1,i.media=!1,i.extensionId=Re(),void 0!==t.videoinputDeviceId&&(i.extensionId+=":"+t.videoinputDeviceId),t.enableDualStream&&(i.extensionId=i.extensionId+":tksmall");break;case TK.STREAM_SCREEN:i.screen=!0,i.media=!1,i.extensionId=Re()+":"+e;break;case TK.STREAM_FILE:i.screen=!1,i.media=!0,i.path=t.path,i.scale=L.Utils.isBoolean(t.scale)?t.scale:D._mediaFileScale,i.extensionId=Re()+":"+e}var r=!1;TK.isTkNative&&(r=TK.isTkMacNative?e===TK.STREAM_SCREEN&&TK.isTkNative:TK.isTkNative);var a=TK.Stream(i,r);return e===TK.STREAM_VIDEO&&(void 0!==t.videoinputDeviceId?a.videoinputDeviceId=t.videoinputDeviceId:a.videoinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),a.audioinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)),D._createStreams[a.extensionId]=a}function Be(e,t){if(TK.isOnlyAudioRoom!==e){if(TK.isOnlyAudioRoom=e,TK.isOnlyAudioRoom)for(var i in N.remoteStreams){(c=N.remoteStreams[i])&&c.video&&(c.getAttributes().type===TK.STREAM_FILE&&c.publisherId()===Re()?TK.isTkNative&&l.stopShareMediaFile():c.getAttributes().type===TK.STREAM_SCREEN&&c.publisherId()===Re()?TK.isTkNative?l.stopShareScreen():N.stopShareScreen():c.getAttributes().type===TK.STREAM_MEDIA&&c.publisherId()===Re()&&N.stopShareMedia())}for(var i in D._myself)if(!TK.isMultiCamera&&"publishstate"===i||TK.isMultiCamera&&/publishstate:/g.test(i)){var o=D._myself[i];if(o>TK.PUBLISH_STATE_NONE){var n=void 0;if(TK.isMultiCamera&&/publishstate:/g.test(i)&&(n=Et(i)),TK.isOnlyAudioRoom)if(o!==TK.PUBLISH_STATE_AUDIOONLY){var r=void 0;if(o===TK.PUBLISH_STATE_VIDEOONLY||o===TK.PUBLISH_STATE_BOTH){var a={};TK.isMultiCamera&&(a.deviceId=n),r=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_SWITCHAUDIOROOM,info:a}})}TK.isMultiCamera?D._mainCameraDeviceId===n?N.changeUserPublish(Re(),TK.PUBLISH_STATE_AUDIOONLY,n):N.changeUserPublish(Re(),TK.PUBLISH_STATE_NONE,n):N.changeUserPublish(Re(),TK.PUBLISH_STATE_AUDIOONLY,n),r&&N.dispatchEvent(r)}else TK.isMultiCamera&&D._mainCameraDeviceId!==n&&N.changeUserPublish(Re(),TK.PUBLISH_STATE_NONE,n);else if(o!==TK.PUBLISH_STATE_BOTH){var s=void 0;if(o===TK.PUBLISH_STATE_AUDIOONLY||o===TK.PUBLISH_STATE_MUTEALL){a={};var d=!1;TK.isMultiCamera?D._mainCameraDeviceId===n&&(a.deviceId=n,d=!0):d=!0,d&&(s=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_PUBLISHVIDEO_BY_SWITCHAUDIOVIDEOROOM,info:a}}))}TK.isMultiCamera?D._mainCameraDeviceId===n?N.changeUserPublish(Re(),TK.PUBLISH_STATE_BOTH,n):N.changeUserPublish(Re(),TK.PUBLISH_STATE_NONE,n):N.changeUserPublish(Re(),TK.PUBLISH_STATE_BOTH,n),s&&N.dispatchEvent(s)}else TK.isMultiCamera&&D._mainCameraDeviceId!==n&&N.changeUserPublish(Re(),TK.PUBLISH_STATE_NONE,n)}}for(var i in D._playVideoStreams){var c=D._playVideoStreams[i];TK.isOnlyAudioRoom?c.hideVideo():c.showVideo()}var u=TK.RoomEvent({type:TK.EVENT_TYPE.roomAudioVideoStateSwitched,message:{fromId:t,onlyAudio:TK.isOnlyAudioRoom}});N.dispatchEvent(u)}}function je(e){"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e&&e.data&&"string"==typeof e.data&&(e.data=L.Utils.toJsonParse(e.data));var s=e.fromID,d=e.data,c=function(e){for(var t=0;t<D._room_filelist.length;t++)if(D._room_filelist[t].fileid==e)return{file:D._room_filelist[t],index:t}}(d.filedata.fileid);if(d.isDel){if(c&&c.file){D._room_filelist.splice(c.index,1);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomDeleteFile,message:{fileid:c.file.fileid,fileinfo:c.file,fromID:s}});N.dispatchEvent(t)}}else{var i=function(e){var t=d.filedata;t.fileid=Number(t.fileid),t.pagenum=Number(t.pagenum),t.filecategory=void 0!==t.filecategory?Number(t.filecategory):0,t.isContentDocument=void 0!==t.isContentDocument&&null!==t.isContentDocument&&"number"==typeof Number(t.isContentDocument)?Number(t.isContentDocument):0,t.dynamicppt=d.isDynamicPPT?1:0,t.uploaduserid=s,t.uploadusername=e?e.nickname:"",t.companyid=D._room_properties.companyid,t.downloadpath=t.swfpath,t.filetype=t.filetype&&"string"==typeof t.filetype?t.filetype.toLocaleLowerCase():t.filetype,t.fileprop=d.isDynamicPPT?2:d.isH5Document?3:0,t.type=0;var i=t;if(c){var o={},n=!1;for(var r in i)c.file[r]!==i[r]&&(c.file[r]=i[r],o[r]=i[r],n=!0);if(n){a=TK.RoomEvent({type:TK.EVENT_TYPE.roomUpdateFile,message:{fileid:i.fileid,updateFileinfo:o,fromID:s}});N.dispatchEvent(a)}}else{D._room_filelist.push(i);var a=TK.RoomEvent({type:TK.EVENT_TYPE.roomAddFile,message:{fileid:i.fileid,fromID:s}});N.dispatchEvent(a)}};N.getRoomUser(s,function(e){i(e)},function(){i()})}}function Je(e,t){if(e.getAttributes().type===TK.STREAM_VIDEO){e.publisherId()===Re()&&Ue(e.extensionId)&&(e=Ue(e.extensionId));var i=D._users[e.publisherId()];if(i){void 0===ge(e.publisherId())&&pe(e.publisherId(),!1),void 0===me(e.extensionId)&&le(e.extensionId,!1),void 0===fe(e.extensionId)&&ue(e.extensionId,!1);var o=lt(e).replace(/\:tksmall/g,""),n=pt(i,o),r=n===TK.PUBLISH_STATE_AUDIOONLY||n===TK.PUBLISH_STATE_BOTH,a=n===TK.PUBLISH_STATE_VIDEOONLY||n===TK.PUBLISH_STATE_BOTH;if(e.audio&&(me(e.extensionId.replace(/\:tksmall/g,""))!==r||t)){var s={userId:e.publisherId(),published:r,type:e.getAttributes().type,publishstate:n,attributes:e.getAttributes()},d=ge(e.publisherId());le(e.extensionId,s.published);var c=new RegExp(e.publisherId()+":","g");if(void 0!==i.tk_maincamera&&c.test(e.extensionId))if(o!==i.tk_maincamera)D._playAudioStreams[It(e.publisherId(),e.getAttributes().type)]&&Fe(e,{notDelete:!0});else if(pe(e.publisherId(),s.published),r===d)s.published&&null===D._playAudioStreams[It(e.publisherId(),e.getAttributes().type)]&&Me(e);else{L.Logger.info(R,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:s}));var u=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:s});N.dispatchEvent(u)}else{pe(e.publisherId(),s.published),L.Logger.info(R,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:s}));u=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:s});N.dispatchEvent(u)}}if(e.video&&(fe(e.extensionId.replace(/\:tksmall/g,""))!==a||t)){s={userId:e.publisherId(),published:a,type:e.getAttributes().type,publishstate:n,attributes:e.getAttributes()};(c=new RegExp(e.publisherId()+":","g")).test(e.extensionId)&&(s.deviceId=o),ue(e.extensionId,s.published),L.Logger.info(R,"[tk-sdk]roomUserVideoStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:s}));var l=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:s});N.dispatchEvent(l)}ve(e.extensionId),he(e.publisherId())}}}function He(e){if(e.getAttributes().type===TK.STREAM_VIDEO){e.publisherId()===Re()&&Ue(e.extensionId)&&(e=Ue(e.extensionId));var t=D._users[e.publisherId()];if(t){void 0===ge(e.publisherId())&&pe(e.publisherId(),!1),void 0===me(e.extensionId)&&le(e.extensionId,!1),void 0===fe(e.extensionId)&&ue(e.extensionId,!1);var i=lt(e),o=pt(t,i);if(e.audio&&me(e.extensionId)){var n={userId:e.publisherId(),published:!1,type:e.getAttributes().type,publishstate:o,attributes:e.getAttributes()},r=ge(e.publisherId());le(e.extensionId,n.published);var a=new RegExp(e.publisherId()+":","g");if(void 0!==t.tk_maincamera&&a.test(e.extensionId))if(i!==t.tk_maincamera)D._playAudioStreams[It(e.publisherId(),e.getAttributes().type)]&&Fe(e,{notDelete:!0});else if(pe(e.publisherId(),!1),!1===r);else{L.Logger.info(R,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:n}));var s=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:n});N.dispatchEvent(s)}else{pe(e.publisherId(),!1),L.Logger.info(R,"[tk-sdk]roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:n}));s=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserAudioStateChanged,message:n});N.dispatchEvent(s)}}if(e.video&&fe(e.extensionId)){n={userId:e.publisherId(),published:!1,type:e.getAttributes().type,publishstate:o,attributes:e.getAttributes()};(a=new RegExp(e.publisherId()+":","g")).test(e.extensionId)&&(n.deviceId=i),ue(e.extensionId,n.published),L.Logger.info(R,"[tk-sdk]roomUserVideoStateChanged info:"+L.Utils.toJsonStringify({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:n}));var d=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserVideoStateChanged,message:n});N.dispatchEvent(d)}ve(e.extensionId),he(e.publisherId())}}}function We(e,t){var i="room-user"+e.getAttributes().type+"state-changed",o=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.getAttributes()));o.video=e.hasVideo(),o.audio=e.hasAudio();var n={userId:e.publisherId(),published:t,type:e.getAttributes().type,attributes:o};t?D._createStreams[e.extensionId]=e:delete D._createStreams[e.extensionId],L.Logger.info(R,"[tk-sdk]"+i+" info:"+L.Utils.toJsonStringify({type:i,message:n}));var r=TK.RoomEvent({type:i,message:n});N.dispatchEvent(r)}function qe(e,t){var i="room-user"+e.getAttributes().type+"attributes-update",o=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.getAttributes()));o.video=e.hasVideo(),o.audio=e.hasAudio();var n={userId:e.publisherId(),type:e.getAttributes().type,attributes:o,updateAttributes:t};if(e.getAttributes().type===TK.STREAM_VIDEO&&new RegExp(e.publisherId()+":","g").test(e.extensionId)){var r=lt(e);n.deviceId=r}var a=TK.RoomEvent({type:i,message:n});N.dispatchEvent(a)}function Ge(){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _sendDeviceInfoToPhp cannot be executed!");else{var e=D._web_protocol+"://"+D._web_host+":"+D._web_port+"/ClientAPI/equipment?ts="+(new Date).getTime(),t=L.Utils.getBrowserInfo(),i={serial:D._room_properties.serial,companyid:D._room_properties.companyid,peerid:Re(),peername:D._myself.nickname,peerrole:D._myself.role,ip:D._myIp,country:D._ipinfo.country,region:D._ipinfo.city,city:D._ipinfo.area,osversion:L.Utils.detectOS(),devicemodel:TK.isTkNative&&(TK.clientfriendlyversion||TK.clientversion)?TK.clientfriendlyversion||TK.clientversion:t.info.browserName+" "+t.info.browserVersion,cpuarchitecture:"x86",sdkversion:TK.SDKVERSIONS,sdkdate:TK.SDKVERSIONSTIME,connecttime:M,reconnectcount:F,isp:D._ipinfo.perators,redirectcount:x,routename:D._myself.servername,browsername:L.Utils.getBrowserName(),docServer:D._docServerAddr||D._doc_protocol+"://"+D._doc_host+":"+D._doc_port||""},o=TK.DeviceMgrImpl.getUseDevice();o&&(i.audioinput=o.audioinput?o.audioinput.label:"",i.videoinput=o.videoinput?o.videoinput.label:"",i.audiooutput=o.audiooutput?o.audiooutput.label:""),L.Utils.sdkAjax({url:e,dataType:"json",type:"POST",anync:!0,data:i,success:function(e){L.Logger.debug(R,"[tk-sdk]equipment resp = ",L.Utils.toJsonStringify(e))},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]equipment fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}}function Ye(e){if(D._isConnected)L.Logger.warning(R,"[tk-sdk]Room already connected!");else if(void 0!==D._web_host&&void 0!==D._web_port)if(D._room_properties){if(N.needReconnectSocket=!0,TK.isMultiCamera)for(var t in D._myself)/publishstate:/g.test(t)&&D._myself[t]!==TK.PUBLISH_STATE_NONE&&(D._myself[t]=TK.PUBLISH_STATE_NONE);else D._myself.publishstate!==TK.PUBLISH_STATE_NONE&&(D._myself.publishstate=TK.PUBLISH_STATE_NONE);if(D._userJsonOptions&&D._userJsonOptions.userProperties&&"object"===Ft(D._userJsonOptions.userProperties))for(var t in D._userJsonOptions.userProperties)void 0===D._myself[t]&&(D._myself[t]=D._userJsonOptions.userProperties[t]);D._roomJsonOptions&&D._roomJsonOptions.group&&(Array.isArray(D._roomJsonOptions.group)?D._myself.group=D._roomJsonOptions.group:L.Logger.warning(R,"[tk-sdk]joinroomOptions.group must is a array!")),L.Logger.info(R,"[tk-sdk]joinroom:my device info  [hasvideo , hasaudio] is ["+D._myself.hasvideo+" ,"+D._myself.hasaudio+"]"),L.Logger.debug(R,"[tk-sdk]joinroom:my room user",D._myself),D._users={},ie(e=e||D._web_host,D._web_port,function(e,t){if(0!=e){L.Logger.error(R,"[tk-sdk]step2GetConfig failure --\x3e result and responseText:",e,t);var i=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"getconfig",error:e,errorCode:e}});if(N.dispatchEvent(i),G.getConfigCount++,5<=G.getConfigCount){var o=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"getconfig",error:e,errorCode:e}},{httpTime:Date.now()-B,socketTime:0,reconnectCount:F,isReconnect:q&&0<F});N.dispatchEvent(o)}}else oe(D._web_host,D._web_port,function(e,t){if(L.Logger.debug(R,"[tk-sdk]step2GetFileList result = "+e+" , message:"+L.Utils.toJsonStringify(t)),0===e){if(D._room_filelist=[],t&&Array.isArray(t)&&t.length)for(var i=0,o=t.length;i<o;i++){var n=t[i];n&&(n.fileid=Number(n.fileid),n.pagenum=Number(n.pagenum),n.dynamicppt=Number(n.dynamicppt),n.filecategory=Number(n.filecategory),n.fileprop=Number(n.fileprop),n.type=Number(n.type),n.filetype=n.filetype&&"string"==typeof n.filetype?n.filetype.toLocaleLowerCase():n.filetype,n.isContentDocument=void 0!==n.isContentDocument&&null!==n.isContentDocument&&"number"==typeof Number(n.isContentDocument)?Number(n.isContentDocument):0,D._room_filelist.push(n))}var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomFiles,message:D._room_filelist});N.dispatchEvent(r)}else L.Logger.info(R,"[tk-sdk]step2GetFileList code is "+e);if(L.Utils.isFunction(D._roomJsonOptions.awitConnectRoomCallback)){D._roomJsonOptions.awitConnectRoomCallback(function(){re()}),delete D._roomJsonOptions.awitConnectRoomCallback}else re()})},{notSpeedNetwordk:!D._roomJsonOptions.autoServer})}else L.Logger.warning(R,"[tk-sdk]No checkroom cannot joinroom , room_properties is "+D._room_properties);else L.Logger.warning(R,"[tk-sdk]web_host or web_port or myself is undefined , web_host is "+D._web_host+" , web_port is "+D._web_port+",myself is "+D._myself)}function ze(i){TK.isPlayback?Ye(i):D._roomJsonOptions&&"object"===Ft(D._roomJsonOptions)&&void 0!==D._roomJsonOptions.video&&void 0!==D._roomJsonOptions.audio?void 0===D._myself.hasvideo||void 0===D._myself.hasaudio?(L.Logger.debug(R,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),O.getDeviceMgr().getDevices(function(e){L.Logger.debug(R,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");var t=e.hasdevice;D._myself.hasvideo=t.videoinput,D._myself.hasaudio=t.audioinput,Ye(i)})):Ye(i):void 0===D._myself.hasvideo||void 0===D._myself.hasaudio?(L.Logger.debug(R,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream start!"),O.getDeviceMgr().getDevices(function(e){L.Logger.debug(R,"[tk-sdk]call getDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream finshed!");var t=e.hasdevice;D._myself.hasvideo=t.videoinput,D._myself.hasaudio=t.audioinput,Ye(i)})):Ye(i)}function Qe(e,t,i,o,n,r,a){if(!e)return L.Logger.error(R,"[tk-sdk] "+r+" method got invalid userId!"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));if(!t)return L.Logger.error(R,"[tk-sdk]  "+r+" method got invalid elementId!"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));if(i&&"object"!==Ft(i))return L.Logger.error(R,"[tk-sdk]  "+r+" method options is not json!"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));(D._playVideoStreams[wt(e,n,a)]||D._playAudioStreams[It(e,n)])&&Xe(e,void 0,n,"un"+r,a);var s=Ee(e,n,a);if(!s)return L.Logger.debug(R,"[tk-sdk]  "+r+": user has not stream, user id is "+e),void(L.Utils.isFunction(o)&&o("TK_NO_THIS_STREAM"));Ke(t,s,i),Me(s,i)}function Xe(e,t,i,o,n){if(!e)return L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk] "+o+" method got invalid userId!");var r=D._playVideoStreams[wt(e,i,n)];r||L.Logger.debug(R,"[tk-sdk] "+o+": user has not video stream, user id is "+e);var a=D._playAudioStreams[It(e,i)];a||L.Logger.debug(R,"[tk-sdk] "+o+": user has not audio stream, user id is "+e),r||a?(r&&xe(r),a&&Fe(a)):L.Utils.isFunction(t)&&t("TK_NO_THIS_STREAM")}function Ze(e){if(D._roomMode===window.TK.ROOM_MODE.BIG_ROOM&&e.getAttributes().type===TK.STREAM_VIDEO&&e.publisherId()!==Re()&&D._users[e.publisherId()]){var t=D._users[e.publisherId()];if(t.role!==window.TK.ROOM_ROLE.TEACHER&&t.role!==window.TK.ROOM_ROLE.ASSISTANT)for(var i in t)if(("publishstate"===i||/publishstate:/g.test(i))&&t[i]===TK.PUBLISH_STATE_NONE){delete D._users[e.publisherId()];break}}}function $e(){if(D._roomMode===window.TK.ROOM_MODE.BIG_ROOM)for(var e in D._users){var t=D._users[e];if(e!==Re()&&t.role!==window.TK.ROOM_ROLE.TEACHER&&t.role!==window.TK.ROOM_ROLE.ASSISTANT)for(var i in t)if(("publishstate"===i||/publishstate:/g.test(i))&&t[i]===TK.PUBLISH_STATE_NONE){delete D._users[e];break}}}function et(a,s,d){if(D._isConnected)if(a.isPublishing)L.Utils.isFunction(d)&&d(void 0,"publishing");else if(s=s||{},L.Logger.info(R,"[tk-sdk]calling publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a&&void 0===N.localStreams[a.getID()]){if(s.maxVideoBW=s.maxVideoBW||C.defaultVideoBW,s.maxVideoBW>C.maxVideoBW&&(s.maxVideoBW=C.maxVideoBW),a.getAttributes().type===TK.STREAM_SCREEN)s.maxVideoBW=C.maxScreenBW,s.videowidth&&s.videoheight&&a.updateLocalAttributes({videowidth:s.videowidth,videoheight:s.videoheight});else if(a.getAttributes().type===TK.STREAM_FILE){var e=a.getAttributes().width,t=a.getAttributes().height;if(e&&t){var i=640,o=e,n=t;a.scale||(i=1920<Math.max(e,t)?1920:e),t<=e?i<e&&(n=(o=i)*(t/e)):i<t&&(o=(n=i)*(e/t)),o=Math.floor(o),n=Math.floor(n),a.updateLocalAttributes({width:o,height:n,videowidth:o,videoheight:n}),s.maxVideoBW=L.Utils.getMaxBPS(o,30),a.scale&&s.maxVideoBW>C.maxLocalFileMediaBW&&(s.maxVideoBW=C.maxLocalFileMediaBW)}else s.maxVideoBW=C.maxLocalFileMediaBW}else if(a.getAttributes().type===TK.STREAM_VIDEO){var r="";a&&a.extensionId&&a.extensionId.split&&(r=a.extensionId.split(":")[1]);var c=O.getUseVideoProfile(r),u=O.getMaxVideoProfile(r),l=L.Utils.getMaxBPS(c.width,c.fps),p=L.Utils.getMaxBPS(u.width,u.fps);l<p&&(a.needSetVideoBW=l),s.maxVideoBW=p}void 0===s.minVideoBW&&(s.minVideoBW=0),s.minVideoBW>C.maxVideoBW&&(s.minVideoBW=C.maxVideoBW),a.publishFailCount=0,a.isPublishing=!0;var f=function(r){if(a.getAttributes().type===TK.STREAM_VIDEO&&ft(a.videoinputDeviceId)===TK.PUBLISH_STATE_NONE)return O.closeConnection(a.getID()),N.localStreams[a.getID()]&&tt(a),Z(a),void(L.Utils.isFunction(d)&&d(void 0,"not need publish!"));Le("publish",{state:"ms",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),minVideoBW:s.minVideoBW,attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:s.createOffer,metadata:s.metadata,scheme:s.scheme},void 0,function(e,t){if(0!==e)return a.isPublishing=!1,a.isUnpublishing=!1,L.Logger.warning(R,"[tk-sdk]Error when publishing the stream: ",e,t),L.Logger.info(R,"[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),2===e?(Z(a),Ut(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_ROOMMAXVIDEOLIMITED,"publish ack failed")):(z(a,"publish ack failed"),Ut(a,window.TK.ERROR_NOTICE.ERR_PUBLISH_FAILED,"publish ack failed")),void(L.Utils.isFunction(d)&&d(void 0,e));L.Logger.debug(R,"[tk-sdk]Stream assigned an Id, starting the publish process , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.getID=function(){return t},a.id=a.getID(),a.setAttributes=function(e){var t,i;i=e,(t=a)&&"object"===Ft(i)&&(N.remoteStreams[t.getID()]?(t.local&&t.updateLocalAttributes(i),P.sendMessageSocket("updateStreamAttributes",{id:t.getID(),attrs:i})):L.Logger.warning(R,"[tk-sdk]You can not update attributes to server, because the stream does not exist on the server."))};var i={video:(N.localStreams[t]=a).hasVideo(),maxVideoBW:s.maxVideoBW},o={audio:a.hasAudio(),maxAudioBW:s.maxAudioBW},n=function(e,t){Le("signaling_message",{streamId:e,msg:t=ye(t)})};O.createUpConnection(a.getID(),{mediaStream:r,useNative:a.isTkNative,extraData:{video:a.hasVideo(),audio:a.hasAudio(),screen:a.hasScreen(),media:a.hasMedia(),setStreamMethod:v,extensionId:a.extensionId}}),O.bindIceCandidate(a.getID(),function(e,t){L.Logger.debug(R,"[tk-sdk]Sending ice info(connection_id is "+e+"):",t),n(e,t)}),O.bindOfferGenerated(a.getID(),function(e,t){t.sdp=L.Utils.setMaxBWToSdp(t.sdp,i,o),L.Logger.debug(R,"[tk-sdk]Sending sdp info(connection_id is "+e+"):",t),n(e,t)}),O.bindIceConnectionStateChange(a.getID(),function(e,t){if(L.Logger.info(R,"[tk-sdk]publish ice state:"+t+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),"failed"===t&&D._isConnected&&a){L.Logger.warning(R,"[tk-sdk]Publishing Stream ",a.getID()," has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var i=a.getID();H[a.extensionId]?H[a.extensionId].failCount++:H[a.extensionId]={peerID:a.extensionId,streamID:i,failCount:1};A(a,t,"publish")}if("completed"===t&&D._isConnected&&a){i=a.getID();H[a.extensionId]||(H[a.extensionId]={peerID:a.extensionId,streamID:i,failCount:0})}}),O.createOffer(a.getID()),L.Utils.isFunction(d)&&d(!0,t)})};switch(a.getAttributes().type){case TK.STREAM_VIDEO:var m="tksmall"===kt(a.extensionId,2);O.getDeviceMediaStream(a.videoinputDeviceId,a.audioinputDeviceId,function(e,t,i){ft(a.videoinputDeviceId)>TK.PUBLISH_STATE_NONE&&(t&&L.Logger.info(R,"[tk-sdk]publish video track is fail, fail info:",L.Utils.toJsonStringify(t)),i&&L.Logger.info(R,"[tk-sdk]publish audio track is fail, fail info:",L.Utils.toJsonStringify(i)),f(e)),Pe(a.extensionId)&&Oe(a.extensionId)},function(e,t){e&&L.Logger.info(R,"[tk-sdk]publish device stream is not success, video track is fail, fail info:",L.Utils.toJsonStringify(e)),t&&L.Logger.info(R,"[tk-sdk]publish device stream is not success, audio track is fail, fail info:",L.Utils.toJsonStringify(t));var i=ft(a.videoinputDeviceId);if(i>TK.PUBLISH_STATE_NONE){var o=void 0;if(i===TK.PUBLISH_STATE_VIDEOONLY||i===TK.PUBLISH_STATE_BOTH){var n={};TK.isMultiCamera&&(n.deviceId=a.videoinputDeviceId),o=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:n}})}var r=void 0;i!==TK.PUBLISH_STATE_AUDIOONLY&&i!==TK.PUBLISH_STATE_BOTH||(r=TK.RoomEvent({type:TK.EVENT_TYPE.roomWarnNotice,message:{code:window.TK.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:{}}})),N.changeUserPublish(a.publisherId(),TK.PUBLISH_STATE_NONE,a.videoinputDeviceId),o&&N.dispatchEvent(o),r&&N.dispatchEvent(r)}else tt(a);Pe(a.extensionId)&&Oe(a.extensionId),L.Utils.isFunction(d)&&d(void 0,"publish device stream not success")},m?O.getSmallVideoProfile():null);break;case TK.STREAM_SCREEN:f(a.mediaStream);break;default:f(void 0)}}else L.Logger.info(R,"[tk-sdk]Trying to publish invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.isPublishing=!1,L.Utils.isFunction(d)&&d(void 0,"Trying to publish invalid stream")}function tt(i,o,e){if(i.isUnpublishing)L.Utils.isFunction(o)&&o(void 0,"unpublishing");else if(e=e||{},L.Logger.info(R,"[tk-sdk]calling unpublish , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),i&&N.localStreams[i.getID()])i.isUnpublishing=!0,P.sendMessageSocket("unpublish",i.getID(),function(e,t){if(i.isUnpublishing=!1,i.isPublishing=!1,0!==e)return L.Logger.warning(R,"[tk-sdk]Error unpublishing stream, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error info:",t),L.Logger.info(R,"[tk-sdk]stream-unpublish-fail , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),void(L.Utils.isFunction(o)&&o(void 0,t));L.Logger.debug(R,"[tk-sdk]Stream unpublished  , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),O.closeConnection(i.getID()),delete i.report,delete N.localStreams[i.getID()],i.getID=function(){return"local"},i.id=i.getID(),i.setAttributes=function(e){i.updateLocalAttributes(e)},Pe(i.extensionId)&&Oe(i.extensionId),L.Utils.isFunction(o)&&o(!0)});else{var t="Cannot unpublish, stream does not exist or is not local";L.Logger.warning(R,"[tk-sdk]unpublish warning:",t),L.Utils.isFunction(o)&&o(void 0,t)}}function it(r,a,s){if(a=a||{},N.remoteStreams[r.getID()]){if(r.hasVideo()||r.hasScreen()||(a.video=!1),r.hasAudio()||(a.audio=!1),a.maxVideoBW=a.maxVideoBW||C.defaultVideoBW,a.maxVideoBW>C.maxVideoBW&&(a.maxVideoBW=C.maxVideoBW),r.getAttributes().type===TK.STREAM_SCREEN)a.maxVideoBW=C.maxScreenBW;else if(r.getAttributes().type===TK.STREAM_FILE){var e=r.getAttributes().width;a.maxVideoBW=e?L.Utils.getMaxBPS(e,30):C.maxLocalFileMediaBW}L.Logger.debug(R,"[tk-sdk]Subscribing to: "+r.getID()),Le("subscribe",{streamId:r.getID(),audio:a.audio,video:a.video,data:a.data,browser:L.Utils.getBrowser(),createOffer:a.createOffer,metadata:a.metadata,slideShowMode:a.slideShowMode},void 0,function(e,t){if(0!==e)return L.Logger.warning(R,"[tk-sdk]Error subscribing to stream ",t),L.Logger.info(R,"[tk-sdk]stream-subscribe-fail , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes())),Pt(r,window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"subscribe ack failed"),Q(r,"subscribe ack failed"),void(L.Utils.isFunction(s)&&s(void 0,t));r.incremental=0,r.subscribeFailCount=0,L.Logger.debug(R,"[tk-sdk]Subscriber added");var i={video:r.hasVideo(),maxVideoBW:a.maxVideoBW},o={audio:r.hasAudio(),maxAudioBW:a.maxAudioBW};O.createDownConnection(r.getID(),{useNative:TK.subscribe_from_native,extraData:{video:r.hasVideo(),audio:r.hasAudio(),screen:r.hasScreen(),media:r.hasMedia(),extensionId:r.extensionId}});var n=function(e,t){Le("signaling_message",{streamId:e,msg:t=ye(t),browser:L.Utils.getBrowser()})};O.bindIceCandidate(r.getID(),function(e,t){L.Logger.debug(R,"[tk-sdk]Sending ice info(connection_id is "+e+"):",t),n(e,t)}),O.bindOfferGenerated(r.getID(),function(e,t){t.sdp=L.Utils.setMaxBWToSdp(t.sdp,i,o),L.Logger.debug(R,"[tk-sdk]Sending sdp info(connection_id is "+e+"):",t),n(e,t)}),O.bindAddStream(r.getID(),function(e,t){if(N.remoteStreams[e])if(L.Logger.debug(R,"[tk-sdk]Stream subscribed"),L.Logger.info(R,"[tk-sdk]stream-subscribed , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes())),r.subscribed=!0,r.getAttributes().type===TK.STREAM_VIDEO){var i=!1;D._users[r.publisherId()]&&D._users[r.publisherId()].publishstate===TK.PUBLISH_STATE_MUTEALL&&(i=!0),Je(r,i),!r.hasVideoTrack()&&O.getConnectionVideoTrack(e)&&(r.addVideoTrack(O.getConnectionVideoTrack(e)),r.showVideo())}else We(r,!0);else L.Logger.info(R,"[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes()))}),O.bindIceConnectionStateChange(r.getID(),function(e,t){if(L.Logger.info(R,"[tk-sdk]subscribe ice state:"+t+" , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes())),"failed"===t&&D._isConnected&&r){L.Logger.warning(R,"[tk-sdk]Subscribing stream ",r.getID()," has failed after successful ICE checks , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes()));var i=r.getID();H[r.extensionId]?H[r.extensionId].failCount++:H[r.extensionId]={peerID:r.extensionId,streamID:i,failCount:1};A(r,t,"subscribe")}if("completed"===t&&D._isConnected&&r){i=r.getID();H[r.extensionId]||(H[r.extensionId]={peerID:r.extensionId,streamID:i,failCount:0})}}),O.createOffer(r.getID()),L.Utils.isFunction(s)&&s(!0)})}else{L.Logger.info(R,"[tk-sdk]Cannot subscribe to invalid stream , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes())),L.Utils.isFunction(s)&&s(void 0,"subscribe invalid stream")}}function ot(i,o,e){if(e=e||{},N.remoteStreams[i.getID()])P.sendMessageSocket("unsubscribe",i.getID(),function(e,t){if(0!==e)return L.Logger.error(R,"[tk-sdk]Error unsubscribe stream, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error code is "+e+" ,error info:",t),L.Logger.info(R,"[tk-sdk]stream-unsubscribe-fail , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),void(L.Utils.isFunction(o)&&o(void 0,t));i.subscribed=!1,O.closeConnection(i.getID()),L.Utils.isFunction(o)&&o(!0)});else{L.Logger.info(R,"[tk-sdk]Cannot unsubscribe to invalid stream , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),L.Utils.isFunction(o)&&o(void 0,"unsubscribe invalid stream")}}function nt(o,n,r,a,s,d){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _checkroom cannot be executed!");else{var e=D._web_protocol+"://"+D._web_host+":"+D._web_port+u+"?ts="+(new Date).getTime(),t=!0,i="";if("string"==typeof r)i=r,TK.isPlayback&&(i+="&playback=true"),i+="&clientType="+(TK.isTkNative?4:1);else for(var c in TK.isPlayback&&(r.playback=!0),TK.isTkNative?r.clientType=4:r.clientType=1,r)t?t=!1:i+="&",i=i+c+"="+r[c];L.Logger.debug(R,"[tk-sdk]Going to checkroom",i),L.Logger.info(R,"[tk-sdk]call checkroom start!"),L.Utils.sdkAjax({url:e,dataType:"json",type:"POST",anync:!0,data:i,success:function(e){L.Logger.debug(R,"[tk-sdk]checkroom resp = ",L.Utils.toJsonStringify(e)),ke(e,a,s)},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]checkroom fail[ XHR , textStatus , errorThrown ]:",e,t,i),D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method checkroom cannot be executed!"):(D._webReconnectNumList.hasOwnProperty("checkroomReconnectNum")||(D._webReconnectNumList.checkroomReconnectNum=0),D._webReconnectNumList.checkroomReconnectNum=++D._webReconnectNumList.checkroomReconnectNum%5,clearTimeout(D._webReconnectNumList.checkroomReconnectTimer),D._webReconnectNumList.checkroomReconnectTimer=setTimeout(function(){D._webReconnectNumList.checkroomReconnectTimer=void 0,D._isLeaveRoom?L.Logger.info(R,"[tk-sdk]The room is over. Method checkroom cannot be executed!"):(L.Logger.info(R,"[tk-sdk]Rerequest checkroom web interface!"),nt(o,n,r,a,s,d))},1e3*D._webReconnectNumList.checkroomReconnectNum))}})}}function rt(e,t,i){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _sendNetworkequipment cannot be executed!");else{D._web_protocol,D._web_host,D._web_port,(new Date).getTime();var o=e[0],n={};try{o&&(n={cpuOccupancy:o.cpuOccupancy,video:{currentDelay:(o.video?o.video.currentDelay:0)||0,videoWidth:(o.video?o.video.frameWidth:0)||0,videoHeight:(o.video?o.video.frameHeight:0)||0,frameRate:(o.video?o.video.frameRate:0)||0,videoFps:i},audio:{currentDelay:(o.audio?o.audio.currentDelay:0)||0}})}catch(e){L.Logger.error(R,"[tk-sdk]setStreamStats error info:"+e+"!")}var r={streamId:t.getID(),peerId:t.extensionId.split(":")[0],stats:n};t.extensionId.split(":")[0]===D._myself.id&&P.socketSend("setStreamStats",r)}}function at(i,o,n,r){if(Ie(i)&&(i=Ue(i.extensionId)),!i)return L.Logger.warning(R,"[tk-sdk]stream is not exist!"),void(L.Utils.isFunction(n)&&n("TK_ERR_INVALID_ARG"));if(O.hasConnection(i.getID()))if(O.hasNativeConnection(i.getID())){var e=D._nativeStatsDelivered[i.extensionId];e?(L.Utils.isFunction(o)&&o(e),ct(i,e)):L.Utils.isFunction(n)&&n("TK_ERR_NOT_DATA")}else try{O.getStats(i.getID(),function(e){if(!e)return L.Logger.warning(R,"[tk-sdk]pc.getStats -> getStats not exist!"),void(L.Utils.isFunction(n)&&n("TK_ERR_UNKNOWN"));var t=function(e,t){var i=!1,o=!1;e.getAttributes().type!==TK.STREAM_MEDIA&&e.publisherId()===Re()||(o=!0);var n=0,r={frameWidth:0,frameHeight:0},a=0,s=0,d=0,c=0,u=0,l=0,p=0,f=0,m=0,g=0,v=0,h=0,T=0,y=0,_=0,k=0,b=0,S=0,w=0,I=0,E=0,A=0,R=0,C=0,D=0,N=0,U=0,P=0,O=0,K=0,M=0,x=0,F=0,V=0,B=0,j=0,J=0,H=0,W=0,q=0,G=function(e){"ssrc"===e.type&&"video"===e.mediaType?/send/g.test(e.id)?(T=Number(e.bytesSent),y=Number(e.packetsSent),f=Number(e.googRtt),_=Number(e.packetsLost),m=Number(e.googFrameWidthSent),g=Number(e.googFrameHeightSent),h=Number(e.googFrameRateSent),v=e.timestamp,o=!1,l=e.googFirsReceived?Number(e.googFirsReceived):0,p=e.googPlisReceived?Number(e.googPlisReceived):0):/recv/g.test(e.id)&&(k=Number(e.bytesReceived),E=Number(e.packetsReceived),b=Number(e.googCurrentDelayMs),A=Number(e.packetsLost),S=Number(e.googFrameWidthReceived),w=Number(e.googFrameHeightReceived),I=Number(e.googFrameRateReceived),v=e.timestamp,o=!0):"ssrc"===e.type&&"audio"===e.mediaType&&(/send/g.test(e.id)?(M=Number(e.bytesSent),x=Number(e.packetsSent),K=Number(e.googRtt),F=Number(e.packetsLost),B=Number(e.googJitterReceived),V=e.timestamp,o=!1):/recv/g.test(e.id)&&(J=Number(e.bytesReceived),H=Number(e.packetsReceived),W=Number(e.googCurrentDelayMs),q=Number(e.packetsLost),B=Number(e.googJitterReceived),V=e.timestamp,o=!0))},Y=function(e){"video"===e.mediaType?"outbound-rtp"===e.type?(f=Number(e.Rtt)?Number(e.Rtt):0,T=Number(e.bytesSent)?Number(e.bytesSent):0,y=Number(e.packetsSent)?Number(e.packetsSent):0,_=Number(e.nackCount)?Number(e.nackCount):0,m=Number(e.FrameWidthSent)?Number(e.FrameWidthSent):0,g=Number(e.FrameHeightSent)?Number(e.FrameWidthSent):0,h=Number(e.framerateMean)?Number(e.framerateMean):0,l=Number(e.firCount)?Number(e.firCount):0,p=Number(e.firCount)?Number(e.pliCount):0,v=e.timestamp,o=!1):"inbound-rtp"===e.type&&(k=Number(e.bytesReceived)?Number(e.bytesReceived):0,E=Number(e.packetsReceived)?Number(e.packetsReceived):0,b=Number(e.CurrentDelayMs)?Number(e.CurrentDelayMs):0,A=Number(e.packetsLost)?Number(e.packetsLost):0,S=Number(e.FrameWidthReceived)?Number(e.FrameWidthReceived):0,w=Number(e.FrameHeightReceived)?Number(e.FrameHeightReceived):0,I=Number(e.framerateMean)?Number(e.framerateMean):0,v=e.timestamp,o=!0):"audio"===e.mediaType&&("outbound-rtp"===e.type?(M=Number(e.bytesSent)?Number(e.bytesSent):0,x=Number(e.packetsSent)?Number(e.packetsSent):0,K=Number(e.Rtt)?Number(e.Rtt):0,F=Number(e.nackCount)?Number(e.nackCount):0,B=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,V=e.timestamp,o=!1):"inbound-rtp"===e.type&&(J=Number(e.bytesReceived)?Number(e.bytesReceived):0,H=Number(e.packetsReceived)?Number(e.packetsReceived):0,W=Number(e.CurrentDelayMs)?Number(e.CurrentDelayMs):0,q=Number(e.packetsLost)?Number(e.packetsLost):0,B=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,V=e.timestamp,o=!0))};if(t&&"object"===Ft(t)&&t.forEach)t.forEach(function(e,t){"chrome"===L.Utils.getBrowserInfo().info.browserName?G(e):"firefox"===L.Utils.getBrowserInfo().info.browserName?Y(e):"Edge"===L.Utils.getBrowserInfo().info.browserName||L.Utils.getBrowserInfo().info.browserName});else for(var z in t){var Q=t[z];"chrome"===L.Utils.getBrowserInfo().info.browserName?G(Q):"firefox"===L.Utils.getBrowserInfo().info.browserName?Y(Q):"Edge"===L.Utils.getBrowserInfo().info.browserName||L.Utils.getBrowserInfo().info.browserName}if(e.report||(e.report={},i=!0),e.report.timestamp=e.report.timestamp||v,e.report.audioTimestamp=e.report.audioTimestamp||V,o?(e.report.bytesReceived=e.report.bytesReceived||k,e.report.packetsReceived=e.report.packetsReceived||E,e.report.packetsLostReceived=e.report.packetsLostReceived||A,e.report.audioBytesReceived=e.report.audioBytesReceived||J,e.report.audioPacketsReceived=e.report.audioPacketsReceived||H,e.report.audioPacketsLostReceived=e.report.audioPacketsLostReceived||q):(e.report.bytesSent=e.report.bytesSent||T,e.report.packetsSent=e.report.packetsSent||y,e.report.packetsLostSend=e.report.packetsLostSend||_,e.report.audioBytesSent=e.report.audioBytesSent||M,e.report.audioPacketsSent=e.report.audioPacketsSent||x,e.report.audioPacketsLostSend=e.report.audioPacketsLostSend||F),!i){if(e.networkStatus&&v-e.report.timestamp<=0&&V-e.report.audioTimestamp<=0)return e.networkStatus;C=o?(R=8*(k-e.report.bytesReceived),r.frameWidth=isNaN(m)?0:S,r.frameHeight=isNaN(g)?0:w,a=I,n=b,u=isNaN(n)?0:n,s=(A-e.report.packetsLostReceived)/(E-e.report.packetsReceived)*100,c=E,d=A,j=8*(J-e.report.audioBytesReceived),N=W,O=isNaN(N)?0:N,P=B,U=(q-e.report.audioPacketsLostReceived)/(H-e.report.audioPacketsReceived)*100,D=H,q):(R=8*(T-e.report.bytesSent),r.frameWidth=isNaN(m)?0:m,r.frameHeight=isNaN(g)?0:g,a=h,n=f,u=isNaN(n)?0:Math.round(n/2),s=(_-e.report.packetsLostSend)/(y-e.report.packetsSent)*100,c=y,d=_,j=8*(M-e.report.audioBytesSent),N=K,O=isNaN(N)?0:Math.round(N/2),P=B,U=(F-e.report.audioPacketsLostSend)/(x-e.report.audioPacketsSent)*100,D=x,F);var X=R/((v-e.report.timestamp)/1e3),Z=j/((V-e.report.audioTimestamp)/1e3);o?(e.report.bytesReceived=k,e.report.packetsReceived=E,e.report.packetsLostReceived=A,e.report.audioBytesReceived=J,e.report.audioPacketsReceived=H,e.report.audioPacketsLostReceived=q):(e.report.bytesSent=T,e.report.packetsSent=y,e.report.packetsLostSend=_,e.report.audioBytesSent=M,e.report.audioPacketsSent=x,e.report.audioPacketsLostSend=F),e.report.timestamp=v,e.report.audioTimestamp=V,s=isNaN(s)?0:Math.round(s)<=100?Math.round(s):100,U=isNaN(U)?0:Math.round(U)<=100?Math.round(U):100,u=isNaN(u)?0:u,O=isNaN(O)?0:O;var $={video:{bytesSent:Number(T),bitsPerSecond:isNaN(X)?0:Math.round(X),packetsLost:isNaN(d)?0:d,totalPackets:isNaN(c)?0:c,packetsLostRate:s,currentDelay:u,frameRate:isNaN(a)?0:Math.round(a),frameWidth:r.frameWidth,frameHeight:r.frameHeight,timestamp:v,netquality:L.Utils.getNetLevel(s,u),googFirsCount:l,googPlisCount:p},audio:{audioBytesSent:Number(M),bitsPerSecond:isNaN(Z)?0:Math.round(Z),packetsLost:isNaN(C)?0:C,totalPackets:isNaN(D)?0:D,packetsLostRate:U,currentDelay:O,jitter:isNaN(P)?0:P,timestamp:V,netquality:L.Utils.getNetLevel(U,O)}};return 100<=$.video.packetsLostRate&&($.video.packetsLostRate=100),e.networkStatus=$}}(i,e);if(t)L.Utils.isFunction(o)&&o(t),ct(i,t);else{if(r)return L.Logger.warning(R,"[tk-sdk]pc.getStats ->not get data!"),void(L.Utils.isFunction(n)&&n("TK_ERR_UNKNOWN"));at(i,o,n,!0)}},function(e){L.Logger.warning(R,"[tk-sdk]pc.getStats fail,fail info:",e),L.Utils.isFunction(n)&&n(e)})}catch(e){L.Logger.error(R,"[tk-sdk]pc.getStats error:",e),L.Utils.isFunction(n)&&n("TK_ERR_UNKNOWN")}else L.Utils.isFunction(n)&&n("TK_ERR_NOT_PEERCONNECTION")}function st(e){var t=void 0;for(var i in D._createStreams)e===i&&(t=Ue(i));if(!t)for(var i in N.remoteStreams)e===i&&(t=N.remoteStreams[i]);return t}function dt(e,t,i){if(e&&st(e)&&"object"===Ft(t))if(D._nativeStatsDelivered[e]=D._nativeStatsDelivered[e]||{},D._nativeStatsDelivered[e].video=D._nativeStatsDelivered[e].video||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,frameRate:0,frameWidth:0,frameHeight:0,timestamp:0,netquality:L.Utils.getNetLevel(0,0)},D._nativeStatsDelivered[e].audio=D._nativeStatsDelivered[e].audio||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,jitter:0,timestamp:0,netquality:L.Utils.getNetLevel(0,0)},i){var o=(t.packetsLost-D._nativeStatsDelivered[e].video.packetsLost)/(t.totalPackets-D._nativeStatsDelivered[e].video.totalPackets)*100;for(var n in D._nativeStatsDelivered[e].video.packetsLostRate=isNaN(o)?0:Math.round(o)<=100?Math.round(o):100,t)"timeStamp"===n?D._nativeStatsDelivered[e].video.timestamp=t[n]:"netQuality"===n?D._nativeStatsDelivered[e].video.netquality=t[n]:D._nativeStatsDelivered[e].video[n]=t[n]}else{var r=(t.packetsLost-D._nativeStatsDelivered[e].audio.packetsLost)/(t.totalPackets-D._nativeStatsDelivered[e].audio.totalPackets)*100;for(var n in D._nativeStatsDelivered[e].audio.packetsLostRate=isNaN(r)?0:Math.round(r)<=100?Math.round(r):100,t)"timeStamp"===n?D._nativeStatsDelivered[e].audio.timestamp=t[n]:"netQuality"===n?D._nativeStatsDelivered[e].audio.netquality=t[n]:D._nativeStatsDelivered[e].audio[n]=t[n]}else!st(e)&&D._nativeStatsDelivered[e]&&(D._nativeStatsDelivered[e]=void 0,delete D._nativeStatsDelivered[e])}function ct(e,t){t&&t.video&&J.hasOwnProperty(e.publisherId())&&(t.video.kartunCount=J[e.publisherId()]),e.networkStatus=t;var i={userId:e.publisherId(),type:e.getAttributes().type,networkStatus:t};switch(e.getAttributes().type){case TK.STREAM_VIDEO:if(new RegExp(e.publisherId()+":","g").test(e.extensionId)){var o=lt(e);i.deviceId=o}var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserNetworkStateChanged,message:i},!1);N.dispatchEvent(n,!1);break;case TK.STREAM_MEDIA:case TK.STREAM_FILE:case TK.STREAM_SCREEN:n=TK.RoomEvent({type:"room-"+e.getAttributes().type+"networkstate-changed",message:i},!1);N.dispatchEvent(n,!1)}}function ut(e,t){if(e&&t&&(L.Logger.debug(R,"[tk-sdk]Process Signaling Message:",L.Utils.toJsonStringify(e)),e.sdp&&"answer"===e.type)){var i=e.sdp,o=i.indexOf("udp");if(-1!==o){var n="";t&&(n+="stream sdp info:stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())+". \n"),n+="udp info:"+(window.__TkSdkBuild__?L.Utils.encrypt(i.substr(o,58)):i.substr(o,58)),L.Logger.info(R,n)}TK.isHiFi&&(e.sdp=L.Utils.setHiFiToSdp(e.sdp)),e.sdp=L.Utils.setMaxBWToSdp(e.sdp),L.Logger.debug(R,"[tk-sdk]Set remote and local description"),L.Logger.debug(R,"[tk-sdk]Remote Description",e.sdp),O.setRemoteDescription(t.getID(),e)}}function lt(e){if(e.publisherId()===Re()&&e.videoinputDeviceId)return e.videoinputDeviceId;var t=new RegExp(e.publisherId()+":","g");return t.test(e.extensionId)?e.extensionId.replace(t,""):""}function pt(e,t){if(e.id===Re())return TK.isMultiCamera?e["publishstate:"+t]||TK.PUBLISH_STATE_NONE:e.publishstate||TK.PUBLISH_STATE_NONE;var i="publishstate";return t&&(i+=":"+t),e[i]||TK.PUBLISH_STATE_NONE}function ft(e){return TK.isMultiCamera?D._myself["publishstate:"+e]||TK.PUBLISH_STATE_NONE:D._myself.publishstate||TK.PUBLISH_STATE_NONE}function mt(){return D._myself.tk_screenstate||TK.SCREENSTATE_OFF}function gt(){return D._myself.tk_mediafilestate||TK.MEDIAFILESTATE_OFF}function vt(e,t){t=t||e;var i=ft(e.videoinputDeviceId);i===TK.PUBLISH_STATE_NONE&&N.remoteStreams[e.getID()]?tt(e):i>TK.PUBLISH_STATE_NONE&&tt(e,function(){i>TK.PUBLISH_STATE_NONE&&(ue(t,!1),le(t,!1),et(t))})}function ht(e,t){for(var i=Ae(TK.STREAM_VIDEO),o=0,n=i.length;o<n;o++){var r=i[o];e===L.Constant.deviceStorage.videoinput?TK.isMultiCamera||void 0!==t&&t!==r.videoinputDeviceId&&Tt(r,t):e===L.Constant.deviceStorage.audioinput&&void 0!==t&&t!==r.audioinputDeviceId&&yt(r,t)}}function Tt(t,i,e,o){if(i!==t.videoinputDeviceId||e){var n=ft(t.videoinputDeviceId);if(TK.isMultiCamera&&i!==t.videoinputDeviceId){if(n===TK.PUBLISH_STATE_NONE&&N.remoteStreams[t.getID()])tt(t);else if(n>TK.PUBLISH_STATE_NONE){var r=Ce(i,!0);vt(t,r)}}else{O.hasConnection(t.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn||t.removeVideoTrack();var a=t.videoinputDeviceId;t.videoinputDeviceId=i,D._playVideoStreams[t.extensionId]||n>TK.PUBLISH_STATE_NONE?TK.DeviceMgrImpl.getVideoTrack(i,function(e){t.removeVideoTrack(),t.addVideoTrack(e),n===TK.PUBLISH_STATE_NONE&&N.remoteStreams[t.getID()]?tt(t):O.hasConnection(t.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn?O.replaceVideoTrack(t.getID(),e):vt(t),Pe(t.extensionId)&&Oe(t.extensionId),a!==i&&O.destroyVideoTrack(a)},function(e){L.Logger.info(R,"[tk-sdk]updateStreamVideoinputDeviceId:getDeviceVideoTrack fail,fain info is "+L.Utils.toJsonStringify(e)+",stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),Nt(e,"videoinput",i)}):n===TK.PUBLISH_STATE_NONE&&N.remoteStreams[t.getID()]&&tt(t)}}}function yt(t,i,e){if(i!==t.audioinputDeviceId||e){var o=ft(t.videoinputDeviceId);O.hasConnection(t.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn||t.removeAudioTrack(),t.audioinputDeviceId=i,D._playAudioStreams[It(t.publisherId(),t.getAttributes().type)]||D._registerAudioVolumeListeners[It(t.publisherId(),t.getAttributes().type)]||o>TK.PUBLISH_STATE_NONE?TK.DeviceMgrImpl.getAudioTrack(i,function(e){t.removeAudioTrack(),t.addAudioTrack(e),o===TK.PUBLISH_STATE_NONE&&N.remoteStreams[t.getID()]?tt(t):O.hasConnection(t.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!TK.customStreamFn?O.replaceAudioTrack(t.getID(),e):vt(t),Pe(t.extensionId)&&Oe(t.extensionId),O.destroyAudioTrack(t.audioinputDeviceId)},function(e){L.Logger.info(R,"[tk-sdk]updateStreamAudioinputDeviceId:getDeviceAudioTrack fail,fain info is "+L.Utils.toJsonStringify(e)+",stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),Nt(e,"audioinput",i)}):o===TK.PUBLISH_STATE_NONE&&N.remoteStreams[t.getID()]&&tt(t)}}function _t(e,t){if(!TK.isMultiCamera)return L.Logger.warning(R,"[tk-sdk]set main camera is fail,not in a multi-camera environment!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_IN_MULTI_CAMERA_ENVIRONMENT"));if(L.Utils.isVideoinputDeviceIdFromDeviceList(e))if(D._mainCameraDeviceId!==e){var i=D._mainCameraDeviceId;D._isConnected&&D._myself.tk_maincamera!==e&&N.changeUserProperty(Re(),"__all",{tk_maincamera:e});var o=(r=i,(a=TK.isMultiCamera?ft(r):D._myself.publishstate)===TK.PUBLISH_STATE_AUDIOONLY||a===TK.PUBLISH_STATE_BOTH);o&&N.unpublishAudio();i=D._mainCameraDeviceId;D._mainCameraDeviceId=e,L.Logger.info(R,"[tk-sdk]change myself main camera device id,my id is "+Re()+",change device id is "+D._mainCameraDeviceId+",old device id is "+i),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,D._mainCameraDeviceId),o&&N.publishAudio(),D._registerAudioVolumeListeners[It(Re(),TK.STREAM_VIDEO)]&&(Ce(i)&&Ce(i).stopIntervalGetRealtimeVolume(),Ce(D._mainCameraDeviceId)&&Ce(D._mainCameraDeviceId).startIntervalGetRealtimeVolume());var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:Re()!==D._local_def_ext_id?Re():"",deviceId:D._mainCameraDeviceId}});N.dispatchEvent(n)}else D._isConnected&&D._myself.tk_maincamera!==D._mainCameraDeviceId&&N.changeUserProperty(Re(),"__all",{tk_maincamera:D._mainCameraDeviceId});else L.Logger.warning(R,"[tk-sdk]set main camera is fail,the device id("+e+") is not in the video device list!"),L.Utils.isFunction(t)&&t("TK_ERR_DEVICE_ID_NOT_LIST");var r,a}function kt(e,t){var i=e.split(":");if(!i.length)return e;if(2==(t=t||0))return"tksmall"===i[1]?i[1]:"tksmall"===i[2]?i[2]:e;if(i[t]){if("tksmall"===i[t])return;return i[t]}}function Lt(e){var t=e.split(":");if(t.length){var i=e;return t.forEach(function(e){/tksmall/.test(e)||(i=e)}),i}}function e(e,t,i,o,n,r,a){if(bt(o,!0)){if(D._isLeaveRoom=!1,L.Utils.isNull(e)||L.Utils.isNull(t)||L.Utils.isNull(i)||"object"!==Ft(i))return L.Logger.error(R,"[tk-sdk] startPlayback function got wrong arguments"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));D._roomJsonOptions={},D._userJsonOptions=D._userJsonOptions||{},D._userJsonOptions.userProperties={},D._roomJsonOptions.video=!0,D._roomJsonOptions.audio=!0,D._roomJsonOptions.autoServer=!L.Utils.isBoolean(i.autoServer)||i.autoServer,D._testIP=n,D._testPort=r,L.Logger.info(R,"[tk-sdk]call startPlayback start!");var s=!1,d=!1,c=!1,u=D._web_host;ne(e,D._webInterfaceHtmlPort,function(e){s=!0,0===e&&(u=L.Utils.replaceHostname(D._web_host,D._serverName)),s&&d&&!c&&(c=!0,ze(u))}),function(e,t,i,o,n,r){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _initPlaybackInfo cannot be executed!");else{var a=function(){if(void 0===i.roomtype||void 0===i.serial||void 0===i.recordfilepath)return L.Logger.error(R,"[tk-sdk]The params must be included [roomtype , serial , recordfilepath] ! "),void(L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"));b({web_host:e,web_port:t}),i.recordfilepath=/\//g.test(i.recordfilepath.charAt(i.recordfilepath.length-1))?i.recordfilepath:i.recordfilepath+"/",TK.isPlayback=!0,D._recordfilepath=i.recordfilepath,D._isGetFileList=!1,ke({result:0,room:{roomtype:i.roomtype,maxvideo:void 0!==i.maxvideo?i.maxvideo:1e6,roomrole:-1,serial:i.serial,roomname:i.roomname||"Play Back",recordfilepath:i.recordfilepath,domain:i.domain,host:i.host||e,companyid:i.companyid||-1}},function(e,t,i){0===e&&o&&"function"==typeof o&&o(e,t,i)})};if(n)a();else{if(!i.recordfilepath)return L.Logger.error(R,"[tk-sdk]params.recordfilepath is required !"),L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG");b({web_host:e,web_port:t}),i.recordfilepath=/\//g.test(i.recordfilepath.charAt(i.recordfilepath.length-1))?i.recordfilepath:i.recordfilepath+"/",TK.isPlayback=!0,D._recordfilepath=i.recordfilepath,D._isGetFileList=!1,L.Logger.info(R,"[tk-sdk]initPlaybackInfo to checkroom start , params is "+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(i)):L.Utils.toJsonStringify(i))+"!");var s=i.recordfilepath,d=new RegExp(/:[0-9]{1,6}\//);d.test(s)&&(s=s.replace(d,"/")),0===s.indexOf("http")&&0!==s.indexOf("https")&&(s=s.replace(/http/,"https"));var c=s+"room.json";L.Utils.sdkAjax({url:c,dataType:"json",type:"GET",async:!0,success:function(e){L.Logger.debug(R,"[tk-sdk]getPlaybackRoomJson resp = ",L.Utils.toJsonStringify(e)),e&&"object"===Ft(e)?ke(e,function(e,t,i){0===e?o&&"function"==typeof o&&o(e,t,i):a()}):(L.Logger.error(R,"[tk-sdk]getPlaybackRoomJson resp must is json , call oldInitPlaybackInterface handler!"),a())},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]getPlaybackRoomJson fail[ XHR , textStatus , errorThrown ]:",e,t,i),a()}})}}}(e,t,i,function(e,t,i){d=!0;var o=TK.RoomEvent({type:TK.EVENT_TYPE.roomCheckroomPlayback,message:{ret:e,userinfo:t,roominfo:i}});if(N.dispatchEvent(o),0===e)s&&d&&!c&&(c=!0,ze(u));else{var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"checkroom playback",error:e,errorCode:e}});if(N.dispatchEvent(n),G.checkRoomPlaybackCount++,5<=G.checkRoomPlaybackCount){var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"checkroom playback",error:e,errorCode:e}},{httpTime:Date.now()-B,socketTime:0,reconnectCount:F,isReconnect:q&&0<F});N.dispatchEvent(r)}}},a,o)}}function t(e,t){if(bt(t,!0))return TK.isPlayback?L.Utils.isBoolean(e)?void(e?P.socketSend("pausePlayback"):P.socketSend("Playback")):(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk] pausePlayback function got wrong arguments")):(L.Logger.warning(R,"[tk-sdk]No playback environment!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_PLAYBACK_ENVIRONMENT")))}function bt(e,t){return!!m||(t&&L.Logger.error(R,"[tk-sdk]The room is not initialized and cannot execute methods on the room class. Please call the init method for initialization!"),L.Utils.isFunction(e)&&e("TK_ERR_ROOM_NOT_INIT"),!1)}function St(e,t){return!!D._isConnected||(t&&L.Logger.error(R,"[tk-sdk]The room has not been successfully connected yet. Please try again after the connection is successful!"),L.Utils.isFunction(e)&&e("TK_ERR_ROOM_NOT_CONNECTED",window.TK_ERR.ROOM_NOT_CONNECT),!1)}function wt(e,t,i){return t===TK.STREAM_VIDEO?e===Re()?TK.isMultiCamera?e+":"+i:e:i?e+":"+i:e:e+":"+t}function It(e,t){return e+":"+t}function Et(e){return"publishstate"===e?"":/publishstate:/g.test(e)?e.replace(/publishstate:/g,""):""}function At(e,t,i,o,n,r){if(o=o||{},i===TK.STREAM_MEDIA||i===TK.STREAM_SCREEN||t!==Re()){if(O.hasConnection(e)){var a=O.getConnectionVideoTrack(e);a?L.Utils.isFunction(n)&&n(a):L.Utils.isFunction(r)&&r("TK_ERR_NOT_VIDEOTRACK")}else L.Utils.isFunction(r)&&r("TK_ERR_NOT_PEERCONNECTION")}else i===TK.STREAM_VIDEO&&o.videoinputDeviceId?TK.DeviceMgrImpl.getVideoTrack(o.videoinputDeviceId,function(e){L.Utils.isFunction(n)&&n(e),o.extensionId&&Pe(o.extensionId)&&Oe(o.extensionId)},function(e){Nt(e,"videoinput",o.videoinputDeviceId),L.Utils.isFunction(r)&&r(e)}):L.Utils.isFunction(r)&&r("TK_ERR_NOT_VIDEOTRACK")}function Rt(e,t,i,o,n,r){if(i===TK.STREAM_MEDIA||t!==Re())if(O.hasConnection(e)){var a=O.getConnectionAudioTrack(e);a?L.Utils.isFunction(n)&&n(a):L.Utils.isFunction(r)&&r("TK_ERR_NOT_AUDIOTRACK")}else L.Utils.isFunction(r)&&r("TK_ERR_NOT_PEERCONNECTION");else i===TK.STREAM_VIDEO&&o.audioinputDeviceId?TK.DeviceMgrImpl.getAudioTrack(o.audioinputDeviceId,function(e){L.Utils.isFunction(n)&&n(e),o.extensionId&&Pe(o.extensionId)&&Oe(o.extensionId)},function(e){Nt(e,"audioinput",o.audioinputDeviceId),L.Utils.isFunction(r)&&r(e)}):L.Utils.isFunction(r)&&r("TK_ERR_NOT_AUDIOTRACK")}function Ct(e,t){return D._registerAudioVolumeListeners[It(e,t)]}function Dt(e){var t="";if(e===Re())TK.isMultiCamera&&(t=D._mainCameraDeviceId);else{var i=D._users[e];i&&void 0!==i.tk_maincamera&&(t=i.tk_maincamera)}return t}function Nt(e,t,i){if(i){var o=void 0,n="",r={};if("object"===Ft(e))for(var a in n=e.name,e)"code"!==a&&"name"!==a&&"message"!==a||(r[a]=e[a]);var s=L.Utils.getUserMediaFailCode(n);"TypeError"===n&&(o={causeCode:window.TK_ERR.DEVICE_ERROR_TypeError,causeInfo:r}),L.Logger.info(R,"[tk-sdk]device-not-available , error code is "+s+"  , kind is "+t+" , deviceId is "+i+",errorInfo:"+L.Utils.toJsonStringify(r));var d={kind:t,deviceId:i};o&&(d.detailsInfo=o);var c=TK.RoomEvent({type:TK.EVENT_TYPE.deviceNotAvailable,message:d},{code:s});N.dispatchEvent(c)}}function Ut(e,t,i){if(t!==window.TK.ERROR_NOTICE.ERR_PUBLISH_FAILED||(e.publishFailCount++,e.publishFailCount%k==0)){var o={userId:e.publisherId(),type:e.getAttributes().type,source:i};if(TK.isMultiCamera&&e.getAttributes().type===TK.STREAM_VIDEO){var n=lt(e);o.deviceId=n}var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomErrorNotice,message:{code:t,info:o}},{errorCode:t,errorInfo:o});r&&N.dispatchEvent&&N.dispatchEvent(r)}}function Pt(e,t,i){if(t!==window.TK.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED||(e.subscribeFailCount++,e.subscribeFailCount%k==0)){var o={userId:e.publisherId(),type:e.getAttributes().type,source:i};if(e.getAttributes().type===TK.STREAM_VIDEO)if(new RegExp(e.publisherId()+":","g").test(e.extensionId)){var n=lt(e);o.deviceId=n}var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomErrorNotice,message:{code:t,info:o}},{errorCode:t,errorInfo:o});r&&N.dispatchEvent&&N.dispatchEvent(r)}}function Ot(){for(var e in D._playVideoStreams){if((r=(n=D._playVideoStreams[e]).publisherId())!==Re()){var t=e.replace(new RegExp(r,"g"),Re());D._createStreams[e]||D._playAudioStreams[It(n.publisherId(),n.getAttributes().type)]||L.Utils.isFunction(n.updateExtensionId)&&n.updateExtensionId(t),D._playVideoStreams[t]=n,D._playVideoStreams[e]=void 0,delete D._playVideoStreams[e]}}for(var i in D._playAudioStreams){e=(n=D._playAudioStreams[i]).extensionId;if((r=n.publisherId())!==Re()){var o=i.replace(new RegExp(r,"g"),Re());D._createStreams[e]||L.Utils.isFunction(n.updateExtensionId)&&n.updateExtensionId(t),D._playAudioStreams[o]=n,D._playAudioStreams[i]=void 0,delete D._playAudioStreams[i]}}for(var e in D._createStreams){var n,r;if((r=(n=D._createStreams[e]).publisherId())!==Re()){t=e.replace(new RegExp(r,"g"),Re());L.Utils.isFunction(n.updateExtensionId)&&n.updateExtensionId(t),D._createStreams[t]=n,D._createStreams[e]=void 0,delete D._createStreams[e]}}}function Kt(e){if(e){if(e.publisherId()!==Re()||e.publisherId()===Re()&&e.getAttributes().type===TK.STREAM_MEDIA){e.stopIntervalGetRealtimeVolume();var t=D._registerAudioVolumeListeners[It(e.publisherId(),e.getAttributes().type)];t&&(t.onSuccess=void 0,t.onFailure=void 0,t.interval=100,t.isWaiting=!1,D._registerAudioVolumeListeners[It(e.publisherId(),e.getAttributes().type)]=void 0,delete D._registerAudioVolumeListeners[It(e.publisherId(),e.getAttributes().type)])}D._nativeStatsDelivered[e.extensionId]=void 0,delete D._nativeStatsDelivered[e.extensionId]}}function Mt(e){var t=!1;for(var i in e)if(D._sdkUserProperty.hasOwnProperty(i)||/publishstate:/g.test(i)){t=!0;break}return t}function xt(){try{return talkrecoder}catch(e){return null}}return o(),TK.networkTestInfo.isConnectRoom=D._isConnected,N.remoteStreams={},N.localStreams={},N.init=function(e,o,t,i,n){if(L.Logger.debug(R,"[tk-sdk] room-sdk initializing."),m)return L.Logger.error(R,"[tk-sdk]Already initialized,can the uninit method first if you need to initialize again!"),void(L.Utils.isFunction(t)&&t("TK_ERR_ALREADY_INIT"));n=n||{};var r=!!L.Utils.isBoolean(n.isEncryption)&&n.isEncryption,a=!!L.Utils.isBoolean(n.tk_invalidappkey)&&n.tk_invalidappkey;if(!a){if(L.Utils.isNull(e))return L.Logger.error(R,"[tk-sdk] the appKey can not be empty when initializing room-sdk"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));if(r){if(!L.Utils.isFunction(n.onDecode))return L.Logger.error(R,"[tk-sdk]Cipher decode algorithm function can't be empty, please introduced to encryption function configuration items (option.onDecode)!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_DECODE_ALGORITHM_FUNCTION"));e=n.onDecode(e)}window.TK.MD5&&L.Utils.isFunction(window.TK.MD5)?h=window.TK.MD5(e):(L.Logger.error(R,"[tk-sdk]Encryption method missing, please check if an encrypted file is introduced,please link MD5,for example: window.TK.MD5 = md5"),L.Utils.isFunction(t)&&t("TK_ERR_NOT_MD5_ENCRYPT")),T=e}_=!!L.Utils.isBoolean(n.tk_question_compatibility)&&n.tk_question_compatibility,i=!L.Utils.isBoolean(i)||i,s.autoSubscribeAV=void 0!==n.autoSubscribeAV?n.autoSubscribeAV:s.autoSubscribeAV,D._isGetFileList=!!L.Utils.isBoolean(n.isGetFileList)&&n.isGetFileList,TK.isMultiCamera=!!L.Utils.isBoolean(n.tk_multistream)&&n.tk_multistream,D._useServerScreenRecording=!!L.Utils.isBoolean(n.useServerScreenRecording)&&n.useServerScreenRecording,n.tk_use_secure_socket=!L.Utils.isBoolean(n.tk_use_secure_socket)||n.tk_use_secure_socket,c=L.Utils.isNumber(n.tk_max_reconnect_count)?n.tk_max_reconnect_count:void 0,D.isTkInvalidAppkey=a,D._tk_room_test_sdk=!!L.Utils.isBoolean(n.tk_room_test_sdk)&&n.tk_room_test_sdk,n.useHttpProtocol&&(n.tk_use_secure_socket=!1),n.tk_use_secure_socket?(D._web_protocol="https",D._doc_protocol="https",D._socket_protocol="https",D._backup_doc_protocol="https",D._webInterfaceHtmlPort=8080):(D._web_protocol="http",D._doc_protocol="http",D._socket_protocol="http",D._backup_doc_protocol="http",D._webInterfaceHtmlPort=81),n.tk_host&&(D.tk_host=n.tk_host||"global.talk-cloud.net"),n.tk_port&&(D.tk_port=n.tk_port||(n.tk_use_secure_socket?443:80)),O.getDeviceMgr().getDevices(function(e){var t=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);t&&(TK.isTkNative?O.getDeviceMgr().setDevices({audiooutput:t}):O.getDeviceMgr().associateElementsToSpeaker(void 0,t)),n&&!1!==n.isCheckDevice&&O.checkDeviceAvailability(e,function(){var e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);if(e&&(TK.isTkNative?O.getDeviceMgr().setDevices({audiooutput:e}):O.getDeviceMgr().associateElementsToSpeaker(void 0,e)),TK.isMultiCamera&&!D._mainCameraDeviceId){var t=D._mainCameraDeviceId;D._mainCameraDeviceId=Te(),L.Logger.info(R,"[tk-sdk]change myself main camera device id,my id is "+Re()+",change device id is "+D._mainCameraDeviceId+",old device id is "+t);var i=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:Re()!==D._local_def_ext_id?Re():"",deviceId:D._mainCameraDeviceId}});N.dispatchEvent(i)}m=!0,L.Utils.isFunction(o)&&(o(),window.onunload=function(){N.uninit()})},{findAvailabilityDevice:!!L.Utils.isBoolean(n.findAvailabilityDevice)&&(!TK.isTkNative&&n.findAvailabilityDevice),onVideoSuccess:function(){var e=TK.RoomEvent({type:TK.EVENT_TYPE.deviceSuccess,message:{kind:"videoinput"}});N.dispatchEvent(e)},onAudioSuccess:function(){var e=TK.RoomEvent({type:TK.EVENT_TYPE.deviceSuccess,message:{kind:"audioinput"}});N.dispatchEvent(e)},onVideoFailure:function(e){if(e&&"object"===Ft(e)){var t="object"===Ft(e)&&e.name,i=L.Utils.getUserMediaFailCode(t),o=TK.RoomEvent({type:TK.EVENT_TYPE.deviceFailure,message:{kind:"videoinput"}},{code:i});N.dispatchEvent(o)}},onAudioFailure:function(e){if(e&&"object"===Ft(e)){var t="object"===Ft(e)&&e.name,i=L.Utils.getUserMediaFailCode(t),o=TK.RoomEvent({type:TK.EVENT_TYPE.deviceFailure,message:{kind:"audioinput"}},{code:i});N.dispatchEvent(o)}}})},{isSetlocalStorage:!0})},N.uninit=function(e,t){m&&N.leaveroom(),function(){for(var e in D._createStreams)Oe(e);O.destroyAllVideoTrack(),O.destroyAllAudioTrack()}(),TK.isPlayback=!1,TK.isMultiCamera=!1,m=!1,T=h="",c=void 0,F=-1,v=null,B=V=M=x=0,o(),TK.networkTestInfo.isConnectRoom=D._isConnected,Ot(),L.Utils.isFunction(e)&&e()},N.checkInit=function(e,t){return bt(e,t)},N.setLogIsDebug=function(e,t,i){i=i||!1;var o={debug:e=e||!1},n={development:e,logLevel:void 0!==t&&"number"==typeof t?t:e?L.Constant.LOGLEVEL.DEBUG:L.Constant.LOGLEVEL.INFO},r={webrtcLogDebug:e};TK.tkLogPrintConfig(o,n,r),L.Logger.setIsFormatLog(i)},N.registerLogListener=function(e){L.Logger.registerLogListener(e)},N.getFileList=function(){return D._room_filelist},N.getFileinfo=function(e){for(var t=void 0,i=0,o=D._room_filelist.length;i<o;i++)if(D._room_filelist[i]&&D._room_filelist[i].fileid==e){t=D._room_filelist[i];break}return t},N.getDeviceMgr=function(){return O.getDeviceMgr()},N.getRoomProperties=function(){return D._room_properties},N.getMySelf=function(){return D._myself},N.getUser=function(e){return void 0===e?void 0:D._users[e]},N.getUsers=function(){return D._users},N.takePhoto=function(e,t,i){if(t){var o=Ee(t,TK.STREAM_VIDEO,i);if(o)return o.getVideoFrameURL(e)}return null},N.changeUserPropertyByRole=function(e,t,i){if(bt(void 0,!0)&&St(void 0,!0))if(Array.isArray(e))if("object"===Ft(i)){var o={roles:e};N.changeUserProperty(o,t,i)}else L.Logger.error(R,"[tk-sdk]changeUserPropertyByRole properties params must is json !");else L.Logger.error(R,"[tk-sdk]changeUserPropertyByRole roles params must is array!")},N.batchChangeUserProperty=function(e,t,i){if(bt(void 0,!0)&&St(void 0,!0))if(Array.isArray(e))if("object"===Ft(i)){if(D._roomMode!==window.TK.ROOM_MODE.BIG_ROOM)for(var o=e.length-1;0<=o;o--)e[o]&&!D._users[e[o]]&&(L.Logger.warning(R,"[tk-sdk]batchChangeUserProperty:user is not exist, user id: "+e[o]+" !"),e.splice(o,1));var n={ids:e};N.changeUserProperty(n,t,i)}else L.Logger.error(R,"[tk-sdk]batchChangeUserProperty properties params must is json !");else L.Logger.error(R,"[tk-sdk]batchChangeUserProperty ids params must is array!")},N.changeUserProperty=function(e,t,i){if(bt(void 0,!0)&&St(void 0,!0))if(void 0!==i&&void 0!==e)if("object"===Ft(i)){if(TK.isOnlyAudioRoom)for(var o in i)("publishstate"===o||/publishstate:/g.test(o))&&(i[o]!==TK.PUBLISH_STATE_VIDEOONLY&&i[o]!==TK.PUBLISH_STATE_BOTH||delete i[o]);var n={};if(n.id=e,n.toID=t||"__all",i.hasOwnProperty("id")&&(L.Logger.warning(R,"[tk-sdk]Method changeUserProperty cannot modify the id properties"),delete i.id),n.properties=i,"object"===Ft(e)){if(e.hasOwnProperty("ids")&&Array.isArray(e.ids))for(var r in e.ids)if(e.ids[r]===Re()){for(var o in i)"publishstate"===o||/publishstate:/g.test(o)?D._myself[o]=i[o]:"tk_maincamera"===o?D._myself[o]=i[o]:"tk_screenstate"===o?D._myself[o]=i[o]:"tk_mediafilestate"===o&&(D._myself[o]=i[o]);Mt(i)&&L.Logger.info(R,"[tk-sdk]change myself property,my id is "+Re()+",change property:"+L.Utils.toJsonStringify(i))}if(e.hasOwnProperty("roles")&&Array.isArray(e.roles))for(var r in e.roles)if(e.roles[r]===D._myself.role){for(var o in i)"publishstate"===o||/publishstate:/g.test(o)?D._myself[o]=i[o]:"tk_maincamera"===o?D._myself[o]=i[o]:"tk_screenstate"===o?D._myself[o]=i[o]:"tk_mediafilestate"===o&&(D._myself[o]=i[o]);Mt(i)&&L.Logger.info(R,"[tk-sdk]change myself property,my id is "+Re()+",change property:"+L.Utils.toJsonStringify(i))}}else{if(D._roomMode!==window.TK.ROOM_MODE.BIG_ROOM&&!D._users[e])return void L.Logger.error(R,"[tk-sdk]changeUserProperty:user is not exist , user id: "+e+"!");if(e===Re()){for(var o in i)"publishstate"===o||/publishstate:/g.test(o)?D._myself[o]=i[o]:"tk_maincamera"===o?D._myself[o]=i[o]:"tk_screenstate"===o?D._myself[o]=i[o]:"tk_mediafilestate"===o&&(D._myself[o]=i[o]);Mt(i)&&L.Logger.info(R,"[tk-sdk]change myself property,my id is "+Re()+",change property:"+L.Utils.toJsonStringify(i))}}L.Utils.getJsonLength(n.properties)&&P.sendMessageSocket("setProperty",n)}else L.Logger.error(R,"[tk-sdk]changeUserProperty properties must is json !");else L.Logger.error(R,"[tk-sdk]changeUserProperty properties or id is not exist!")},N.sendMessage=function(e,t,i){if(bt(void 0,!0)&&St(void 0,!0)){var o={};t=t||"__all",o.toID=t;var n={};if("string"==typeof e){var r=L.Utils.toJsonParse(e);"object"!==Ft(r)&&(r=e),e=r}if("object"===Ft(e))for(var a in e)n[a]=e[a];else n.msg=e;if("string"==typeof i&&(i=L.Utils.toJsonParse(i)),i&&"object"===Ft(i))for(var a in i)n[a]=i[a];o.message=L.Utils.toJsonStringify(n),P.sendMessageSocket("sendMessage",o)}},N.pubMsg=function(e){if(bt(void 0,!0)&&St(void 0,!0))if("object"===Ft(e)){var t={};t.name=e.name||e.msgName,t.id=e.id||e.msgId||t.name,t.toID=e.toID||e.toId||"__all",t.data=e.data,e.save||(t.do_not_save=""),void 0!==e.associatedMsgID&&(t.associatedMsgID=e.associatedMsgID),void 0!==e.associatedUserID&&(t.associatedUserID=e.associatedUserID);var i={};for(var o in e)void 0===t[o]&&void 0!==e[o]&&"save"!==o&&"name"!==o&&"msgName"!==o&&"id"!==o&&"msgId"!==o&&"toID"!==o&&"toId"!==o&&"data"!==o&&"associatedMsgID"!==o&&"associatedUserID"!==o&&(i[o]=e[o]);for(var o in i)void 0===t[o]&&"save"!==o&&(t[o]=i[o]);if(void 0!==t.name&&null!==t.name){if("DocumentChange"===t.name&&"__allExceptSender"===t.toID){var n=L.Utils.toJsonParse(L.Utils.toJsonStringify(t));n.fromID=Re(),n&&n.data&&"string"==typeof n.data&&(n.data=L.Utils.toJsonParse(n.data)),je(n)}P.sendMessageSocket("pubMsg",t)}else L.Logger.error(R,"[tk-sdk]pubMsg name is must exist!")}else L.Logger.error(R,"[tk-sdk]pubMsg params must is json!")},N.delMsg=function(e){if(bt(void 0,!0)&&St(void 0,!0))if("object"===Ft(e)){var t,i,o,n;n=1===arguments.length&&e&&"object"===Ft(e)?(t=e.name||e.msgName,i=e.id||e.msgId,o=e.toID||e.toId,e.data):(t=e,i=arguments[1],o=arguments[2],arguments[3]);var r={};r.name=t,r.id=i||r.name,r.toID=o||"__all",r.data=n||{},void 0!==r.name&&null!==r.name?void 0!==r.id&&null!==r.id?P.sendMessageSocket("delMsg",r):L.Logger.error(R,"[tk-sdk]delMsg id is must exist!"):L.Logger.error(R,"[tk-sdk]delMsg name is must exist!")}else L.Logger.error(R,"[tk-sdk]delMsg params must is json!")},N.evictUser=function(e,t){if(bt(void 0,!0)&&St(void 0,!0)){L.Logger.info(R,"[tk-sdk]evictUser",e);var i={};if(i.id=e,t&&"object"===Ft(t))for(var o in t)i[o]=t[o];P.sendMessageSocket("evictParticipant",i)}},N.joinroom=function(e,t,i,o,n,r,a,s){if(bt(void 0,!0))if(D._isLeaveRoom)if(D._isConnected)L.Logger.warning(R,"[tk-sdk]Room already connected!");else{F=-1,V=x=M=0,B=Date.now(),e=e||"global.talk-cloud.net",t=t||(/https/g.test(D._web_protocol)?443:80),L.Logger.info(R,"[tk-sdk]call joinroom start!"),D._myself={id:""},Ot(),D._isLeaveRoom=!1,D._webReconnectNumList={},b({web_host:e,web_port:t}),D._roomJsonOptions="object"===Ft(n)?n:{},D._userJsonOptions=D._userJsonOptions||{},D._userJsonOptions.userProperties=r||{},D._roomJsonOptions.video=!0,D._roomJsonOptions.audio=!0,D._roomJsonOptions.autoServer=!L.Utils.isBoolean(D._roomJsonOptions.autoServer)||D._roomJsonOptions.autoServer,D._testIP=a,D._testPort=s;var d={serial:D._roomJsonOptions.serial,password:D._roomJsonOptions.password||""};D.isTkInvalidAppkey||(d.version=1,d.authkey=h,d.key=T),i&&(d.nickname=i);var c=!1,u=!1,l=!1,p=D._web_host;ne(e,D._webInterfaceHtmlPort,function(e){c=!0,0===e&&(p=L.Utils.replaceHostname(D._web_host,D._serverName)),c&&u&&!l&&(l=!0,ze(p))}),D._roomJsonOptions.checkroomParamsUrl&&!D.isTkInvalidAppkey&&(D._roomJsonOptions.checkroomParamsUrl+="&version=1&authkey="+h+"&key="+T),nt(e,t,D._roomJsonOptions.checkroomParamsUrl?D._roomJsonOptions.checkroomParamsUrl:d,function(e,t,i){u=!0;var o=TK.RoomEvent({type:TK.EVENT_TYPE.roomCheckroom,message:{ret:e,userinfo:t,roominfo:i}});if(N.dispatchEvent(o),0===e)c&&u&&!l&&(l=!0,ze(p));else{var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"checkroom",error:e,errorCode:e}});if(N.dispatchEvent(n),G.checkRoomCount++,5<=G.checkRoomCount){var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"checkroom",error:e,errorCode:e}},{httpTime:Date.now()-B,socketTime:0,reconnectCount:F,isReconnect:q&&0<F});N.dispatchEvent(r)}}i&&i.room&&i.room.serial&&(TK.mySerial=i.room.serial),t&&t.id&&(TK.myPeerid=t.id);var a={};function s(e){try{L.Logger.getAllLog(e,function(e){if(L.Utils.isArray(e)){var t;if((t=e.filter(function(e,t){if(e&&e.peerid)return e.peerid===TK.myPeerid&&e.ts>TK.logTs}))&&t.length&&t[t.length-1]&&(TK.logTs=t[t.length-1].ts),t&&t.length){var i=D._web_protocol+"://"+D._web_host+":"+D._web_port+f+"?ts="+(new Date).getTime();L.Utils.sdkAjax({url:i,dataType:"json",type:"POST",anync:!0,data:function(e){if(L.Utils.isArray(e)){var t="";e.forEach(function(e){t+=JSON.stringify(e)+"\n"})}var i=pako.gzip(t,{to:"string"});return btoa(i)}(t),success:function(e){L.Logger.debug(R,"[tk-sdk]send logs = ",L.Utils.toJsonStringify(e))},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]send logs fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}}else L.Logger.debug(R,"[tk-sdk]getAllLog error , Because the return value is not an array!")}),L.Logger.keep(.16)}catch(e){L.Logger.error(R,"[tk-sdk]gzip is null or error info:",e)}}a.peerid=TK.myPeerid?TK.myPeerid:"",a.serial=TK.mySerial?TK.mySerial:"",L.Logger.setLogStaicPrefix(a.peerid,a.serial),s(y),window.setInterval(function(){s(y)},18e4)},o)}else L.Logger.warning(R,"[tk-sdk]Room is not leaved!")},N.joinRoomEx=function(e,t,i,o){if(bt(void 0,!0))if(D._isLeaveRoom)if(D._isConnected)L.Logger.warning(R,"[tk-sdk]Room already connected!");else{e||L.Logger.error(R,"[tk-sdk]joinRoomEx roomId is null!"),F=-1,V=x=M=0,B=Date.now();var n=D.tk_host||"global.talk-cloud.net",r=D.tk_port||(/https/g.test(D._web_protocol)?443:80);L.Logger.info(R,"[tk-sdk]call joinroom start!"),D._myself={id:""},Ot(),D._isLeaveRoom=!1,D._webReconnectNumList={},b({web_host:n,web_port:r}),D._roomJsonOptions={thirdroomid:e},D._userJsonOptions=D._userJsonOptions||{},D._userJsonOptions.userProperties=o||{},D._roomJsonOptions.video=!0,D._roomJsonOptions.audio=!0,D._roomJsonOptions.autoServer=!L.Utils.isBoolean(D._roomJsonOptions.autoServer)||D._roomJsonOptions.autoServer;var a={thirdroomid:D._roomJsonOptions.thirdroomid};D.isTkInvalidAppkey||(a.version=1,a.authkey=h,a.key=T),t&&(a.nickname=t);var d=!1,c=!1,u=!1,l=D._web_host;ne(n,D._webInterfaceHtmlPort,function(e){d=!0,0===e&&(l=L.Utils.replaceHostname(D._web_host,D._serverName)),d&&c&&!u&&(u=!0,ze(l))}),D._roomJsonOptions.checkroomParamsUrl&&!D.isTkInvalidAppkey&&(D._roomJsonOptions.checkroomParamsUrl+="&version=1&authkey="+h+"&key="+T),nt(n,r,D._roomJsonOptions.checkroomParamsUrl?D._roomJsonOptions.checkroomParamsUrl:a,function(e,t,i){c=!0;var o=TK.RoomEvent({type:TK.EVENT_TYPE.roomCheckroom,message:{ret:e,userinfo:t,roominfo:i}});if(N.dispatchEvent(o),0===e)d&&c&&!u&&(u=!0,ze(l));else{var n=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"checkroom",error:e,errorCode:e}});if(N.dispatchEvent(n),G.checkRoomCount++,5<=G.checkRoomCount){var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"checkroom",error:e,errorCode:e}},{httpTime:Date.now()-B,socketTime:0,reconnectCount:F,isReconnect:q&&0<F});N.dispatchEvent(r)}}i&&i.room&&i.room.serial&&(TK.mySerial=i.room.serial),t&&t.id&&(TK.myPeerid=t.id);var a={};function s(e){try{L.Logger.getAllLog(e,function(e){if(L.Utils.isArray(e)){var t;if((t=e.filter(function(e,t){if(e&&e.peerid)return e.peerid===TK.myPeerid&&e.ts>TK.logTs}))&&t.length&&t[t.length-1]&&(TK.logTs=t[t.length-1].ts),t&&t.length){var i=D._web_protocol+"://"+D._web_host+":"+D._web_port+f+"?ts="+(new Date).getTime();L.Utils.sdkAjax({url:i,dataType:"json",type:"POST",anync:!0,data:function(e){if(L.Utils.isArray(e)){var t="";e.forEach(function(e){t+=JSON.stringify(e)+"\n"})}var i=pako.gzip(t,{to:"string"});return btoa(i)}(t),success:function(e){L.Logger.debug(R,"[tk-sdk]send logs = ",L.Utils.toJsonStringify(e)),L.Logger.keep(.28)},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]send logs fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}}else L.Logger.debug(R,"[tk-sdk]getAllLog error , Because the return value is not an array!")})}catch(e){L.Logger.error(R,"[tk-sdk]gzip is null or error info:",e)}}a.peerid=TK.myPeerid?TK.myPeerid:"",a.serial=TK.mySerial?TK.mySerial:"",L.Logger.setLogStaicPrefix(a.peerid,a.serial),s(y),window.setInterval(function(){s(y)},18e4)},i)}else L.Logger.warning(R,"[tk-sdk]Room is not leaved!")},N.leaveroom=function(e){if(bt(void 0,!0)){e=e||!1,D._isLeaveRoom=!0,clearInterval(N._networkequipmentTimer),clearInterval(N._catonNumber),clearInterval(N.sendcatonNumber),clearTimeout(D._webReconnectNumList.checkroomReconnectTimer),D._webReconnectNumList.checkroomReconnectTimer=void 0,clearTimeout(D._webReconnectNumList.getFalsificationIpReconnectTimer),D._webReconnectNumList.getFalsificationIpReconnectTimer=void 0,clearTimeout(D._webReconnectNumList.getConfigReconnectTimer),D._webReconnectNumList.getConfigReconnectTimer=void 0,L.Logger.info(R,"force : "+e),$();try{P&&P.socketDisconnect&&P.socketDisconnect()}catch(e){L.Logger.warning(R,"[tk-sdk]Socket already disconnected , disconnect errorInfo:",e)}P&&P.emptySocket&&P.emptySocket(),D._isConnected=!1,TK.networkTestInfo.isConnectRoom=!1,F=-1,B=V=x=M=0,U&&U.changeCommonWhiteBoardConfigration&&U.changeCommonWhiteBoardConfigration({isConnectedRoom:D._isConnected});var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomLeaveRoom,message:e});N.dispatchEvent(t)}},N.startServerRecord=function(e){if(bt(void 0,!0)&&St(void 0,!0)){e=e||{};var t=L.Utils.isNull(e.recordType)?TK.REC_TYPE_RECFILE:e.recordType,i=void 0===e.recordChat||"boolean"!=typeof e.recordChat||e.recordChat,o=L.Utils.isNull(e.convert)?0:e.convert,n=L.Utils.isNull(e.layout)?0:e.layout;L.Logger.info(R,"[tk-sdk]startServerRecord recordtype = "+t+",convert = "+o+",layout = "+n);var r={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{recordtype:t,convert:o,layout:n},save:!0};i&&(r.data.recordchat=!0),r.data=L.Utils.toJsonStringify(r.data),N.pubMsg(r)}},N.stopServerRecord=function(){if(bt(void 0,!0)&&St(void 0,!0)){L.Logger.info(R,"[tk-sdk]stopServerRecord .");var e={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{}};e.data=L.Utils.toJsonStringify(e.data),N.delMsg(e)}},N.uploadRoomFile=function(e,t,i,o,n,r,a){if(bt(r,!0)&&St(function(e,t){L.Utils.isFunction(r)&&r(t,e)},!0)){if((a=a||{}).isWritedb=!!L.Utils.isBoolean(a.isWritedb)&&a.isWritedb,!e||!t||!i)return L.Logger.error(R,"[tk-sdk] uploadRoomFile method got invalid arguments"),void(L.Utils.isFunction(r)&&r(window.TK.ERROR_NOTICE.ERR_BAD_PARAMETERS,"TK_ERR_INVALID_ARG"));var s=N.getUploadFileParams(e,t,a.isWritedb,a.qRCodeId),d=new FormData;for(var c in s)d.append(c,s[c]);return d.append("filedata",i),se(d,o,n,r)}},N.deleteRoomFile=function(e,t,i){if(bt(void 0,!0)&&St(function(e,t){L.Utils.isFunction(i)&&i(t,e)},!0))return null==e?(L.Logger.error(R,"[tk-sdk] deleteRoomFile method got invalid arguments"),void(L.Utils.isFunction(i)&&i(window.TK.ERROR_NOTICE.ERR_BAD_PARAMETERS,"TK_ERR_INVALID_ARG"))):void ce(e,t,i)},N.setAutoProcessDeviceChangeEvent=function(e){L.Utils.isBoolean(e)&&(D._autoProcessDevChangeEvent=e)},N.requestServerList=function(e,t,n,r,i){if(i=i||{},bt(r,!0))if(L.Utils.getJsonLength(D._serverList))L.Utils.isFunction(n)&&(w(D._serverList,D._serverName),n(D._serverList));else{if(!e||!t)return L.Logger.error(R,"[tk-sdk]requestServerList host or port is not exist!"),void(L.Utils.isFunction(r)&&r(window.TK.ERROR_NOTICE.ERR_BAD_PARAMETERS,"TK_ERR_INVALID_ARG"));L.Logger.debug(R,"[tk-sdk]Going to requestServerList");var o=(i.protocol||D._web_protocol)+"://"+e+":"+t+"/ClientAPI/getserverarea?ts="+(new Date).getTime();L.Utils.sdkAjax({url:o,type:"post",async:!0,success:function(e){L.Logger.info(R,"[tk-sdk]webInterfaceGetserver resp = ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(e)):L.Utils.toJsonStringify(e));var t=(e=L.Utils.toJsonParse(e)).result;if(D._serverList={},0==t&&void 0!==e.serverarealist){for(var i in e.serverarealist){var o=e.serverarealist[i];D._serverList[o.serverareaname]=o}L.Utils.isFunction(n)&&(w(D._serverList,D._serverName),n(D._serverList))}else L.Logger.info(R,"[tk-sdk]webInterfaceGetserver resp.serverarealist is not exist , nRet:"+t),L.Utils.isFunction(r)&&r(t,e)},error:function(e){L.Logger.error(R,"[tk-sdk]webInterfaceGetserver fail[readyState-status]:",e),L.Utils.isFunction(r)&&r(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}},N.switchServer=function(e){N.switchServerByName(e)},N.publishVideo=function(e){if(bt(void 0,!0)&&St(void 0,!0))if(TK.isOnlyAudioRoom)L.Logger.warning(R,"[tk-sdk]only audio room not execute method publishVideo method !");else if(!TK.isMultiCamera||L.Utils.isVideoinputDeviceIdFromDeviceList(e)){var t=ft(e);if(t!==TK.PUBLISH_STATE_VIDEOONLY&&t!==TK.PUBLISH_STATE_BOTH){var i=t===TK.PUBLISH_STATE_MUTEALL||t===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_BOTH;N.changeUserPublish(Re(),i,e)}}else L.Logger.warning(R,"[tk-sdk]publishVideo is fail,the device id("+e+") is not in the video device list!")},N.unpublishVideo=function(e){if(bt(void 0,!0)&&St(void 0,!0))if(TK.isOnlyAudioRoom)L.Logger.warning(R,"[tk-sdk]only audio room not execute method unpublishVideo method !");else{var t=ft(e);if(t!==TK.PUBLISH_STATE_NONE&&t!==TK.PUBLISH_STATE_AUDIOONLY){var i=t===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_NONE;N.changeUserPublish(Re(),i,e)}}},N.publishAudio=function(){if(bt(void 0,!0)&&St(void 0,!0)){var e=ft(D._mainCameraDeviceId);if(e!==TK.PUBLISH_STATE_AUDIOONLY&&e!==TK.PUBLISH_STATE_BOTH){var t=e===TK.PUBLISH_STATE_MUTEALL||e===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_BOTH;N.changeUserPublish(Re(),t,D._mainCameraDeviceId)}}},N.unpublishAudio=function(){if(bt(void 0,!0)&&St(void 0,!0)){var e=ft(D._mainCameraDeviceId);if(e!==TK.PUBLISH_STATE_NONE&&e!==TK.PUBLISH_STATE_VIDEOONLY){var t=e===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_NONE;N.changeUserPublish(Re(),t,D._mainCameraDeviceId)}}},N.playRemoteMedia=function(e,t,i,o){bt(o,!0)&&Qe(e,t,i=i||{},o,TK.STREAM_MEDIA,"playRemoteMedia")},N.unplayRemoteMedia=function(e,t){bt(t,!0)&&Xe(e,t,TK.STREAM_MEDIA,"unplayRemoteMedia")},N.playRemoteMediaFile=function(e,t,i,o){bt(o,!0)&&Qe(e,t,i=i||{},o,TK.STREAM_FILE,"playRemoteMediaFile")},N.unplayRemoteMediaFile=function(e,t){bt(t,!0)&&Xe(e,t,TK.STREAM_FILE,"unplayRemoteMediaFile")},N.playRemoteScreen=function(e,t,i,o){bt(o,!0)&&(e!==Re()?Qe(e,t,i=i||{},o,TK.STREAM_SCREEN,"playRemoteScreen"):L.Utils.isFunction(o)&&o("TK_ERR_NOT_PLAY_SELF_SCREEN"))},N.playVideoOnDemand=function(e,t,i){if(i=i||{},!e||!t||"string"!=typeof e||"string"!=typeof t)return L.Logger.error(R,"[tk-sdk]Illegal parameter in function playVideoOnDemand, params is:",e,t,i);var o=document.getElementById(t);if(!o)return L.Logger.error(R,"[tk-sdk]Can not found the element by id ",t);var n=document.createElement("video"),r=document.createElement("source");if(n.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;z-index:999;top:0;"),n.setAttribute("autoplay","true"),n.setAttribute("class","tk_video_on_demand"),n.setAttribute("controls","true"),r.setAttribute("src",e),i)for(var a in i)try{n.setAttribute(a,i[a])}catch(e){L.Logger.error(R,"[tk-sdk]Catch set attribute exception,info is:"+e)}n.appendChild(r),o.appendChild(n)},N.stopVideoOnDemand=function(e){if(!e||"string"!=typeof e)return L.Logger.error(R,"[tk-sdk]Illegal parameter in function playVideoOnDemand, params is:",e);var t=document.getElementById(e);if(!t)return L.Logger.error(R,"[tk-sdk]Can not found the element by id ",t);var i=t.getElementsByClassName("tk_video_on_demand");Array.prototype.forEach.call(i,function(e){try{t.removeChild(e)}catch(e){L.Logger.error(R,"[tk-sdk]Catch stop video on demand exception,info is:"+e)}})},N.unplayRemoteScreen=function(e,t){bt(t,!0)&&(e!==Re()?Xe(e,t,TK.STREAM_SCREEN,"unplayRemoteScreen"):L.Utils.isFunction(t)&&t("TK_ERR_NOT_UNPLAY_SELF_SCREEN"))},N.setRemoteAudioVolume=function(e,t,i,o){if(bt(void 0,!0)){if(""===t&&(t=Re()),L.Utils.isNull(t))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk]setRemoteAudioVolume method got invalid userId!");if("number"!=typeof e)return L.Logger.error(R,"[tk-sdk] setRemoteAudioVolume method volume muset is number!"),void(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"));if(t!==Re()&&!D._users[t])return L.Logger.debug(R,"[tk-sdk]setRemoteAudioVolume:user is not exist,user id is "+t+"!"),void(L.Utils.isFunction(i)&&i("TK_ERR_NOT_USER"));var n=o||TK.STREAM_VIDEO,r=void 0;n===TK.STREAM_VIDEO&&(r=Dt(t));var a=Ee(t,n,r);if(!a)return L.Logger.debug(R,"[tk-sdk] setRemoteAudioVolume: user is not stream  , user id is "+t),void(L.Utils.isFunction(i)&&i("TK_NO_THIS_STREAM"));a.setVolume(e)}},N.getAudioVolume=function(e,t,i,o){if(bt(void 0,!0)){if(""===e&&(e=Re()),L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk]getAudioVolume method got invalid userId!");if(!L.Utils.isFunction(t))return L.Logger.error(R,"[tk-sdk] getAudioVolume: onVolume is not function"),void(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"));if(e!==Re()&&!D._users[e])return L.Logger.debug(R,"[tk-sdk]setRemoteAudioVolume:user is not exist,user id is "+e+"!"),void(L.Utils.isFunction(i)&&i("TK_ERR_NOT_USER"));var n=o||TK.STREAM_VIDEO,r=void 0;n===TK.STREAM_VIDEO&&(r=Dt(e));var a=Ee(e,n,r);if(!a)return L.Logger.debug(R,"[tk-sdk] getAudioVolume: user has not stream, user id is "+e),void(L.Utils.isFunction(i)&&i("TK_NO_THIS_STREAM"));a.getRealtimeVolume(t,i)}},N.registerAudioVolumeListener=function(i,o,n,r,e){if(bt(r,!0)){if(""===i&&(i=Re()),L.Utils.isNull(i))return L.Logger.error(R,"[tk-sdk] registerAudioVolumeListener: userId is invalid"),void(L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"));if("number"!=typeof o)return L.Logger.error(R,"[tk-sdk] registerAudioVolumeListener: msInterval is invalid"),void(L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"));if(!L.Utils.isFunction(n))return L.Logger.error(R,"[tk-sdk] registerAudioVolumeListener: onVolume is not function"),void(L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"));if(i!==Re()&&!D._users[i])return L.Logger.debug(R,"[tk-sdk]registerAudioVolumeListener:user is not exist,user id is "+i+"!"),void(L.Utils.isFunction(r)&&r("TK_ERR_NOT_USER"));o<50&&(o=50);var a=e||TK.STREAM_VIDEO,s=void 0;a===TK.STREAM_VIDEO&&(s=Dt(i));var t=Ee(i,a,s);if(!t)return function t(){setTimeout(function(){var e=Ee(i,a,s);e?(D._registerAudioVolumeListeners[It(i,a)]={onSuccess:n,interval:L.Utils.isNumber(o)?o:100,onFailure:r,isWaiting:!0},e.stopIntervalGetRealtimeVolume(),TK.isTkNative?e.startIntervalGetRealtimeVolume(n,o,r):e.startIntervalGetRealtimeVolume()):t()},500)}(),L.Logger.debug(R,"[tk-sdk] registerAudioVolumeListener: user has not stream, user id is "+i),void(L.Utils.isFunction(r)&&r("TK_NO_THIS_STREAM"));D._registerAudioVolumeListeners[It(i,a)]={onSuccess:n,interval:L.Utils.isNumber(o)?o:100,onFailure:r,isWaiting:!0},t.stopIntervalGetRealtimeVolume(),TK.isTkNative?t.startIntervalGetRealtimeVolume(n,o,r):t.startIntervalGetRealtimeVolume()}},N.unregisterAudioVolumeListener=function(e,t,i){if(bt(void 0,!0)){if(""===e&&(e=Re()),L.Utils.isNull(e))return L.Logger.error(R,"[tk-sdk] unregisterAudioVolumeListener: userId is invalid"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));if(e!==Re()&&!D._users[e])return L.Logger.debug(R,"[tk-sdk]setRemoteAudioVolume:user is not exist,user id is "+e+"!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_USER"));var o=i||TK.STREAM_VIDEO,n=void 0;o===TK.STREAM_VIDEO&&(n=Dt(e));var r=D._registerAudioVolumeListeners[It(e,o)];r&&(r.onSuccess=void 0,r.onFailure=void 0,r.interval=100,r.isWaiting=!1,D._registerAudioVolumeListeners[It(e,o)]=void 0,delete D._registerAudioVolumeListeners[It(e,o)]);var a=Ee(e,o,n);if(!a)return L.Logger.debug(R,"[tk-sdk] unregisterAudioVolumeListener: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("TK_NO_THIS_STREAM"));a.stopIntervalGetRealtimeVolume()}},N.switchOnlyAudioRoom=function(e){if(bt(void 0,!0)){var t,i="OnlyAudioRoom",o=i,n={};e?(TK.needOnlyAudioRoom=1,t={name:i,id:o,toID:"__all",data:n,save:!0},N.pubMsg(t)):(TK.needOnlyAudioRoom=2,t={name:i,id:o,toID:"__all",data:n},N.delMsg(t))}},N.startShareMedia=function(i,e,o,t){if(bt(o,!0)&&St(o,!0)){if(t=t||{},e=void 0!==e&&e,!i)return L.Logger.error(R,"[tk-fake-sdk]startShareMedia url can not be empty!"),void(o&&"function"==typeof o&&o("TK_ERR_INVALID_ARG"));if(TK.isOnlyAudioRoom&&e)return L.Logger.warning(R,"[tk-sdk]only audio room not execute method startShareMedia to video media !"),void(o&&"function"==typeof o&&o("TK_ERR_NOT_SUPPORT"));var n={type:"media"};if(void 0!==t.toID&&(n.toID=t.toID),t.attrs&&"object"===Ft(t.attrs))for(var r in t.attrs)"toID"!==r&&"type"!==r&&(n[r]=t.attrs[r]);var a={audio:!0,video:e,url:i,extensionId:Re()+":media",attributes:n},s=!1;for(var r in N.remoteStreams){var d=N.remoteStreams[r];d&&"media"===d.getAttributes().type&&(s=!0,N.stopShareMedia(function(e){c()},function(){c()}))}s||c()}function c(){L.Logger.info(R,"[tk-sdk]calling startShareMedia  , url is "+i+" , isVideo is "+e+" , options is "+L.Utils.toJsonStringify(t)),Le("publish",{state:"url",data:a.data,audio:a.audio,video:a.video,attributes:a.attributes,extensionId:a.extensionId,metadata:void 0,createOffer:void 0},a.url,function(e,t){0===e?L.Logger.debug(R,"[tk-sdk]mediaStream published , stream id:"+t+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.attributes)):(L.Logger.warning(R,"[tk-sdk]Error when publishing mediaStream",e,t),L.Logger.info(R,"[tk-sdk]stream-publish-fail , stream url:"+i+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.attributes)),L.Utils.isFunction(o)&&o(e))})}},N.stopShareMedia=function(o,n,e){if(bt(o,!0)&&St(o,!0)){e=e||{};var t=!1;for(var i in N.remoteStreams){var r=N.remoteStreams[i];if(r&&"media"===r.getAttributes().type){if(e&&"object"===Ft(e)&&e.onlyStopMyself&&r.publisherId()!==Re())continue;t=!0,a(r)}}t||(L.Logger.warning(R,"[tk-sdk]No media are Shared!"),o&&"function"==typeof o&&o("TK_ERR_NOT_MEDIA_SHARED"))}function a(i){L.Logger.info(R,"[tk-sdk]calling stopShareMedia , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),P.sendMessageSocket("unpublish",i.getID(),function(e,t){0!==e?(L.Logger.warning(R,"[tk-sdk]unpublish media stream fail, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error code is "+e+" ,error info:",t),L.Utils.isFunction(o)&&o(t)):(L.Logger.debug(R,"[tk-sdk]meidaStream unpublished , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),L.Utils.isFunction(n)&&n())})}},N.pauseShareMedia=function(e,t){if(bt(t,!0)&&St(t,!0)){if(!L.Utils.isBoolean(e))return L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk] pauseShareMedia function got wrong arguments");var i=!1;for(var o in N.remoteStreams){var n=N.remoteStreams[o];"media"===n.getAttributes().type&&(i=!0,P.controlMedia(n.getID(),{type:"pause",pause:e}))}i||(L.Logger.warning(R,"[tk-sdk]No media are Shared and the execution pauseShareMedia method is invalid!"),t&&"function"==typeof t&&t("TK_ERR_NOT_MEDIA_SHARED"))}},N.seekMedia=function(e,t){if(bt(t,!0)&&St(t,!0)){if(!L.Utils.isNumber(e))return L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk] seekShareMedia function got wrong arguments");var i=!1;for(var o in e<0&&(e=0),1<e&&(e=1),N.remoteStreams){var n=N.remoteStreams[o];if("media"===n.getAttributes().type){i=!0;var r=parseInt(e*n.getAttributes().duration);r>n.getAttributes().duration&&(r=n.getAttributes().duration),P.controlMedia(n.getID(),{type:"seek",pos:r})}}i||(L.Logger.warning(R,"[tk-sdk]No media are Shared and the execution seekShareMedia method is invalid!"),t&&"function"==typeof t&&t("TK_ERR_NOT_MEDIA_SHARED"))}},N.setMute=function(e,t,i){var o=void 0;o=t==TK.MEDIA_TYPE.MEDIA?e+":"+TK.STREAM_MEDIA:e+":"+TK.STREAM_FILE;var n=D._createStreams[o];null!=n&&n.setMute(i)},N.setVolume=function(e,t,i){var o=void 0;o=t==TK.MEDIA_TYPE.MEDIA?e+":"+TK.STREAM_MEDIA:e+":"+TK.STREAM_FILE;var n=D._createStreams[o];null!=n&&n.setVolume(i)},N.isPlayAudio=function(e,t,i){var o={audio:!0,isPlay:t,audioUrl:e,type:i.type,currentPage:i.currentPage};l&&l.clientAudioMediaPlayer(e,t?"play":"stop",o)},N.playVideo=function(e,t,i,o,n){if(bt(o,!0)){if(L.Logger.info(R,"[tk-sdk] playVideo. userId:",e,";elementId:",t,";options:",i,"; videoinputDeviceId:",n),i=i||{},""===e&&(e=Re()),!e)return L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk]playVideo method got invalid userId!");if(!t)return L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk]playVideo method got invalid elementId!");if(i&&"object"!==Ft(i))return L.Logger.error(R,"[tk-sdk]playVideo method options must is json!"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));if(D._playVideoStreams[wt(e,i&&i.mediaType||TK.STREAM_VIDEO,n)]&&N.unplayVideo(e,void 0,n),e===Re()){if(TK.isMultiCamera&&(!i||i.mediaType!==TK.STREAM_SCREEN)&&!L.Utils.isVideoinputDeviceIdFromDeviceList(n))return L.Logger.error(R,"[tk-sdk]playVideo is fail,the device id("+n+") is not in the video device list!"),void(L.Utils.isFunction(o)&&o("TK_ERR_DEVICE_ID_NOT_LIST"));i.mirror=L.Utils.isBoolean(i.mirror)?i.mirror:D._isLocalVideoMirrorList[wt(e,i&&i.mediaType||TK.STREAM_VIDEO,n)]||D._isLocalVideoMirror,De(n)||i&&"screen"===i.mediaType||Ne(n)}else if(!D._users[e])return L.Logger.info(R,"[tk-sdk]playVideo:user is not exist, user id is "+e),void(L.Utils.isFunction(o)&&o("TK_ERR_NOT_USER"));var r=Ee(e,i&&i.mediaType||TK.STREAM_VIDEO,n);if(!r)return L.Logger.debug(R,"[tk-sdk]playVideo: user has not stream, user id is "+e),void(L.Utils.isFunction(o)&&o("TK_NO_THIS_STREAM"));Ke(t,r,i)}},N.unplayVideo=function(e,t,i,o){if(bt(t,!0)){if(L.Logger.info(R,"[tk-sdk] unplayVideo. userId:",e),""===e&&(e=Re()),!e)return L.Logger.error(R,"[tk-sdk]unplayVideo method got invalid userId!"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));var n=D._playVideoStreams[wt(e,o&&o.mediaType||TK.STREAM_VIDEO,i)];if(!n)return L.Logger.debug(R,"[tk-sdk]unplayVideo: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("TK_NO_THIS_STREAM"));xe(n)}},N.playAudio=function(e,t){if(bt(t,!0)){if(L.Logger.info(R,"[tk-sdk] playAudio, userId:",e),3===arguments.length&&"string"==typeof arguments[1]&&"function"==typeof arguments[2]&&(t=arguments[2]),!e)return L.Logger.error(R,"[tk-sdk]playAudio method got invalid userId!"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));if(e===Re())return L.Logger.info(R,"[tk-sdk]playAudio:play local audio are not allowed, user id is "+e),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_PLAY_SELF_AUDIO"));D._playAudioStreams[It(e,TK.STREAM_VIDEO)]&&N.unplayAudio(e);var i=D._users[e];if(!i)return L.Logger.info(R,"[tk-sdk]playAudio:user is not exist, user id is "+e),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_USER"));var o=Ee(e,TK.STREAM_VIDEO,i.tk_maincamera);if(!o)return L.Logger.debug(R,"[tk-sdk]playAudio: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("TK_NO_THIS_STREAM"));Me(o)}},N.unplayAudio=function(e,t){if(bt(t,!0)){if(L.Logger.info(R,"[tk-sdk] unplayAudio. userId:",e),!e)return L.Logger.error(R,"[tk-sdk]unplayAudio method got invalid userId!"),void(L.Utils.isFunction(t)&&t("TK_ERR_INVALID_ARG"));var i=D._playAudioStreams[It(e,TK.STREAM_VIDEO)];if(!i)return L.Logger.debug(R,"[tk-sdk]unplayAudio: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("TK_NO_THIS_STREAM"));Fe(i)}},N.setLocalVideoMirror=function(e,t){L.Utils.isBoolean(e)?(L.Logger.info(R,"[tk-sdk] setLocalVideoMirror. isMirror:",e),TK.isMultiCamera&&void 0!==t||(D._isLocalVideoMirror=e),TK.isMultiCamera&&(D._isLocalVideoMirrorList[wt(Re(),TK.STREAM_VIDEO,t)]=e),De(t)&&Ce(t).setLocalVideoMirror(e)):L.Logger.error(R,"[tk-sdk]The setLocalVideoMirror method parameter isMirror must be of Boolean type!")},N.getVideoProfile=function(e){return O.getVideoProfile(e)},N.setVideoProfile=function(e,i,o){if(bt(i,!0)){var t=function(){L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"),L.Logger.error(R,"[tk-sdk] setVideoProfile method got invalid arguments")};if("object"===Ft(e))if("number"==typeof e.width&&"number"==typeof e.height&&"number"==typeof e.maxfps){TK.isMultiCamera||(o=void 0);var n=function(e){if(!L.Utils.isNull(D._myself.id)){var t=D._myself.id;return e&&(t+=":"+e),Ue(t)}L.Logger.warning(R,"[tk-sdk]The room has not been successfully connected yet. Please try again after the connection is successful!")}(o);O.setVideoProfile(e,o,function(){if(n){var e=O.getUseVideoProfile(o);n.maxfps=e.maxfps;var t=L.Utils.getMaxBPS(e.width,e.maxfps);isNaN(t)&&(t=1280),O.setBandWidth(n.getID(),t,function(){L.Logger.info(R,"[tk-sdk] setBandWidth success setBandWidth info:",t)},i)}},function(){if(n){var e=O.getUseVideoProfile(o);Tt(n,n.videoinputDeviceId,!0,e.maxfps)}}),O.getDeviceMgr()&&O.getDeviceMgr().isNativeSetVideoProfile||L.Logger.info(R,"[tk-sdk]setVideoProfile profile:"+e+(o?" , videoinputDeviceId is "+o:""))}else t();else t()}},N.getRoomUserNum=function(t,e,o,i){if(bt(o,!0)&&St(o,!0)){if(!L.Utils.isFunction(t))return L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk] The parameter onSuccess of method getRoomUserNum must be a function");var n={companyid:D._room_properties.companyid,serial:D._room_properties.serial};void 0!==e&&Array.isArray(e)&&(n.role=e),i&&L.Utils.isString(i)&&(n.search=i);var r=D._web_protocol+"://"+D._web_host+":"+D._web_port+"/ClientAPI/getroomusernum?ts="+(new Date).getTime();L.Utils.sdkAjax({url:r,dataType:"json",type:"GET",async:!0,data:n,success:function(e){L.Logger.debug(R,"[tk-sdk]getroomusernum resp = ",L.Utils.toJsonStringify(e)),0===e.result?t(L.Utils.isNumber(Number(e.num))?Number(e.num):0):(L.Logger.warning(R,"[tk-sdk]getroomusernum interface request fail , code is "+e.result),L.Utils.isFunction(o)&&o(e.result,e))},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]getroomusernum fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(o)&&o(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}},N.getRoomUsers=function(n,e,t,i,r,o,a){if(bt(r,!0)&&St(r,!0)){if(!L.Utils.isFunction(n))return L.Utils.isFunction(r)&&r("TK_ERR_INVALID_ARG"),void L.Logger.error(R,"[tk-sdk] The parameter onSuccess of method getRoomUsers must be a function");var s={companyid:D._room_properties.companyid,serial:D._room_properties.serial};if(void 0!==e&&L.Utils.isNumber(e)&&(s.start=e),void 0!==t&&L.Utils.isNumber(t)&&(s.max=t),void 0!==i&&Array.isArray(i)&&(s.role=i),o&&L.Utils.isString(o)&&(s.search=o),a&&Array.isArray(a)){for(var d=[],c=0,u=a.length;c<u&&("object"===Ft(a[c])&&d.push(a[c]),!(3<=d.length));c++);d.length&&(s.order=d)}var l=D._web_protocol+"://"+D._web_host+":"+D._web_port+"/ClientAPI/getroomusers?ts="+(new Date).getTime();L.Utils.sdkAjax({url:l,dataType:"json",type:"POST",async:!0,data:s,success:function(e){if(L.Logger.debug(R,"[tk-sdk]getroomusers resp = ",L.Utils.toJsonStringify(e)),0===e.result){var t=[];if(e.userlist&&Array.isArray(e.userlist))for(var i=0,o=e.userlist.length;i<o;i++)t.push(TK.RoomUser(e.userlist[i]));n(t,e.total)}else L.Logger.warning(R,"[tk-sdk]getroomusers interface request fail , code is "+e.result),L.Utils.isFunction(r)&&r(e.result,e)},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]getroomusers fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(r)&&r(window.TK.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"TK_ERR_HTTP_REQUEST_FAILED")}})}},N.getNativeInterface=function(e){return TK.isTkNative?l:(L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),void L.Logger.error(R,"[tk-sdk] getNativeInterface method must be called in the native environment!"))},N.getPlaybackInterface=function(){return a},N.getRoomUser=function(e,i,o){if(bt(o,!0)&&St(o,!0)){if(!e||!L.Utils.isFunction(i))return L.Logger.error(R,"[tk-sdk]getRoomUser method got invalid argument!"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));if(D._roomMode===window.TK.ROOM_MODE.NORMAL_ROOM)D._users[e]?i(D._users[e]):L.Utils.isFunction(o)&&o("TK_ERR_NOT_DATA");else{var t=[];t.push(e),P.sendMessageSocket("getUser",t,function(e,t){0===e&&Array.isArray(t)&&t.length&&t[0]?i(TK.RoomUser(t[0])):L.Utils.isFunction(o)&&o("TK_ERR_NOT_DATA")})}}},N.setStreamProcessor=function(e){e&&L.Utils.isFunction(e)&&(v=e)},N.getIp=function(t,i){if(L.Utils.isFunction(t))try{var o=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),n=function(){},r={},a=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,s=function(e){r[e]||(L.Utils.isFunction(t)?t(e):L.Logger.error(R,"[tk-sdk] getIP method parameter is not a specified type"),r[e]=!0)};o.createDataChannel(""),o.createOffer().then(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(a).forEach(s)}),o.setLocalDescription(e,n,n)}).catch(function(e){L.Logger.error(R,"[tk-sdk] getip An error occurred, so handle the failure to connect")}),o.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(a)&&e.candidate.candidate.match(a).forEach(s)}}catch(e){L.Utils.isFunction(i)?i(e):L.Logger.error(R,"[tk-sdk] getIP method parameter is not a specified type"),L.Logger.error(R,"[tk-sdk]Use a browser that supports webRTC,form")}else L.Logger.error(R,"[tk-sdk] getIP method parameter is not a specified type")},N.getDocServerList=function(){var e=D._backupCourseAddrList.reduce(function(i,e,t,o){return e.docaddr&&Array.isArray(e.docaddr)&&e.docaddr.forEach(function(e,t){i.push(e)}),i},[]);return D._docServerAddr&&e.push(D._docServerAddr),e||[]},N.reportDocServer=function(e){D._docServerAddr=e,Ge()},N.setNoticeInterval=function(e){k=e},N.enableDualStream=function(e){bt(void 0,!0)&&(g=!!e,N.changeUserProperty(Re(),"__all",{tk_enabledualstream:g}))},N.setSmallStreamParameter=function(e){bt(void 0,!0)&&(e&&"object"===Ft(e)?O.setSmallVideoProfile(Number(e.width),Number(e.height),Number(e.maxfps)):L.Logger.error(R,"[tk-sdk]setSmallStreamParameter method parameter type is incorrect"))},N.setRemoteDefaultVideoStreamType=function(e){bt(void 0,!0)&&(K=!!e)},N.setRemoteVideoStreamType=function(r,e,t){if(bt(void 0,!0))if(e){var a=N.getUser(e);if(a){if(a.tk_enabledualstream){var s="Dual:"+(t||"");if(a[s]===r)return;if(r===Bt||r===jt){var i=function(t){if("object"!==Ft(t)||!t.userId)return L.Logger.error(R,"Parameter not valid in private function _getStreams");var i=[];if(t.userId){var o=new RegExp(t.userId);Object.values(N.remoteStreams).forEach(function(e){o.test(e.extensionId)&&i.push(e)})}if(t.deviceId&&i.length){var n=new RegExp(t.deviceId);i=i.filter(function(e){return n.test(e.extensionId)})}t.streamType&&i.length?i=i.filter(function(e){return e.attributes.type===t.streamType}):i.length&&(i=i.filter(function(e){return e.attributes.type===TK.STREAM_VIDEO}));return i}({userId:e,deviceId:t}),d=[],c=[];i.length&&(r===Bt?(d=i.filter(function(e){return!!e.subscribed&&/tksmall/.test(e.extensionId)}),c=i.filter(function(e){return!e.subscribed&&!/tksmall/.test(e.extensionId)})):r===jt&&(d=i.filter(function(e){return!!e.subscribed&&!/tksmall/.test(e.extensionId)}),c=i.filter(function(e){return!e.subscribed&&/tksmall/.test(e.extensionId)})),c.length&&c.forEach(function(o,n){it(o,{},function(e){e&&d.length&&(ue(o.extensionId,!0),d.forEach(function(i){Lt(o.extensionId)===Lt(i.extensionId)&&i.getVideoPlayer()&&i.getVideoPlayer().elementID&&i.replaceStream(o,function(e,t){0===e&&(ot(i,function(e){e&&(Me(o,{},!0),Fe(i,{},!0),ue(i,!1))}),n===c.length&&(a[s]=r))})}))})}))}}}else L.Logger.error(R,"[tk-sdk]setRemoteVideoStreamType method user was not found by specifying parameters,userId:"+e)}else L.Logger.error(R,"[tk-sdk]setRemoteVideoStreamType method missing parameter.")},N.setLocalStreamAttributes=function(e,t){if(e&&"object"===Ft(e)){if(!TK.isMultiCamera||void 0===t)for(var i in e)D._videoStreamAttrs[i]=e[i];if(TK.isMultiCamera)for(var i in D._videoStreamListAttrs[wt(Re(),TK.STREAM_VIDEO,t)]=D._isLocalVideoMirrorList[wt(Re(),TK.STREAM_VIDEO,t)]||{},e)D._videoStreamListAttrs[wt(Re(),TK.STREAM_VIDEO,t)][i]=e[i];De(t)&&(Ce(t).updateLocalAttributes(e),Ce(t).setAttributes(e))}},N.liveSimulateServerCommunicationInterface=function(e){if(p["_handler_"+e]&&"function"==typeof p["_handler_"+e]){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);p["_handler_"+e].apply(null,t)}},N.changeUserPublish=function(e,t,i){if(bt(void 0,!0)&&St(void 0,!0))if(void 0!==e)if(TK.isMultiCamera){var o={};o["publishstate:"+i]=t,N.changeUserProperty(e,"__all",o)}else N.changeUserProperty(e,"__all",{publishstate:t});else L.Logger.error(R,"[tk-sdk]changeUserPublish method id is not exist!")},N.changeUserShare=function(e,t,i){i?bt(void 0,!0)&&St(void 0,!0)&&(void 0!==e?N.changeUserProperty(e,"__all",Vt({},i,t)):L.Logger.error(R,"[tk-sdk]changeUserShare method id is not exist! type:",i)):L.Logger.error(R,"[tk-sdk]changeUserShare method type is not exist!")},N.changeMyDisableVideoState=function(e){bt(void 0,!0)&&St(void 0,!0)&&("boolean"==typeof e?N.changeUserProperty(Re(),"__all",{disablevideo:e}):L.Logger.warning(R,"[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !"))},N.changeMyDisableAudioState=function(e){bt(void 0,!0)&&St(void 0,!0)&&("boolean"==typeof e?N.changeUserProperty(Re(),"__all",{disableaudio:e}):L.Logger.warning(R,"[tk-sdk]changeMyDisableAudioState:disableaudio must boolean !"))},N.updateVideoPlayerOptions=function(e,t,i,o,n){if(bt(void 0,!0)){if("object"!==Ft(e))return L.Logger.error(R,"[tk-sdk] updateVideoPlayerOptions method options muset is json!"),void(L.Utils.isFunction(i)&&i("TK_ERR_INVALID_ARG"));var r=Ee(t,o||TK.STREAM_VIDEO,n);if(!r)return L.Logger.debug(R,"[tk-sdk] updateVideoPlayerOptions: user is not stream  , user id is "+t),void(L.Utils.isFunction(i)&&i("TK_NO_THIS_STREAM"));r.updateVideoPlayerOptions(e)}},N.registerRoomWhiteBoardDelegate=function(e){if(e&&"TKWhiteBoardManager"===e.className&&"function"==typeof e.registerRoomDelegate){if((U=e)&&(U.registerRoomDelegate&&U.registerRoomDelegate(N),U.changeCommonWhiteBoardConfigration)){var t={};if(D._web_protocol&&D._web_host&&void 0!==D._web_port&&(t.webAddress={protocol:D._web_protocol,hostname:D._web_host,port:D._web_port}),D._doc_protocol&&D._doc_host&&void 0!==D._doc_port&&(t.docAddress={protocol:D._doc_protocol,hostname:D._doc_host,port:D._doc_port}),D._backup_doc_host_list.length){for(var i=[],o=0,n=D._backup_doc_host_list.length;o<n;o++)i.push({protocol:D._backup_doc_protocol,hostname:D._backup_doc_host_list[o],port:D._backup_doc_port});t.backupDocAddressList=i}t.myUserId=Re(),void 0!==D._myself.nickname&&(t.myName=D._myself.nickname),void 0!==D._myself.role&&(t.myRole=D._myself.role),t.isPlayback=TK.isPlayback,U.changeCommonWhiteBoardConfigration(t)}}else L.Logger.warning(R,"[tk-sdk]register whiteboardManagerInstance not is a TKWhiteBoardManager instance class , cannot execute registerRoomWhiteBoardDelegate method.")},N.stopShareLocalMedia=function(o,n,e){if(bt(o,!0)&&St(o,!0)){e=e||{};var t=!1;for(var i in N.remoteStreams){var r=N.remoteStreams[i];if(r&&"file"===r.getAttributes().type){if(e&&"object"===Ft(e)&&e.onlyStopMyself&&r.publisherId()!==Re())continue;t=!0,TK.isTkNative&&r.publisherId()===Re()?l.stopShareMediaFile():a(r)}}t||(L.Logger.warning(R,"[tk-sdk]No media file are Shared!"),o&&"function"==typeof o&&o("TK_ERR_NOT_LOCAL_MEDIA_FILE_SHARED"))}function a(i){L.Logger.info(R,"[tk-sdk]calling stopShareLocalMedia , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),P.sendMessageSocket("unpublish",i.getID(),function(e,t){0!==e?(L.Logger.warning(R,"[tk-sdk]Error unpublish local media stream fail, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error code is "+e+" ,error info:",t),L.Utils.isFunction(o)&&o(t)):(L.Logger.debug(R,"[tk-sdk]meidaStream unpublished , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),L.Utils.isFunction(n)&&n())})}},N.joinPlaybackRoom=e,N.seekPlayback=function(e,t){e&&L.Utils.isNumber(e)&&D._durationTime?P.socketSend("seekPlayback",e):L.Logger.error(R,"[tk-sdk]Incorrect parameter!")},N.pausePlayback=t,N.getUploadFileParams=function(e,t,i,o){if(bt(void 0,!0)){i=void 0===i||i;var n={serial:D._room_properties.serial,userid:Re(),sender:D._myself.nickname,conversion:1,isconversiondone:0,writedb:i?1:0,fileoldname:e,fieltype:t,alluser:1};return o&&(n.codeid=o),n}},N.uploadFile=function(e,i,t){if(bt(void 0,!0)&&St(void 0,!0))if(e){if(e instanceof FormData)return se(e,i,t,function(e,t){L.Utils.isFunction(i)&&i(e,t)});if(e.filename&&e.filetype&&e.filedata){var o=N.getUploadFileParams(e.filename,e.filetype,e.isWritedb,e.qRCodeId),n=new FormData;for(var r in o)n.append(r,o[r]);return n.append("filedata",e.filedata),se(n,i,t,function(e,t){L.Utils.isFunction(i)&&i(e,t)})}L.Logger.error(R,"[tk-sdk] uploadFile method Parameters of the lack of!")}else L.Logger.error(R,"[tk-sdk]uploadFile method Parameters of the lack of!")},N.deleteFile=function(e,i){bt(void 0,!0)&&St(void 0,!0)&&(null!=e?ce(e,i,function(e,t){L.Utils.isFunction(i)&&i(e,t)}):L.Logger.error(R,"[tk-sdk]deleteFile fileid is required!"))},N.switchServerByName=function(e){if(bt(void 0,!0)){if(!L.Utils.getJsonLength(D._serverList))return L.Logger.error(R,"[tk-sdk]selectServerByName --\x3e service list not request  , list is not exist!"),!1;if(!D._serverList[e])return L.Logger.error(R,"[tk-sdk]selectServerByName --\x3e the service list  has no option name  "+e+"!"),!1;if(void 0!==D._web_host&&void 0!==D._web_port)if(0<D._connectedNumber)if(D._serverName=e,w(D._serverList,D._serverName),function(){if(!D._useServerScreenRecording&&!D._tk_room_test_sdk&&!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(D._web_host)&&D._serverName)if(void 0!==D._web_host){var e=D._web_host.indexOf(".");if(0<e){var t=D._web_host.substring(0,e),i=new RegExp(t);D._old_web_host=D._web_host;var o=D._web_host.replace(i,D._serverName);o!==D._web_host?(L.Logger.info(R,"[tk-sdk]changeWebRequest host , old host is "+(window.__TkSdkBuild__?L.Utils.encrypt(D._old_web_host):D._old_web_host)+", now host is "+(window.__TkSdkBuild__?L.Utils.encrypt(o):o)),b({web_host:o})):L.Logger.info(R,"[tk-sdk]changeWebRequest host , host is not change ,   host is "+(window.__TkSdkBuild__?L.Utils.encrypt(D._web_host):D._web_host))}else L.Logger.error(R,"[tk-sdk]web request host not find first dot , cannot address to replace , current host is "+(window.__TkSdkBuild__?L.Utils.encrypt(D._web_host):D._web_host)+" ! ")}else L.Logger.error(R,"[tk-sdk]web request host is not exist , cannot call changeWebRequestAddress ! ")}(),D._old_web_host!==D._web_host){S({source:"select service reconnect",restrict:!0})}else L.Logger.info(R,"[tk-sdk]web request host is not change , not need reconnect service!");else L.Logger.error(R,"[tk-sdk]selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! ");else L.Logger.error(R,"[tk-sdk]selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");return!0}},N.setLogLevel=function(e){e&&(y=e)},N.getStreamStats=function(r,a){try{var n=N.getUsers();if(r&&a){var t=[];for(var e in N.remoteStreams)!function(e){var n=N.remoteStreams[e];if(n&&n.extensionId&&n.extensionId.split){t.push(new Promise(function(i,o){P.socketSend("getStreamStats",{streamId:e,peerId:r},function(e,t){if(0==e){if(!L.Utils.isFunction(a))return L.Logger.error(R,"[tk-sdk]getStreamStats method specifies that the parameter type is incorrect!"),void o();if(!(n&&n.extensionId&&n.extensionId.split))return void L.Logger.error(R,"[tk-sdk]be from getStreamStats method ,stream or extensionId is null!");if(!t[r])return L.Logger.warning(R,"[tk-sdk]getStreamStats method error info : stats  not exist!"),void o();t[r].type=n.extensionId.split(":")[0]===r?"up":"down",t[r].userId=n.extensionId.split(":")[0],t[r].peerId=r,t[r]&&t[r].video&&(t[r].video.frameRate=n.frameRate),TK.isMultiCamera&&n.extensionId.split(":").length&&(t[r].deviceId=n.extensionId.split(":")[1]),i(t[r])}else switch(e){case 1:L.Logger.warning(R,"[tk-sdk]getStreamStats method error info :  room does not exist!"),o();case 2:L.Logger.warning(R,"[tk-sdk]getStreamStats method error info :"+n.id+"  stream does not exist!"),o();case 3:L.Logger.warning(R,"[tk-sdk]getStreamStats method error info :"+r+" user not exist!"),o()}})}))}}(e);Promise.all(t).then(function(e){var o=null;e.forEach(function(e){for(var t in N.remoteStreams)if(N.remoteStreams[t].extensionId&&N.remoteStreams[t].extensionId.split&&(o=TK.isMultiCamera?N.remoteStreams[t].extensionId.split(":")[1]:N.remoteStreams[t].extensionId.split(":")[0]),o===e.deviceId)if(e&&e.video&&1==e.video.videoMute?delete e.video:e&&e.video&&(e.video.videoFps&&e.video.frameRate&&(e.video.frameRate=e.video.frameRate>e.video.videoFps?e.video.videoFps:e.video.frameRate),e.video.videoWidth=N.remoteStreams[t]&&N.remoteStreams[t].width?N.remoteStreams[t].width:0,e.video.videoHeight=N.remoteStreams[t]&&N.remoteStreams[t].height?N.remoteStreams[t].height:0,delete e.video.videoFps),e&&e.audio&&1==e.audio.audioMute&&delete e.audio,TK.isMultiCamera){if(n[e.userId])for(var i in n[e.userId])i.split(":").length&&i.split(":")[1]===e.deviceId&&(1==n[e.userId][i]?delete e.video:2==n[e.userId][i]&&delete e.audio)}else n[e.userId]&&(1==n[e.userId].publishstate?delete e.video:2==n[e.userId].publishstate&&delete e.audio)}),a(e)}).catch(function(e){L.Logger.warning(R,"[tk-sdk]getStreamStats method promise error info :",e)})}else a(),L.Logger.warning(R,"[tk-sdk]getStreamStats method specifies that the parameter type is incorrect!")}catch(e){L.Logger.warning(R,"[tk-sdk]getStreamStats method error info: ",e)}},N.startShareScreen=function(o,n){bt(void 0,!0)&&St(void 0,!0)&&(TK.isOnlyAudioRoom?L.Logger.warning(R,"[tk-sdk]only audio room not execute method publishVideo method !"):((o=o||{}).electronblackwinlist&&(o.electron=o.electron||{},o.electron.blackwinlist=o.electronblackwinlist),TK.DeviceMgrImpl.checkUserDesktopMediaMode(function(e){e?O.openWebScreen(o,function(e){var t=TK.SCREENSTATE_ON;if(t!==mt()){N.changeUserShare(Re(),t,"tk_screenstate");var i={};o&&o.video&&o.video.mandatory?(o.video.mandatory.maxWidth?i.videowidth=o.video.mandatory.maxWidth:L.Logger.error(R,"[tk-sdk]ShareScreen must set videowidth"),o.video.mandatory.maxHeight?i.videoheight=o.video.mandatory.maxHeight:L.Logger.error(R,"[tk-sdk]ShareScreen must set videoheight")):(i.videowidth=window.screen.width,i.videoheight=window.screen.height),function(e,t,i){t=t||{};var o=Ue(Re()+":screen");if(!L.Utils.isNull(o))return L.Utils.isFunction(i)&&i("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error(R,"[tk-sdk]Share screen in progress.");(o=Ve("screen",{video:!0,isWeb:!0})).mediaStream=e,o.needPublishToServer=!0,L.Logger.info(R,"[tk-sdk]calling screenPublish stream , stream id:"+o.getID()+" , extensionId is "+o.extensionId+", attrs is "+L.Utils.toJsonStringify(o.getAttributes())),void 0===N.remoteStreams[o.getID()]?et(o,t,function(e,t){e||L.Utils.isFunction(i)&&i(t,"[tk-sdk]please install the web sharing plug-in")}):(L.Logger.error(R,"[tk-sdk]Trying to publish invalid screenStream",o),L.Utils.isFunction(i)&&i(void 0,"[tk-sdk]Trying to publish invalid screenStream"))}(e,i,n)}},function(e){L.Logger.info(R,"[tk-sdk]No media stream from the plug-in was retrieved",e),L.Utils.isFunction(n)&&(e&&e.code&&e.message?n(e.code,e.message):n(void 0,"[tk-sdk]No media stream from the plug-in was retrieved"))},function(e){L.Logger.info(R,"[tk-sdk]Sharing has closed data."),N.stopShareScreen()}):L.Utils.isFunction(n)&&n(window.TK_ERR.CHECK_USERDesktopMediaError,"please install the web sharing plug-in")})))},N.stopShareScreen=function(e){if(bt(void 0,!0)&&St(void 0,!0)){var t=TK.SCREENSTATE_OFF;t!==mt()&&(N.changeUserShare(Re(),t,"tk_screenstate"),function(i){O.closeWebScreen();var e=Ue(Re()+":"+TK.STREAM_SCREEN);if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning(R,"[tk-sdk]Could not find the specify stream while stop sharing screen.");e.needPublishToServer=!1,L.Logger.info(R,"[tk-sdk]calling unpublishScreen , stream id:"+e.getID()+" , extensionId is "+e.extensionId+", attrs is "+L.Utils.toJsonStringify(e.getAttributes())),tt(e,function(e,t){e||L.Utils.isFunction(i)&&i(t),Pe(Re()+":"+TK.STREAM_SCREEN)&&Oe(Re()+":"+TK.STREAM_SCREEN)})}(e))}},p._handler_participantLeft=function(e,t){var i=D._users[e];if(void 0!==i){L.Logger.debug(R,"[tk-sdk]user left room  , user info: "+L.Utils.toJsonStringify(i)),L.Logger.info(R,"[tk-sdk]user left room  , user id: "+e),TK.isPlayback&&void 0!==t&&(i.leaveTs=t),TK.isPlayback?D._users[e]&&(D._users[e].playbackLeaved=!0):delete D._users[e];var o=TK.RoomEvent({type:TK.EVENT_TYPE.roomParticipantLeave,user:i});N.dispatchEvent(o)}else L.Logger.error(R,"[tk-sdk]participantLeft user is not exist , userid is "+e+"!")},p._handler_participantJoined=function(e){L.Logger.debug(R,"[tk-sdk]participantJoined userinfo:"+L.Utils.toJsonStringify(e));var t=TK.RoomUser(e);L.Logger.info(R,"[tk-sdk]user joined room  , user id : "+t.id),D._users[t.id]=t,TK.isPlayback&&D._users[t.id]&&delete D._users[t.id].playbackLeaved,TK.isPlayback&&"object"===Ft(e)&&(t.joinTs=e.ts);var i=TK.RoomEvent({type:TK.EVENT_TYPE.roomParticipantJoin,user:t});N.dispatchEvent(i)},p._handler_participantPublished=function(e){if(L.Logger.debug(R,"[tk-sdk]participantPublished userinfo:"+L.Utils.toJsonStringify(e)),D._roomMode===window.TK.ROOM_MODE.BIG_ROOM){var t=TK.RoomUser(e),i=D._users[t.id];if(i)for(var o in t)i[o]=t[o];else i=t;D._users[i.id]=i,TK.isPlayback&&D._users[i.id]&&delete D._users[i.id].playbackLeaved,TK.isPlayback&&"object"===Ft(e)&&(i.joinTs=e.ts)}},p._handler_sendMessage=function(e){if(L.Logger.debug(R,"[tk-sdk]room-text-message info:"+(e&&"object"===Ft(e)?L.Utils.toJsonStringify(e):e)),e&&e.hasOwnProperty("message")){var t=D._users[e.fromID];t||(t={id:e.fromID,nickname:t?t.nickname:e.nickname,role:t?t.role:e.role}),e&&e.message&&"string"==typeof e.message&&(e.message=L.Utils.toJsonParse(e.message)),TK.isPlayback&&void 0!==e.ts&&"object"===Ft(e.message)&&(e.message.ts=e.ts);var i=TK.RoomEvent({type:TK.EVENT_TYPE.roomTextMessage,user:t,message:e.message},{userid:e.fromID,nickname:t?t.nickname:e.nickname,role:t?t.role:e.role});N.dispatchEvent(i)}else L.Logger.error(R,"[tk-sdk]room-text-message messages or messages.message is not exist!")},p._handler_pubMsg=function(e){if(L.Logger.debug(R,"[tk-sdk]pubMsg info:",L.Utils.toJsonStringify(e)),e&&"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e.data&&"string"==typeof e.data&&(e.data=L.Utils.toJsonParse(e.data)),"OnlyAudioRoom"===e.name)return L.Logger.info(R,"[tk-sdk]pubMsg name : OnlyAudioRoom , from : ",e.fromID),void Be(!0,e.fromID);if("ClassBegin"===e.name&&L.Logger.info(R,"[tk-sdk]pubMsg name : ClassBegin , from : ",e.fromID),"DocumentChange"===e.name&&je(e),"RemoteControl"===e.name&&function(e){if(e&&e.data){var t=e.data.type,i={associatedMsgID:"ClassBegin",id:"RemoteControl",name:"RemoteControl",toID:e.fromID};switch(t){case"getDeviceInfo":TK.DeviceMgrImpl.getDevices(function(e){TK.isMultiCamera&&e.devices&&e.devices.videoinput&&delete e.devices.videoinput,i.data={action:"deviceManagement",type:"sendDeviceInfo",deviceData:{deviceInfo:e}},P.socketSend("pubMsg",i)},{isSetlocalStorage:!1});break;case"changeDeviceInfo":var o=e.data.changeData.selectDeviceInfo;TK.DeviceMgrImpl.setDevices(o,function(){L.Logger.error(R,"set devices failed")})}}}(e),"BigRoom"===e.name){D._roomMode=window.TK.ROOM_MODE.BIG_ROOM,$e(),L.Logger.info(R,"[tk-sdk]pubMsg name : BigRoom , roomMode : ",D._roomMode);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:D._roomMode}});N.dispatchEvent(t)}t=TK.RoomEvent({type:TK.EVENT_TYPE.roomPubmsg,message:e});N.dispatchEvent(t)},p._handler_delMsg=function(e){if(L.Logger.debug(R,"[tk-sdk]delMsg info:",L.Utils.toJsonStringify(e)),e&&"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e.data&&"string"==typeof e.data&&(e.data=L.Utils.toJsonParse(e.data)),"OnlyAudioRoom"===e.name)return L.Logger.info(R,"[tk-sdk]delMsg name : OnlyAudioRoom , from : ",e.fromID),void Be(!1,e.fromID);if("BigRoom"===e.name){D._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM,$e(),L.Logger.info(R,"[tk-sdk]delMsg name : BigRoom , roomMode : ",D._roomMode);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:D._roomMode}})}if("ClassBegin"===e.name){L.Logger.info(R,"[tk-sdk]delMsg name : ClassBegin , from : ",e.fromID);try{D._useServerScreenRecording&&xt()&&(L.Logger.info(R,"recoder class over,roomid is "+D._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(D._myself)),xt().over())}catch(e){L.Logger.error(R,"[tk-sdk]talkrecoder err:",e)}}t=TK.RoomEvent({type:TK.EVENT_TYPE.roomDelmsg,message:e});N.dispatchEvent(t)},p._handler_setProperty=function(e){L.Logger.debug(R,"[tk-sdk]setProperty info:",L.Utils.toJsonStringify(e));var t=e,i=t.id;if((i!==Re()||i===Re()&&Re()!==t.fromID)&&t.hasOwnProperty("properties")&&Mt(t.properties)&&L.Logger.info(R,"[tk-sdk]change user property,user id is "+i+",change property:"+L.Utils.toJsonStringify(t.properties)),t.hasOwnProperty("properties")){var o=t.properties,n=D._users[i];if(Re()===i)for(var r in n=D._myself,o)if("publishstate"===r||/publishstate:/g.test(r)){var a=Et(r),s=o[r];if(be(s,a),s>TK.PUBLISH_STATE_NONE)(l=Ce(a,!0))&&N.remoteStreams[l.getID()]&&Je(l);else if(s===TK.PUBLISH_STATE_NONE){(l=Ce(a))&&Z(l)}O.needRePublish(l.getID())&&vt(l)}else"disablevideo"===r?Se(o[r]):"disableaudio"===r&&we(o[r]);if(!n)return void(D._roomMode!==window.TK.ROOM_MODE.NORMAL_ROOM&&L.Logger.info(R,"[tk-sdk]setProperty user is not exist , userid is "+i+", change user property inof:"+L.Utils.toJsonStringify(e)+"!"));var d=n.servername,c=n.tk_maincamera;for(var r in o)"id"!=r&&"watchStatus"!=r&&(n[r]=o[r]);if(Re()!==n.id)for(var u in o)if("publishstate"===u||/publishstate:/g.test(u))for(var r in N.remoteStreams){var l;if((l=N.remoteStreams[r]).publisherId()!==Re()&&l.getAttributes().type===TK.STREAM_VIDEO&&o[u]>TK.PUBLISH_STATE_NONE&&N.remoteStreams[l.getID()])if("publishstate"===u)l.extensionId===n.id&&Je(l);else{a=Et(u);l.extensionId===n.id+":"+a&&Je(l)}}Re()===i&&o.hasOwnProperty("tk_maincamera")&&Re()!==t.fromID&&o.tk_maincamera!==c&&_t(o.tk_maincamera,function(e){L.Logger.warning(R,"[tk-sdk]other user control set main camera fail,fail info:",e),N.changeUserProperty(Re(),"__all",{tk_maincamera:c})}),Re()===i&&o.hasOwnProperty("servername")&&(Re()!==t.fromID?o.servername&&o.servername!==d&&N.switchServerByName(o.servername):o.servername&&o.servername!==d&&(D._serverName=o.servername,w(D._serverList,D._serverName)));var p=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserPropertyChanged,user:n,message:o},{fromID:t.fromID,userId:n.id});if(N.dispatchEvent(p),Re()!==n.id&&o.hasOwnProperty("tk_maincamera")){L.Logger.info(R,"[tk-sdk]change user main camera device id,user id is "+i+",change device id is "+o.tk_maincamera+",old device id is "+c);var f=TK.RoomEvent({type:TK.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:n.id,deviceId:o.tk_maincamera}});N.dispatchEvent(f)}}},a.onJoinPlaybackRoom=e,a.onSeekPlayback=function(e,t){if(bt(t,!0)){if(!TK.isPlayback)return L.Logger.warning(R,"[tk-sdk]No playback environment!"),void(L.Utils.isFunction(t)&&t("TK_ERR_NOT_PLAYBACK_ENVIRONMENT"));try{var i=Math.floor(Number(e*D._durationTime));i>D._durationTime&&(i=D._durationTime),P.socketSend("seekPlayback",i)}catch(e){L.Utils.isFunction(t)&&t("TK_ERR_UNKNOWN"),L.Logger.error(R,"[tk-sdk]The seek posttion must be a number, in milliseconds !")}}},a.onPausePlayback=t,a.onPlaybackClearAll=function(){if(TK.isPlayback){D._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM,L.Logger.info(R,"[tk-sdk]room mode changed,current mode is "+D._roomMode);var e=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:D._roomMode}});N.dispatchEvent(e);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackClear_all});N.dispatchEvent(t),TK.isPlayback?(ee(),D._users[Re()]=D._myself):L.Logger.error(R,"[tk-sdk]No playback environment, no execution playbackClearAll!")}else L.Logger.warning(R,"[tk-sdk]No playback environment!")},a.onHandlerDuration=function(e){if(TK.isPlayback){var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackDuration,message:e});D._durationTime=e,N.dispatchEvent(t)}else L.Logger.warning(R,"[tk-sdk]No playback environment!")},a.onHandlerPlaybackEnd=function(){if(TK.isPlayback){try{D._useServerScreenRecording&&xt()&&(L.Logger.info(R,"recoder class over,roomid is "+D._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(D._myself)),xt().over())}catch(e){L.Logger.error(R,"[tk-sdk]talkrecoder err:",e)}var e=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackPlaybackEnd});N.dispatchEvent(e)}else L.Logger.warning(R,"[tk-sdk]No playback environment!")},a.onHandlerPlaybackUpdateTime=function(e){if(TK.isPlayback){var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomPlaybackPlayback_updatetime,message:e});N.dispatchEvent(t)}else L.Logger.warning(R,"[tk-sdk]No playback environment!")},p._handler_connectSocketSuccess=function(e,t){if(D._isLeaveRoom)return L.Logger.info(R,"[tk-sdk]The room is over. Method _handler_connectSocketSuccess cannot be executed!"),void(P&&P.isHasSocket&&P.isHasSocket()&&N.leaveroom());TK.isTkNative&&!D._handlerCallbackJson&&(D._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",localId:Re().toString(),width:320,height:240,fps:10,roomInfo:D._roomCheckRoomInfoString,webAddr:D._web_host.toString(),webPort:D._web_port.toString(),tk_multistream:TK.isMultiCamera}));var i=t.roominfo,o=t.msglist,n=t.userlist,r=[],a=i.streams||[],s=i.id;for(var d in TK.networkTestInfo.protocol=D._web_protocol,TK.networkTestInfo.host=D._socket_host||D._web_host||"global.talk-cloud.net",TK.networkTestInfo.port=D._web_port||/https/g.test(D._web_protocol)?443:80,D._isConnected=!0,TK.networkTestInfo.isConnectRoom=!0,N.iceServers=i.iceServers,C.defaultVideoBW=D._room_video_maxbps,C.maxVideoBW=D._room_video_maxbps,C.defaultScreenBW=L.Utils.getMaxBPS(1280,20),C.maxScreenBW=L.Utils.getMaxBPS(1280,20),C.defaultLocalFileMediaBW=L.Utils.getMaxBPS(640,30),C.maxLocalFileMediaBW=L.Utils.getMaxBPS(640,30),D._users={},D._users[Re()]=D._myself,D._myself){if(TK.isMultiCamera){if(/publishstate:/g.test(d)&&D._myself[d]>TK.PUBLISH_STATE_NONE){var c=Et(d);Y(D._myself[d],void 0,void 0,c),et(v=Ce(c,!0))}}else if("publishstate"===d)if(D._myself[d]>TK.PUBLISH_STATE_NONE)Y(D._myself[d],void 0,void 0,void 0),et(v=Ce(void 0,!0))}for(var u in a)if(a.hasOwnProperty(u)){var l=a[u],p=!1;TK.subscribe_from_native&&(p=!0);var f=kt(l.extensionId),m=(kt(l.extensionId,1),!0),g="tksmall"===kt(l.extensionId,2)?1:0;n.forEach(function(e){e.id===f&&e.properties&&e.properties.tk_enabledualstream&&g!=K&&(m=!1)});var v=TK.Stream({streamID:l.id,local:!1,audio:l.audio,video:l.video,data:l.data,screen:l.screen,attributes:l.attributes,extensionId:l.extensionId,getVideoTrack:At,getAudioTrack:Rt,getRegisterAudioVolumeListener:Ct},p);r.push(v),N.remoteStreams[l.id]=v,L.Logger.info(R,"[tk-sdk]room-connected --\x3e stream info , stream id:"+v.getID()+" , extensionId is "+v.extensionId+", attrs is "+L.Utils.toJsonStringify(v.getAttributes())),m&&it(v)}for(var u in n)if(n.hasOwnProperty(u)){var h=n[u],T=TK.RoomUser(h);void 0!==T&&(D._users[T.id]=T,TK.isPlayback&&D._users[T.id]&&delete D._users[T.id].playbackLeaved,L.Logger.info(R,"[tk-sdk]room-connected --\x3e user info: "+L.Utils.toJsonStringify(T)))}L.Logger.info(R,"[tk-sdk]room-connected --\x3e myself info: "+L.Utils.toJsonStringify(D._myself));var y=new Array;(o&&"string"==typeof o&&(o=L.Utils.toJsonParse(o)),o.hasOwnProperty("OnlyAudioRoom"))?(Be(!0,o.OnlyAudioRoom.fromID),2===TK.needOnlyAudioRoom&&N.switchOnlyAudioRoom(!1)):1===TK.needOnlyAudioRoom&&N.switchOnlyAudioRoom(!0);o.hasOwnProperty("BigRoom")?(D._roomMode=window.TK.ROOM_MODE.BIG_ROOM,$e()):D._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM,L.Logger.info(R,"[tk-sdk]room mode changed,current mode is "+D._roomMode);var _=TK.RoomEvent({type:TK.EVENT_TYPE.roomModeChanged,message:{roomMode:D._roomMode}});for(var d in N.dispatchEvent(_),o)o.hasOwnProperty(d)&&y.push(o[d]);if(y.sort(function(e,t){return void 0!==e&&e.hasOwnProperty("seq")&&void 0!==t&&t.hasOwnProperty("seq")?e.seq-t.seq:0}),L.Logger.debug(R,"[tk-sdk]Connected to room "+s),L.Logger.debug(R,"[tk-sdk]connected response:",L.Utils.toJsonStringify(t)),L.Logger.info(R,"[tk-sdk]room-connected ,streams length is "+r.length+" , signalling list length "+y.length),U&&U.changeCommonWhiteBoardConfigration){for(var k=[],b=0,S=D._backup_doc_host_list.length;b<S;b++)k.push({protocol:D._backup_doc_protocol,hostname:D._backup_doc_host_list[b],port:D._backup_doc_port});U.changeCommonWhiteBoardConfigration({webAddress:{protocol:D._web_protocol,hostname:D._web_host,port:D._web_port},docAddress:{protocol:D._doc_protocol,hostname:D._doc_host,port:D._doc_port},backupDocAddressList:k,myUserId:Re(),myName:D._myself.nickname,myRole:D._myself.role,isConnectedRoom:D._isConnected,isPlayback:TK.isPlayback})}if(F+=1,!TK.isPlayback){var w=0;Ge(),clearInterval(N._networkequipmentTimer),clearInterval(N._catonNumber),clearInterval(N.sendcatonNumber),N._networkequipmentTimer=setInterval(function(){var d=[],c=!1;10<=++w&&(w=0,D._sentAloneNetQualityBadList={},c=!0);var u=0;for(var e in N.remoteStreams){var t=N.remoteStreams[e];t.getAttributes().type===TK.STREAM_VIDEO&&D._users[t.publisherId()]&&function(s){u++,at(s,function(e){if(u--,e&&D._users[s.publisherId()]){var t=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.video)),i=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.audio));delete t.packetsLostRate,delete i.packetsLostRate;var o={video:t,audio:i,cpuOccupancy:0,peerId:D._users[s.publisherId()].id,peerName:D._users[s.publisherId()].nickname,streamId:s.getID()};N.remoteStreams[s.getID()].width=t.frameWidth,N.remoteStreams[s.getID()].height=t.frameHeight,N.remoteStreams[s.getID()].frameRate=t.frameRate;var n=[];n.push(o);var r={};if(s&&s.extensionId&&s.extensionId.split&&(r=O.getVideoProfile(s.extensionId.split(":")[1])),rt(n,s,r.maxfps),(!c&&e.audio.netquality>=window.TK.NET_QUALITY.TK_NET_QUALITY_BAD||e.video.netquality>=window.TK.NET_QUALITY.TK_NET_QUALITY_BAD)&&!D._sentAloneNetQualityBadList[s.getID()]){D._sentAloneNetQualityBadList[s.getID()]=!0;var a=[];a.push(o),rt(a,s)}c&&(D._isSendAllPublishUserNetworkequipment?d.push(o):s.publisherId()===Re()&&d.push(o),u<=0&&(c=!1,rt(d,s)))}s=void 0},function(){u--})}(t)}},6e3),N._catonNumber=setInterval(function(){var e=[];for(var t in N.remoteStreams){var i=N.remoteStreams[t];i.getAttributes().type===TK.STREAM_VIDEO&&D._users[i.publisherId()]&&function(n){try{e.push(new Promise(function(t,e){at(n,function(e){if(e.video&&e.video.frameRate<3){var i="",o=0;n&&n.extensionId&&n.extensionId.split&&n.extensionId.split(":")[0]!==D._myself.id&&(i=n.extensionId.split(":")[0]),i&&(J.hasOwnProperty(i)?J[i]+=1:J[i]=1,j.forEach(function(e,t){e.peerid===i&&(o+=1,e.count+=1)}),o||j.push({peerid:i,count:0}))}n.extensionId&&n.extensionId.split&&N.getMySelf().id===n.extensionId.split(":")[0]&&(e.isMe=!0),t(e),n=void 0})}))}catch(e){L.Logger.warning(R,"[tk-sdk]catonNumber method was a slight problem with the handling.")}}(i)}Promise.all(e).then(function(e){var t=[],i=[],o=0,n=0;e.forEach(function(e){e.isMe?t.push(e):i.push(e)}),W.audioDelay=0,W.videoDelay=0,t.forEach(function(e){e&&e.audio&&(W.outAudioKBitRate+=e.audio.bitsPerSecond?e.audio.bitsPerSecond:0,W.outBytes+=e.audio.audioBytesSent?e.audio.audioBytesSent:0,W.outPackets+=e.audio.totalPackets?e.audio.totalPackets:0,W.audioDelay+=e.audio.currentDelay?e.audio.currentDelay:0,o+=1),e&&e.video&&(W.outVideoKBitRate+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,W.outBytes+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,W.outPackets+=e.video.totalPackets?e.video.totalPackets:0,W.videoDelay+=e.video.currentDelay?e.video.currentDelay:0,n+=1)}),W.audioDelay=isNaN(parseInt(W.audioDelay/o))?0:parseInt(W.audioDelay/o),W.videoDelay=isNaN(parseInt(W.videoDelay/n))?0:parseInt(W.videoDelay/n),i.forEach(function(e){e&&e.audio&&(W.inAudioKBitRate+=e.audio.bitsPerSecond?e.audio.bitsPerSecond:0,W.inBytes+=e.audio.audioBytesSent?e.audio.audioBytesSent:0,W.inPackets+=e.audio.totalPackets?e.audio.totalPackets:0),e&&e.video&&(W.inVideoKBitRate+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,W.inBytes+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,W.inPackets+=e.video.totalPackets?e.video.totalPackets:0)});var r=(new Date).getTime()-TK.connectTimer;W.duration=0<=r?r:0;var a=TK.RoomEvent({type:TK.EVENT_TYPE.roomRtcStatsReportEvent,message:{stats:W}});N.dispatchEvent(a)}).catch(function(e){L.Logger.warning(R,"[tk-sdk]catonNumber promise error info :",e)})},1e3),N.sendcatonNumber=setInterval(function(){try{if(!j||!j.length)return;L.Utils.isArray(j)&&(j=j.filter(function(e){return e.count}));var e={serial:D._room_properties.serial,companyid:D._room_properties.companyid,peerid:D._myself.id,statistics:j,streamstat:Object.values(H)},t=D._web_protocol+"://"+D._web_host+":"+D._web_port+"/ClientAPI/networkequipmentcount?ts="+(new Date).getTime();L.Utils.sdkAjax({url:t,dataType:"json",type:"POST",async:!0,data:e,success:function(e){j=[]},error:function(e,t,i){L.Logger.error(R,"[tk-sdk]sendcatonNumber fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}catch(e){L.Logger.warning(R,"[tk-sdk]sendcatonNumber method was a slight problem with the handling.")}},6e4)}var I=M;M=x=0;try{D&&D._useServerScreenRecording&&xt()&&(L.Logger.info(R,"recoder class set state,state is "+window.TK.TALKRECODER.STATE_ROOM_CONNECTED+",roomid is "+D._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(D._myself)),xt().setstate(window.TK.TALKRECODER.STATE_ROOM_CONNECTED))}catch(e){L.Logger.error(R,"[tk-sdk]talkrecoder err:",e)}G={checkRoomCount:0,joinRoomCount:0,getConfigCount:0,checkRoomPlaybackCount:0};var E=q&&0<F,A=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnected,streams:r,message:y},{httpTime:E?Date.now()-B:V-B,socketTime:I,reconnectCount:F,isReconnect:E});L.Logger.info(R,"[tk-sdk]Test connect success info:",JSON.stringify({httpTime:E?Date.now()-B:V-B,socketTime:I,reconnectCount:F,isReconnect:E})),N.dispatchEvent(A),TK.connectTimer=(new Date).getTime()},p._handler_connectSocketFail=function(e){if(D._isLeaveRoom)L.Logger.info(R,"[tk-sdk]The room is over. Method _handler_connectSocketFail cannot be executed!");else{L.Logger.error(R,"[tk-sdk]Not Connected! Error: "+e);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomError,message:{source:"joinRoom",error:window.TK_ERR.ROOM_JOIN_FAILED,errorCode:window.TK_ERR.ROOM_JOIN_FAILED}});if(N.dispatchEvent(t),G.joinRoomCount++,5<=G.joinRoomCount){var i=q&&0<F,o=TK.RoomEvent({type:TK.EVENT_TYPE.roomConnectFail,message:{source:"joinRoom",error:window.TK_ERR.ROOM_JOIN_FAILED,errorCode:window.TK_ERR.ROOM_JOIN_FAILED}},{httpTime:i?Date.now()-B:V-B,socketTime:i?B-V:Date.now()-V,reconnectCount:F,isReconnect:i});L.Logger.info(R,"[tk-sdk]Test connect fail info:",JSON.stringify({httpTime:i?Date.now()-B:V-B,socketTime:tempConnTime,reconnectCount:F,isReconnect:i})),N.dispatchEvent(o)}}},l.onNativeStartShareMediaFile=function(e,t,i,o){var n=TK.MEDIAFILESTATE_ON;if(n!==gt()){N.changeUserShare(Re(),n,"tk_mediafilestate");var r=Ue(Re()+":file");if(!L.Utils.isNull(r))return L.Utils.isFunction(i)&&i("TK_ERR_OPERATION_IN_PROGRESS"),void L.Logger.error(R,"[tk-sdk]Share media file in progress.");r=Ve("file",e),o&&o.IgnoreElementId?(r.create(),l.pauseShareMediaFile(!0)):r.play(t),r.needPublishToServer=!0,L.Logger.info(R,"[tk-sdk]calling localFilePublish stream , stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes())),r&&void 0===N.remoteStreams[r.getID()]?et(r,function(e,t){e||L.Utils.isFunction(i)&&i(t)}):(L.Logger.error(R,"[tk-sdk]Trying to publish invalid LocalFileStream",r),L.Utils.isFunction(i)&&i(void 0,"Trying to publish invalid LocalFileStream"))}},l.onNativeStopShareMediaFile=function(i){var e=TK.MEDIAFILESTATE_OFF;if(e!==gt()){N.changeUserShare(Re(),e,"tk_mediafilestate");var t=Ue(Re()+":file");if(L.Utils.isNull(t))return L.Utils.isFunction(i)&&i("TK_ERR_OPERATION_TERMINATED"),void L.Logger.warning(R,"[tk-sdk]Could not find the specify stream while stop sharing media file.");t.stop(),t.needPublishToServer=!1,L.Logger.info(R,"[tk-sdk]calling unpublishLocalFile , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),tt(t,function(e,t){e||L.Utils.isFunction(i)&&i(t)}),Pe(Re()+":"+TK.STREAM_FILE)&&Oe(Re()+":"+TK.STREAM_FILE)}},l.onNativeStartShareScreen=function(e,i){var t=Ue(Re()+":screen");if(!L.Utils.isNull(t))return L.Utils.isFunction(i)&&i("TK_ERR_OPERATION_IN_PROGRESS"),void L.Logger.error(R,"[tk-sdk]Share screen in progress.");(t=Ve("screen",e)).needPublishToServer=!0,L.Logger.info(R,"[tk-sdk]calling screenPublish stream , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),void 0===N.remoteStreams[t.getID()]?et(t,void 0,function(e,t){e||L.Utils.isFunction(i)&&i(t)}):(L.Logger.error(R,"[tk-sdk]Trying to publish invalid screenStream",t),L.Utils.isFunction(i)&&i(void 0,"Trying to publish invalid screenStream"))},l.onNativeStopShareScreen=function(i){var e=Ue(Re()+":"+TK.STREAM_SCREEN);if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("TK_ERR_OPERATION_TERMINATED"),void L.Logger.warning(R,"[tk-sdk]Could not find the specify stream while stop sharing screen.");e.needPublishToServer=!1,L.Logger.info(R,"[tk-sdk]calling unpublishScreen , stream id:"+e.getID()+" , extensionId is "+e.extensionId+", attrs is "+L.Utils.toJsonStringify(e.getAttributes())),tt(e,function(e,t){e||L.Utils.isFunction(i)&&i(t)}),Pe(Re()+":"+TK.STREAM_SCREEN)&&Oe(Re()+":"+TK.STREAM_SCREEN)},l.onNativeNotification=function(e){if("object"===Ft(e))switch(e.name){case"onMediaFileEnded":(o=Ee(Re(),"file"))&&l.pauseShareMediaFile(!0);var t=TK.RoomEvent({type:TK.EVENT_TYPE.roomClientNotificationOnMediaFileEnded});N.dispatchEvent(t);break;case"onRemoteAudioVolume":var i=e.args;if(!L.Utils.isNull(i)){var o,n=i.type||TK.STREAM_VIDEO;(o=Ee(i.id,n))&&L.Utils.isFunction(o.onRemoteAudioVolume)&&o.onRemoteAudioVolume(i.volume)}break;case"onAudioStatsDelivered":e&&"object"===Ft(e.args)&&dt(e.args.connectionId,e.args.stats,!1);break;case"onVideoStatsDelivered":e&&"object"===Ft(e.args)&&dt(e.args.connectionId,e.args.stats,!0);break;default:var r=TK.RoomEvent({type:TK.EVENT_TYPE.roomNativeNotification,message:e});N.dispatchEvent(r)}},l.onMicVolumeReport=function(e){if("object"===Ft(e)){var t=Ee(Re(),TK.STREAM_VIDEO,D._mainCameraDeviceId);t&&L.Utils.isFunction(t.onMicVolumeReport)&&t.onMicVolumeReport(e.volume)}},l.onPauseMediaFile=function(e){var t=Ee(Re(),TK.STREAM_FILE);t&&N.remoteStreams[t.getID()]&&"file"===t.getAttributes().type&&P.controlMedia(t.getID(),{type:"pause",pause:e})},l.onSeekMediaFile=function(e){var t=Ee(Re(),TK.STREAM_FILE);if(t&&N.remoteStreams[t.getID()]&&"file"===t.getAttributes().type){var i=parseInt(e*t.getAttributes().duration);i>t.getAttributes().duration&&(i=t.getAttributes().duration),P.controlMedia(t.getID(),{type:"seek",pos:i})}},l.onNativeWindowClose=function(){var e=TK.RoomEvent({type:TK.EVENT_TYPE.roomClientClose});N.dispatchEvent(e)},TK.DeviceMgrImpl.onDevicesSetted=function(e,t,i){TK.isMultiCamera&&void 0!==e.videoinput&&e.videoinput!==D._mainCameraDeviceId&&(L.Utils.isVideoinputDeviceIdFromDeviceList(e.videoinput)?_t(e.videoinput):(L.Logger.warning(R,"[tk-sdk]The device id("+e.videoinput+") is not in the video device list,not allow set main camera!"),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,D._mainCameraDeviceId)));for(var o=Ae(TK.STREAM_VIDEO),n=0,r=o.length;n<r;n++){var a=o[n];TK.isMultiCamera||void 0!==e.videoinput&&e.videoinput!==a.videoinputDeviceId&&Tt(a,e.videoinput),void 0!==e.audioinput&&e.audioinput!==a.audioinputDeviceId&&yt(a,e.audioinput)}},TK.DeviceMgrImpl.onCameraSetted=function(e,t,i){TK.isMultiCamera&&void 0!==e&&e!==D._mainCameraDeviceId&&(L.Utils.isVideoinputDeviceIdFromDeviceList(e)?_t(e):(L.Logger.warning(R,"[tk-sdk]The device id("+e+") is not in the video device list,not allow set main camera!"),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,D._mainCameraDeviceId))),ht(L.Constant.deviceStorage.videoinput,e)},TK.DeviceMgrImpl.onMicrophoneSetted=function(e,t,i){ht(L.Constant.deviceStorage.audioinput,e)},TK.DeviceMgrImpl.onSpeakerSetted=function(e,t,i){},TK.DeviceMgrImpl.onDeviceChanged=function(h,T,y,_){for(var e in T)if("videoinput"===e||"audioinput"===e){var t=T[e];if(t&&t.length)for(var i=0,o=t.length;i<o;i++)if(t[i]){var n=t[i].deviceId;if("videoinput"===e)(c=Ce(n))&&c.removeVideoTrack(),O.hasDeviceVideoTrack(n)&&O.destroyVideoTrack(n);else if("audioinput"===e){var r=0;for(o=(d=Ae(TK.STREAM_VIDEO)).length;r<o;r++){(c=d[r]).audioinputDeviceId===n&&c.removeAudioTrack()}O.hasDeviceAudioTrack(n)&&O.destroyAudioTrack(n)}}}for(var e in h)if("videoinput"===e||"audioinput"===e){var a=h[e];if(a&&a.length)for(i=0,o=a.length;i<o;i++)if(a[i]){var s=a[i].deviceId;if("videoinput"===e)(c=Ce(s))&&c.videoinputDeviceId===s&&Tt(c,c.videoinputDeviceId,!0);else if("audioinput"===e){var d;for(r=0,o=(d=Ae(TK.STREAM_VIDEO)).length;r<o;r++){var c;(c=d[r]).audioinputDeviceId===s&&yt(c,c.audioinputDeviceId,!0)}}}}if(D._autoProcessDevChangeEvent){var k=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);O.getDeviceMgr().getDevices(function(e){var t,i,o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),n=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),r=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);if(k!==r&&(TK.isTkNative?O.getDeviceMgr().setDevices({audiooutput:r}):O.getDeviceMgr().associateElementsToSpeaker(void 0,r)),D._myself){var a=e.hasdevice,s={},d={},c=!1;d.hasvideo=D._myself.hasvideo,d.hasaudio=D._myself.hasaudio,D._myself.hasvideo!==a.videoinput&&(s.hasvideo=a.videoinput,D._myself.hasvideo=s.hasvideo,c=!0),D._myself.hasaudio!==a.audioinput&&(s.hasaudio=a.audioinput,D._myself.hasaudio=s.hasaudio,c=!0),c&&(L.Logger.info(R,"[tk-sdk]change device:my old device info  [hasvideo , hasaudio] is ["+d.hasvideo+" ,"+d.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(s)),D._isConnected&&N.changeUserProperty(Re(),"__all",s));for(var u=Ae(TK.STREAM_VIDEO),l=0,p=u.length;l<p;l++){var f=u[l];n!==f.audioinputDeviceId&&yt(f,n),TK.isMultiCamera||o!==f.videoinputDeviceId&&Tt(f,o)}if(TK.isMultiCamera){var m=T.videoinput;if(m)for(l=0,p=m.length;l<p;l++)if(m[l]){var g=m[l].deviceId;t=g,void 0,((i=TK.isMultiCamera?ft(t):D._myself.publishstate)===TK.PUBLISH_STATE_VIDEOONLY||i===TK.PUBLISH_STATE_BOTH)&&N.unpublishVideo(g),g===D._mainCameraDeviceId&&_t(Te())}var v=h.videoinput;v&&v.length&&(D._mainCameraDeviceId||_t(Te()))}}L.Utils.isFunction(_)&&_(h,T,y)},{isSetlocalStorage:!0})}else{if(TK.isMultiCamera){var u=T.videoinput;if(u&&u.length){for(i=0,o=u.length;i<o;i++){if(u[i])u[i].deviceId===D._mainCameraDeviceId&&_t(Te())}D._mainCameraDeviceId||_t(Te())}var l=h.videoinput;l&&l.length&&(D._mainCameraDeviceId||_t(Te()))}L.Utils.isFunction(_)&&_(h,T,y)}},O.getDeviceMgr().getDevices(),N},window.TK=window.TK||{},window.L=window.L||{},TK.RoomUser=function(e){if(null!=e&&void 0!==e.properties){var t=e.id,i=e.properties;L.Logger.debug("RoomUser","[tk-sdk]RoomUser",t,i);var o={};for(var n in o.id=t,o.watchStatus=0,i)"id"!=n&&"watchStatus"!=n&&(o[n]=i[n]);return o.publishstate=o.publishstate||TK.PUBLISH_STATE_NONE,o.hasOwnProperty("tk_screenstate")||(o.tk_screenstate=TK.SCREENSTATE_OFF),o.hasOwnProperty("tk_mediafilestate")||(o.tk_mediafilestate=TK.MEDIAFILESTATE_OFF),o.hasOwnProperty("tk_enabledualstream")||(o.tk_enabledualstream=TK.ENABLEDUALSTREAM_OFF),o.getId=function(){return t},o.nickName=function(){return i.nickname},o.userRole=function(){},o.hasVideo=function(){},o.hasAudio=function(){},o.publishState=function(e){var t="publishstate";return L.Utils.isNull(e)&&(t+=":"+e),i[t]},o.videoStatus=function(e){var t="publishstate";L.Utils.isNull(e)&&(t+=":"+e);i[t];return i[t]},o.audioStatus=function(){},o.enableDualStream=function(){return!!o.hasOwnProperty("tk_enabledualstream")&&i.tk_enabledualstream},o.getValue=function(e){return o.hasOwnProperty(e)?i[e]:null},o}L.Logger.warning("RoomUser","[tk-sdk]Invalidate user info",t,i)},window.TK=window.TK||{},window.L=window.L||{},TK.Signalling=function(){var o={},i=null,n="Signalling";function r(){if(arguments.length){var e=arguments[0];if("function"==typeof o[e]){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);o[e].apply(o[e],t)}}}return o.sendMessageSocket=function(e,t,i){L.Logger.debug(n,"[tk-sdk]sendMessageSocket",e,t),o.socketSend(e,t,i)},o.connectSocket=function(e,t){(t=t||{}).secure=!L.Utils.isBoolean(t.secure)||t.secure,t.reconnection=!L.Utils.isBoolean(t.reconnection)||t.reconnection,t.transports=Array.isArray(t.transports)?t.transports:["websocket"],window.TK.socketIO?((i=window.TK.socketIO.connect(e,{secure:t.secure,reconnection:t.reconnection,transports:t.transports})).on("connect_error",r.bind(r,"onConnectError")),i.on("connect",r.bind(r,"onConnect")),i.on("onAddStream",r.bind(r,"onAddStream")),i.on("signaling_message_mediaserver",r.bind(r,"onSignalingMessageMediaserver")),i.on("onUpdateAttributeStream",r.bind(r,"onUpdateAttributeStream")),i.on("publish_failed",r.bind(r,"onPublishFailed")),i.on("subscribe_failed",r.bind(r,"onSubscribeFailed")),i.on("onRemoveStream",r.bind(r,"onRemoveStream")),i.on("disconnect",r.bind(r,"onDisconnect")),i.on("reconnecting",r.bind(r,"onReconnecting")),i.on("participantLeft",r.bind(r,"onParticipantLeft")),i.on("participantJoined",r.bind(r,"onParticipantJoined")),i.on("participantPublished",r.bind(r,"onParticipantPublished")),i.on("participantEvicted",r.bind(r,"onParticipantEvicted")),i.on("sendMessage",r.bind(r,"onSendMessage")),i.on("msgList",r.bind(r,"onMsgList")),i.on("pubMsg",r.bind(r,"onPubMsg")),i.on("delMsg",r.bind(r,"onDelMsg")),i.on("setProperty",r.bind(r,"onSetProperty")),i.on("playback_clearAll",r.bind(r,"onPlaybackClearAll")),i.on("duration",r.bind(r,"onDuration")),i.on("playbackEnd",r.bind(r,"onPlaybackEnd")),i.on("playback_updatetime",r.bind(r,"onPlaybackUpdatetime")),i.on("forceReconnect",r.bind(r,"onForceReconnect"))):L.Logger.error(n,"[tk-sdk]socket.io is not exist,please link socket.io,for example: window.TK.SocketIO = io (io is the socket.io that you want to associate with)!")},o.socketSend=function(){if(arguments.length&&i)if("string"==typeof arguments[0]){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);i.emit.apply(i,e)}else L.Logger.warning(n,"[tk-sdk] PARAMETER ERROR ")},o.controlMedia=function(e,t){i&&i.emit("controlmedia",e,t)},o.isHasSocket=function(){return!!i},o.emptySocket=function(){i=void 0},o.socketDisconnect=function(){i&&i.disconnect()},o}(),window.TK=window.TK||{},window.L=window.L||{},TK.Stream=function(e,t){return t?TK.NativeStream(e):TK.StreamInner(e)},TK.StreamInner=function(e){var r=TK.EventDispatcher(e),o=void 0,i=void 0,n=void 0,a=!1,s="Stream";void 0!==e.video&&"number"==typeof e.video&&(e.video=0!==e.video),void 0!==e.audio&&"number"==typeof e.audio&&(e.audio=0!==e.audio),r.classInstanceName="Stream",r.url=e.url,r.local=!L.Utils.isBoolean(e.local)||e.local,r.video=e.video,r.audio=e.audio,r.screen=e.screen,r.scale=e.scale,r.media=e.media,r.data=e.data,r.extensionId=e.extensionId,r.path=e.path||"",r.attributes=e.attributes||{},r.isTkNative=!1,r.streamID=e.streamID,r.audioinputDeviceId=e.audioinputDeviceId,r.videoinputDeviceId=e.videoinputDeviceId,r.subscribed=e.subscribed||!1,r.subscribeFailCount=0,r.publishFailCount=0;var d=e.getVideoTrack,c=e.getAudioTrack,t=e.getRegisterAudioVolumeListener,u={onSuccess:void 0,onFailure:void 0,interval:100,isWaiting:!1},l=void 0,p=void 0,f=void 0,m={};function g(){if(h(),v(),"function"!=typeof u.onSuccess)return L.Logger.error(s,"[tk-sdk] intervalCallback must is function!"),void(L.Utils.isFunction(u.onFailure)&&u.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function"));try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext}catch(e){return L.Logger.error(s,"[tk-sdk]startIntervalGetRealtimeVolume:Web Audio API(audioContext) not supported"),void(L.Utils.isFunction(u.onFailure)&&u.onFailure(e))}try{o&&o.stop&&(o.stop(),o=void 0),o=null,r&&r.attributes&&TK.audioContext&&TK.DeviceMgrImpl&&TK.DeviceMgrImpl.getsSoundMeterInstance?L.Utils.isFunction(c)&&c(r.getID(),r.publisherId(),r.attributes.type,{audioinputDeviceId:r.audioinputDeviceId},function(e){o=void 0,h(),L.Utils.isFunction(u.onSuccess)||v();var t=L.Utils.createMediaStream();t&&e?(t.addTrack(e),(o=TK.DeviceMgrImpl.getsSoundMeterInstance(TK.audioContext,{mediaStream:t}))&&o.connectToSource?o.connectToSource(t,function(e){if(h(),L.Utils.isFunction(u.onSuccess)||v(),e)return L.Logger.error(s,"[tk-sdk]startIntervalGetRealtimeVolume connectToSource error:",e),v(),void(L.Utils.isFunction(u.onFailure)&&u.onFailure(e));if(o){if(o&&o.instant&&o.instant.toFixed){var t=Math.floor(100*o.instant.toFixed(2));L.Utils.isFunction(u.onSuccess)&&u.onSuccess(t)}else L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0);clearInterval(i),i=setInterval(function(){if(L.Utils.isFunction(u.onSuccess))if(o&&o.instant&&o.instant.toFixed){var e=Math.floor(100*o.instant.toFixed(2));u.onSuccess(e)}else u.onSuccess(0);else v()},u.interval)}else L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)}):L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)):L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)},function(e){o=void 0,L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)}):L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)}catch(e){L.Logger.error(s,"[tk-sdk]startIntervalGetRealtimeVolume error :",e),L.Utils.isFunction(u.onFailure)&&u.onFailure(e)}}function v(){o&&o.stop&&o.stop(),clearInterval(i),i=o=void 0,h()}function h(){L.Utils.isFunction(t)&&(u=t(r.publisherId(),r.attributes.type)),u||(u={onSuccess:void 0,onFailure:void 0,interval:100,isWaiting:!1})}return Object.defineProperties(m,{videoTrackChangeProfile:{value:TK.DeviceMgrImpl.videoTrackChangeProfileEventName,writable:!1,enumerable:!0}}),r.onVideoTrackChangeProfile=function(e){var t=(e=e||{}).data;if(t&&r.hasVideoTrack()&&t.ikey===r.videoinputDeviceId){var i=r.getVideoTrack();TK.DeviceMgrImpl.videoTrackapplyConstraints(i,t.videoprofile,function(){L.Logger.info(s,"[tk-sdk]onVideoProfilechange, profile:",t.videoprofile," ,readyState: ",i.readyState," , videoinputDeviceId is "+r.videoinputDeviceId)})}},r.getID=function(){return r.local&&!r.streamID?"local":r.streamID},r.id=r.getID(),r.destroy=function(){r.local&&TK.DeviceMgrImpl.removeEventListener(m.videoTrackChangeProfile,r.onVideoTrackChangeProfile),r.stopIntervalGetRealtimeVolume(),r.removeAudioTrack(),r.removeVideoTrack(),l&&r.unplayVideo(),p&&r.unplayAudio()},r.publisherId=function(){var e=r.extensionId.split(":");return e.length?e[0]:r.extensionId},r.getAttributes=function(){return r.attributes},r.setAttributes=function(e){r.updateLocalAttributes(e)},r.updateLocalAttributes=function(e){if(e&&"object"===Ft(e))for(var t in e)r.attributes[t]=e[t]},r.hasAudio=function(){return r.audio},r.hasVideo=function(){return r.video},r.hasScreen=function(){return r.screen},r.hasMedia=function(){return r.media},r.hasData=function(){return r.data},r.hasVideoPlayer=function(){return!!l},r.getVideoPlayer=function(){return l},r.hasAudioPlayer=function(){return!!p},r.getAudioPlayer=function(){return p},r.getVideoPlayerElementId=function(){return f},r.playVideo=function(e,t,i){if(t=t||{},void 0!==e&&(l&&r.unplayVideo(),f=e,r.local&&(t.mirror=L.Utils.isBoolean(t.mirror)?t.mirror:a),l=i||new TK.VideoPlayer({id:r.extensionId,elementID:e,local:r.local,type:r.attributes.type,userid:r.publisherId(),bundleId:r.extensionId,extensionId:r.extensionId,options:t}),TK.isOnlyAudioRoom&&l.hideVideo(),L.Utils.isFunction(d))){var o="videoplayer_"+(new Date).getTime();l.videoTrackTempId=o,d(r.getID(),r.publisherId(),r.attributes.type,{videoinputDeviceId:r.videoinputDeviceId},function(e){l&&o===l.videoTrackTempId&&(l.hasVideoTrack()&&l.removeVideoTrack(),l.addVideoTrack(e))},function(e){L.Logger.info(s,"[tk-sdk]playVideo:getVideoTrack fail,fail info:",e)})}},r.replaceStream=function(e,t){if(e.playVideo){var i=r.getVideoPlayerElementId(),o=r.getVideoPlayerOptions(),n=new TK.VideoPlayer({id:e.extensionId,elementID:i,local:e.local,type:e.attributes.type,userid:e.publisherId(),bundleId:e.extensionId,extensionId:e.extensionId,options:o,isClone:!0});e.playVideo(r.getVideoPlayerElementId(),r.getVideoPlayerOptions(),n),L.Utils.mediaPlay(n.video,function(e){0===e&&(n.container.style.zIndex="1",n.oldContainer&&n.container.parentNode.removeChild(n.oldContainer),n.oldContainer=void 0,L.Utils.isFunction(t)&&t(0,n))})}},r.playAudio=function(e){if(e=e||{},!document.getElementById("TKSDK_audioPlayer_list_container")){var t=document.createElement("div");t.setAttribute("id","TKSDK_audioPlayer_list_container"),t.style.display="none",document.body.appendChild(t)}if(p&&r.unplayAudio(),p=new TK.AudioPlayer({id:r.extensionId,elementID:"TKSDK_audioPlayer_list_container",local:r.local,type:r.attributes.type,userid:r.publisherId(),bundleId:r.extensionId,extensionId:r.extensionId,options:e}),L.Utils.isFunction(c)){var i="audioplayer_"+(new Date).getTime();p.audioTrackTempId=i,c(r.getID(),r.publisherId(),r.attributes.type,{audioinputDeviceId:r.audioinputDeviceId},function(e){p&&i===p.audioTrackTempId&&(p.hasAudioTrack()&&p.removeAudioTrack(),p.addAudioTrack(e))},function(e){L.Logger.debug(s,"[tk-sdk]playAudio:getAudioTrack fail,fail info:",e)})}r.local&&r.attributes.type===TK.STREAM_VIDEO||(h(),u.isWaiting&&void 0===o&&g())},r.unplayVideo=function(){l&&l.destroy(),l=void 0,r.local&&r.attributes.type===TK.STREAM_VIDEO||p||v()},r.unplayAudio=function(){p&&p.destroy(),p=void 0,r.local&&r.attributes.type===TK.STREAM_VIDEO||v()},r.getVideoPlayerOptions=function(){if(l&&l.getVideoPlayerOptions)return l.getVideoPlayerOptions()},r.updateVideoPlayerOptions=function(e){l&&l.updateVideoPlayerOptions&&l.updateVideoPlayerOptions(e)},r.updateAudioPlayerOptions=function(e){p&&p.updateAudioPlayerOptions&&p.updateAudioPlayerOptions(e)},r.showVideo=function(){l&&l.showVideo()},r.hideVideo=function(){l&&l.hideVideo()},r.getAudioTrack=function(){p&&p.getAudioTrack()},r.hasAudioTrack=function(){p&&p.hasAudioTrack()},r.removeAudioTrack=function(){p&&p.removeAudioTrack()},r.addAudioTrack=function(e){r.hasAudioTrack()&&r.removeAudioTrack(),p&&p.addAudioTrack(e),h(),v(),u.isWaiting&&void 0===o&&g()},r.getVideoTrack=function(){var e;return l&&(e=l.getVideoTrack()),e},r.hasVideoTrack=function(){var e=!1;return l&&(e=l.hasVideoTrack()),e},r.removeVideoTrack=function(){l&&l.removeVideoTrack()},r.addVideoTrack=function(e){r.hasVideoTrack()&&r.removeVideoTrack(),l&&l.addVideoTrack(e)},r.setMute=function(e){p&&p.setMute&&p.setMute(e)},r.setVolume=function(e){if(p&&p.setVolume){if("number"!=typeof e)return void L.Logger.error(s,"[tk-sdk]Stream setVolume volume type must is number!");p.setVolume(e)}},r.getVolume=function(e){return p&&p.getVolume?p.getVolume(e):(L.Utils.isFunction(e)&&e(0),0)},r.startIntervalGetRealtimeVolume=function(){r.stopIntervalGetRealtimeVolume(),h(),g()},r.stopIntervalGetRealtimeVolume=function(){v(),h()},r.hideLoading=function(){l&&l.hideLoading&&l.hideLoading()},r.showLoading=function(){l&&l.showLoading&&l.showLoading()},r.getVideoElement=function(){return l&&l.video},r.setLocalVideoMirror=function(e){r.local&&(a=e,r.updateVideoPlayerOptions({mirror:e}))},r.getRealtimeVolume=function(i,o){if(!L.Utils.isFunction(i))return L.Logger.error(s,"[tk-sdk] getRealtimeVolume: onVolume is not function"),void(L.Utils.isFunction(o)&&o("TK_ERR_INVALID_ARG"));try{n&&n.stop&&(n.stop(),n=void 0),window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext,r&&r.attributes&&TK.audioContext&&TK.DeviceMgrImpl&&TK.DeviceMgrImpl.getsSoundMeterInstance?L.Utils.isFunction(c)&&c(r.getID(),r.publisherId(),r.attributes.type,{audioinputDeviceId:r.audioinputDeviceId},function(e){var t=L.Utils.createMediaStream();t&&e?(t.addTrack(e),(n=TK.DeviceMgrImpl.getsSoundMeterInstance(TK.audioContext,{mediaStream:t}))&&n.connectToSource?n.connectToSource(t,function(e){if(e)return L.Logger.error(s,"[tk-sdk]getRealtimeVolume connectToSource error:",e),void(L.Utils.isFunction(o)&&o(e));if(n&&n.instant&&n.instant.toFixed){var t=Math.floor(100*n.instant.toFixed(2));i(t)}else i(0);n&&n.stop&&(n.stop(),n=void 0)}):i(0)):i(0)},function(e){i(0)}):i(0)}catch(e){L.Logger.error(s,"[tk-sdk]getRealtimeVolume:Web Audio API(audioContext) not supported",e),L.Utils.isFunction(o)&&o(e)}},r.updateExtensionId=function(e){r.extensionId=e,l&&l.updateVideoPlayerSpec&&l.updateVideoPlayerSpec({id:r.extensionId,userid:r.publisherId(),bundleId:r.extensionId,extensionId:r.extensionId}),p&&p.updateAudioPlayerSpec&&p.updateAudioPlayerSpec({id:r.extensionId,userid:r.publisherId(),bundleId:r.extensionId,extensionId:r.extensionId})},r.getVideoFrameURL=function(e){var t=function(){{if(void 0===l)return null;var e=l.video,t=document.defaultView.getComputedStyle(e),i=parseInt(t.getPropertyValue("width"),10),o=parseInt(t.getPropertyValue("height"),10),n=(parseInt(t.getPropertyValue("left"),10),parseInt(t.getPropertyValue("top"),10),document.createElement("canvas"));return n.id="testing",n.width=i,n.height=o,n.setAttribute("style","display: none"),n.getContext("2d").drawImage(e,0,0,i,o),n}}();return null!==t?e?t.toDataURL(e):t.toDataURL():null},r.local&&TK.DeviceMgrImpl.addEventListener(m.videoTrackChangeProfile,r.onVideoTrackChangeProfile),h(),r},window.TK=window.TK||{},window.L=window.L||{},function(e){function l(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function s(e,t,i,o,n,r){return l((a=l(l(t,e),l(o,r)))<<(s=n)|a>>>32-s,i);var a,s}function p(e,t,i,o,n,r,a){return s(t&i|~t&o,e,t,n,r,a)}function f(e,t,i,o,n,r,a){return s(t&o|i&~o,e,t,n,r,a)}function m(e,t,i,o,n,r,a){return s(t^i^o,e,t,n,r,a)}function g(e,t,i,o,n,r,a){return s(i^(t|~o),e,t,n,r,a)}function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var i,o,n,r,a,s=1732584193,d=-271733879,c=-1732584194,u=271733878;for(i=0;i<e.length;i+=16)d=g(d=g(d=g(d=g(d=m(d=m(d=m(d=m(d=f(d=f(d=f(d=f(d=p(d=p(d=p(d=p(n=d,c=p(r=c,u=p(a=u,s=p(o=s,d,c,u,e[i],7,-680876936),d,c,e[i+1],12,-389564586),s,d,e[i+2],17,606105819),u,s,e[i+3],22,-1044525330),c=p(c,u=p(u,s=p(s,d,c,u,e[i+4],7,-176418897),d,c,e[i+5],12,1200080426),s,d,e[i+6],17,-1473231341),u,s,e[i+7],22,-45705983),c=p(c,u=p(u,s=p(s,d,c,u,e[i+8],7,1770035416),d,c,e[i+9],12,-1958414417),s,d,e[i+10],17,-42063),u,s,e[i+11],22,-1990404162),c=p(c,u=p(u,s=p(s,d,c,u,e[i+12],7,1804603682),d,c,e[i+13],12,-40341101),s,d,e[i+14],17,-1502002290),u,s,e[i+15],22,1236535329),c=f(c,u=f(u,s=f(s,d,c,u,e[i+1],5,-165796510),d,c,e[i+6],9,-1069501632),s,d,e[i+11],14,643717713),u,s,e[i],20,-373897302),c=f(c,u=f(u,s=f(s,d,c,u,e[i+5],5,-701558691),d,c,e[i+10],9,38016083),s,d,e[i+15],14,-660478335),u,s,e[i+4],20,-405537848),c=f(c,u=f(u,s=f(s,d,c,u,e[i+9],5,568446438),d,c,e[i+14],9,-1019803690),s,d,e[i+3],14,-187363961),u,s,e[i+8],20,1163531501),c=f(c,u=f(u,s=f(s,d,c,u,e[i+13],5,-1444681467),d,c,e[i+2],9,-51403784),s,d,e[i+7],14,1735328473),u,s,e[i+12],20,-1926607734),c=m(c,u=m(u,s=m(s,d,c,u,e[i+5],4,-378558),d,c,e[i+8],11,-2022574463),s,d,e[i+11],16,1839030562),u,s,e[i+14],23,-35309556),c=m(c,u=m(u,s=m(s,d,c,u,e[i+1],4,-1530992060),d,c,e[i+4],11,1272893353),s,d,e[i+7],16,-155497632),u,s,e[i+10],23,-1094730640),c=m(c,u=m(u,s=m(s,d,c,u,e[i+13],4,681279174),d,c,e[i],11,-358537222),s,d,e[i+3],16,-722521979),u,s,e[i+6],23,76029189),c=m(c,u=m(u,s=m(s,d,c,u,e[i+9],4,-640364487),d,c,e[i+12],11,-421815835),s,d,e[i+15],16,530742520),u,s,e[i+2],23,-995338651),c=g(c,u=g(u,s=g(s,d,c,u,e[i],6,-198630844),d,c,e[i+7],10,1126891415),s,d,e[i+14],15,-1416354905),u,s,e[i+5],21,-57434055),c=g(c,u=g(u,s=g(s,d,c,u,e[i+12],6,1700485571),d,c,e[i+3],10,-1894986606),s,d,e[i+10],15,-1051523),u,s,e[i+1],21,-2054922799),c=g(c,u=g(u,s=g(s,d,c,u,e[i+8],6,1873313359),d,c,e[i+15],10,-30611744),s,d,e[i+6],15,-1560198380),u,s,e[i+13],21,1309151649),c=g(c,u=g(u,s=g(s,d,c,u,e[i+4],6,-145523070),d,c,e[i+11],10,-1120210379),s,d,e[i+2],15,718787259),u,s,e[i+9],21,-343485551),s=l(s,o),d=l(d,n),c=l(c,r),u=l(u,a);return[s,d,c,u]}function c(e){var t,i="",o=32*e.length;for(t=0;t<o;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function u(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var o=8*e.length;for(t=0;t<o;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function o(e){var t,i,o="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),o+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return o}function i(e){return unescape(encodeURIComponent(e))}function n(e){return c(d(u(t=i(e)),8*t.length));var t}function r(e,t){return function(e,t){var i,o,n=u(e),r=[],a=[];for(r[15]=a[15]=void 0,16<n.length&&(n=d(n,8*e.length)),i=0;i<16;i+=1)r[i]=909522486^n[i],a[i]=1549556828^n[i];return o=d(r.concat(u(t)),512+8*t.length),c(d(a.concat(o),640))}(i(e),i(t))}function t(e,t,i){return t?i?r(t,e):o(r(t,e)):i?n(e):o(n(e))}"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.md5=t,"undefined"!=typeof window&&(window.md5=t)}(this),window.TK.MD5=window.TK.MD5||window.md5,!window.TK.MD5)try{window.TK.MD5=md5}catch(e){console.error("[tk-sdk]Encryption method missing, please check if an encrypted file is introduced,please link MD5,for example: window.TK.MD5 = md5")}if(window.TK=window.TK||{},window.L=window.L||{},function(e){("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=function r(a,s,d){function c(i,e){if(!s[i]){if(!a[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(u)return u(i,!0);var o=new Error("Cannot find module '"+i+"'");throw o.code="MODULE_NOT_FOUND",o}var n=s[i]={exports:{}};a[i][0].call(n.exports,function(e){var t=a[i][1][e];return c(t||e)},n,n.exports,r,a,s,d)}return s[i].exports}for(var u="function"==typeof require&&require,e=0;e<d.length;e++)c(d[e]);return c}({1:[function(e,t,i){var K=e("sdp");function d(e,t,i,o,n){var r=K.writeRtpDescription(e.kind,t);if(r+=K.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=K.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":n||"active"),r+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(o?o.id:"-")+" "+a+"\r\n";r+="a="+s,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+K.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+K.localCName+"\r\n"),r}function g(c,u){var l={codecs:[],headerExtensions:[],fecMechanisms:[]},p=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]};return c.codecs.forEach(function(i){for(var e=0;e<u.codecs.length;e++){var t=u.codecs[e];if(i.name.toLowerCase()===t.name.toLowerCase()&&i.clockRate===t.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&t.parameters.apt&&(o=i,n=t,r=c.codecs,a=u.codecs,d=s=void 0,s=p(o.parameters.apt,r),d=p(n.parameters.apt,a),!s||!d||s.name.toLowerCase()!==d.name.toLowerCase()))continue;(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(i.numChannels,t.numChannels),l.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var o,n,r,a,s,d}),c.headerExtensions.forEach(function(e){for(var t=0;t<u.headerExtensions.length;t++){var i=u.headerExtensions[t];if(e.uri===i.uri){l.headerExtensions.push(i);break}}}),l}function r(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function M(e,t){var i=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return i||e.addRemoteCandidate(t),!i}function l(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}t.exports=function(U,P){function O(e,t){t.addTrack(e),t.dispatchEvent(new U.MediaStreamTrackEvent("addtrack",{track:e}))}function n(e,t,i,o){var n=new Event("track");n.track=t,n.receiver=i,n.transceiver={receiver:i},n.streams=o,U.setTimeout(function(){e._dispatchEvent("track",n)})}var o=function(e){var t,o,n,i=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=r[e].bind(r)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=(t=e.iceServers||[],o=P,n=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&14393<=o&&-1===e.indexOf("?transport=udp"):n=!0}),delete e.url,e.urls=i?t[0]:t,!!t.length}})),this._iceGatherers=[],e.iceCandidatePoolSize)for(var a=e.iceCandidatePoolSize;0<a;a--)this._iceGatherers.push(new U.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=K.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},o.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(e,t){var i=0<this.transceivers.length,o={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)o.iceTransport=this.transceivers[0].iceTransport,o.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();o.iceTransport=n.iceTransport,o.dtlsTransport=n.dtlsTransport}return t||this.transceivers.push(o),o},o.prototype.addTrack=function(t,e){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i,o=this.transceivers.find(function(e){return e.track===t});if(o)throw l("InvalidAccessError","Track already exists.");for(var n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(i=this.transceivers[n]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),i.track=t,i.stream=e,i.rtpSender=new U.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},o.prototype.addStream=function(t){var i=this;if(15025<=P)t.getTracks().forEach(function(e){i.addTrack(e,t)});else{var o=t.clone();t.getTracks().forEach(function(e,t){var i=o.getTracks()[t];e.addEventListener("enabled",function(e){i.enabled=e.enabled})}),o.getTracks().forEach(function(e){i.addTrack(e,o)})}},o.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof U.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw l("InvalidAccessError","Sender was not created by this connection.");var i=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null;var o=this.transceivers.map(function(e){return e.stream});-1===o.indexOf(i)&&-1<this.localStreams.indexOf(i)&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(e){var i=this;e.getTracks().forEach(function(t){var e=i.getSenders().find(function(e){return e.track===t});e&&i.removeTrack(e)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},o.prototype._createIceGatherer=function(i,e){var o=this;if(e&&0<i)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var n=new U.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(n,"state",{value:"new",writable:!0}),this.transceivers[i].bufferedCandidateEvents=[],this.transceivers[i].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;n.state=t?"completed":"gathering",null!==o.transceivers[i].bufferedCandidateEvents&&o.transceivers[i].bufferedCandidateEvents.push(e)},n.addEventListener("localcandidate",this.transceivers[i].bufferCandidates),n},o.prototype._gather=function(s,d){var c=this,u=this.transceivers[d].iceGatherer;if(!u.onlocalcandidate){var e=this.transceivers[d].bufferedCandidateEvents;this.transceivers[d].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[d].bufferCandidates),u.onlocalcandidate=function(e){if(!(c.usingBundle&&0<d)){var t=new Event("icecandidate");t.candidate={sdpMid:s,sdpMLineIndex:d};var i=e.candidate,o=!i||0===Object.keys(i).length;if(o)"new"!==u.state&&"gathering"!==u.state||(u.state="completed");else{"new"===u.state&&(u.state="gathering"),i.component=1,i.ufrag=u.getLocalParameters().usernameFragment;var n=K.writeCandidate(i);t.candidate=Object.assign(t.candidate,K.parseCandidate(n)),t.candidate.candidate=n,t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}}var r=K.getMediaSections(c._localDescription.sdp);r[t.candidate.sdpMLineIndex]+=o?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",c._localDescription.sdp=K.getDescription(c._localDescription.sdp)+r.join("");var a=c.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==c.iceGatheringState&&(c.iceGatheringState="gathering",c._emitGatheringStateChange()),o||c._dispatchEvent("icecandidate",t),a&&(c._dispatchEvent("icecandidate",new Event("icecandidate")),c.iceGatheringState="complete",c._emitGatheringStateChange())}},U.setTimeout(function(){e.forEach(function(e){u.onlocalcandidate(e)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var e=this,t=new U.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var i=new U.RTCDtlsTransport(t);return i.ondtlsstatechange=function(){e._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:i}},o.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},o.prototype._transceive=function(e,t,i){var o=g(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:K.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&0<o.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&P<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},o.prototype.setLocalDescription=function(e){var t,p,f=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(l("TypeError",'Unsupported type "'+e.type+'"'));if(!r("setLocalDescription",e.type,f.signalingState)||f._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+e.type+" in state "+f.signalingState));if("offer"===e.type)t=K.splitSections(e.sdp),p=t.shift(),t.forEach(function(e,t){var i=K.parseRtpParameters(e);f.transceivers[t].localCapabilities=i}),f.transceivers.forEach(function(e,t){f._gather(e.mid,t)});else if("answer"===e.type){t=K.splitSections(f._remoteDescription.sdp),p=t.shift();var m=0<K.matchPrefix(p,"a=ice-lite").length;t.forEach(function(e,t){var i=f.transceivers[t],o=i.iceGatherer,n=i.iceTransport,r=i.dtlsTransport,a=i.localCapabilities,s=i.remoteCapabilities,d=K.isRejected(e)&&0===K.matchPrefix(e,"a=bundle-only").length;if(!d&&!i.rejected){var c=K.getIceParameters(e,p),u=K.getDtlsParameters(e,p);m&&(u.role="server"),f.usingBundle&&0!==t||(f._gather(i.mid,t),"new"===n.state&&n.start(o,c,m?"controlling":"controlled"),"new"===r.state&&r.start(u));var l=g(a,s);f._transceive(i,0<l.codecs.length,!1)}})}return f._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(I){var E=this;if(-1===["offer","answer"].indexOf(I.type))return Promise.reject(l("TypeError",'Unsupported type "'+I.type+'"'));if(!r("setRemoteDescription",I.type,E.signalingState)||E._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+I.type+" in state "+E.signalingState));var A={};E.remoteStreams.forEach(function(e){A[e.id]=e});var R=[],e=K.splitSections(I.sdp),C=e.shift(),D=0<K.matchPrefix(C,"a=ice-lite").length,N=0<K.matchPrefix(C,"a=group:BUNDLE ").length;E.usingBundle=N;var t=K.matchPrefix(C,"a=ice-options:")[0];return E.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var i=K.splitLines(e),o=K.getKind(e),n=K.isRejected(e)&&0===K.matchPrefix(e,"a=bundle-only").length,r=i[0].substr(2).split(" ")[2],a=K.getDirection(e,C),s=K.parseMsid(e),d=K.getMid(e)||K.generateIdentifier();if(n||"application"===o&&("DTLS/SCTP"===r||"UDP/DTLS/SCTP"===r))E.transceivers[t]={mid:d,kind:o,protocol:r,rejected:!0};else{var c,u,l,p,f,m,g,v,h;!n&&E.transceivers[t]&&E.transceivers[t].rejected&&(E.transceivers[t]=E._createTransceiver(o,!0));var T,y,_=K.parseRtpParameters(e);n||(T=K.getIceParameters(e,C),(y=K.getDtlsParameters(e,C)).role="client"),g=K.parseRtpEncodingParameters(e);var k=K.parseRtcpParameters(e),L=0<K.matchPrefix(e,"a=end-of-candidates",C).length,b=K.matchPrefix(e,"a=candidate:").map(function(e){return K.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===I.type||"answer"===I.type)&&!n&&N&&0<t&&E.transceivers[t]&&(E._disposeIceAndDtlsTransports(t),E.transceivers[t].iceGatherer=E.transceivers[0].iceGatherer,E.transceivers[t].iceTransport=E.transceivers[0].iceTransport,E.transceivers[t].dtlsTransport=E.transceivers[0].dtlsTransport,E.transceivers[t].rtpSender&&E.transceivers[t].rtpSender.setTransport(E.transceivers[0].dtlsTransport),E.transceivers[t].rtpReceiver&&E.transceivers[t].rtpReceiver.setTransport(E.transceivers[0].dtlsTransport)),"offer"!==I.type||n)"answer"!==I.type||n||(c=E.transceivers[t],u=c.iceGatherer,l=c.iceTransport,p=c.dtlsTransport,f=c.rtpReceiver,m=c.sendEncodingParameters,v=c.localCapabilities,E.transceivers[t].recvEncodingParameters=g,E.transceivers[t].remoteCapabilities=_,E.transceivers[t].rtcpParameters=k,b.length&&"new"===l.state&&(!D&&!L||N&&0!==t?b.forEach(function(e){M(c.iceTransport,e)}):l.setRemoteCandidates(b)),N&&0!==t||("new"===l.state&&l.start(u,T,"controlling"),"new"===p.state&&p.start(y)),E._transceive(c,"sendrecv"===a||"recvonly"===a,"sendrecv"===a||"sendonly"===a),!f||"sendrecv"!==a&&"sendonly"!==a?delete c.rtpReceiver:(h=f.track,s?(A[s.stream]||(A[s.stream]=new U.MediaStream),O(h,A[s.stream]),R.push([h,f,A[s.stream]])):(A.default||(A.default=new U.MediaStream),O(h,A.default),R.push([h,f,A.default]))));else{(c=E.transceivers[t]||E._createTransceiver(o)).mid=d,c.iceGatherer||(c.iceGatherer=E._createIceGatherer(t,N)),b.length&&"new"===c.iceTransport.state&&(!L||N&&0!==t?b.forEach(function(e){M(c.iceTransport,e)}):c.iceTransport.setRemoteCandidates(b)),v=U.RTCRtpReceiver.getCapabilities(o),P<15019&&(v.codecs=v.codecs.filter(function(e){return"rtx"!==e.name})),m=c.sendEncodingParameters||[{ssrc:1001*(2*t+2)}];var S,w=!1;"sendrecv"===a||"sendonly"===a?(w=!c.rtpReceiver,f=c.rtpReceiver||new U.RTCRtpReceiver(c.dtlsTransport,o),w&&(h=f.track,s&&"-"===s.stream||(S=s?(A[s.stream]||(A[s.stream]=new U.MediaStream,Object.defineProperty(A[s.stream],"id",{get:function(){return s.stream}})),Object.defineProperty(h,"id",{get:function(){return s.track}}),A[s.stream]):(A.default||(A.default=new U.MediaStream),A.default)),S&&(O(h,S),c.associatedRemoteMediaStreams.push(S)),R.push([h,f,S]))):c.rtpReceiver&&c.rtpReceiver.track&&(c.associatedRemoteMediaStreams.forEach(function(e){var t,i,o=e.getTracks().find(function(e){return e.id===c.rtpReceiver.track.id});o&&(t=o,(i=e).removeTrack(t),i.dispatchEvent(new U.MediaStreamTrackEvent("removetrack",{track:t})))}),c.associatedRemoteMediaStreams=[]),c.localCapabilities=v,c.remoteCapabilities=_,c.rtpReceiver=f,c.rtcpParameters=k,c.sendEncodingParameters=m,c.recvEncodingParameters=g,E._transceive(E.transceivers[t],!1,w)}}}),void 0===E._dtlsRole&&(E._dtlsRole="offer"===I.type?"active":"passive"),E._remoteDescription={type:I.type,sdp:I.sdp},"offer"===I.type?E._updateSignalingState("have-remote-offer"):E._updateSignalingState("stable"),Object.keys(A).forEach(function(e){var o=A[e];if(o.getTracks().length){if(-1===E.remoteStreams.indexOf(o)){E.remoteStreams.push(o);var t=new Event("addstream");t.stream=o,U.setTimeout(function(){E._dispatchEvent("addstream",t)})}R.forEach(function(e){var t=e[0],i=e[1];o.id===e[2].id&&n(E,t,i,[o])})}}),R.forEach(function(e){e[2]||n(E,e[0],e[1],[])}),U.setTimeout(function(){E&&E.transceivers&&E.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},o.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,U.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},o.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},o.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},o.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var t=s.transceivers.filter(function(e){return"audio"===e.kind}).length,i=s.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(i=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(s.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});0<t||0<i;)0<t&&(s._createTransceiver("audio"),t--),0<i&&(s._createTransceiver("video"),i--);var o=K.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(i,e){var t=i.track,o=i.kind,n=i.mid||K.generateIdentifier();i.mid=n,i.iceGatherer||(i.iceGatherer=s._createIceGatherer(e,s.usingBundle));var r=U.RTCRtpSender.getCapabilities(o);P<15019&&(r.codecs=r.codecs.filter(function(e){return"rtx"!==e.name})),r.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),r.headerExtensions.forEach(function(t){var e=i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[];e.forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});var a=i.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];t&&15019<=P&&"video"===o&&!a[0].rtx&&(a[0].rtx={ssrc:a[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new U.RTCRtpReceiver(i.dtlsTransport,o)),i.localCapabilities=r,i.sendEncodingParameters=a}),"max-compat"!==s._config.bundlePolicy&&(o+="a=group:BUNDLE "+s.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",s.transceivers.forEach(function(e,t){o+=d(e,e.localCapabilities,"offer",e.stream,s._dtlsRole),o+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===s.iceGatheringState||0!==t&&s.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,o+="a="+K.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))});var n=new U.RTCSessionDescription({type:"offer",sdp:o});return Promise.resolve(n)},o.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(l("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var a=K.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=K.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,t){if(!(s<t+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var i;e.stream&&("audio"===e.kind?i=e.stream.getAudioTracks()[0]:"video"===e.kind&&(i=e.stream.getVideoTracks()[0]),i&&15019<=P&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var o=g(e.localCapabilities,e.remoteCapabilities),n=o.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!n&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=d(e,o,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var e=new U.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(e)},o.prototype.addIceCandidate=function(d){var c,u=this;return d&&void 0===d.sdpMLineIndex&&!d.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!u._remoteDescription)return t(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(d&&""!==d.candidate){var i=d.sdpMLineIndex;if(d.sdpMid)for(var o=0;o<u.transceivers.length;o++)if(u.transceivers[o].mid===d.sdpMid){i=o;break}var n=u.transceivers[i];if(!n)return t(l("OperationError","Can not add ICE candidate"));if(n.rejected)return e();var r=0<Object.keys(d.candidate).length?K.parseCandidate(d.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return e();if(r.component&&1!==r.component)return e();if((0===i||0<i&&n.iceTransport!==u.transceivers[0].iceTransport)&&!M(n.iceTransport,r))return t(l("OperationError","Can not add ICE candidate"));var a=d.candidate.trim();0===a.indexOf("a=")&&(a=a.substr(2)),(c=K.getMediaSections(u._remoteDescription.sdp))[i]+="a="+(r.type?a:"end-of-candidates")+"\r\n",u._remoteDescription.sdp=K.getDescription(u._remoteDescription.sdp)+c.join("")}else for(var s=0;s<u.transceivers.length&&(u.transceivers[s].rejected||(u.transceivers[s].iceTransport.addRemoteCandidate({}),(c=K.getMediaSections(u._remoteDescription.sdp))[s]+="a=end-of-candidates\r\n",u._remoteDescription.sdp=K.getDescription(u._remoteDescription.sdp)+c.join(""),!u.usingBundle));s++);e()})},o.prototype.getStats=function(t){if(t&&t instanceof U.MediaStreamTrack){var i=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)}),!i)throw l("InvalidAccessError","Invalid selector.");return i.getStats()}var o=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&o.push(t[e].getStats())})}),Promise.all(o).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t=U[e];if(t&&t.prototype&&t.prototype.getStats){var i=t.prototype.getStats;t.prototype.getStats=function(){return i.apply(this).then(function(i){var o=new Map;return Object.keys(i).forEach(function(e){var t;i[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=i[e]).type]||t.type,o.set(e,i[e])}),o})}}});var e=["createOffer","createAnswer"];return e.forEach(function(e){var i=o.prototype[e];o.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?i.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):i.apply(this,arguments)}}),(e=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var i=o.prototype[e];o.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?i.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):i.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),o}},{sdp:2}],2:[function(e,t,i){var u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},u.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},u.getDescription=function(e){var t=u.splitSections(e);return t&&t[0]},u.getMediaSections=function(e){var t=u.splitSections(e);return t.shift(),t},u.matchPrefix=function(e,t){return u.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},u.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":i.relatedAddress=t[o+1];break;case"rport":i.relatedPort=parseInt(t[o+1],10);break;case"tcptype":i.tcpType=t[o+1];break;case"ufrag":i.ufrag=t[o+1],i.usernameFragment=t[o+1];break;default:i[t[o]]=t[o+1]}return i},u.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},u.parseIceOptions=function(e){return e.substr(14).split(" ")},u.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},u.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},u.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},u.parseFmtp=function(e){for(var t,i={},o=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<o.length;n++)t=o[n].trim().split("="),i[t[0].trim()]=t[1];return i},u.writeFmtp=function(t){var e="",i=t.payloadType;if(void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var o=[];Object.keys(t.parameters).forEach(function(e){t.parameters[e]?o.push(e+"="+t.parameters[e]):o.push(e)}),e+="a=fmtp:"+i+" "+o.join(";")+"\r\n"}return e},u.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},u.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},u.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return-1<o?(i.attribute=e.substr(t+1,o-t-1),i.value=e.substr(o+1)):i.attribute=e.substr(t+1),i},u.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},u.getMid=function(e){var t=u.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},u.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},u.getDtlsParameters=function(e,t){var i=u.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:i.map(u.parseFingerprint)}},u.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},u.getIceParameters=function(e,t){var i=u.splitLines(e),o={usernameFragment:(i=i.concat(u.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return o},u.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},u.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=u.splitLines(e),o=i[0].split(" "),n=3;n<o.length;n++){var r=o[n],a=u.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){var s=u.parseRtpMap(a),d=u.matchPrefix(e,"a=fmtp:"+r+" ");switch(s.parameters=d.length?u.parseFmtp(d[0]):{},s.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(u.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return u.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(u.parseExtmap(e))}),t},u.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=0<t.codecs.length?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=u.writeRtpMap(e),i+=u.writeFmtp(e),i+=u.writeRtcpFb(e)});var o=0;return t.codecs.forEach(function(e){e.maxptime>o&&(o=e.maxptime)}),0<o&&(i+="a=maxptime:"+o+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){i+=u.writeExtmap(e)}),i},u.parseRtpEncodingParameters=function(e){var i,o=[],t=u.parseRtpParameters(e),n=-1!==t.fecMechanisms.indexOf("RED"),r=-1!==t.fecMechanisms.indexOf("ULPFEC"),a=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),s=0<a.length&&a[0].ssrc,d=u.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});0<d.length&&1<d[0].length&&d[0][0]===s&&(i=d[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&i&&(t.rtx={ssrc:i}),o.push(t),n&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:i,mechanism:r?"red+ulpfec":"red"},o.push(t))}}),0===o.length&&s&&o.push({ssrc:s});var c=u.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,o.forEach(function(e){e.maxBitrate=c})),o},u.parseRtcpParameters=function(e){var t={},i=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var o=u.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<o.length,t.compound=0===o.length;var n=u.matchPrefix(e,"a=rtcp-mux");return t.mux=0<n.length,t},u.parseMsid=function(e){var t,i=u.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var o=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<o.length?{stream:(t=o[0].value.split(" "))[0],track:t[1]}:void 0},u.generateSessionId=function(){return Math.random().toString().substr(2,21)},u.writeSessionBoilerplate=function(e,t){var i=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||u.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},u.writeMediaSection=function(e,t,i,o){var n=u.writeRtpDescription(e.kind,t);if(n+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var r="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+r,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),n},u.getDirection=function(e,t){for(var i=u.splitLines(e),o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substr(2)}return t?u.getDirection(t):"sendrecv"},u.getKind=function(e){var t=u.splitLines(e),i=t[0].split(" ");return i[0].substr(2)},u.isRejected=function(e){return"0"===e.split(" ",2)[1]},u.parseMLine=function(e){var t=u.splitLines(e),i=t[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},u.parseOLine=function(e){var t=u.matchPrefix(e,"o=")[0],i=t.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},u.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=u.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=u)},{}],3:[function(i,o,e){(function(e){var t=i("./adapter_factory.js");o.exports=t({window:e.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(f,e,t){var m=f("./utils");e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var n in t)hasOwnProperty.call(t,n)&&(o[n]=t[n]);var r=m.log,a=m.detectBrowser(i),s=f("./chrome/chrome_shim")||null,d=f("./edge/edge_shim")||null,c=f("./firefox/firefox_shim")||null,u=f("./safari/safari_shim")||null,l=f("./common_shim")||null,p={browserDetails:a,commonShim:l,extractVersion:m.extractVersion,disableLog:m.disableLog,disableWarnings:m.disableWarnings};switch(a.browser){case"chrome":if(!s||!s.shimPeerConnection||!o.shimChrome)return r("Chrome shim is not included in this adapter release."),p;r("adapter.js shimming chrome."),p.browserShim=s,l.shimCreateObjectURL(i),s.shimGetUserMedia(i),s.shimMediaStream(i),s.shimSourceObject(i),s.shimPeerConnection(i),s.shimOnTrack(i),s.shimAddTrackRemoveTrack(i),s.shimGetSendersWithDtmf(i),s.shimSenderReceiverGetStats(i),s.fixNegotiationNeeded(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"firefox":if(!c||!c.shimPeerConnection||!o.shimFirefox)return r("Firefox shim is not included in this adapter release."),p;r("adapter.js shimming firefox."),p.browserShim=c,l.shimCreateObjectURL(i),c.shimGetUserMedia(i),c.shimSourceObject(i),c.shimPeerConnection(i),c.shimOnTrack(i),c.shimRemoveStream(i),c.shimSenderGetStats(i),c.shimReceiverGetStats(i),c.shimRTCDataChannel(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return r("MS edge shim is not included in this adapter release."),p;r("adapter.js shimming edge."),p.browserShim=d,l.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"safari":if(!u||!o.shimSafari)return r("Safari shim is not included in this adapter release."),p;r("adapter.js shimming safari."),p.browserShim=u,l.shimCreateObjectURL(i),u.shimRTCIceServerUrls(i),u.shimCreateOfferLegacy(i),u.shimCallbacksAPI(i),u.shimLocalStreamsAPI(i),u.shimRemoteStreamsAPI(i),u.shimTrackEventTransceiver(i),u.shimGetUserMedia(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;default:r("Unsupported browser!")}return p}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(e,t,i){var d=e("../utils.js"),o=d.log;function n(i,t,e){var o=e?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;var r=[];return i.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(function(t){i.forEach(function(e){e.type===o&&e.trackId===t.id&&function t(i,o,n){o&&!n.has(o.id)&&(n.set(o.id,o),Object.keys(o).forEach(function(e){e.endsWith("Id")?t(i,i.get(o[e]),n):e.endsWith("Ids")&&o[e].forEach(function(e){t(i,i.get(e),n)})}))}(i,e,n)})}),n}t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(r){if("object"!=typeof r||!r.RTCPeerConnection||"ontrack"in r.RTCPeerConnection.prototype)"RTCRtpTransceiver"in r||d.wrapPeerConnectionEvent(r,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var e=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(o){o.stream.addEventListener("addtrack",function(t){var e;e=r.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track};var i=new Event("track");i.track=t.track,i.receiver=e,i.transceiver={receiver:e},i.streams=[o.stream],n.dispatchEvent(i)}),o.stream.getTracks().forEach(function(t){var e;e=r.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t};var i=new Event("track");i.track=t,i.receiver=e,i.transceiver={receiver:e},i.streams=[o.stream],n.dispatchEvent(i)})},n.addEventListener("addstream",n._ontrackpoly)),e.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var o=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){var i=n.apply(this,arguments);return i||(i=o(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;t._senders=t._senders||[],r.apply(t,[e]),e.getTracks().forEach(function(e){t._senders.push(o(t,e))})};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var i=this;i._senders=i._senders||[],t.apply(i,[e]),e.getTracks().forEach(function(t){var e=i._senders.find(function(e){return e.track===t});e&&i._senders.splice(i._senders.indexOf(e),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=a.apply(t,[]);return e.forEach(function(e){e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=i.apply(t,[]);return e.forEach(function(e){e._pc=t}),e});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return n(e,t.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=o.apply(t,[]);return e.forEach(function(e){e._pc=t}),e}),d.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return n(e,t.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var t,i,o,n=arguments[0];return this.getSenders().forEach(function(e){e.track===n&&(t?o=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===n&&(i?o=!0:i=e),e.track===n}),o||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}}},shimSourceObject:function(e){var i=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&i.revokeObjectURL(this.src),e?(this.src=i.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&i.revokeObjectURL(t.src),t.src=i.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&i.revokeObjectURL(t.src),t.src=i.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=o.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(i)&&this._shimmedLocalStreams[t.id].push(i):this._shimmedLocalStreams[t.id]=[t,i],i};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){var e=i.getSenders().find(function(e){return e.track===t});if(e)throw new DOMException("Track already exists.","InvalidAccessError")});var t=i.getSenders();n.apply(this,arguments);var o=i.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(o)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(i){var o=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},i&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=o._shimmedLocalStreams[e].indexOf(i);-1!==t&&o._shimmedLocalStreams[e].splice(t,1),1===o._shimmedLocalStreams[e].length&&delete o._shimmedLocalStreams[e]}),r.apply(this,arguments)}},shimAddTrackRemoveTrack:function(s){var e=d.detectBrowser(s);if(s.RTCPeerConnection.prototype.addTrack&&65<=e.version)return this.shimAddTrackRemoveTrackWithNative(s);var i=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=i.apply(this);return t._reverseStreams=t._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var o=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(e){var i=this;if(i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{},e.getTracks().forEach(function(t){var e=i.getSenders().find(function(e){return e.track===t});if(e)throw new DOMException("Track already exists.","InvalidAccessError")}),!i._reverseStreams[e.id]){var t=new s.MediaStream(e.getTracks());i._streams[e.id]=t,i._reverseStreams[t.id]=e,e=t}o.apply(i,[e])};var n=s.RTCPeerConnection.prototype.removeStream;function r(o,e){var n=e.sdp;return Object.keys(o._reverseStreams||[]).forEach(function(e){var t=o._reverseStreams[e],i=o._streams[t.id];n=n.replace(new RegExp(i.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:n})}s.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},n.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},s.RTCPeerConnection.prototype.addTrack=function(t,e){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var n=i.getSenders().find(function(e){return e.track===t});if(n)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var r=i._streams[e.id];if(r)r.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var a=new s.MediaStream([t]);i._streams[e.id]=a,i._reverseStreams[a.id]=e,i.addStream(a)}return i.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){var i=this,o=arguments,e=arguments.length&&"function"==typeof arguments[0];return e?t.apply(i,[function(e){var t=r(i,e);o[0].apply(null,[t])},function(e){o[1]&&o[1].apply(null,e)},arguments[2]]):t.apply(i,arguments).then(function(e){return r(i,e)})}});var t=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){var o,e,n;return arguments.length&&arguments[0].type&&(arguments[0]=(o=this,e=arguments[0],n=e.sdp,Object.keys(o._reverseStreams||[]).forEach(function(e){var t=o._reverseStreams[e],i=o._streams[t.id];n=n.replace(new RegExp(t.id,"g"),i.id)}),new RTCSessionDescription({type:e.type,sdp:n}))),t.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:r(this,e)}}),s.RTCPeerConnection.prototype.removeTrack=function(i){var o=this;if("closed"===o.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!i._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var n,e=i._pc===o;if(!e)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");o._streams=o._streams||{},Object.keys(o._streams).forEach(function(e){var t=o._streams[e].getTracks().find(function(e){return i.track===e});t&&(n=o._streams[e])}),n&&(1===n.getTracks().length?o.removeStream(o._reverseStreams[n.id]):n.removeTrack(i.track),o.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(i){var e=d.detectBrowser(i);if(!i.RTCPeerConnection&&i.webkitRTCPeerConnection)i.RTCPeerConnection=function(e,t){return o("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new i.webkitRTCPeerConnection(e,t)},i.RTCPeerConnection.prototype=i.webkitRTCPeerConnection.prototype,i.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return i.webkitRTCPeerConnection.generateCertificate}});else{var r=i.RTCPeerConnection;i.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var n=e.iceServers[o];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,i.push(n)):i.push(e.iceServers[o])}e.iceServers=i}return new r(e,t)},i.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var s=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(e,t,i){var o=this,n=arguments;if(0<arguments.length&&"function"==typeof e)return s.apply(this,arguments);var r=function(e){var o={},t=e.result();return t.forEach(function(t){var i={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){i[e]=t.stat(e)}),o[i.id]=i}),o},a=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};return 2<=arguments.length?s.apply(this,[function(e){n[1](a(r(e)))},arguments[0]]):new Promise(function(t,e){s.apply(o,[function(e){t(a(r(e)))},e])}).then(t,i)},e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var n=i.RTCPeerConnection.prototype[e];i.RTCPeerConnection.prototype[e]=function(){var i=arguments,o=this,e=new Promise(function(e,t){n.apply(o,[i[0],e,t])});return i.length<2?e:e.then(function(){i[1].apply(null,[])},function(e){3<=i.length&&i[2].apply(null,[e])})}}),e.version<52&&["createOffer","createAnswer"].forEach(function(e){var n=i.RTCPeerConnection.prototype[e];i.RTCPeerConnection.prototype[e]=function(){var i=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var o=1===arguments.length?arguments[0]:void 0;return new Promise(function(e,t){n.apply(i,[e,t,o])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=i.RTCPeerConnection.prototype[e];i.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var t=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){d.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if("stable"===t.signalingState)return e})},shimGetDisplayMedia:function(e,i){"getDisplayMedia"in e.navigator||("function"==typeof i?navigator.getDisplayMedia=function(t){return i(t).then(function(e){return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:t.video.frameRate||3}},navigator.mediaDevices.getUserMedia(t)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},{"../utils.js":14,"./getusermedia":6}],6:[function(e,t,i){var c=e("../utils.js"),u=c.log;t.exports=function(o){var a=c.detectBrowser(o),s=o&&o.navigator,d=function(n){if("object"!=typeof n||n.mandatory||n.optional)return n;var r={};return Object.keys(n).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var i="object"==typeof n[t]?n[t]:{ideal:n[t]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){r.optional=r.optional||[];var e={};"number"==typeof i.ideal?(e[o("min",t)]=i.ideal,r.optional.push(e),(e={})[o("max",t)]=i.ideal):e[o("",t)]=i.ideal,r.optional.push(e)}void 0!==i.exact&&"number"!=typeof i.exact?(r.mandatory=r.mandatory||{},r.mandatory[o("",t)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(r.mandatory=r.mandatory||{},r.mandatory[o(e,t)]=i[e])})}}),n.advanced&&(r.optional=(r.optional||[]).concat(n.advanced)),r},n=function(i,o){if(61<=a.version)return o(i);if((i=JSON.parse(JSON.stringify(i)))&&"object"==typeof i.audio){var e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","googAutoGainControl"),e(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=d(i.audio)}if(i&&"object"==typeof i.video){var n=i.video.facingMode;n=n&&("object"==typeof n?n:{ideal:n});var r,t=a.version<66;if(n&&("user"===n.exact||"environment"===n.exact||"user"===n.ideal||"environment"===n.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||t)&&(delete i.video.facingMode,"environment"===n.exact||"environment"===n.ideal?r=["back","rear"]:"user"!==n.exact&&"user"!==n.ideal||(r=["front"]),r))return s.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return r.some(function(e){return-1!==t.label.toLowerCase().indexOf(e)})});return!t&&e.length&&-1!==r.indexOf("back")&&(t=e[e.length-1]),t&&(i.video.deviceId=n.exact?{exact:t.deviceId}:{ideal:t.deviceId}),i.video=d(i.video),u("chrome: "+JSON.stringify(i)),o(i)});i.video=d(i.video)}return u("chrome: "+JSON.stringify(i)),o(i)},r=function(e){return 64<=a.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};s.getUserMedia=function(e,t,i){n(e,function(e){s.webkitGetUserMedia(e,t,function(e){i&&i(r(e))})})};var t=function(i){return new Promise(function(e,t){s.getUserMedia(i,e,t)})};if(s.mediaDevices||(s.mediaDevices={getUserMedia:t,enumerateDevices:function(){return new Promise(function(t){var i={audio:"audioinput",video:"videoinput"};return o.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:i[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),s.mediaDevices.getUserMedia){var i=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(e){return n(e,function(t){return i(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){o.L&&o.L.Utils&&"function"==typeof o.L.Utils.stopTrack?o.L.Utils.stopTrack(e):e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(r(e))})})}}else s.mediaDevices.getUserMedia=function(e){return t(e)};void 0===s.mediaDevices.addEventListener&&(s.mediaDevices.addEventListener=function(){u("Dummy mediaDevices.addEventListener called.")}),void 0===s.mediaDevices.removeEventListener&&(s.mediaDevices.removeEventListener=function(){u("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(e,t,i){var l=e("sdp"),d=e("./utils");t.exports={shimRTCIceCandidate:function(t){if(t.RTCIceCandidate&&!(t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){var n=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new n(e),i=l.parseCandidate(e.candidate),o=Object.assign(t,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new n(e)},t.RTCIceCandidate.prototype=n.prototype,d.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var i=t.createObjectURL.bind(t),o=t.revokeObjectURL.bind(t),n=new Map,r=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++r;return n.set(t,e),d.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return i(e)},t.revokeObjectURL=function(e){o(e),n.delete(e)};var a=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(e){return this.srcObject=n.get(e)||null,a.set.apply(this,[e])}});var s=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=n.get(arguments[1])||null),s.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var c=d.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var u=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,t,i,o;if(this._sctp=null,e=arguments[0],(t=l.splitSections(e.sdp)).shift(),t.some(function(e){var t=l.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var n,r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var i=parseInt(t[1],10);return i!=i?-1:i}(arguments[0]),a=(i=r,o=65536,"firefox"===c.browser&&(o=c.version<57?-1===i?16384:2147483637:c.version<60?57===c.version?65535:65536:2147483637),o),s=function(e,t){var i=65536;"firefox"===c.browser&&57===c.version&&(i=65535);var o=l.matchPrefix(e.sdp,"a=max-message-size:");return 0<o.length?i=parseInt(o[0].substr(19),10):"firefox"===c.browser&&-1!==t&&(i=2147483637),i}(arguments[0],r);n=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var d={};Object.defineProperty(d,"maxMessageSize",{get:function(){return n}}),this._sctp=d}return u.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return i(e,this),e},d.wrapPeerConnectionEvent(e,"datachannel",function(e){return i(e.channel,e.target),e})}function i(i,o){var n=i.send;i.send=function(){var e=arguments[0],t=e.length||e.size||e.byteLength;if("open"===i.readyState&&o.sctp&&t>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return n.apply(i,arguments)}}}}},{"./utils":14,sdp:2}],8:[function(e,t,i){var n=e("../utils"),r=e("./filtericeservers"),a=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var i=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){i.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=a(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=r(e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(e,t,i){var r=e("../utils");t.exports=function(e,o){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){var t=0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n;return t?n=!0:0===e.indexOf("stun:")&&14393<=o&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?t[0]:t,!!t.length}})}},{"../utils":14}],10:[function(e,t,i){t.exports=function(e){var t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}});var t})}}},{}],11:[function(e,t,i){var o=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(i){i.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e,t.receiver={track:e},t.transceiver={receiver:t.receiver},t.streams=[i.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(s){var d=o.detectBrowser(s);if("object"==typeof s&&(s.RTCPeerConnection||s.mozRTCPeerConnection)){s.RTCPeerConnection||(s.RTCPeerConnection=function(e,t){if(d.version<38&&e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var n=e.iceServers[o];if(n.hasOwnProperty("urls"))for(var r=0;r<n.urls.length;r++){var a={url:n.urls[r]};0===n.urls[r].indexOf("turn")&&(a.username=n.username,a.credential=n.credential),i.push(a)}else i.push(e.iceServers[o])}e.iceServers=i}return new s.mozRTCPeerConnection(e,t)},s.RTCPeerConnection.prototype=s.mozRTCPeerConnection.prototype,s.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:function(){return s.mozRTCPeerConnection.generateCertificate}}),s.RTCSessionDescription=s.mozRTCSessionDescription,s.RTCIceCandidate=s.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=s.RTCPeerConnection.prototype.addIceCandidate;s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(e,n,t){return i.apply(this,[e||null]).then(function(i){var t,o;if(d.version<48&&(t=i,o=new Map,Object.keys(t).forEach(function(e){o.set(e,t[e]),o[e]=t[e]}),i=o),d.version<53&&!n)try{i.forEach(function(e){e.type=r[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;i.forEach(function(e,t){i.set(t,Object.assign({},e,{type:r[e.type]||e.type}))})}return i}).then(n,t)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=i.apply(t,[]);return e.forEach(function(e){e._pc=t}),e});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=i.apply(t,[]);return e.forEach(function(e){e._pc=t}),e}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var i=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&-1!==t.getTracks().indexOf(e.track)&&i.removeTrack(e)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,i){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:i}:e.video.mediaSource=i,navigator.mediaDevices.getUserMedia(e);var t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)})}}},{"../utils":14,"./getusermedia":12}],12:[function(e,t,i){var p=e("../utils"),f=p.log;t.exports=function(i){var n=p.detectBrowser(i),r=i&&i.navigator,e=i&&i.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,t,i){var o=function(o){if("object"!=typeof o||o.require)return o;var n=[];return Object.keys(o).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var t=o[e]="object"==typeof o[e]?o[e]:{ideal:o[e]};if(void 0===t.min&&void 0===t.max&&void 0===t.exact||n.push(e),void 0!==t.exact&&("number"==typeof t.exact?t.min=t.max=t.exact:o[e]=t.exact,delete t.exact),void 0!==t.ideal){o.advanced=o.advanced||[];var i={};"number"==typeof t.ideal?i[e]={min:t.ideal,max:t.ideal}:i[e]=t.ideal,o.advanced.push(i),delete t.ideal,Object.keys(t).length||delete o[e]}}}),n.length&&(o.require=n),o};return e=JSON.parse(JSON.stringify(e)),n.version<38&&(f("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),f("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,t,function(e){i(a(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(i){return new Promise(function(e,t){o(i,e,t)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},n.version<41){var t=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return t().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(n.version<49){var s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return s(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){i.L&&i.L.Utils&&"function"==typeof i.L.Utils.stopTrack?i.L.Utils.stopTrack(e):e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(e){return Promise.reject(a(e))})}}if(!(55<n.version&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var d=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},c=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),c(e)},e&&e.prototype.getSettings){var u=e.prototype.getSettings;e.prototype.getSettings=function(){var e=u.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(e&&e.prototype.applyConstraints){var l=e.prototype.applyConstraints;e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}r.getUserMedia=function(e,t,i){if(n.version<44)return o(e,t,i);p.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)}}},{"../utils":14}],13:[function(e,t,i){var a=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(t){var i=null;return this._localStreams&&this._localStreams.forEach(function(e){e.id===t&&(i=e)}),this._remoteStreams&&this._remoteStreams.forEach(function(e){e.id===t&&(i=e)}),i}),!("addStream"in e.RTCPeerConnection.prototype)){var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(t)&&this._localStreams.push(t);var i=this;t.getTracks().forEach(function(e){o.call(i,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e,t){return t&&(this._localStreams?-1===this._localStreams.indexOf(t)&&this._localStreams.push(t):this._localStreams=[t]),o.call(this,e,t)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var i=this,o=e.getTracks();this.getSenders().forEach(function(e){-1!==o.indexOf(e.track)&&i.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(i._remoteStreams||(i._remoteStreams=[]),!(0<=i._remoteStreams.indexOf(e))){i._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,i.dispatchEvent(t)}})}),t.apply(i,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,a=t.setLocalDescription,s=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(e,t){var i=2<=arguments.length?arguments[2]:arguments[0],o=n.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var i=2<=arguments.length?arguments[2]:arguments[0],o=r.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o};var i=function(e,t,i){var o=a.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o};t.setLocalDescription=i,i=function(e,t,i){var o=s.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o},t.setRemoteDescription=i,i=function(e,t,i){var o=d.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o},t.addIceCandidate=i}},shimGetUserMedia:function(e){var o=e&&e.navigator;o.getUserMedia||(o.webkitGetUserMedia?o.getUserMedia=o.webkitGetUserMedia.bind(o):o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=function(e,t,i){o.mediaDevices.getUserMedia(e).then(t,i)}.bind(o)))},shimRTCIceServerUrls:function(e){var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var n=e.iceServers[o];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,delete n.url,i.push(n)):i.push(e.iceServers[o])}e.iceServers=i}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var o=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var t=this.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=this.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video")}return o.apply(this,arguments)}}}},{"../utils":14}],14:[function(e,t,i){var o=!0,n=!0;function r(e,t,i){var o=e.match(t);return o&&o.length>=i&&parseInt(o[i],10)}t.exports={extractVersion:r,wrapPeerConnectionEvent:function(e,o,n){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.addEventListener;t.addEventListener=function(e,i){if(e!==o)return r.apply(this,arguments);var t=function(e){var t=n(e);t&&i(t)};return this._eventMap=this._eventMap||{},this._eventMap[i]=t,r.apply(this,[e,t])};var a=t.removeEventListener;t.removeEventListener=function(e,t){if(e!==o||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);var i=this._eventMap[t];return delete this._eventMap[t],a.apply(this,[e,i])},Object.defineProperty(t,"on"+o,{get:function(){return this["_on"+o]},set:function(e){this["_on"+o]&&(this.removeEventListener(o,this["_on"+o]),delete this["_on"+o]),e&&this.addEventListener(o,this["_on"+o]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=e)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){n&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,i={browser:null,version:null};if(void 0===e||!e.navigator)return i.browser="Not a browser.",i;if(t.mozGetUserMedia)i.browser="firefox",i.version=r(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)i.browser="chrome",i.version=r(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=r(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=r(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return i}}},{}]},{},[3])(3)}(),window.TK=window.TK||{},window.L=window.L||{},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t(),("undefined"!=typeof window?window:"undefined"!=typeof self?self:this).Promise=t()}(this,function(){function c(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,t=void 0,n=void 0,s=function(e,t){p[o]=e,p[o+1]=t,2===(o+=2)&&(n?n(f):T())};var e="undefined"!=typeof window?window:void 0,r=e||{},a=r.MutationObserver||r.WebKitMutationObserver,d="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function l(){var e=setTimeout;return function(){return e(f,1)}}var p=new Array(1e3);function f(){for(var e=0;e<o;e+=2){(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0}o=0}var m,g,v,h,T=void 0;function y(e,t){var i=this,o=new this.constructor(L);void 0===o[k]&&M(o);var n=i._state;if(n){var r=arguments[n-1];s(function(){return O(n,o,r,i._result)})}else U(i,o,e,t);return o}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(L);return R(t,e),t}T=d?function(){return process.nextTick(f)}:a?(g=0,v=new a(f),h=document.createTextNode(""),v.observe(h,{characterData:!0}),function(){h.data=g=++g%2}):u?((m=new MessageChannel).port1.onmessage=f,function(){return m.port2.postMessage(0)}):void 0===e&&"function"==typeof require?function(){try{var e=Function("return this")().require("vertx");return void 0!==(t=e.runOnLoop||e.runOnContext)?function(){t(f)}:l()}catch(e){return l()}}():l();var k=Math.random().toString(36).substring(2);function L(){}var b=void 0,S=1,w=2,I={error:null};function E(e){try{return e.then}catch(e){return I.error=e,I}}function A(e,t,i){var o,n,r,a;t.constructor===e.constructor&&i===y&&t.constructor.resolve===_?(r=e,(a=t)._state===S?D(r,a._result):a._state===w?N(r,a._result):U(a,void 0,function(e){return R(r,e)},function(e){return N(r,e)})):i===I?(N(e,I.error),I.error=null):void 0===i?D(e,t):c(i)?(o=t,n=i,s(function(t){var i=!1,e=function(e,t,i,o){try{e.call(t,i,o)}catch(e){return e}}(n,o,function(e){i||(i=!0,o!==e?R(t,e):D(t,e))},function(e){i||(i=!0,N(t,e))},t._label);!i&&e&&(i=!0,N(t,e))},e)):D(e,t)}function R(e,t){var i,o;e===t?N(e,new TypeError("You cannot resolve a promise with itself")):(o=typeof(i=t),null===i||"object"!==o&&"function"!==o?D(e,t):A(e,t,E(t)))}function C(e){e._onerror&&e._onerror(e._result),P(e)}function D(e,t){e._state===b&&(e._result=t,e._state=S,0!==e._subscribers.length&&s(P,e))}function N(e,t){e._state===b&&(e._state=w,e._result=t,s(C,e))}function U(e,t,i,o){var n=e._subscribers,r=n.length;e._onerror=null,n[r]=t,n[r+S]=i,n[r+w]=o,0===r&&e._state&&s(P,e)}function P(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var o=void 0,n=void 0,r=e._result,a=0;a<t.length;a+=3)o=t[a],n=t[a+i],o?O(i,o,n,r):n(r);e._subscribers.length=0}}function O(e,t,i,o){var n=c(i),r=void 0,a=void 0,s=void 0,d=void 0;if(n){if((r=function(e,t){try{return e(t)}catch(e){return I.error=e,I}}(i,o))===I?(d=!0,a=r.error,r.error=null):s=!0,t===r)return void N(t,new TypeError("A promises callback cannot return that same promise."))}else r=o,s=!0;t._state!==b||(n&&s?R(t,r):d?N(t,a):e===S?D(t,r):e===w&&N(t,r))}var K=0;function M(e){e[k]=K++,e._state=void 0,e._result=void 0,e._subscribers=[]}var x=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(L),this.promise[k]||M(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&D(this.promise,this._result))):N(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===b&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,o=i.resolve;if(o===_){var n=E(t);if(n===y&&t._state!==b)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===F){var r=new i(L);A(r,t,n),this._willSettleAt(r,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(o(t),e)},e.prototype._settledAt=function(e,t,i){var o=this.promise;o._state===b&&(this._remaining--,e===w?N(o,i):this._result[t]=i),0===this._remaining&&D(o,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;U(e,void 0,function(e){return i._settledAt(S,t,e)},function(e){return i._settledAt(w,t,e)})},e}();var F=function(){function t(e){this[k]=K++,this._result=this._state=void 0,this._subscribers=[],L!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){R(t,e)},function(e){N(t,e)})}catch(e){N(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var i=this.constructor;return this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})})},t}();return F.prototype.then=y,F.all=function(e){return new x(this,e).promise},F.race=function(n){var r=this;return i(n)?new r(function(e,t){for(var i=n.length,o=0;o<i;o++)r.resolve(n[o]).then(e,t)}):new r(function(e,t){return t(new TypeError("You must pass an array to race."))})},F.resolve=_,F.reject=function(e){var t=new this(L);return N(t,e),t},F._setScheduler=function(e){n=e},F._setAsap=function(e){s=e},F._asap=s,F.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=F},(F.Promise=F).polyfill(),F}),window.TK=window.TK||{},window.L=window.L||{},function(){var t=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"==typeof window.__SDKDEV__)try{t=window.__SDKDEV__}catch(e){t=!1}var e,i,o,n,r,a,s=t||(e="debug",i=decodeURIComponent(window.location.href),o=i.indexOf("?"),n=i.substring(o+1),r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),null!=(a=n.match(r))?a[2]:"");window.__TkSdkBuild__=!s;try{if(window.localStorage){var d=s?"*":"none";window.localStorage.setItem("debug",d)}else console.warn("[tk-sdk]window.localStorage is not exist!")}catch(e){console.warn("[tk-sdk]Browser does not support localStorage!")}}(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():e.io=t(),window&&!window.io&&(window.io=t())}(this||window,function(){return function(i){function o(e){if(n[e])return n[e].exports;var t=n[e]={exports:{},id:e,loaded:!1};return i[e].call(t.exports,t,t.exports,o),t.loaded=!0,t.exports}var n={};return o.m=i,o.c=n,o.p="",o(0)}([function(e,t,i){function o(e,t){"object"===(void 0===e?"undefined":d(e))&&(t=e,e=void 0),t=t||{};var i,o=c(e),n=o.source,r=o.id,a=o.path,s=p[r]&&a in p[r].nsps;return i=t.forceNew||t["force new connection"]||!1===t.multiplex||s?(l("ignoring socket cache for %s",n),u(n,t)):(p[r]||(l("new io instance for %s",n),p[r]=u(n,t)),p[r]),o.query&&!t.query&&(t.query=o.query),i.socket(o.path,t)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=i(1),n=i(7),u=i(13),l=i(3)("socket.io-client");e.exports=t=o;var p=t.managers={};t.protocol=n.protocol,t.connect=o,t.Manager=i(13),t.Socket=i(39)},function(e,t,i){(function(n){var r=i(2),a=i(3)("socket.io-client:url");e.exports=function(e,t){var i=e;t=t||n.location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(a("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),a("parse %s",e),i=r(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";var o=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port,i.href=i.protocol+"://"+o+(t&&t.port===i.port?"":":"+i.port),i}}).call(t,function(){return this||window}())},function(e,t){var s=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var n=s.exec(e||""),r={},a=14;a--;)r[d[a]]=n[a]||"";return-1!=i&&-1!=o&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r}},function(i,r,o){(function(t){function e(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(r=i.exports=o(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var i="color: "+this.color;e.splice(1,0,i,"color: inherit");var o=0,n=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(n=o))}),e.splice(n,0,i)}},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=e,r.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(e())}).call(r,o(4))},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function n(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function r(){m&&p&&(m=!1,p.length?f=p.concat(f):g=-1,f.length&&a())}function a(){if(!m){var e=n(r);m=!0;for(var t=f.length;t;){for(p=f,f=[];++g<t;)p&&p[g].run();g=-1,t=f.length}p=null,m=!1,function(t){if(u===clearTimeout)return clearTimeout(t);if((u===o||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function d(){}var c,u,l=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{u="function"==typeof clearTimeout?clearTimeout:o}catch(e){u=o}}();var p,f=[],m=!1,g=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];f.push(new s(e,t)),1!==f.length||m||n(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=d,l.addListener=d,l.once=d,l.off=d,l.removeListener=d,l.removeAllListeners=d,l.emit=d,l.prependListener=d,l.prependOnceListener=d,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,s,t){function i(e){function o(){if(o.enabled){var n=o,e=+new Date,t=e-(d||e);n.diff=t,n.prev=d,n.curr=e,d=e;for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];r[0]=s.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var a=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;a++;var i=s.formatters[t];if("function"==typeof i){var o=r[a];e=i.call(n,o),r.splice(a,1),a--}return e}),s.formatArgs.call(n,r),(o.log||s.log||console.log.bind(console)).apply(n,r)}}return o.namespace=e,o.enabled=s.enabled(e),o.useColors=s.useColors(),o.color=function(e){var t,i=0;for(t in e)i=(i<<5)-i+e.charCodeAt(t),i|=0;return s.colors[Math.abs(i)%s.colors.length]}(e),"function"==typeof s.init&&s.init(o),o}var d;(s=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e),s.names=[],s.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),i=t.length,o=0;o<i;o++)t[o]&&("-"===(e=t[o].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){var t,i;for(t=0,i=s.skips.length;t<i;t++)if(s.skips[t].test(e))return!1;for(t=0,i=s.names.length;t<i;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=t(6),s.names=[],s.skips=[],s.formatters={}},function(e,t){function r(e,t,i){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}e.exports=function(e,t){t=t||{};var i,o,n=typeof e;if("string"===n&&0<e.length)return function(e){if(!(100<(e=String(e)).length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"days":case"day":case"d":return 864e5*i;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===n&&!1===isNaN(e))return t.long?r(o=e,864e5,"day")||r(o,36e5,"hour")||r(o,6e4,"minute")||r(o,1e3,"second")||o+" ms":864e5<=(i=e)?Math.round(i/864e5)+"d":36e5<=i?Math.round(i/36e5)+"h":6e4<=i?Math.round(i/6e4)+"m":1e3<=i?Math.round(i/1e3)+"s":i+"ms";throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,a,t){function i(){}function r(e){var t=""+e.type;return a.BINARY_EVENT!==e.type&&a.BINARY_ACK!==e.type||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),c("encoded %j as %s",e,t),t}function o(){this.reconstructor=null}function n(e){var t=0,i={type:Number(e.charAt(0))};if(null==a.types[i.type])return d();if(a.BINARY_EVENT===i.type||a.BINARY_ACK===i.type){for(var o="";"-"!==e.charAt(++t)&&(o+=e.charAt(t),t!=e.length););if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(t+1))for(i.nsp="";++t;){if(","===(r=e.charAt(t)))break;if(i.nsp+=r,t===e.length)break}else i.nsp="/";var n=e.charAt(t+1);if(""!==n&&Number(n)==n){for(i.id="";++t;){var r;if(null==(r=e.charAt(t))||Number(r)!=r){--t;break}if(i.id+=e.charAt(t),t===e.length)break}i.id=Number(i.id)}return e.charAt(++t)&&(i=function(e,t){try{e.data=JSON.parse(t)}catch(e){return d()}return e}(i,e.substr(t))),c("decoded %s as %j",e,i),i}function s(e){this.reconPack=e,this.buffers=[]}function d(){return{type:a.ERROR,data:"parser error"}}var c=t(3)("socket.io-parser"),u=t(8),l=t(9),p=t(11),f=t(12);a.protocol=4,a.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],a.CONNECT=0,a.DISCONNECT=1,a.EVENT=2,a.ACK=3,a.ERROR=4,a.BINARY_EVENT=5,a.BINARY_ACK=6,a.Encoder=i,a.Decoder=o,i.prototype.encode=function(e,t){var i,n;(e.type!==a.EVENT&&e.type!==a.ACK||!l(e.data)||(e.type=e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK),c("encoding packet %j",e),a.BINARY_EVENT===e.type||a.BINARY_ACK===e.type)?(i=e,n=t,p.removeBlobs(i,function(e){var t=p.deconstructPacket(e),i=r(t.packet),o=t.buffers;o.unshift(i),n(o)})):t([r(e)])},u(o.prototype),o.prototype.add=function(e){var t;if("string"==typeof e)t=n(e),a.BINARY_EVENT===t.type||a.BINARY_ACK===t.type?(this.reconstructor=new s(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!f(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},s.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length!==this.reconPack.attachments)return null;var t=p.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t},s.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,i){function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}(e.exports=o).prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o,n=0;n<i.length;n++)if((o=i[n])===t||o.fn===t){i.splice(n,1);break}return this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),i=this._callbacks["$"+e];if(i)for(var o=0,n=(i=i.slice(0)).length;o<n;++o)i[o].apply(this,t);return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(t,e,i){(function(r){var a=i(10),e=Object.prototype.toString,s="function"==typeof r.Blob||"[object BlobConstructor]"===e.call(r.Blob),d="function"==typeof r.File||"[object FileConstructor]"===e.call(r.File);t.exports=function e(t){if(!t||"object"!=typeof t)return!1;if(a(t)){for(var i=0,o=t.length;i<o;i++)if(e(t[i]))return!0;return!1}if("function"==typeof r.Buffer&&r.Buffer.isBuffer&&r.Buffer.isBuffer(t)||"function"==typeof r.ArrayBuffer&&t instanceof ArrayBuffer||s&&t instanceof Blob||d&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return!0;return!1}}).call(e,function(){return this||window}())},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,i,o){(function(e){var u=o(10),l=o(12),t=Object.prototype.toString,p="function"==typeof e.Blob||"[object BlobConstructor]"===t.call(e.Blob),f="function"==typeof e.File||"[object FileConstructor]"===t.call(e.File);i.deconstructPacket=function(e){var t=[],i=e.data,o=e;return o.data=function e(t,i){if(!t)return t;if(l(t)){var o={_placeholder:!0,num:i.length};return i.push(t),o}if(u(t)){for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=e(t[r],i);return n}if("object"!=typeof t||t instanceof Date)return t;n={};for(var a in t)n[a]=e(t[a],i);return n}(i,t),o.attachments=t.length,{packet:o,buffers:t}},i.reconstructPacket=function(e,t){return e.data=function e(t,i){if(!t)return t;if(t&&t._placeholder)return i[t.num];if(u(t))for(var o=0;o<t.length;o++)t[o]=e(t[o],i);else if("object"==typeof t)for(var n in t)t[n]=e(t[n],i);return t}(e.data,t),e.attachments=void 0,e},i.removeBlobs=function(e,s){var d=0,c=e;(function e(t,i,o){if(!t)return t;if(p&&t instanceof Blob||f&&t instanceof File){d++;var n=new FileReader;n.onload=function(){o?o[i]=this.result:c=this.result,--d||s(c)},n.readAsArrayBuffer(t)}else if(u(t))for(var r=0;r<t.length;r++)e(t[r],r,t);else if("object"==typeof t&&!l(t))for(var a in t)e(t[a],a,t)})(c),d||s(c)}}).call(i,function(){return this||window}())},function(e,t){(function(t){e.exports=function(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(t,function(){return this||window}())},function(e,t,i){function o(e,t){if(!(this instanceof o))return new o(e,t);e&&"object"===(void 0===e?"undefined":n(e))&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new f({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var i=t.parser||s;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=i(14),r=i(39),a=i(8),s=i(7),c=i(41),u=i(42),l=i(3)("socket.io-client:manager"),p=i(37),f=i(43),m=Object.prototype.hasOwnProperty;(e.exports=o).prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)m.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},o.prototype.updateSocketIds=function(){for(var e in this.nsps)m.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},o.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(o.prototype),o.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},o.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},o.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},o.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},o.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},o.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},o.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},o.prototype.open=o.prototype.connect=function(i,e){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=d(this.uri,this.opts);var t=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var n=c(t,"open",function(){o.onopen(),i&&i()}),r=c(t,"error",function(e){if(l("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",e),i){var t=new Error("Connection error");t.data=e,i(t)}else o.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;l("connect attempt will timeout after %d",a);var s=setTimeout(function(){l("connect attempt timed out after %d",a),n.destroy(),t.close(),t.emit("error","timeout"),o.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(n),this.subs.push(r),this},o.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",u(this,"ondata"))),this.subs.push(c(e,"ping",u(this,"onping"))),this.subs.push(c(e,"pong",u(this,"onpong"))),this.subs.push(c(e,"error",u(this,"onerror"))),this.subs.push(c(e,"close",u(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",u(this,"ondecoded")))},o.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},o.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},o.prototype.ondata=function(e){this.decoder.add(e)},o.prototype.ondecoded=function(e){this.emit("packet",e)},o.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},o.prototype.socket=function(e,t){function i(){~p(n.connecting,o)||n.connecting.push(o)}var o=this.nsps[e];if(!o){o=new r(this,e,t),this.nsps[e]=o;var n=this;o.on("connecting",i),o.on("connect",function(){o.id=n.generateId(e)}),this.autoConnect&&i()}return o},o.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},o.prototype.packet=function(i){l("writing packet %j",i);var o=this;i.query&&0===i.type&&(i.nsp+="?"+i.query),o.encoding?o.packetBuffer.push(i):(o.encoding=!0,this.encoder.encode(i,function(e){for(var t=0;t<e.length;t++)o.engine.write(e[t],i.options);o.encoding=!1,o.processPacketQueue()}))},o.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},o.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},o.prototype.close=o.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},o.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},o.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();l("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var i=setTimeout(function(){t.skipReconnect||(l("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(l("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(l("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(i)}})}},o.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,i){e.exports=i(15)},function(e,t,i){e.exports=i(16),e.exports.parser=i(23)},function(t,e,c){(function(o){function l(e,t){if(!(this instanceof l))return new l(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=s(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=s(t.host).host),this.secure=null!=t.secure?t.secure:o.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(o.location?location.hostname:"localhost"),this.port=t.port||(o.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=d.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var i="object"==typeof o&&o;i.global===i&&(t.extraHeaders&&0<Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}var n=c(17),e=c(8),p=c(3)("engine.io-client:socket"),r=c(37),a=c(23),s=c(2),i=c(38),d=c(31);(t.exports=l).priorWebsocketSuccess=!1,e(l.prototype),l.protocol=a.protocol,(l.Socket=l).Transport=c(22),l.transports=c(17),l.parser=c(23),l.prototype.createTransport=function(e){p('creating transport "%s"',e);var t=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var i=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new n[e]({query:t,socket:this,agent:i.agent||this.agent,hostname:i.hostname||this.hostname,port:i.port||this.port,secure:i.secure||this.secure,path:i.path||this.path,forceJSONP:i.forceJSONP||this.forceJSONP,jsonp:i.jsonp||this.jsonp,forceBase64:i.forceBase64||this.forceBase64,enablesXDR:i.enablesXDR||this.enablesXDR,timestampRequests:i.timestampRequests||this.timestampRequests,timestampParam:i.timestampParam||this.timestampParam,policyPort:i.policyPort||this.policyPort,pfx:i.pfx||this.pfx,key:i.key||this.key,passphrase:i.passphrase||this.passphrase,cert:i.cert||this.cert,ca:i.ca||this.ca,ciphers:i.ciphers||this.ciphers,rejectUnauthorized:i.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:i.perMessageDeflate||this.perMessageDeflate,extraHeaders:i.extraHeaders||this.extraHeaders,forceNode:i.forceNode||this.forceNode,localAddress:i.localAddress||this.localAddress,requestTimeout:i.requestTimeout||this.requestTimeout,protocols:i.protocols||void 0})},l.prototype.open=function(){var e;if(this.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},l.prototype.setTransport=function(e){p("setting transport %s",e.name);var t=this;this.transport&&(p("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=e).on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},l.prototype.probe=function(i){function e(){if(u.onlyBinaryUpgrades){var e=!this.supportsBinary&&u.transport.supportsBinary;c=c||e}c||(p('probe transport "%s" opened',i),d.send([{type:"ping",data:"probe"}]),d.once("packet",function(e){if(!c)if("pong"===e.type&&"probe"===e.data){if(p('probe transport "%s" pong',i),u.upgrading=!0,u.emit("upgrading",d),!d)return;l.priorWebsocketSuccess="websocket"===d.name,p('pausing current transport "%s"',u.transport.name),u.transport.pause(function(){c||"closed"!==u.readyState&&(p("changing transport and sending upgrade packet"),s(),u.setTransport(d),d.send([{type:"upgrade"}]),u.emit("upgrade",d),d=null,u.upgrading=!1,u.flush())})}else{p('probe transport "%s" failed',i);var t=new Error("probe error");t.transport=d.name,u.emit("upgradeError",t)}}))}function o(){c||(c=!0,s(),d.close(),d=null)}function t(e){var t=new Error("probe error: "+e);t.transport=d.name,o(),p('probe transport "%s" failed because of error: %s',i,e),u.emit("upgradeError",t)}function n(){t("transport closed")}function r(){t("socket closed")}function a(e){d&&e.name!==d.name&&(p('"%s" works - aborting "%s"',e.name,d.name),o())}function s(){d.removeListener("open",e),d.removeListener("error",t),d.removeListener("close",n),u.removeListener("close",r),u.removeListener("upgrading",a)}p('probing transport "%s"',i);var d=this.createTransport(i,{probe:1}),c=!1,u=this;l.priorWebsocketSuccess=!1,d.once("open",e),d.once("error",t),d.once("close",n),this.once("close",r),this.once("upgrading",a),d.open()},l.prototype.onOpen=function(){if(p("socket open"),this.readyState="open",l.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){p("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},l.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(p('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(i(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else p('packet received with socket readyState "%s"',this.readyState)},l.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},l.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},l.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){p("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},l.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},l.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},l.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(p("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},l.prototype.write=l.prototype.send=function(e,t,i){return this.sendPacket("message",e,t,i),this},l.prototype.sendPacket=function(e,t,i,o){if("function"==typeof t&&(o=t,t=void 0),"function"==typeof i&&(o=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState){(i=i||{}).compress=!1!==i.compress;var n={type:e,data:t,options:i};this.emit("packetCreate",n),this.writeBuffer.push(n),o&&this.once("flush",o),this.flush()}},l.prototype.close=function(){function e(){o.onClose("forced close"),p("socket closing - telling transport to close"),o.transport.close()}function t(){o.removeListener("upgrade",t),o.removeListener("upgradeError",t),e()}function i(){o.once("upgrade",t),o.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var o=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?i():e()}):this.upgrading?i():e()}return this},l.prototype.onError=function(e){p("socket error %j",e),l.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},l.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){p('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},l.prototype.filterUpgrades=function(e){for(var t=[],i=0,o=e.length;i<o;i++)~r(this.transports,e[i])&&t.push(e[i]);return t}}).call(e,function(){return this||window}())},function(e,t,i){(function(a){var s=i(18),d=i(20),c=i(34),e=i(35);t.polling=function(e){var t=!1,i=!1,o=!1!==e.jsonp;if(a.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),t=e.hostname!==location.hostname||r!==e.port,i=e.secure!==n}if(e.xdomain=t,e.xscheme=i,"open"in new s(e)&&!e.forceJSONP)return new d(e);if(!o)throw new Error("JSONP disabled");return new c(e)},t.websocket=e}).call(t,function(){return this||window}())},function(e,t,i){(function(n){var r=i(19);e.exports=function(e){var t=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!t)try{return new(n[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(t,function(){return this||window}())},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(u,e,l){(function(n){function t(){}function e(e){if(o.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,n.location){var t="https:"===location.protocol,i=location.port;i||(i=t?443:80),this.xd=e.hostname!==n.location.hostname||i!==e.port,this.xs=e.secure!==t}}function r(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function i(){for(var e in r.requests)r.requests.hasOwnProperty(e)&&r.requests[e].abort()}var a=l(18),o=l(21),s=l(8),d=l(32),c=l(3)("engine.io-client:polling-xhr");u.exports=e,u.exports.Request=r,d(e,o),e.prototype.supportsBinary=!0,e.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new r(e)},e.prototype.doWrite=function(e,t){var i="string"!=typeof e&&void 0!==e,o=this.request({method:"POST",data:e,isBinary:i}),n=this;o.on("success",t),o.on("error",function(e){n.onError("xhr post error",e)}),this.sendXhr=o},e.prototype.doPoll=function(){c("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},s(r.prototype),r.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),i=this;try{c("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&t.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState){var e;try{e=t.getResponseHeader("Content-Type")}catch(e){}"application/octet-stream"===e&&(t.responseType="arraybuffer")}4===t.readyState&&(200===t.status||1223===t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0))},c("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}n.document&&(this.index=r.requestsCount++,r.requests[this.index]=this)},r.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},r.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},r.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},r.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=t:this.xhr.onreadystatechange=t,e)try{this.xhr.abort()}catch(e){}n.document&&delete r.requests[this.index],this.xhr=null}},r.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},r.prototype.hasXDR=function(){return void 0!==n.XDomainRequest&&!this.xs&&this.enablesXDR},r.prototype.abort=function(){this.cleanup()},r.requestsCount=0,r.requests={},n.document&&(n.attachEvent?n.attachEvent("onunload",i):n.addEventListener&&n.addEventListener("beforeunload",i,!1))}).call(e,function(){return this||window}())},function(e,t,i){function o(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),n.call(this,e)}var n=i(22),r=i(31),a=i(23),s=i(32),d=i(33),c=i(3)("engine.io-client:polling");e.exports=o;var u=null!=new(i(18))({xdomain:!1}).responseType;s(o,n),o.prototype.name="polling",o.prototype.doOpen=function(){this.poll()},o.prototype.pause=function(e){function t(){c("paused"),i.readyState="paused",e()}var i=this;if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(c("we are currently polling - waiting to pause"),o++,this.once("pollComplete",function(){c("pre-pause polling complete"),--o||t()})),this.writable||(c("we are currently writing - waiting to pause"),o++,this.once("drain",function(){c("pre-pause writing complete"),--o||t()}))}else t()},o.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},o.prototype.onData=function(e){var o=this;c("polling got data %s",e);a.decodePayload(e,this.socket.binaryType,function(e,t,i){return"opening"===o.readyState&&o.onOpen(),"close"===e.type?(o.onClose(),!1):void o.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},o.prototype.doClose=function(){function e(){c("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},o.prototype.write=function(e){var t=this;this.writable=!1;var i=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,i)})},o.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",i="";return!1!==this.timestampRequests&&(e[this.timestampParam]=d()),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(i=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+i+this.path+e}},function(e,t,i){function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var n=i(23);i(8)((e.exports=o).prototype),o.prototype.onError=function(e,t){var i=new Error(e);return i.type="TransportError",i.description=t,this.emit("error",i),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,h,o){(function(c){function s(e,t,i){if(!t)return h.encodeBase64Packet(e,i);if(l)return function(e,t,i){if(!t)return h.encodeBase64Packet(e,i);var o=new FileReader;return o.onload=function(){e.data=o.result,h.encodePacket(e,t,!0,i)},o.readAsArrayBuffer(e.data)}(e,t,i);var o=new Uint8Array(1);return o[0]=f[e.type],i(new v([o.buffer,e.data]))}function n(e,t,i){for(var n=new Array(e.length),o=d(e.length,i),r=function(i,e,o){t(e,function(e,t){n[i]=t,o(e,n)})},a=0;a<e.length;a++)r(a,e[a],o)}var r,e=o(24),a=o(9),p=o(25),d=o(26),u=o(27);c&&c.ArrayBuffer&&(r=o(29));var t="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),i="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=t||i;h.protocol=3;var f=h.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=e(f),g={type:"error",data:"parser error"},v=o(30);h.encodePacket=function(e,t,i,o){"function"==typeof t&&(o=t,t=!1),"function"==typeof i&&(o=i,i=null);var n,r=void 0===e.data?void 0:e.data.buffer||e.data;if(c.ArrayBuffer&&r instanceof ArrayBuffer)return function(e,t,i){if(!t)return h.encodeBase64Packet(e,i);var o=e.data,n=new Uint8Array(o),r=new Uint8Array(1+o.byteLength);r[0]=f[e.type];for(var a=0;a<n.length;a++)r[a+1]=n[a];return i(r.buffer)}(e,t,o);if(v&&r instanceof c.Blob)return s(e,t,o);if(r&&r.base64)return n=e,o("b"+h.packets[n.type]+n.data.data);var a=f[e.type];return void 0!==e.data&&(a+=i?u.encode(String(e.data),{strict:!1}):String(e.data)),o(""+a)},h.encodeBase64Packet=function(t,i){var o,n="b"+h.packets[t.type];if(v&&t.data instanceof c.Blob){var r=new FileReader;return r.onload=function(){var e=r.result.split(",")[1];i(n+e)},r.readAsDataURL(t.data)}try{o=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var a=new Uint8Array(t.data),s=new Array(a.length),d=0;d<a.length;d++)s[d]=a[d];o=String.fromCharCode.apply(null,s)}return n+=c.btoa(o),i(n)},h.decodePacket=function(e,t,i){if(void 0===e)return g;if("string"==typeof e){if("b"===e.charAt(0))return h.decodeBase64Packet(e.substr(1),t);if(i&&!1===(e=function(e){try{e=u.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return g;var o=e.charAt(0);return Number(o)==o&&m[o]?1<e.length?{type:m[o],data:e.substring(1)}:{type:m[o]}:g}o=new Uint8Array(e)[0];var n=p(e,1);return v&&"blob"===t&&(n=new v([n])),{type:m[o],data:n}},h.decodeBase64Packet=function(e,t){var i=m[e.charAt(0)];if(!r)return{type:i,data:{base64:!0,data:e.substr(1)}};var o=r.decode(e.substr(1));return"blob"===t&&v&&(o=new v([o])),{type:i,data:o}},h.encodePayload=function(e,t,i){"function"==typeof t&&(i=t,t=null);var o=a(e);return t&&o?v&&!l?h.encodePayloadAsBlob(e,i):h.encodePayloadAsArrayBuffer(e,i):e.length?void n(e,function(e,i){h.encodePacket(e,!!o&&t,!1,function(e){var t;i(null,(t=e).length+":"+t)})},function(e,t){return i(t.join(""))}):i("0:")},h.decodePayload=function(e,t,i){if("string"!=typeof e)return h.decodePayloadAsBinary(e,t,i);var o;if("function"==typeof t&&(i=t,t=null),""===e)return i(g,0,1);for(var n,r,a="",s=0,d=e.length;s<d;s++){var c=e.charAt(s);if(":"===c){if(""===a||a!=(n=Number(a)))return i(g,0,1);if(a!=(r=e.substr(s+1,n)).length)return i(g,0,1);if(r.length){if(o=h.decodePacket(r,t,!1),g.type===o.type&&g.data===o.data)return i(g,0,1);if(!1===i(o,s+n,d))return}s+=n,a=""}else a+=c}return""!==a?i(g,0,1):void 0},h.encodePayloadAsArrayBuffer=function(e,o){return e.length?void n(e,function(e,t){h.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,t){var i=t.reduce(function(e,t){var i;return e+(i="string"==typeof t?t.length:t.byteLength).toString().length+i+2},0),a=new Uint8Array(i),s=0;return t.forEach(function(e){var t="string"==typeof e,i=e;if(t){for(var o=new Uint8Array(e.length),n=0;n<e.length;n++)o[n]=e.charCodeAt(n);i=o.buffer}a[s++]=t?0:1;var r=i.byteLength.toString();for(n=0;n<r.length;n++)a[s++]=parseInt(r[n]);a[s++]=255;for(o=new Uint8Array(i),n=0;n<o.length;n++)a[s++]=o[n]}),o(a.buffer)}):o(new ArrayBuffer(0))},h.encodePayloadAsBlob=function(e,i){n(e,function(e,s){h.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);e=i.buffer,t[0]=0}var n=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),r=new Uint8Array(n.length+1);for(o=0;o<n.length;o++)r[o]=parseInt(n[o]);if(r[n.length]=255,v){var a=new v([t.buffer,r.buffer,e]);s(null,a)}})},function(e,t){return i(new v(t))})},h.decodePayloadAsBinary=function(e,i,o){"function"==typeof i&&(o=i,i=null);for(var t=e,n=[];0<t.byteLength;){for(var r=new Uint8Array(t),a=0===r[0],s="",d=1;255!==r[d];d++){if(310<s.length)return o(g,0,1);s+=r[d]}t=p(t,2+s.length),s=parseInt(s);var c=p(t,0,s);if(a)try{c=String.fromCharCode.apply(null,new Uint8Array(c))}catch(e){var u=new Uint8Array(c);c="";for(d=0;d<u.length;d++)c+=String.fromCharCode(u[d])}n.push(c),t=p(t,s)}var l=n.length;n.forEach(function(e,t){o(h.decodePacket(e,i,!0),t,l)})}}).call(h,function(){return this||window}())},function(e,t){e.exports=Object.keys||function(e){var t=[],i=Object.prototype.hasOwnProperty;for(var o in e)i.call(e,o)&&t.push(o);return t}},function(e,t){e.exports=function(e,t,i){var o=e.byteLength;if(t=t||0,i=i||o,e.slice)return e.slice(t,i);if(t<0&&(t+=o),i<0&&(i+=o),o<i&&(i=o),o<=t||i<=t||0===o)return new ArrayBuffer(0);for(var n=new Uint8Array(e),r=new Uint8Array(i-t),a=t,s=0;a<i;a++,s++)r[s]=n[a];return r.buffer}},function(e,t){function a(){}e.exports=function(e,i,o){function n(e,t){if(n.count<=0)throw new Error("after called too many times");--n.count,e?(r=!0,i(e),i=o):0!==n.count||r||i(null,t)}var r=!1;return o=o||a,0===(n.count=e)?i():n}},function(e,g,v){var h;(function(f,m){!function(e){function s(e){for(var t,i,o=[],n=0,r=e.length;n<r;)55296<=(t=e.charCodeAt(n++))&&t<=56319&&n<r?56320==(64512&(i=e.charCodeAt(n++)))?o.push(((1023&t)<<10)+(1023&i)+65536):(o.push(t),n--):o.push(t);return o}function o(e,t){if(55296<=e&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function n(e,t){return p(e>>t&63|128)}function d(e,t){if(0==(4294967168&e))return p(e);var i="";return 0==(4294965248&e)?i=p(e>>6&31|192):0==(4294901760&e)?(o(e,t)||(e=65533),i=p(e>>12&15|224),i+=n(e,6)):0==(4292870144&e)&&(i=p(e>>18&7|240),i+=n(e,12),i+=n(e,6)),i+p(63&e|128)}function r(){if(u<=l)throw Error("Invalid byte index");var e=255&c[l];if(l++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function a(e){var t,i;if(u<l)throw Error("Invalid byte index");if(l==u)return!1;if(t=255&c[l],l++,0==(128&t))return t;if(192==(224&t)){if(128<=(i=(31&t)<<6|r()))return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(i=(15&t)<<12|r()<<6|r()))return o(i,e)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(65536<=(i=(7&t)<<18|r()<<12|r()<<6|r())&&i<=1114111))return i;throw Error("Invalid UTF-8 detected")}var t=("object"==typeof f&&f&&f.exports,"object"==typeof m&&m);t.global!==t&&t.window;var c,u,l,p=String.fromCharCode,i={version:"2.1.2",encode:function(e,t){for(var i=!1!==(t=t||{}).strict,o=s(e),n=o.length,r=-1,a="";++r<n;)a+=d(o[r],i);return a},decode:function(e,t){var i=!1!==(t=t||{}).strict;c=s(e),u=c.length,l=0;for(var o,n=[];!1!==(o=a(i));)n.push(o);return function(e){for(var t,i=e.length,o=-1,n="";++o<i;)65535<(t=e[o])&&(n+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=p(t);return n}(n)}};void 0===(h=function(){return i}.call(g,v,g,f))||(f.exports=h)}()}).call(g,v(28)(e),function(){return this||window}())},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){!function(){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(256),e=0;e<r.length;e++)l[r.charCodeAt(e)]=e;t.encode=function(e){var t,i=new Uint8Array(e),o=i.length,n="";for(t=0;t<o;t+=3)n+=r[i[t]>>2],n+=r[(3&i[t])<<4|i[t+1]>>4],n+=r[(15&i[t+1])<<2|i[t+2]>>6],n+=r[63&i[t+2]];return o%3==2?n=n.substring(0,n.length-1)+"=":o%3==1&&(n=n.substring(0,n.length-2)+"=="),n},t.decode=function(e){var t,i,o,n,r,a=.75*e.length,s=e.length,d=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(t=0;t<s;t+=4)i=l[e.charCodeAt(t)],o=l[e.charCodeAt(t+1)],n=l[e.charCodeAt(t+2)],r=l[e.charCodeAt(t+3)],u[d++]=i<<2|o>>4,u[d++]=(15&o)<<4|n>>2,u[d++]=(3&n)<<6|63&r;return c}}()},function(d,e){(function(e){function n(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.buffer instanceof ArrayBuffer){var o=i.buffer;if(i.byteLength!==o.byteLength){var n=new Uint8Array(i.byteLength);n.set(new Uint8Array(o,i.byteOffset,i.byteLength)),o=n.buffer}e[t]=o}}}function t(e,t){t=t||{};var i=new r;n(e);for(var o=0;o<e.length;o++)i.append(e[o]);return t.type?i.getBlob(t.type):i.getBlob()}function i(e,t){return n(e),new Blob(e,t||{})}var r=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,o=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=o&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),s=r&&r.prototype.append&&r.prototype.getBlob;d.exports=o?a?e.Blob:i:s?t:void 0}).call(e,function(){return this||window}())},function(e,t){t.encode=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t},t.decode=function(e){for(var t={},i=e.split("&"),o=0,n=i.length;o<n;o++){var r=i[o].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}},function(e,t){e.exports=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},function(e,t){function i(e){for(var t="";t=r[e%a]+t,0<(e=Math.floor(e/a)););return t}function o(){var e=i(+new Date);return e!==n?(d=0,n=e):e+"."+i(d++)}for(var n,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,s={},d=0,c=0;c<a;c++)s[r[c]]=c;o.encode=i,o.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*a+s[e.charAt(c)];return t},e.exports=o},function(a,e,s){(function(i){function o(){}function e(e){n.call(this,e),this.query=this.query||{},r||(i.___eio||(i.___eio=[]),r=i.___eio),this.index=r.length;var t=this;r.push(function(e){t.onData(e)}),this.query.j=this.index,i.document&&i.addEventListener&&i.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=o)},!1)}var n=s(21),t=s(32);a.exports=e;var r,c=/\n/g,u=/\\n/g;t(e,n),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},e.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var i=document.getElementsByTagName("script")[0];i?i.parentNode.insertBefore(e,i):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},e.prototype.doWrite=function(e,t){function i(){o(),t()}function o(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}var n=this;if(!this.form){var r,a=document.createElement("form"),s=document.createElement("textarea"),d=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=d,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),o(),e=e.replace(u,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&i()}:this.iframe.onload=i}}).call(e,function(){return this||window}())},function(l,e,p){(function(r){function e(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=c&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(u=t),i.call(this,e)}var t,i=p(22),a=p(23),o=p(31),n=p(32),s=p(33),d=p(3)("engine.io-client:websocket"),c=r.WebSocket||r.MozWebSocket;if("undefined"==typeof window)try{t=p(36)}catch(e){}var u=c;u||"undefined"!=typeof window||(u=t),n(l.exports=e,i),e.prototype.name="websocket",e.prototype.supportsBinary=!0,e.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,i={agent:this.agent,perMessageDeflate:this.perMessageDeflate};i.pfx=this.pfx,i.key=this.key,i.passphrase=this.passphrase,i.cert=this.cert,i.ca=this.ca,i.ciphers=this.ciphers,i.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(i.headers=this.extraHeaders),this.localAddress&&(i.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new u(e,t):new u(e):new u(e,t,i)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},e.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},e.prototype.write=function(e){var o=this;this.writable=!1;for(var n=e.length,t=0,i=n;t<i;t++)!function(i){a.encodePacket(i,o.supportsBinary,function(e){if(!o.usingBrowserWebSocket){var t={};if(i.options&&(t.compress=i.options.compress),o.perMessageDeflate)("string"==typeof e?r.Buffer.byteLength(e):e.length)<o.perMessageDeflate.threshold&&(t.compress=!1)}try{o.usingBrowserWebSocket?o.ws.send(e):o.ws.send(e,t)}catch(e){d("websocket closed before onclose event")}--n||(o.emit("flush"),setTimeout(function(){o.writable=!0,o.emit("drain")},0))})}(e[t])},e.prototype.onClose=function(){i.prototype.onClose.call(this)},e.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},e.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",i="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(i=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||(e.b64=1),(e=o.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+i+this.path+e},e.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===e.prototype.name)}}).call(e,function(){return this||window}())},function(e,t){},function(e,t){var o=[].indexOf;e.exports=function(e,t){if(o)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}},function(e,t){(function(t){var i=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,n=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(a,"").replace(s,""),t.JSON&&JSON.parse?JSON.parse(e):i.test(e.replace(o,"@").replace(n,"]").replace(r,""))?new Function("return "+e)():void 0):null}}).call(t,function(){return this||window}())},function(e,t,i){function o(e,t,i){this.io=e,this.nsp=t,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,i&&i.query&&(this.query=i.query),this.io.autoConnect&&this.open()}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=i(7),a=i(8),s=i(40),d=i(41),c=i(42),u=i(3)("socket.io-client:socket"),l=i(31);e.exports=o;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=a.prototype.emit;a(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[d(e,"open",c(this,"onopen")),d(e,"packet",c(this,"onpacket")),d(e,"close",c(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},o.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(p.hasOwnProperty(e))return f.apply(this,arguments),this;var t=s(arguments),i={type:r.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===n(this.query)?l.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:r.CONNECT,query:e})}else this.packet({type:r.CONNECT})},o.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(t){var i=this,o=!1;return function(){if(!o){o=!0;var e=s(arguments);u("sending ack %j",e),i.packet({type:r.ACK,id:t,data:e})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},function(e,t){e.exports=function(e,t){for(var i=[],o=(t=t||0)||0;o<e.length;o++)i[o-t]=e[o];return i}},function(e,t){e.exports=function(e,t,i){return e.on(t,i),{destroy:function(){e.removeListener(t,i)}}}},function(e,t){var o=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var i=o.call(arguments,2);return function(){return t.apply(e,i.concat(o.call(arguments)))}}},function(e,t){function i(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}(e.exports=i).prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),i=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-i:e+i}return 0|Math.min(e,this.max)},i.prototype.reset=function(){this.attempts=0},i.prototype.setMin=function(e){this.ms=e},i.prototype.setMax=function(e){this.max=e},i.prototype.setJitter=function(e){this.jitter=e}}])}),window.TK.socketIO=window.TK.socketIO||window.io,!window.TK.socketIO)try{window.TK.socketIO=io}catch(e){console.error("[tk-sdk]socket.io registration failed,please link socket.io,for example: window.tk.SocketIO = io (io is the socket.io that you want to associate with)!")}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Logline=t()}(this,function(){function e(e,t){var i={};"string"==typeof e?i[e]=t:"[object Object]"===Object.prototype.toString.call(e)&&(i=e),o(s,i)}function c(e){p&&console.error("Logline: "+e)}function u(e,t,i){var o;p&&d.get().verbose&&(o=window.console)[f[t.toUpperCase()]||f.INFO].apply(o,[e+" "+t.toUpperCase()].concat(r(i||"")))}var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},l=function e(t,i,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,o)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(o):void 0},t=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},r=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},s=o({},{verbose:!0}),d=e;d.set=e,d.get=function(e){return e?s[e]:s};var p=window.console,f={INFO:"log",WARN:"warn",ERROR:"error",CRITICAL:"error"},m=function(){function t(e){n(this,t),this._namespace=e}return i(t,[{key:"_record",value:function(e,t,i){c("method _record is not implemented.")}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),n=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["info"].concat(r(o),[n]))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),n=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["warn"].concat(r(o),[n]))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),n=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["error"].concat(r(o),[n]))}},{key:"critical",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),n=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["critical"].concat(r(o),[n]))}}],[{key:"init",value:function(e){return!0}},{key:"transTimeFormat",value:function(e,t){if(!e||/^\d{13}$/.test(e))return+e;if(t&&!/^\d{13}$/.test(t))throw new TypeError("relative time should be standard unix timestamp");return(t||Date.now())-24*e.replace(/d$/,"")*3600*1e3}},{key:"get",value:function(e,t,i){c("method get is not implemented.")}},{key:"keep",value:function(e){c("method keep is not implemented.")}},{key:"clean",value:function(){c("method clean is not implemented.")}},{key:"STATUS",get:function(){return{INITING:1,INITED:2,FAILED:4}}}]),t}(),g=function(){function e(){n(this,e),this._pool=[]}return i(e,[{key:"push",value:function(e,t){e.context=t,this._pool.push(e)}},{key:"consume",value:function(){for(var e;e=this._pool.shift();)e.call(e.context)}}]),e}(),v=function(e){function d(){var e;n(this,d);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return a(this,(e=d.__proto__||Object.getPrototypeOf(d)).call.apply(e,[this].concat(i)))}return t(d,m),i(d,[{key:"_record",value:function(e,t,i){var o=this;try{if(d.status!==m.STATUS.INITED)return d._pool.push(function(){return o._record(e,t,i)}),void(d.status!==m.STATUS.INITING&&d.init());u(this._namespace,e,i);var n=d.db.transaction(["logs"],"readwrite");n.onerror=function(e){c(e.target.error),keep&&keep()};var r=n.objectStore("logs"),a="2";"debug"===e?a="3":"info"===e?a="4":"warn"===e?a="5":"error"===e&&(a="6");var s="";[].concat(Array.prototype.slice.call(arguments)).forEach(function(e,t){t<=1||("string"!=typeof e&&e&&e.constructor?e.constructor===Array?function i(e){e.forEach(function(e,t){"string"!=typeof e&&e&&e.constructor?e.constructor===Array?i(e):s+=JSON.stringify(e):s+=e})}(e):s+=JSON.stringify(e):s+=e)}),r.add({ts:Date.now(),level:a,log:s,file:"",serial:t&&t.serial?t.serial:"",peerid:t&&t.peerid?t.peerid:"",line:null}).onerror=function(e){d.status=m.STATUS.FAILED,c(e.target.error),keep&&keep()}}catch(e){c("failed to write, "+e.message)}}}],[{key:"init",value:function(e){var t=this;try{if(d.support||c("your platform does not support indexeddb protocol."),d.status)return!1;d._pool=d._pool||new g,d._database=e||"logline",d.status=l(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITING,(d.request=window.indexedDB.open(d._database)).onerror=function(e){c("protocol indexeddb is prevented."),keep&&keep()},d.request.onsuccess=function(e){d.db=e.target.result,d.status=l(d.__proto__||Object.getPrototypeOf(d),"STATUS",t).INITED,d._pool.consume(),d.db.onerror=function(e){c(e.target.error),keep&&keep()}},d.request.onupgradeneeded=function(e){var t=e.target.result.createObjectStore("logs",{autoIncrement:!0});t.createIndex("level","level",{unique:!1}),t.createIndex("file","file",{unique:!1}),t.createIndex("log","log",{unique:!1}),t.createIndex("line","line",{unique:!1})}}catch(e){c("failed init, "+e.message)}}},{key:"get",value:function(i,o,n){try{if(d.status!==l(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED)return d._pool.push(function(){return d.get(i,o,n)});i=m.transTimeFormat(i),o=m.transTimeFormat(o);var e=d._getTransactionStore(IDBTransaction.READ_ONLY);if(!e)return n([]);if(e.getAll){var r=void 0,a=[];e.getAll().onsuccess=function(e){r=e.target.result;for(var t=0;t<r.length;t++)i&&r[t].ts<i||o&&r[t].ts>o||a.push(r[t]);n(a)}}else{var t=e.openCursor(),s=[];t.onsuccess=function(e){var t=e.target.result;if(t){if(i&&t.value.ts<i||o&&t.value.ts>o)return t.continue();s.push({ts:t.value.ts,level:t.value.level,descriptor:t.value.descriptor,log:t.value.log,line:null,file:t.value.file}),t.continue()}else n(s)}}}catch(i){c("failed to get logs, "+i.message)}}},{key:"keep",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){try{if(d.status!==l(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED)return d._pool.push(function(){return d.keep(t)});var i=d._getTransactionStore("readwrite");if(!i)return!1;if(t){var o=Date.now()-24*(t||2)*3600*1e3,e=i.openCursor();e.onsuccess=function(e){var t=e.target.result;t&&t.value.ts<o&&(i.delete(t.primaryKey),t.continue())},e.onerror=function(e){c("unable to locate logs earlier than "+t+"d."),keep&&keep()}}else i.clear().onerror=function(e){c(e.target.error),keep&&keep()}}catch(t){c("failed to keep logs, "+t.message)}})},{key:"clean",value:function(){try{if(d.status!==l(d.__proto__||Object.getPrototypeOf(d),"STATUS",this).INITED)return d._pool.push(function(){return d.clean()});d.db.close();var e=window.indexedDB.deleteDatabase(d._database);e.onerror=function(e){c(e.target.error),keep&&keep()},e.onsuccess=function(e){delete d.status,delete d.db}}catch(e){c("failed to cleanup logs, "+e.message)}}},{key:"_getTransactionStore",value:function(e){try{if(d.db){var t=d.db.transaction(["logs"],e||"readwrite");return t.onerror=function(e){c(e.target.error),keep&&keep()},t.objectStore("logs")}c("log database is not created or connections are closed, considering init it.")}catch(e){return c("failed to generate new transaction, "+e.message),!1}}},{key:"support",get:function(){return!!(window.indexedDB&&window.IDBTransaction&&window.IDBKeyRange)}}]),d}(),h=function(e){function r(){var e;n(this,r);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return a(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(i)))}return t(r,m),i(r,[{key:"_record",value:function(e,t,i){var o;try{(o=window.localStorage.getItem(r._database)?JSON.parse(window.localStorage.getItem(r._database)):[]).push([Date.now(),this._namespace,e,t,i]),u(this._namespace,e,t),window.localStorage.setItem(r._database,JSON.stringify(o))}catch(e){window.localStorage.removeItem(r._database),window.localStorage.setItem(r._database,JSON.stringify([])),c("failed to write, may be localStorage is full, "+e.message)}}}],[{key:"init",value:function(e){try{r.support||c("your platform does not support localstorage protocol."),r._database=e||"logline",window.localStorage.getItem(r._database)||window.localStorage.setItem(r._database,JSON.stringify([])),r.status=l(r.__proto__||Object.getPrototypeOf(r),"STATUS",this).INITED}catch(e){c("failed to init, "+e.message)}}},{key:"get",value:function(e,t,i){var o,n;try{for(o=JSON.parse(window.localStorage.getItem(r._database)),e=m.transTimeFormat(e),t=m.transTimeFormat(t),n=0;n<o.length;n++)e&&o[n][0]<e||t&&o[n][0]>t||(o[n]={time:o[n][0],namespace:o[n][1],level:o[n][2],descriptor:o[n][3],data:o[n][4]});i(o)}catch(e){c("failed to get, "+e.message),i([])}}},{key:"keep",value:function(t){var e;try{e=t?(window.localStorage.getItem(r._database)?JSON.parse(window.localStorage.getItem(r._database)):[]).filter(function(e){return e.time>=Date.now()-24*(t||2)*3600*1e3}):[],window.localStorage.setItem(r._database,JSON.stringify(e))}catch(t){c("failed to keep, "+t.message)}}},{key:"clean",value:function(){try{delete r.status,window.localStorage.removeItem(r._database)}catch(e){c("failed to clean, "+e.message)}}},{key:"support",get:function(){return"localStorage"in window}}]),r}(),T=function(e){function r(){var e;n(this,r);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return a(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(i)))}return t(r,m),i(r,[{key:"_record",value:function(t,i,o){var n=this;if(r.status!==m.STATUS.INITED)return r._pool.push(function(){return n._record(t,i,o)}),void(r.status!==m.STATUS.INITING&&r.init());try{u(this._namespace,t,i),r._db.transaction(function(e){e.executeSql("INSERT INTO logs (time, namespace, level, descriptor, data) VALUES(?, ?, ?, ? ,?)",[Date.now(),n._namespace,t,i,void 0===o||""===o?"":JSON.stringify(o)||""],function(){},function(e,t){c("write error, "+t.message)})})}catch(t){c("error inserting record, "+t.message)}}}],[{key:"init",value:function(e){var i=this;if(r.support||c(new Error("your platform does not support websql protocol.")),r.status)return!1;r._pool=r._pool||new g,r._database=e||"logline",r.status=l(r.__proto__||Object.getPrototypeOf(r),"STATUS",this).INITING;try{(r._db=window.openDatabase(r._database,"1.0","cats loves logs",5085593.6)).transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS logs (time, namespace, level, descriptor, data)",[],function(){r.status=l(r.__proto__||Object.getPrototypeOf(r),"STATUS",i).INITED,r._pool.consume()},function(e,t){r.status=l(r.__proto__||Object.getPrototypeOf(r),"STATUS",i).FAILED,c("unable to create table, "+t.message)})})}catch(e){c("unable to init log database, "+e.message)}}},{key:"get",value:function(a,s,d){if(r.status!==l(r.__proto__||Object.getPrototypeOf(r),"STATUS",this).INITED)return r._pool.push(function(){return r.get(a,s,d)});a=m.transTimeFormat(a),s=m.transTimeFormat(s);try{r._db.transaction(function(e){e.executeSql("SELECT * FROM logs ORDER BY time DESC",[],function(e,t){for(var i,o,n=[],r=t.rows.length;0<=--r;)if(o=t.rows.item(r),!(a&&o.time<a||s&&o.time>s)){i=JSON.parse(JSON.stringify(o));try{i.data=JSON.parse(i.data)}catch(e){}n.push(i)}d(n)},function(e,t){c(t.message)})})}catch(a){c("unable to collect logs from database.")}}},{key:"keep",value:function(t){if(r.status!==l(r.__proto__||Object.getPrototypeOf(r),"STATUS",this).INITED)return r._pool.push(function(){return r.keep(t)});try{r._db.transaction(function(e){t?e.executeSql("DELETE FROM logs WHERE time < ?",[Date.now()-24*(t||2)*3600*1e3],function(){},function(e,t){c(t.message)}):e.executeSql("DELETE FROM logs",[],function(){},function(e,t){c(t.message)})})}catch(t){c("unable to clean logs from database.")}}},{key:"clean",value:function(){if(r.status===l(r.__proto__||Object.getPrototypeOf(r),"STATUS",this).INITED)try{r._db.transaction(function(e){e.executeSql("DROP TABLE logs",[],function(){delete r.status},function(e,t){c(t.message)})})}catch(e){c("unable to clean log database.")}else r._pool.push(function(){return r.clean()})}},{key:"support",get:function(){return"openDatabase"in window}}]),r}(),y=function(){function o(t){if(n(this,o),!(this instanceof o))return new o(t);try{return o._checkProtocol(),new o._protocol(t)}catch(e){return new m(t)}}return i(o,null,[{key:"_initProtocol",value:function(e){(o._protocol=e).init(o._database||"logline")}},{key:"_checkProtocol",value:function(){if(!o._protocol){for(var e=Object.keys(o.PROTOCOL),t=void 0;t=o.PROTOCOL[e.shift()];)if(t.support)return void o._initProtocol(t);c("protocols "+e.join(", ").toLowerCase()+" are not supported on this platform")}}},{key:"get",value:function(e,t,i){switch(o._checkProtocol(),arguments.length){case 1:i=e,e=void 0;break;case 2:i=t,t=void 0}o._protocol.get(e,t,i)}},{key:"all",value:function(e){o.get(e)}},{key:"keep",value:function(e){return o._checkProtocol(),o._protocol.keep(e),this}},{key:"clean",value:function(){return o._checkProtocol(),o._protocol.clean(),this}},{key:"using",value:function(e,t){return-1===[v,h,T].indexOf(e)&&c("specialfied protocol "+(e?e+" ":"")+"is not available"),o._protocol||(o.database(t||o._database),o._initProtocol(e)),this}},{key:"database",value:function(e){o._database=e}},{key:"config",get:function(){return d}}]),o}();return y.PROTOCOL={INDEXEDDB:v,LOCALSTORAGE:h,WEBSQL:T},y.INTERFACE=Object.freeze(m),y.env={verbose:!0},y}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=e(),"undefined"!=typeof window&&(window.pako=e())}(function(){return function r(a,s,d){function c(t,e){if(!s[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var n=s[t]={exports:{}};a[t][0].call(n.exports,function(e){return c(a[t][1][e]||e)},n,n.exports,r,a,s,d)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<d.length;e++)c(d[e]);return c}({1:[function(e,t,i){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)n=i,r=o,Object.prototype.hasOwnProperty.call(n,r)&&(e[o]=i[o])}}var n,r;return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,o,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+o),n);else for(var r=0;r<o;r++)e[n+r]=t[i+r]},flattenChunks:function(e){var t,i,o,n,r,a;for(t=o=0,i=e.length;t<i;t++)o+=e[t].length;for(a=new Uint8Array(o),t=n=0,i=e.length;t<i;t++)r=e[t],a.set(r,n),n+=r.length;return a}},r={arraySet:function(e,t,i,o,n){for(var r=0;r<o;r++)e[n+r]=t[i+r]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(o)},{}],2:[function(e,t,i){function d(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&n))return String.fromCharCode.apply(null,c.shrinkBuf(e,t));for(var i="",o=0;o<t;o++)i+=String.fromCharCode(e[o]);return i}var c=e("./common"),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var u=new c.Buf8(256),o=0;o<256;o++)u[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;u[254]=u[254]=1,i.string2buf=function(e){var t,i,o,n,r,a=e.length,s=0;for(n=0;n<a;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(o=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(o-56320),n++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new c.Buf8(s),n=r=0;r<s;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(o=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(o-56320),n++),i<128?t[r++]=i:(i<2048?t[r++]=192|i>>>6:(i<65536?t[r++]=224|i>>>12:(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63),t[r++]=128|i>>>6&63),t[r++]=128|63&i);return t},i.buf2binstring=function(e){return d(e,e.length)},i.binstring2buf=function(e){for(var t=new c.Buf8(e.length),i=0,o=t.length;i<o;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,o,n,r,a=t||e.length,s=new Array(2*a);for(i=o=0;i<a;)if((n=e[i++])<128)s[o++]=n;else if(4<(r=u[n]))s[o++]=65533,i+=r-1;else{for(n&=2===r?31:3===r?15:7;1<r&&i<a;)n=n<<6|63&e[i++],r--;1<r?s[o++]=65533:n<65536?s[o++]=n:(n-=65536,s[o++]=55296|n>>10&1023,s[o++]=56320|1023&n)}return d(s,o)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;0<=i&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+u[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){t.exports=function(e,t,i,o){for(var n=65535&e|0,r=e>>>16&65535|0,a=0;0!==i;){for(i-=a=2e3<i?2e3:i;r=r+(n=n+t[o++]|0)|0,--a;);n%=65521,r%=65521}return n|r<<16|0}},{}],4:[function(e,t,i){var s=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,o){var n=s,r=o+i;e^=-1;for(var a=o;a<r;a++)e=e>>>8^n[255&(e^t[a])];return-1^e}},{}],5:[function(e,t,i){function d(e,t){return e.msg=S[t],t}function c(e){return(e<<1)-(4<e?9:0)}function l(e){for(var t=e.length;0<=--t;)e[t]=0}function u(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(_.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function p(e,t){k._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,u(e.strm)}function f(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function r(e,t){var i,o,n=e.max_chain_length,r=e.strstart,a=e.prev_length,s=e.nice_match,d=e.strstart>e.w_size-M?e.strstart-(e.w_size-M):0,c=e.window,u=e.w_mask,l=e.prev,p=e.strstart+K,f=c[r+a-1],m=c[r+a];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(i=t)+a]===m&&c[i+a-1]===f&&c[i]===c[r]&&c[++i]===c[r+1]){r+=2,i++;do{}while(c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&r<p);if(o=K-(p-r),r=p-K,a<o){if(e.match_start=t,s<=(a=o))break;f=c[r+a-1],m=c[r+a]}}}while((t=l[t&u])>d&&0!=--n);return a<=e.lookahead?a:e.lookahead}function g(e){var t,i,o,n,r,a,s,d,c,u,l=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-M)){for(_.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=i=e.hash_size;o=e.head[--t],e.head[t]=l<=o?o-l:0,--i;);for(t=i=l;o=e.prev[--t],e.prev[t]=l<=o?o-l:0,--i;);n+=l}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,d=e.strstart+e.lookahead,c=n,u=void 0,u=a.avail_in,c<u&&(u=c),i=0===u?0:(a.avail_in-=u,_.arraySet(s,a.input,a.next_in,u,d),1===a.state.wrap?a.adler=L(a.adler,s,u,d):2===a.state.wrap&&(a.adler=b(a.adler,s,u,d)),a.next_in+=u,a.total_in+=u,u),e.lookahead+=i,e.lookahead+e.insert>=O)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+O-1])&e.hash_mask,e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<O)););}while(e.lookahead<M&&0!==e.strm.avail_in)}function o(e,t){for(var i,o;;){if(e.lookahead<M){if(g(e),e.lookahead<M&&t===w)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=O&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-M&&(e.match_length=r(e,i)),e.match_length>=O)if(o=k._tr_tally(e,e.strstart-e.match_start,e.match_length-O),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=O){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=k._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<O-1?e.strstart:O-1,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function n(e,t){for(var i,o,n;;){if(e.lookahead<M){if(g(e),e.lookahead<M&&t===w)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=O&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=O-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-M&&(e.match_length=r(e,i),e.match_length<=5&&(1===e.strategy||e.match_length===O&&4096<e.strstart-e.match_start)&&(e.match_length=O-1)),e.prev_length>=O&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-O,o=k._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-O),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=O-1,e.strstart++,o&&(p(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=k._tr_tally(e,0,e.window[e.strstart-1]))&&p(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=k._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<O-1?e.strstart:O-1,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function a(e,t,i,o,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=o,this.func=n}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _.Buf16(2*U),this.dyn_dtree=new _.Buf16(2*(2*D+1)),this.bl_tree=new _.Buf16(2*(2*N+1)),l(this.dyn_ltree),l(this.dyn_dtree),l(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _.Buf16(P+1),this.heap=new _.Buf16(2*C+1),l(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _.Buf16(2*C+1),l(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function s(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=A,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?x:F,e.adler=2===t.wrap?0:1,t.last_flush=w,k._tr_init(t),I):d(e,E)}function h(e){var t,i=s(e);return i===I&&((t=e.state).window_size=2*t.w_size,l(t.head),t.max_lazy_match=y[t.level].max_lazy,t.good_match=y[t.level].good_length,t.nice_match=y[t.level].nice_length,t.max_chain_length=y[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=O-1,t.match_available=0,t.ins_h=0),i}function T(e,t,i,o,n,r){if(!e)return E;var a=1;if(-1===t&&(t=6),o<0?(a=0,o=-o):15<o&&(a=2,o-=16),n<1||9<n||i!==R||o<8||15<o||t<0||9<t||r<0||4<r)return d(e,E);8===o&&(o=9);var s=new v;return(e.state=s).strm=e,s.wrap=a,s.gzhead=null,s.w_bits=o,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+O-1)/O),s.window=new _.Buf8(2*s.w_size),s.head=new _.Buf16(s.hash_size),s.prev=new _.Buf16(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new _.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=r,s.method=i,h(e)}var y,_=e("../utils/common"),k=e("./trees"),L=e("./adler32"),b=e("./crc32"),S=e("./messages"),w=0,I=0,E=-2,A=2,R=8,C=286,D=30,N=19,U=2*C+1,P=15,O=3,K=258,M=K+O+1,x=42,F=113;y=[new a(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(g(e),0===e.lookahead&&t===w)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+i;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,p(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-M&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(p(e,!1),e.strm.avail_out),1)}),new a(4,4,8,4,o),new a(4,5,16,8,o),new a(4,6,32,32,o),new a(4,4,16,16,n),new a(8,16,32,32,n),new a(8,16,128,128,n),new a(8,32,128,256,n),new a(32,128,258,1024,n),new a(32,258,258,4096,n)],i.deflateInit=function(e,t){return T(e,t,R,15,8,0)},i.deflateInit2=T,i.deflateReset=h,i.deflateResetKeep=s,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?E:(e.state.gzhead=t,I):E},i.deflate=function(e,t){var i,o,n,r;if(!e||!e.state||5<t||t<0)return e?d(e,E):E;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||666===o.status&&4!==t)return d(e,0===e.avail_out?-5:E);if(o.strm=e,i=o.last_flush,o.last_flush=t,o.status===x)if(2===o.wrap)e.adler=0,f(o,31),f(o,139),f(o,8),o.gzhead?(f(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),f(o,255&o.gzhead.time),f(o,o.gzhead.time>>8&255),f(o,o.gzhead.time>>16&255),f(o,o.gzhead.time>>24&255),f(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),f(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(f(o,255&o.gzhead.extra.length),f(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=b(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(f(o,0),f(o,0),f(o,0),f(o,0),f(o,0),f(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),f(o,3),o.status=F);else{var a=R+(o.w_bits-8<<4)<<8;a|=(2<=o.strategy||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(a|=32),a+=31-a%31,o.status=F,m(o,a),0!==o.strstart&&(m(o,e.adler>>>16),m(o,65535&e.adler)),e.adler=1}if(69===o.status)if(o.gzhead.extra){for(n=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>n&&(e.adler=b(e.adler,o.pending_buf,o.pending-n,n)),u(e),n=o.pending,o.pending!==o.pending_buf_size));)f(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>n&&(e.adler=b(e.adler,o.pending_buf,o.pending-n,n)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){n=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>n&&(e.adler=b(e.adler,o.pending_buf,o.pending-n,n)),u(e),n=o.pending,o.pending===o.pending_buf_size)){r=1;break}r=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,f(o,r)}while(0!==r);o.gzhead.hcrc&&o.pending>n&&(e.adler=b(e.adler,o.pending_buf,o.pending-n,n)),0===r&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){n=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>n&&(e.adler=b(e.adler,o.pending_buf,o.pending-n,n)),u(e),n=o.pending,o.pending===o.pending_buf_size)){r=1;break}r=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,f(o,r)}while(0!==r);o.gzhead.hcrc&&o.pending>n&&(e.adler=b(e.adler,o.pending_buf,o.pending-n,n)),0===r&&(o.status=103)}else o.status=103;if(103===o.status&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&u(e),o.pending+2<=o.pending_buf_size&&(f(o,255&e.adler),f(o,e.adler>>8&255),e.adler=0,o.status=F)):o.status=F),0!==o.pending){if(u(e),0===e.avail_out)return o.last_flush=-1,I}else if(0===e.avail_in&&c(t)<=c(i)&&4!==t)return d(e,-5);if(666===o.status&&0!==e.avail_in)return d(e,-5);if(0!==e.avail_in||0!==o.lookahead||t!==w&&666!==o.status){var s=2===o.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(g(e),0===e.lookahead)){if(t===w)return 1;break}if(e.match_length=0,i=k._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(o,t):3===o.strategy?function(e,t){for(var i,o,n,r,a=e.window;;){if(e.lookahead<=K){if(g(e),e.lookahead<=K&&t===w)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=O&&0<e.strstart&&(o=a[n=e.strstart-1])===a[++n]&&o===a[++n]&&o===a[++n]){r=e.strstart+K;do{}while(o===a[++n]&&o===a[++n]&&o===a[++n]&&o===a[++n]&&o===a[++n]&&o===a[++n]&&o===a[++n]&&o===a[++n]&&n<r);e.match_length=K-(r-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=O?(i=k._tr_tally(e,1,e.match_length-O),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=k._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(o,t):y[o.level].func(o,t);if(3!==s&&4!==s||(o.status=666),1===s||3===s)return 0===e.avail_out&&(o.last_flush=-1),I;if(2===s&&(1===t?k._tr_align(o):5!==t&&(k._tr_stored_block(o,0,0,!1),3===t&&(l(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),u(e),0===e.avail_out))return o.last_flush=-1,I}return 4!==t?I:o.wrap<=0?1:(2===o.wrap?(f(o,255&e.adler),f(o,e.adler>>8&255),f(o,e.adler>>16&255),f(o,e.adler>>24&255),f(o,255&e.total_in),f(o,e.total_in>>8&255),f(o,e.total_in>>16&255),f(o,e.total_in>>24&255)):(m(o,e.adler>>>16),m(o,65535&e.adler)),u(e),0<o.wrap&&(o.wrap=-o.wrap),0!==o.pending?I:1)},i.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==x&&69!==t&&73!==t&&91!==t&&103!==t&&t!==F&&666!==t?d(e,E):(e.state=null,t===F?d(e,-3):I):E},i.deflateSetDictionary=function(e,t){var i,o,n,r,a,s,d,c,u=t.length;if(!e||!e.state)return E;if(2===(r=(i=e.state).wrap)||1===r&&i.status!==x||i.lookahead)return E;for(1===r&&(e.adler=L(e.adler,t,u,0)),i.wrap=0,u>=i.w_size&&(0===r&&(l(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new _.Buf8(i.w_size),_.arraySet(c,t,u-i.w_size,i.w_size,0),t=c,u=i.w_size),a=e.avail_in,s=e.next_in,d=e.input,e.avail_in=u,e.next_in=0,e.input=t,g(i);i.lookahead>=O;){for(o=i.strstart,n=i.lookahead-(O-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[o+O-1])&i.hash_mask,i.prev[o&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=o,o++,--n;);i.strstart=o,i.lookahead=O-1,g(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=O-1,i.match_available=0,e.next_in=s,e.input=d,e.avail_in=a,i.wrap=r,I},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":4,"./messages":6,"./trees":7}],6:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],7:[function(e,t,i){function o(e){for(var t=e.length;0<=--t;)e[t]=0}function a(e,t,i,o,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=o,this.max_length=n,this.has_stree=e&&e.length}function n(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d(e){return e<256?P[e]:P[256+(e>>>7)]}function c(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function u(e,t,i){e.bi_valid>S-i?(e.bi_buf|=t<<e.bi_valid&65535,c(e,e.bi_buf),e.bi_buf=t>>S-e.bi_valid,e.bi_valid+=i-S):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function l(e,t,i){u(e,i[2*t],i[2*t+1])}function p(e,t){for(var i=0;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1}function f(e,t,i){var o,n,r=new Array(b+1),a=0;for(o=1;o<=b;o++)r[o]=a=a+i[o-1]<<1;for(n=0;n<=t;n++){var s=e[2*n+1];0!==s&&(e[2*n]=p(r[s]++,s))}}function s(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function m(e){8<e.bi_valid?c(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function r(e,t,i,o){var n=2*t,r=2*i;return e[n]<e[r]||e[n]===e[r]&&o[t]<=o[i]}function g(e,t,i){for(var o=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&r(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!r(t,o,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=o}function v(e,t,i){var o,n,r,a,s=0;if(0!==e.last_lit)for(;o=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],n=e.pending_buf[e.l_buf+s],s++,0===o?l(e,n,t):(l(e,(r=O[n])+256+1,t),0!==(a=A[r])&&u(e,n-=K[r],a),l(e,r=d(--o),i),0!==(a=R[r])&&u(e,o-=M[r],a)),s<e.last_lit;);l(e,256,t)}function h(e,t){var i,o,n,r=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,d=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=L,i=0;i<d;i++)0!==r[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):r[2*i+1]=0;for(;e.heap_len<2;)r[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,s&&(e.static_len-=a[2*n+1]);for(t.max_code=c,i=e.heap_len>>1;1<=i;i--)g(e,r,i);for(n=d;i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=o,r[2*n]=r[2*i]+r[2*o],e.depth[n]=(e.depth[i]>=e.depth[o]?e.depth[i]:e.depth[o])+1,r[2*i+1]=r[2*o+1]=n,e.heap[1]=n++,g(e,r,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,o,n,r,a,s,d=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,m=t.stat_desc.max_length,g=0;for(r=0;r<=b;r++)e.bl_count[r]=0;for(d[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<L;i++)(r=d[2*d[2*(o=e.heap[i])+1]+1]+1)>m&&(r=m,g++),d[2*o+1]=r,c<o||(e.bl_count[r]++,a=0,f<=o&&(a=p[o-f]),s=d[2*o],e.opt_len+=s*(r+a),l&&(e.static_len+=s*(u[2*o+1]+a)));if(0!==g){do{for(r=m-1;0===e.bl_count[r];)r--;e.bl_count[r]--,e.bl_count[r+1]+=2,e.bl_count[m]--,g-=2}while(0<g);for(r=m;0!==r;r--)for(o=e.bl_count[r];0!==o;)(n=e.heap[--i])>c||(d[2*n+1]!==r&&(e.opt_len+=(r-d[2*n+1])*d[2*n],d[2*n+1]=r),o--)}}(e,t),f(r,c,e.bl_count)}function T(e,t,i){var o,n,r=-1,a=t[1],s=0,d=7,c=4;for(0===a&&(d=138,c=3),t[2*(i+1)+1]=65535,o=0;o<=i;o++)n=a,a=t[2*(o+1)+1],++s<d&&n===a||(s<c?e.bl_tree[2*n]+=s:0!==n?(n!==r&&e.bl_tree[2*n]++,e.bl_tree[2*w]++):s<=10?e.bl_tree[2*I]++:e.bl_tree[2*E]++,r=n,c=(s=0)===a?(d=138,3):n===a?(d=6,3):(d=7,4))}function y(e,t,i){var o,n,r=-1,a=t[1],s=0,d=7,c=4;for(0===a&&(d=138,c=3),o=0;o<=i;o++)if(n=a,a=t[2*(o+1)+1],!(++s<d&&n===a)){if(s<c)for(;l(e,n,e.bl_tree),0!=--s;);else 0!==n?(n!==r&&(l(e,n,e.bl_tree),s--),l(e,w,e.bl_tree),u(e,s-3,2)):s<=10?(l(e,I,e.bl_tree),u(e,s-3,3)):(l(e,E,e.bl_tree),u(e,s-11,7));r=n,c=(s=0)===a?(d=138,3):n===a?(d=6,3):(d=7,4)}}function _(e,t,i,o){var n,r,a,s;u(e,0+(o?1:0),3),r=t,a=i,s=!0,m(n=e),s&&(c(n,a),c(n,~a)),k.arraySet(n.pending_buf,n.window,r,a,n.pending),n.pending+=a}var k=e("../utils/common"),L=573,b=15,S=16,w=16,I=17,E=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=new Array(576);o(N);var U=new Array(60);o(U);var P=new Array(512);o(P);var O=new Array(256);o(O);var K=new Array(29);o(K);var M=new Array(30);o(M);var x,F,V,B=!1;i._tr_init=function(e){B||(function(){var e,t,i,o,n,r=new Array(b+1);for(o=i=0;o<28;o++)for(K[o]=i,e=0;e<1<<A[o];e++)O[i++]=o;for(O[i-1]=o,o=n=0;o<16;o++)for(M[o]=n,e=0;e<1<<R[o];e++)P[n++]=o;for(n>>=7;o<30;o++)for(M[o]=n<<7,e=0;e<1<<R[o]-7;e++)P[256+n++]=o;for(t=0;t<=b;t++)r[t]=0;for(e=0;e<=143;)N[2*e+1]=8,e++,r[8]++;for(;e<=255;)N[2*e+1]=9,e++,r[9]++;for(;e<=279;)N[2*e+1]=7,e++,r[7]++;for(;e<=287;)N[2*e+1]=8,e++,r[8]++;for(f(N,287,r),e=0;e<30;e++)U[2*e+1]=5,U[2*e]=p(e,5);x=new a(N,A,257,286,b),F=new a(U,R,0,30,b),V=new a(new Array(0),C,0,19,7)}(),B=!0),e.l_desc=new n(e.dyn_ltree,x),e.d_desc=new n(e.dyn_dtree,F),e.bl_desc=new n(e.bl_tree,V),e.bi_buf=0,e.bi_valid=0,s(e)},i._tr_stored_block=_,i._tr_flush_block=function(e,t,i,o){var n,r,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),h(e,e.l_desc),h(e,e.d_desc),a=function(e){var t;for(T(e,e.dyn_ltree,e.l_desc.max_code),T(e,e.dyn_dtree,e.d_desc.max_code),h(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*D[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=n&&(n=r)):n=r=i+5,i+4<=n&&-1!==t?_(e,t,i,o):4===e.strategy||r===n?(u(e,2+(o?1:0),3),v(e,N,U)):(u(e,4+(o?1:0),3),function(e,t,i,o){var n;for(u(e,t-257,5),u(e,i-1,5),u(e,o-4,4),n=0;n<o;n++)u(e,e.bl_tree[2*D[n]+1],3);y(e,e.dyn_ltree,t-1),y(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),v(e,e.dyn_ltree,e.dyn_dtree)),s(e),o&&m(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(O[i]+256+1)]++,e.dyn_dtree[2*d(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){var t;u(e,2,3),l(e,256,N),16===(t=e).bi_valid?(c(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":1}],8:[function(e,t,i){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/deflate.js":[function(e,t,i){function n(e){if(!(this instanceof n))return new n(e);this.options=s.assign({level:p,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==l)throw new Error(r[i]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var o;if(o="string"==typeof t.dictionary?d.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=a.deflateSetDictionary(this.strm,o))!==l)throw new Error(r[i]);this._dict_set=!0}}function o(e,t){var i=new n(t);if(i.push(e,!0),i.err)throw i.msg||r[i.err];return i.result}var a=e("./zlib/deflate"),s=e("./utils/common"),d=e("./utils/strings"),r=e("./zlib/messages"),c=e("./zlib/zstream"),u=Object.prototype.toString,l=0,p=-1,f=0,m=8;n.prototype.push=function(e,t){var i,o,n=this.strm,r=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=d.string2buf(e):"[object ArrayBuffer]"===u.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new s.Buf8(r),n.next_out=0,n.avail_out=r),1!==(i=a.deflate(n,o))&&i!==l)return this.onEnd(i),!(this.ended=!0);0!==n.avail_out&&(0!==n.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(d.buf2binstring(s.shrinkBuf(n.output,n.next_out))):this.onData(s.shrinkBuf(n.output,n.next_out)))}while((0<n.avail_in||0===n.avail_out)&&1!==i);return 4===o?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l):2!==o||(this.onEnd(l),!(n.avail_out=0))},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=n,i.deflate=o,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,o(e,t)}},{"./utils/common":1,"./utils/strings":2,"./zlib/deflate":5,"./zlib/messages":6,"./zlib/zstream":8}]},{},[])("/lib/deflate.js")});